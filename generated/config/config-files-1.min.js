game.addScene({name:"meet-dick",onScene:game=>{},sprites:[{src:ASSETS.TAVERN_GANGSTA,index:game=>{return game.sceneData.gangstaLookUp?1:0},},{src:ASSETS.BABY_HITLER_WAITER,hidden:game=>!game.sceneData.showBabyHitlerWaiter,},{src:ASSETS.TAVERN_GANGSTA,hidden:game=>!game.sceneData.showGangsta||!game.sceneData.approachGangsta,side:LEFT,index:2,},{src:ASSETS.TAVERN_GANGSTA,hidden:game=>!game.sceneData.showGangsta||!game.sceneData.approachGangsta,side:RIGHT,index:2,},],},);game.addScene({name:"mirror",onScene:game=>{game.playTheme(SOUNDS.JAIL_CELL_THEME);if(!game.data.seen.doctor){if(!game.getSituation("doctar-room").thoughtIndex){game.getSituation("doctar-room").thoughtIndex=0}else{game.getSituation("doctar-room").thoughtIndex --}
game.sceneData.thoughts=["... so here we are ...","... and to think killing Baby Hitler ...","... was the most difficult part ...","... I thought this was all behind ...","... avoiding the holocaust, spare the baby's life ...","... it all seemed too easy ...","... how foolish of me ...","... as a hitman, I never feared death ...","... I was willing to give my life for this mission ...","... and yet ...","... the thought of being erased from existence ...","... it's something different ...","... nobody will never know I ever existed ...","... it is worst than being dead ...","... being ... NOTHING ...","... no more fond memories of traveling in space with Yupa ...","... it's like those never happened ...","... my life has no meaning ...","... the world has no meaning to me ...","... and I mean nothing to the world ...","... ... ...","... goodby cruel world ...","... it was nice never knowing you ...","... I should feel sad, but yet, I feel nothing ...","... ... ...","... so how long are you going to keep listening to by bullshit? ...","... just keep playing the game already ...",].concat(new Array(100).fill("... watch me, I'm going to say the same thing over and over and bore you to death ...")).concat(["... oh my god! you're still here ...","... I ... I have nothing to say ...","... this is ... unbelievable ...","... am I stuck in some kind of loop? ...","... let's start over from the beginning ...",]);game.sceneData.thoughts=game.sceneData.thoughts.concat(game.sceneData.thoughts).concat(["... actually no, I can't ...","... I cannot believe it ...","... you broke the game ...",]).concat(Game.toString().split("{").join("♪").split("}").join("♪").split("=").join("♪").split("\n").join(" ").split(" ").map(a=>a.trim()).filter(a=>a.length).join("\n")).concat(game.sceneData.thoughts);game.currentScene.keepThinking(game)}},arrowGrid:[[null,null,null,null,null],[],[],[],[null,null,null,null,null],],customCursor:({sceneData,hoverSprite,arrow})=>arrow||!sceneData.pickedRazor?null:"none",keepThinking:game=>{const msg=game.sceneData.thoughts[game.getSituation("doctar-room").thoughtIndex];game.showTip(msg,game=>{game.currentScene.keepThinking(game)},msg.length>100?50:150,{removeLock:!0,y:64,maxLines:msg.length>100?10:2});game.getSituation("doctar-room").thoughtIndex=(game.getSituation("doctar-room").thoughtIndex+1)%game.sceneData.thoughts.length},sprites:[{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:10,offsetY:-5,},{src:ASSETS.BEARD_SHAVED,col:3,row:3,index:0,offsetX:-2,offsetY:-5,flipH:!0,onRefresh:(game,sprite)=>{if(game.mouseDown){const stock=game.imageStock[sprite.src];const ctx=stock.img.getContext("2d");ctx.globalCompositeOperation="destination-out";ctx.fillStyle="#000000";const w=64,h=64,canvas=ctx.canvas;for(let yy=0;yy<canvas.height;yy+=h){for(let xx=0;xx<canvas.width;xx+=w){ctx.fillRect(xx+Math.round(64-game.mouse.x-.5),yy+Math.round(game.mouse.y-sprite.offsetY),2,1)}}
if(!game.data.images){game.data.images={}}
game.data.images[sprite.src]=stock.img.toDataURL();if(!game.data.shaved){game.data.shaved=game.now}}},},{src:ASSETS.RAZOR,col:1,row:2,offsetX:({mouse})=>Math.round(mouse.x-16),offsetY:({mouse})=>Math.round(mouse.y),index:1,hidden:({sceneData,mouse,hoverSprite})=>!sceneData.pickedRazor||!mouse||hoverSprite&&hoverSprite.back,},{back:!0,src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:13,noHighlight:!0,onClick:game=>{if(game.sceneData.pickedRazor){game.sceneData.pickedRazor=0}else{game.gotoScene("doctar-room");game.sceneData.from=null;game.sceneData.to="mirror";game.sceneData.toReach=null}},},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:15,hidden:({sceneData})=>sceneData.pickedRazor,onClick:({sceneData,now})=>sceneData.pickedRazor=now,},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:12,},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,offsetY:3,index:14,},{src:ASSETS.RAZOR,col:1,row:2,offsetX:({mouse})=>Math.round(mouse.x-16),offsetY:({mouse})=>Math.round(mouse.y),index:0,hidden:({sceneData,mouse,hoverSprite})=>!sceneData.pickedRazor||!mouse||!hoverSprite||!hoverSprite.back,},...standardMenu(),...standardBag(),],},);game.addScene({name:"money-shot",onScene:game=>{game.hideCursor=!0;game.playSound(SOUNDS.GOOD_BAD_UGLIZ);game.delayAction(game=>{game.gotoScene("crowd")},6000)},sprites:[{src:ASSETS.MONEY_SHOT,},{src:ASSETS.BEARD_SHAVED,col:3,row:3,scale:.7,offsetY:-5,offsetX:30,},{src:ASSETS.MONEY_SHOT,index:1,alpha:game=>(Math.sin(game.now/200)+1)/2,},{src:ASSETS.MONEY_SHOT,index:2,alpha:game=>(Math.sin(game.now/200+Math.PI*2/3)+1)/2,},{src:ASSETS.MONEY_SHOT,index:3,alpha:game=>(Math.sin(game.now/200+Math.PI*4/3)+1)/2,},],},);game.addScene({name:"monster-in-space",onScene:game=>{game.hideCursor=!0},startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"){x=7;y=58;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=22;game.playSound(SOUNDS.YUPA)}
game.showTip(msg,onDone,100,{x,y,talker,removeLock})},sprites:[{init:(game,sprite)=>{game.playTheme(SOUNDS.SOUP_CHOU_THEME,{volume:.7});const{sceneData}=game;sceneData.stars=new Array(100).fill(null).map(()=>{return{x:(Math.random()-.5)*64,y:(Math.random()-.5)*64,size:.2,}});for(let i=0;i<100;i++){sprite.onRefresh(game,sprite)}
if(game.data.shot.shopkeepa){game.delayAction(game=>{game.currentScene.startTalk(game,"yupa",[`So, ~${game.data.name||"Hitman"}~...`,"You know that shopkeepa that ya shot?",],game=>{game.currentScene.startTalk(game,"human",["Yes, so what?",],game=>{game.currentScene.startTalk(game,"yupa",["Not sure if we shoulda trust her with\nconfiguring\nda warp drive.",],game=>{game.currentScene.startTalk(game,"human",["Why not?",],game=>{game.currentScene.startTalk(game,"yupa",["Cause she could send uz wrang diraxian...",],game=>{game.currentScene.startTalk(game,"human",["What? Couldn't you tell this to me earlier?!",],game=>{game.sceneData.toPlanet=game.now;game.playTheme(SOUNDS.GOGOL)})})})})})})},5000)}else{game.delayAction(game=>{game.currentScene.startTalk(game,"yupa",[`So, ~${game.data.name||"Hitman"}~...`,"I hope ya know what ya duing.",],game=>{game.currentScene.startTalk(game,"human",["Hum, not really. Why?",],game=>{game.currentScene.startTalk(game,"yupa",["Welz... I dun really understand how da warp drave worx...","but I knaw if ya configure it badly,","wee culd go wrang diraxion...",],game=>{game.currentScene.startTalk(game,"human",["Well, we should be ok, right?","The shopkeeper configured it for us.",],game=>{game.currentScene.startTalk(game,"yupa",["Ya, but she waz nat happy duin it,","with us stealin da warp drave and all...",],game=>{game.currentScene.startTalk(game,"human",["So... what do you suggest she might have done?...",],game=>{game.sceneData.toPlanet=game.now;game.playTheme(SOUNDS.GOGOL)})})})})})})},5000)}},onRefresh:(game,sprite)=>{const{sceneData,now,sceneTime}=game;sceneData.stars.forEach(star=>{star.x*=1.01;star.y*=1.01;star.size*=1.01;if(star.size>1){star.size=1}
if(Math.abs(star.x)>32||Math.abs(star.y)>32){star.x=(Math.random()-.5)*64;star.y=(Math.random()-.5)*64;star.size=.2}})},custom:(game,sprite,ctx)=>{ctx.fillStyle="#000022";ctx.fillRect(0,0,64,64);ctx.fillStyle="#FFFFFF";const{sceneData}=game;sceneData.stars.forEach(({x,y,size})=>{ctx.fillRect(32+x,32+y,size,size)})},hidden:({sceneData})=>!sceneData.stars,},{src:ASSETS.MONSTER_PLANET,col:3,row:3,scale:game=>{if(!game.sceneData.toPlanet){return 0}
const timeProgress=Math.min(1,(Math.max(0,game.now-game.sceneData.toPlanet)/5000));return timeProgress*timeProgress},index:game=>{const timeProgress=Math.floor((game.now-game.sceneData.toPlanet-4000)/200);if(timeProgress<20){return Math.min(Math.max(0,timeProgress),6)}else{return Math.max(0,6-(timeProgress-20))}},offsetX:(game,sprite)=>32-game.evaluate(sprite.scale)*32,offsetY:(game,sprite)=>32-game.evaluate(sprite.scale)*32,hidden:(game,sprite)=>!game.evaluate(sprite.scale),onRefresh:game=>{const timeProgress=Math.floor((game.now-game.sceneData.toPlanet-4000)/200);if(timeProgress>30&&!game.sceneData.gameOver){game.sceneData.gameOver=game.now;game.playTheme(null);game.gameOver(" “Don't fack with\n       alien lady!”")}},},{src:ASSETS.SPACESHIP,col:1,row:2,scale:game=>{if(!game.sceneData.toPlanet){return 1}
const timeProgress=Math.max(0,1-(Math.max(0,game.now-game.sceneData.toPlanet-5000)/3000));return timeProgress*timeProgress},offsetX:(game,sprite)=>10+20-game.evaluate(sprite.scale)*20,offsetY:(game,sprite)=>10+20-game.evaluate(sprite.scale)*20,hidden:(game,sprite)=>!game.evaluate(sprite.scale),},...standardMenu(),...standardBag(),],},);game.addScene({name:"morning-after",onScene:game=>{game.playTheme(SOUNDS.SOFT_THEME,{volume:.8});game.hideCursor=!0;game.sceneData.sceneDuration=55000;game.sceneData.fadeTime=game.sceneData.sceneDuration/8;game.delayAction(game=>{game.showTip(["The morning after ...","As I contemplate the vast universe ...",],game=>{game.sceneData.vanishTime=game.now;game.showTip(["I can feel my soul slowly vanish from existence ...","I will soon be gone ...","And nobody will know that I ever existed ...","I will leave no trace in this world ...","and yet ...","something tells me that this time, perhaps ...","some part of me would remain ...","Good bye, Amari. Good bye, Yupa ...","You were the best part of my life ...",],game=>{game.fadeToScene("9-months",null,5000)},100,{y:16,maxLines:2})},100,{y:16,maxLines:2})},6000)},onSceneRefresh:game=>{if(game.now-game.sceneTime<=10000){game.fade=Math.min(1,1-(game.now-game.sceneTime)/5000)}},sprites:[{src:ASSETS.EVENING_DATE,col:3,row:3,index:8,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},{src:ASSETS.EVENING_DATE,col:3,row:3,index:7,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},{src:ASSETS.EVENING_DATE,col:3,row:3,index:6,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},{src:ASSETS.EVENING_DATE,col:3,row:3,index:5,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},{src:ASSETS.EVENING_DATE,col:3,row:3,index:4,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},{src:ASSETS.EVENING_DATE,col:3,row:3,index:3,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},{src:ASSETS.EVENING_DATE,col:3,row:3,index:2,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},{src:ASSETS.EVENING_DATE,col:3,row:3,index:1,alpha:(game,{index})=>{const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return Math.max(0,1-(time/fadeTime))},hidden:(game,{index})=>{if(!game.sceneData.vanishTime){return!1}
const fadeTime=game.sceneData.fadeTime;const time=game.now-game.sceneData.vanishTime-fadeTime*(index-1);return 0>=1-(time/fadeTime)},},],},);game.addScene({name:"name-screen",onScene:game=>{game.sceneData.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";if(!game.data.name){game.data.name="Hitman"}
game.startDialog({time:game.now,index:0,highlightColor:"#00998899",conversation:[{options:[{},{hidden:game=>(game.data.name||"")==="",msg:"Backspace",onSelect:(game,dialog)=>game.data.name=game.data.name.substring(0,game.data.name.length-1),},{hidden:game=>(game.data.name||"")==="",msg:"Confirm",onSelect:(game,dialog)=>{game.gotoScene(game.sceneData.returnScene,null,!0);if(game.currentScene.onDialog){game.currentScene.onDialog(game);game.playSound(SOUNDS.HUM);game.showTip([`It's me, your friend ~${game.data.name}~.`,"Remember? We travel in space together, with Baby Hitler!",],onDone=>{game.playSound(SOUNDS.YUPA);dialog.speaking=!0;game.showTip("I been in few paralol universe. I canot rememba evry face!",game=>{game.showTip("I should find something to help him rememba me.")},null,{x:1,y:15,speed:80,talker:"yupa"})})}}},],}],})},customCursor:game=>{const{mouse}=game;if(mouse){const x=Math.floor(mouse.x/6),y=Math.floor(mouse.y/7);const index=x+y*10-30;if(x<10&&index>=0&&index<=36){return"none"}}},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#333344",ctx.fillRect(0,0,64,64)},onClick:game=>{const{mouse}=game;if(mouse&&!game.sceneData.waitCursor){const x=Math.floor(mouse.x/6),y=Math.floor(mouse.y/7);const index=x+y*10-30;if(x<10&&index>=0&&index<=36&&game.sceneData.nameSize<38){const name=(game.data.name||"");game.data.name=name+game.sceneData.alphabet[index];if(game.data.name===" "){game.data.name=""}
game.data.name=game.data.name.split(" ").map(text=>text.charAt(0)+text.substr(1).toLowerCase()).join(" ");game.sceneData.waitCursor=!0}}},},{src:ASSETS.HITMAN_WALK,size:[16,21],},{src:ASSETS.HITMAN_BEARD_WALK,size:[16,21],},{custom:(game,sprite,ctx)=>{const alphaSprite={src:ASSETS.ALPHABET,size:[10,11],col:10,row:7,};game.displayTextLine(ctx,{msg:"Your name?",x:17,y:1});ctx.strokeStyle="#cccccc";ctx.fillStyle="#000000";ctx.lineWidth=1;ctx.beginPath();ctx.rect(17.5,8.5,45,8);ctx.stroke();ctx.fillRect(17.5,8.5,45,8);const{mouse}=game;for(let row=0;row<7;row++){for(let col=0;col<10;col++){const index=row*10+col;if(index<=36){ctx.fillStyle=(col+row)%2===0?"#222222":"#111111";const x=col*6+2,y=22+row*7;ctx.fillRect(x,y,5,6);if(index<36){alphaSprite.index=row*10+col;alphaSprite.offsetX=x;alphaSprite.offsetY=y;game.displayImage(ctx,alphaSprite)}}}}
if(mouse){const x=Math.floor(mouse.x/6),y=Math.floor(mouse.y/7);const index=x+y*10-30;if(x<10&&index>=0&&index<=36){ctx.beginPath();const offX=1.5,offY=.5;ctx.rect(Math.floor(mouse.x/6)*6+offX-1,Math.floor(mouse.y/7)*7+offY-1,8,9);ctx.rect(Math.floor(mouse.x/6)*6+offX-2,Math.floor(mouse.y/7)*7+offY-2,10,11);ctx.stroke();ctx.strokeStyle="#000000";ctx.beginPath();ctx.rect(Math.floor(mouse.x/6)*6+offX,Math.floor(mouse.y/7)*7+offY,6,7);ctx.stroke()}}
const blink=!game.sceneData.waitCursor&&game.sceneData.nameSize<38&&game.now%1000<500;const name=(game.data.name||"");const nameSize=game.displayTextLine(ctx,{msg:`${name}${blink? "_":""}`,x:19,y:10});if(!blink){game.sceneData.nameSize=nameSize;game.sceneData.waitCursor=!1}},},],},);game.addScene({name:"origin",onScene:game=>{game.playTheme(SOUNDS.F1,{volume:.2});game.sceneData.credits=`
				I'm a\nprofessional hitman.

				In ~${game.babyHitlerYear()}~, I was sent on a mission to undo the holocaust.

				by travelling back in time to 1889, in order to kill\nBaby Hitler.

				I failed that mission.

				I was not capable of shooting the baby.

				However, an alien named Yupa, appeared out of nowhere.

				Together, we kidnapped Baby Hitler and took him on a spaceship.

				We travelled the universe ever since.

				That is the last thing I remember.

			`.split("\n").map((a,index)=>game.wordwrap(a.trim(),9)).join("\n").split("\n");game.delayAction(game=>{game.gotoScene("jail-cell")},80000);game.hideCursor=!0;game.delayAction(game=>{game.hideCursor=!0},70000)},onSceneRefresh:game=>{const threshold=3000;if(game.hideCursor&&game.now-game.lastMouseMove<threshold){if(game.now-game.sceneTime<70000){game.hideCursor=!1}}else if(!game.hideCursor&&game.now-game.lastMouseMove>=threshold){game.hideCursor=!0}},sprites:[{custom:(game,sprite,ctx)=>{ctx.clearRect(0,0,64,64)},},{src:ASSETS.ORIGIN_STORY,index:3,fadeTime:75000,alpha:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))},hidden:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))<=0},},{src:ASSETS.ORIGIN_STORY,index:2,fadeTime:55000,alpha:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))},hidden:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))<=0},},{src:ASSETS.ORIGIN_STORY,index:1,fadeTime:38000,alpha:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))},hidden:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))<=0},},{src:ASSETS.ORIGIN_STORY,index:0,fadeTime:22000,alpha:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))},hidden:({now,sceneTime},{fadeTime})=>{return Math.min(1,Math.max(0,1-((now-sceneTime-fadeTime)/3000)))<=0},},{custom:(game,sprite,ctx)=>{if(game.now-game.sceneTime){ctx.fillStyle="#000000";ctx.globalAlpha=Math.min(.6,(game.now-game.sceneTime)/5000);ctx.fillRect(0,0,64,64)}
ctx.globalAlpha=.8;const shift=-(game.now-game.sceneTime-2000)/200+50;game.sceneData.credits.forEach((line,index)=>{const y=index*7+shift;if(y>0&&y<55){game.displayTextLine(ctx,{msg:line,x:10,y:Math.round(y),alpha:Math.max(0.05,Math.min(.8,y/5,(55-y)/5)),})}})},},{src:ASSETS.NEXT_SCENE,hidden:game=>game.hideCursor||game.waitCursor,onClick:game=>game.fadeToScene("jail-cell",null,3000),alpha:.5,offsetX:3,offsetY:3,},{custom:(game,sprite,ctx)=>{game.displayTextLine(ctx,{msg:"skip",x:50,y:47,})},hidden:game=>!game.hoverSprite||game.hoverSprite.src!==ASSETS.NEXT_SCENE,},],},);game.addScene({name:"outside-carnage",onScene:game=>{game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.8});game.sceneData.hitman={pos:{x:64/2,y:12,},goal:{x:64/2,y:32,},visible:!0,speed:1/6,direction:4,anim:[[12,13,14,15],[16,17,18,19],[24,25,26,27],[4,5,6,7],[0,1,2,3],[8,9,10,11],[28,29,30,31],[20,21,22,23],],};game.sceneData.yupa={pos:{x:64/2,y:12,},visible:!1,speed:1/6,dist:20,moving:!1,}},onSceneRefresh:game=>{const{pos,goal,speed}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;if(Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1){const dist=Math.sqrt(dx*dx+dy*dy);pos.x+=dx*Math.min(Math.abs(pos.x-goal.x),speed/dist);pos.y+=dy*Math.min(Math.abs(pos.y-goal.y),speed/dist);if(pos.y>=80&&!game.waitCursor){game.waitCursor=!0}}else{pos.x=goal.x;pos.y=goal.y;if(pos.y>=120&&!game.fade){game.fadeToScene("landscape")}}
const{yupa,hitman}=game.sceneData;if(hitman&&yupa){const dx=hitman.pos.x-yupa.pos.x;const dy=hitman.pos.y-yupa.pos.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>yupa.dist){yupa.pos.x+=dx/dist*yupa.speed;yupa.pos.y+=dy/dist*yupa.speed;yupa.moving=!0}else{yupa.moving=!1}}},arrowGrid:[[null,null,MENU,null,null],[],[],[],[null,null,BAG,null,null],],sprites:[{src:ASSETS.OUTSIDE_BG,noHighlight:game=>game.mouse.y<55,onClick:game=>{const{pos,goal}=game.sceneData.hitman;game.sceneData.frames.length=0;game.sceneData.hitman.visible=!0;game.sceneData.hitman.speed=1/4;if(game.mouseDown){if(game.mouse.y>55){goal.x=Math.round(game.mouse.x);goal.y=120}else{goal.x=Math.round(game.mouse.x);goal.y=Math.round(game.mouse.y)}}},},{onScene:game=>{game.waitCursor=!0;game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.7});const frames=[[0,20],[1,8,game=>{game.sceneData.hitman.visible=!1;game.waitCursor=!1}],[2,8],[3,1],[4,8],[5,5,game=>{game.sceneData.hitman.visible=!0;game.sceneData.hitman.speed=1/4}],];for(let i=1;i<frames.length;i++){frames[i][1]+=frames[i-1][1]}
game.sceneData.frames=frames},onRefresh:game=>{if(game.data.gameOver){game.fade=Math.min(.7,Math.max(0,(game.now-game.data.gameOver)/1000))}
if(game.sceneData.frames){const frame=Math.floor((game.now-game.sceneTime)/100);for(let index=0;index<game.sceneData.frames.length;index++){if(frame<game.sceneData.frames[index][1]){if(game.sceneData.frames[index][2]&&!game.sceneData.frames[index][3]){const fun=game.sceneData.frames[index][2];fun(game);game.sceneData.frames[index][3]=!0}
break}}}},src:ASSETS.OUTSIDE_CARNAGE,col:3,row:4,index:game=>{if(game.sceneData.hitman.visible){return 0}
const frame=Math.floor((game.now-game.sceneTime)/100);for(let index=0;index<game.sceneData.frames.length-1;index++){if(frame<game.sceneData.frames[index][1]){return index}}
return game.sceneData.frames.length-1},},{src:ASSETS.YUPA_WALK,size:[16,32],col:3,row:2,offsetX:({sceneData})=>Math.round(sceneData.yupa.pos.x-8),offsetY:({sceneData})=>Math.round(sceneData.yupa.pos.y-32),index:game=>game.sceneData.yupa.moving?Math.floor(game.now/100)%4:0,hidden:game=>!game.sceneData.hitman.visible,},{src:ASSETS.HITMAN_WALK,size:[16,32],col:6,row:6,offsetX:({sceneData})=>sceneData.hitman.pos.x-8,offsetY:({sceneData})=>sceneData.hitman.pos.y-32,index:game=>{const{pos,goal,anim}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},hidden:game=>!game.sceneData.hitman.visible,},{offsetX:({sceneData})=>sceneData.hitman.pos.x-8,offsetY:({sceneData})=>sceneData.hitman.pos.y-32,src:ASSETS.HITMAN_BEARD_WALK,size:[16,32],col:6,row:6,index:game=>{const{pos,goal,anim}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},hidden:game=>!game.sceneData.hitman.visible,},...standardMenu(),...standardBag(),],},);game.addScene({name:"outside",sprites:[{src:ASSETS.OUTSIDE_BG,},{offsetY:game=>Math.round((game.now-game.sceneTime)/100)-20,offsetX:(64-16)/2,src:ASSETS.HITMAN_WALK,size:[16,32],col:6,row:6,index:game=>Math.floor(game.now/100)%4,hidden:game=>game.now-game.sceneTime>=2000,},{offsetY:game=>Math.round((game.now-game.sceneTime)/100)-20,offsetX:(64-16)/2,src:ASSETS.HITMAN_BEARD_WALK,size:[16,32],col:6,row:6,index:game=>Math.floor(game.now/100)%4,hidden:game=>game.now-game.sceneTime>=2000,},{onScene:game=>{game.hideCursor=!0;game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.8});const frames=[[0,20],[0,8],[1,8],[2,1],[3,8],[4,5],[5,10],[6,2],[7,8],[8,10,game=>{game.playSound(SOUNDS.GUN_SHOT);game.delayAction(game=>game.playSound(SOUNDS.GUN_SHOT),50);game.delayAction(game=>game.playSound(SOUNDS.GUN_SHOT),100)}],[9,1,game=>{game.delayAction(game=>{game.hideCursor=!1;game.gameOver(" “Discretion\n   ain't my forte.”")},3000)}],];for(let i=1;i<frames.length;i++){frames[i][1]+=frames[i-1][1]}
game.sceneData.frames=frames},onRefresh:game=>{if(game.data.gameOver){game.fade=Math.min(.7,Math.max(0,(game.now-game.data.gameOver)/1000))}
if(game.sceneData.frames){const frame=Math.floor((game.now-game.sceneTime)/100);for(let index=0;index<game.sceneData.frames.length;index++){if(frame<game.sceneData.frames[index][1]){if(game.sceneData.frames[index][2]&&!game.sceneData.frames[index][3]){const fun=game.sceneData.frames[index][2];fun(game);game.sceneData.frames[index][3]=!0}
break}}}},src:ASSETS.OUTSIDE,col:3,row:4,index:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);for(let index=0;index<game.sceneData.frames.length-1;index++){if(frame<game.sceneData.frames[index][1]){return index}}
return game.sceneData.frames.length-1},},],},);game.addScene({name:"panic-exit",onScene:game=>{game.hideCursor=!0;game.playTheme(null)},onSceneRefresh:game=>{if(!game.sceneData.lastCrowd||game.now-game.sceneData.lastCrowd>1000){game.playSound(SOUNDS.RANDOM,{volume:.15});game.sceneData.lastCrowd=game.now+Math.random()*1000+500}},sprites:[{src:ASSETS.PANIC_EXIT_BACKGROUND,index:game=>Math.min(Math.max(0,Math.floor((game.now-game.sceneTime-3000)/100)),5),},{src:ASSETS.PANIC_EXIT_YUPA,index:game=>game.pendingTip&&game.pendingTip.progress<1?Math.floor(game.now/100)%5:0,init:game=>{game.playSound(SOUNDS.YUPA);game.showTip([`${game.data.name || "Hitman"}!`,"Da rest of da gang is caming!","Gat reddy for a big faight!",],game=>{game.gotoScene("bring-it-on")})},},...new Array(50).fill(null).map((dummy,idx)=>{const runTime=idx*200;const runner_index=Math.floor(Math.random()*12);return{src:ASSETS[`PANIC_EXIT_RUNNER_${runner_index}`],index:(game,sprite)=>{const frame=Math.floor((game.now-(runTime+game.sceneTime))/80);return frame},hidden:game=>{const frame=Math.floor((game.now-(runTime+game.sceneTime))/80);return frame<0||frame>5},}}),],},);game.addScene({name:"poor-hitman",onScene:game=>{game.hideCursor=!0;game.showTip(["What a surprise, how thoughtful of you!","You really do care about me after all.."],game=>{game.gotoScene("guards-laughing")})},sprites:[{src:ASSETS.POOR_HITMAN_BACK,},{src:ASSETS.POOR_HITMAN,index:({pendingTip,now})=>pendingTip&&pendingTip.progress<1?Math.floor(now/150)%4:0,},{src:ASSETS.POOR_HITMAN_GUARD,index:game=>Math.floor((game.now-game.sceneTime)/200)%4,},],},);game.addScene({name:"robot-dial",onScene:game=>{game.sceneData.digitDown=[];game.sceneData.password=""},onDial:(game,sprite)=>{const PASSWORD="707-8008";const digit=sprite.index%10;game.sceneData.digitDown[digit]=game.now;if(game.sceneData.password.length===3){game.sceneData.password+="-"}
game.sceneData.password+=digit;if(game.sceneData.password.length===8){game.waitCursor=!0;if(game.sceneData.password===PASSWORD){game.playSound(SOUNDS.JINGLE);game.situation.gotPassword=game.now;game.delayAction(game=>{game.gotoScene("tavern-entrance");game.currentScene.openDoor(game)},3000)}else{game.playErrorSound();game.delayAction(game=>{game.sceneData.password="";game.waitCursor=!1},1000)}
return}
game.playSound(SOUNDS.BEEP)},sprites:[{noHighlight:!0,custom:(game,sprite,ctx)=>{ctx.fillStyle="black";ctx.fillRect(0,0,64,64)},onClick:game=>{game.gotoScene("tavern-entrance-zoom")},},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:0,},{custom:(game,sprite,ctx)=>{game.displayTextLine(ctx,{msg:game.sceneData.password,x:14,y:12,dark:!0,alpha:.8})},hidden:game=>game.sceneData.password.length===8&&Math.floor(game.now/200)%2===0,},{custom:(game,sprite,ctx)=>{game.displayTextLine(ctx,{msg:game.sceneData.password,x:14,y:11,dark:!1,alpha:.8})},hidden:game=>game.sceneData.password.length===8&&Math.floor(game.now/200)%2===0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:1,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:2,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:3,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:4,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:5,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:6,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:7,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:8,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:9,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},{src:ASSETS.ROBOT_DIAL,col:3,row:4,index:10,onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[index%10]<100?1:0,},],},);game.addScene({name:"sarlie-planet-world",arrowGrid:[[null,null,MENU,null,null],[],[],[],[null,null,BAG,null,null],],onSceneHoldItem:(game,item)=>{game.save();if(item==="gun"){game.useItem=null;game.showTip(["This place is so peaceful","Let's not stir any trouble here."],null,80,{removeLock:!0})}},onScene:game=>{game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.8});if(!game.situation.hitman){game.situation.hitman={pos:{x:0,y:42,},goal:{x:0,y:42,sprite:null},visible:!0,speed:1/6,direction:4,anim:[[12,13,14,15],[16,17,18,19],[24,25,26,27],[4,5,6,7],[0,1,2,3],[8,9,10,11],[28,29,30,31],[20,21,22,23],],}}else{game.situation.hitman.goal.y=42}
if(!game.situation.yupa){game.situation.yupa={pos:{x:0,y:42,},goal:{x:0,y:42,},visible:!1,speed:1/6,dist:20,moving:!1,}}
if(!game.situation.shift){game.situation.shift=0}
game.sceneData.zoom=.7;if(game.sceneData.fromDoctor){game.situation.hitman.pos.x=120;game.situation.hitman.goal.x=120;game.situation.yupa.pos.x=125;game.situation.yupa.goal.x=125}
game.situation.hitman.visible=!0},onSceneRefresh:game=>{const{pos,goal,speed}=game.situation.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;if(Math.abs(pos.x-goal.x)-Math.abs(pos.y-goal.y)>1){pos.x+=dx*Math.min(Math.abs(pos.x-goal.x),speed)}else if(Math.abs(pos.y-goal.y)-Math.abs(pos.x-goal.x)>1){pos.y+=dy*Math.min(Math.abs(pos.y-goal.y),speed)}else if(Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1){const dist=Math.sqrt(dx*dx+dy*dy);pos.x+=dx*Math.min(Math.abs(pos.x-goal.x),speed/dist);pos.y+=dy*Math.min(Math.abs(pos.y-goal.y),speed/dist)}else{pos.x=goal.x;pos.y=goal.y;if(goal.sprite&&goal.sprite.onReach){goal.sprite.onReach(game,goal.sprite)}
goal.sprite=null}
const{yupa,hitman}=game.situation;if(hitman&&yupa){const dx=hitman.pos.x-yupa.pos.x;const dy=hitman.pos.y-yupa.pos.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>yupa.dist){yupa.pos.x+=dx/dist*yupa.speed;yupa.pos.y=42,yupa.moving=!0}else{yupa.moving=!1}
const shiftDiff=Math.round(hitman.pos.x+game.situation.shift);game.situation.shift=Math.min(0,Math.max(-64,game.situation.shift+(-hitman.pos.x+32-game.situation.shift)/50))}},arrowGrid:[[null,null,MENU,null,null],[],[],[],[null,null,BAG,null,null],],sprites:[{src:ASSETS.SARLIE_PLANET_BG,noHighlight:game=>game.mouse.y<55,onClick:game=>{const{pos,goal}=game.situation.hitman;game.situation.hitman.visible=!0;game.situation.hitman.speed=1/4;if(game.mouseDown){goal.x=Math.round(game.mouse.x)-Math.round(game.situation.shift);goal.y=42;goal.sprite=null}},scale:game=>game.sceneData.zoom/.7,},{src:ASSETS.SARLIE_SHOP,size:[128,64],offsetX:game=>Math.round(game.situation.shift),onClick:(game,sprite)=>{const{pos,goal}=game.situation.hitman;goal.x=26;goal.y=37;goal.sprite=sprite},scale:game=>game.sceneData.zoom/.7,onReach:game=>{if(game.data.seen.doctor){game.situation.hitman.visible=!1;game.fadeToScene("shop",{door:1})}else{game.showTip(["The door is locked.","There's a sign but I can't read it."],null,null,{removeLock:!0})}},},{src:ASSETS.SARLIE_HOSPITAL,size:[128,64],offsetX:game=>Math.round(game.situation.shift),onClick:(game,sprite)=>{const{pos,goal}=game.situation.hitman;goal.x=135;goal.y=42;goal.sprite=sprite;game.situation.yupa.goal.x=135},scale:game=>game.sceneData.zoom/.7,onReach:game=>{if(game.data.seen.doctor){game.fadeToScene("doctar-room",null,1000)}else{game.fadeToScene("doctar",null,3000)}},},{src:ASSETS.SARLIE_PLANET_WORLD,size:[128,64],offsetX:game=>Math.round(game.situation.shift),scale:game=>game.sceneData.zoom/.7,},{src:ASSETS.SHOP_DOOR,size:[128,64],offsetX:game=>Math.round(game.situation.shift),scale:game=>game.sceneData.zoom/.7,hidden:game=>game.data.seen.doctor,},{src:ASSETS.PEDRO,hidden:game=>!game.data.seen.doctor,offsetX:game=>Math.round(game.situation.shift+50),scale:game=>game.sceneData.zoom,onClick:(game,sprite)=>{const{pos,goal}=game.situation.hitman;goal.x=65;goal.y=40;goal.sprite=sprite},combine:(item,game)=>{game.useItem=null;const{pos,goal}=game.situation.hitman;goal.x=65;goal.y=40;goal.sprite=sprite},onReach:(game,sprite)=>{game.sceneData.zoomOnPedro=game.now;const pedroSpeed=40;game.delayAction(game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{hidden:game=>game.situation.gaveTicket,msg:game=>"Hello",onSelect:(game,dialog)=>{game.showTip(["Halo ma friend","You like party?","I got party for u","Come to Party!","Free ride for first timers!"],game=>{dialog.index=1},pedroSpeed,{talker:"pedro"})},},{hidden:game=>!game.situation.gaveTicket,msg:game=>"Go to the party!",onSelect:(game,dialog)=>{if(!game.getSituation("shopkeepa").askedWhereInSpace){game.showTip(["Yeah we can go party!","But give me some time, I need to prepare",],null,pedroSpeed,{talker:"pedro"})}else{game.showTip(["Alright ma friend","Ya we can go to the party.","Show me those tickets!"],null,pedroSpeed,{talker:"pedro"})}},},{msg:"LEAVE",onSelect:game=>{game.sceneData.zoomOnPedro=0;game.dialog=null;game.situation.hitman.goal.y=42},},],},{options:[{hidden:game=>game.sceneData.describedParty,msg:game=>game.sceneData.describedParty?"Party where?":"Party?",onSelect:(game,dialog)=>{game.showTip(game.sceneData.describedParty?"Party in Ecsta city!":["Party in Ecsta City","The city where party never stops!","I'll take you there for free.","First time is always free.",],game=>{game.sceneData.describedParty=!0},pedroSpeed,{talker:"pedro"})},},{msg:game=>"Sure!",onSelect:(game,dialog)=>{game.situation.gaveTicket=game.now;game.showTip(["Alright ma friend","Here are the tickets.",],game=>{game.pickUp({item:"ticket",count:2,image:ASSETS.GRAB_TICKETS,onPicked:game=>{game.showTip(["Come back and lemme know when ya want to go","Until then, let see more people wanna join.",],game=>{game.dialog=null;game.sceneData.zoomOnPedro=0;game.situation.hitman.goal.y=42},pedroSpeed,{talker:"pedro"})}})},pedroSpeed,{talker:"pedro"})},},{msg:game=>"No thanks.",onSelect:(game,dialog)=>{game.showTip(["Com'on ma friend","You dunt like party?","Haha... whadda party pooper!"],game=>{game.dialog=null;game.sceneData.zoomOnPedro=0;game.situation.hitman.goal.y=42},pedroSpeed,{talker:"pedro"})},},],}],})},50)},},{src:ASSETS.HITMAN_WALK,size:[16,32],col:6,row:6,offsetX:(game,{scale})=>Math.round(game.situation.hitman.pos.x-8*game.evaluate(scale))+Math.round(game.situation.shift),offsetY:(game,{scale})=>Math.round(game.situation.hitman.pos.y-32*game.evaluate(scale)),index:game=>{const{pos,goal,anim}=game.situation.hitman;let dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;let dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;if(Math.abs(pos.x-goal.x)>Math.abs(pos.y-goal.y)+1){dy=0}else if(Math.abs(pos.y-goal.y)>Math.abs(pos.x-goal.x)+1){dx=0}
const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},scale:game=>game.sceneData.zoom,hidden:game=>!game.situation.hitman.visible,},{offsetX:(game,{scale})=>Math.round(game.situation.hitman.pos.x-8*game.evaluate(scale))+Math.round(game.situation.shift),offsetY:(game,{scale})=>Math.round(game.situation.hitman.pos.y-32*game.evaluate(scale)),src:ASSETS.HITMAN_BEARD_WALK,size:[16,32],col:6,row:6,index:game=>{const{pos,goal,anim}=game.situation.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},scale:game=>game.sceneData.zoom,hidden:game=>game.data.shaved||!game.situation.hitman.visible,},{offsetX:(game,{scale})=>{const{pos,goal}=game.situation.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;if(dy===0){if(dx<0){return Math.round(pos.x-105*game.evaluate(scale))+Math.round(game.situation.shift)}else if(dx>0){return Math.round(pos.x-20*game.evaluate(scale))+Math.round(game.situation.shift)}}
return Math.round(pos.x-35*game.evaluate(scale))+Math.round(game.situation.shift)+(dx<0?-4:dx>0?5:0)*game.evaluate(scale)},offsetY:(game,{scale})=>{const{pos,goal,anim}=game.situation.hitman;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;return Math.round(game.situation.hitman.pos.y-80*game.evaluate(scale))+(moving?Math.floor(game.now/100)%2:0)},src:ASSETS.BEARD_SHAVED,scale:game=>game.sceneData.zoom*.5,side:game=>{const{pos,goal}=game.situation.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;return dy>0?null:dx<0?RIGHT:dx>0?LEFT:null},hidden:game=>{if(!game.situation.hitman.visible){return!0}
if(!game.data.shaved){return!0}
const{pos,goal,anim}=game.situation.hitman;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;return dy<0},},{src:ASSETS.YUPA_WALK,size:[16,32],col:3,row:2,offsetX:(game,{scale})=>Math.round(game.situation.yupa.pos.x-8*game.evaluate(scale))+Math.round(game.situation.shift),offsetY:(game,{scale})=>Math.round(game.situation.yupa.pos.y-30*game.evaluate(scale)),index:game=>game.situation.yupa.moving?Math.floor(game.now/100)%4:0,scale:game=>game.sceneData.zoom,onClick:game=>{game.sceneData.zoomYupa=game.now;game.delayAction(game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:game=>"What do I do?",onSelect:(game,dialog)=>{game.playSound(SOUNDS.YUPA);if(!game.data.seen.doctor){game.showTip(["Go see doctar Sarlie","The white bilding at the end"],null,80,{talker:"yupa"})}else{game.showTip(["Ask da shopkeepa abowt Baby Hitlah"],null,80,{talker:"yupa"})}},},{msg:"LEAVE",onSelect:game=>{game.sceneData.zoomYupa=0;game.dialog=null;game.situation.hitman.goal.y=42},},],},],})},50)},},{src:ASSETS.SARLIE_PLANET_WORLD_OVERLAY,size:[128,64],offsetX:game=>Math.round(game.situation.shift),scale:game=>game.sceneData.zoom/.7,},{src:ASSETS.SARLIE_PLANET_BG,noHighlight:!0,onClick:game=>{},hidden:game=>!game.sceneData.zoomOnPedro&&!game.sceneData.zoomYupa,},{src:ASSETS.PEDRO,offsetY:-4,index:game=>game.pendingTip&&game.pendingTip.talker==="pedro"&&game.pendingTip.progress<1?Math.floor(game.now/80)%2:0,hidden:game=>!game.sceneData.zoomOnPedro,combine:(item,game)=>{if(item==="photo"){game.useItem=null;game.playSound(SOUNDS.HUM);game.showTip("Have you seen this baby?",game=>{game.showTip(["Nah ma friend","But I tell ya what","Why dunt you come to party","Lots of people at party","Im sure someone can help ya!"],null,40,{talker:"pedro"})});return!0}else if(item==="ticket"){game.useItem=null;if(!game.getSituation("shopkeepa").askedWhereInSpace){game.showTip(["I'm not ready to go yet.","Need to prepare my boat.","Why don't you check out da shop!","Maybe you'll find something ya wanna buy","That way you know how much money ya need to win in Ecsta City!",],game=>{game.dialog=null;game.sceneData.zoomOnPedro=0;game.situation.hitman.goal.y=42},40,{talker:"pedro"})}else{game.showTip(["Alright, ma friend","Let's go now!","Ecsta city, here we go!",],game=>{game.dialog=null;console.log("TODO => GO TO ECSTA CITY")},40,{talker:"pedro"})}
return!0}else if(item==="coin"){game.useItem=null;game.showTip(["Oh dun worry,","For first timer, tickets are free!","After that its 500 coins ...","I'm willing to givaway for free","Cause I guarantee, you'll wanna come back!"],null,40,{talker:"pedro"});return!0}},onRefresh:game=>{if(game.pendingTip&&game.pendingTip.talker==="pedro"&&game.pendingTip.progress<1){if(!game.sceneData.yapping){game.sceneData.yapping=!0;game.playSound(SOUNDS.YAP,{loop:!0})}}else{if(game.sceneData.yapping){game.sceneData.yapping=!1;game.stopSound(SOUNDS.YAP)}}},},{src:ASSETS.ZOOM_YUPA_ALONE,col:3,row:3,hidden:game=>!game.sceneData.zoomYupa||game.sceneData.yupa_photo,index:game=>{const{pendingTip,now,sceneData}=game;if(pendingTip&&pendingTip.talker==="yupa"){return 5+Math.floor(now/50)%3}
return game.useItem?4:Math.min(3,Math.floor((now-sceneData.zoomYupa)/50))},combine:(item,game)=>{if(item==="photo"){game.useItem=null;game.sceneData.yupa_photo=game.now;game.dialog.paused=!0;return!0}},},{src:ASSETS.YUPA_GRAB_PHOTO_ALONE,col:2,row:3,hidden:game=>!game.sceneData.yupa_photo,index:game=>{const frame=Math.floor((game.now-game.sceneData.yupa_photo)/80);if(frame<30){return Math.min(frame,3)}else if(frame<60){return frame%2+4}else if(frame<85){return 3}else{return Math.max(0,3+85-frame)}},onRefresh:game=>{const frame=Math.floor((game.now-game.sceneData.yupa_photo)/80);if(frame>30&&!game.sceneData.yupalaugh){game.sceneData.yupalaugh=game.now;game.playSound(SOUNDS.YUPA_HAHA)}
if(frame>90){game.sceneData.yupa_photo=0;game.dialog.paused=!1}},},{src:ASSETS.SPEECH_OUT,hidden:game=>!game.sceneData.zoomOnPedro||game.pendingTip||game.sceneData.yupa_photo,index:game=>{return Math.min(3,Math.floor((game.now-game.sceneData.zoomOnPedro)/50))},},...standardMenu(),...standardBag(),],},);game.addScene({name:"sarlie-planet",onScene:game=>{game.save();game.playSound(SOUNDS.DIVING);game.hideCursor=!0;game.sceneData.hitman={pos:{x:23,y:35,},goal:{x:23,y:35,},visible:!1,speed:1/8,direction:4,anim:[[12,13,14,15],[16,17,18,19],[24,25,26,27],[4,5,6,7],[0,1,2,3],[8,9,10,11],[28,29,30,31],[20,21,22,23],],};game.sceneData.yupa={pos:{x:23,y:35,},goal:{x:23,y:35,},visible:!1,speed:1/8,dist:10,moving:!1,};game.sceneData.script=[game=>{return game.now-game.sceneTime>3000},game=>{game.sceneData.yupa.visible=!0;game.sceneData.hitman.visible=!0;return!0},game=>{return game.now-game.sceneData.scriptTime>1000},game=>{game.sceneData.yupa.goal.x=23;game.sceneData.yupa.goal.y=44;return!0},game=>{const{pos,goal}=game.sceneData.yupa;return pos.x===goal.x&&pos.y===goal.y},game=>{game.sceneData.hitman.goal.x=23;game.sceneData.hitman.goal.y=44;game.sceneData.yupa.goal.x=70;game.sceneData.yupa.goal.y=44;return!0},game=>{const{pos,goal}=game.sceneData.hitman;return pos.x===goal.x&&pos.y===goal.y},game=>{game.sceneData.hitman.goal.x=65;game.sceneData.hitman.goal.y=44;return!0},game=>{const{pos,goal}=game.sceneData.hitman;return pos.x===goal.x&&pos.y===goal.y},game=>{game.gotoScene("sarlie-planet-world");return!0},]},onSceneRefresh:game=>{const{pos,goal,speed}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;if(Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1){const dist=Math.sqrt(dx*dx+dy*dy);pos.x+=dx*Math.min(Math.abs(pos.x-goal.x),speed/dist);pos.y+=dy*Math.min(Math.abs(pos.y-goal.y),speed/dist)}else{pos.x=goal.x;pos.y=goal.y}
const{yupa,hitman}=game.sceneData;if(hitman&&yupa){if(yupa.goal){const dx=yupa.pos.x>yupa.goal.x?-1:yupa.pos.x<yupa.goal.x?1:0;const dy=yupa.pos.y>yupa.goal.y?-1:yupa.pos.y<yupa.goal.y?1:0;if(Math.abs(yupa.pos.x-yupa.goal.x)>=1||Math.abs(yupa.pos.y-yupa.goal.y)>=1){const dist=Math.sqrt(dx*dx+dy*dy);yupa.pos.x+=dx*Math.min(Math.abs(yupa.pos.x-yupa.goal.x),speed/dist);yupa.pos.y+=dy*Math.min(Math.abs(yupa.pos.y-yupa.goal.y),speed/dist)}else{yupa.pos.x=yupa.goal.x;yupa.pos.y=yupa.goal.y}}else{const dx=hitman.pos.x-yupa.pos.x;const dy=hitman.pos.y-yupa.pos.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>yupa.dist){yupa.pos.x+=dx/dist*yupa.speed;yupa.pos.y+=dy/dist*yupa.speed;yupa.moving=!0}else{yupa.moving=!1}}}
if(game.sceneData.script&&game.sceneData.script.length){while(game.sceneData.script.length&&game.sceneData.script[0](game)){if(!game.sceneTime){break}
game.sceneData.script.shift();game.sceneData.scriptTime=game.now}}},arrowGrid:[[null,null,MENU,null,null],[],[],[],[null,null,BAG,null,null],],sprites:[{src:ASSETS.SARLIE_PLANET_BG,},{src:ASSETS.SPACESHIP,col:1,row:2,index:1,alpha:.5,scale:.8,offsetY:game=>{const time=Math.max(0,game.now-game.sceneTime)/2;return 25-Math.round(Math.min(7,Math.sqrt(time)-30))},offsetX:4,},{src:ASSETS.SARLIE_PLANET,index:game=>{const frame=Math.floor(game.now/100)%30;return frame>=4?0:frame},},{src:ASSETS.SPACESHIP_STAIRS,col:4,row:4,scale:.8,index:game=>{const frame=Math.floor((game.now-game.sceneTime-2000)/100);return Math.max(5,15-Math.min(frame,15))},offsetY:game=>{const time=Math.max(0,game.now-game.sceneTime)/2;return Math.round(Math.min(7,Math.sqrt(time)-30))},offsetX:4,hidden:game=>game.now-game.sceneTime<1000,},{src:ASSETS.YUPA_WALK,size:[16,32],col:3,row:2,scale:.16,offsetX:({sceneData})=>sceneData.yupa.pos.x-2,offsetY:({sceneData})=>sceneData.yupa.pos.y-6,index:game=>game.sceneData.yupa.moving?Math.floor(game.now/100)%4:0,hidden:game=>!game.sceneData.hitman.visible,},{src:ASSETS.HITMAN_WALK,size:[16,32],col:6,row:6,scale:.16,offsetX:({sceneData})=>sceneData.hitman.pos.x-2,offsetY:({sceneData})=>sceneData.hitman.pos.y-6,index:game=>{const{pos,goal,anim}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},hidden:game=>!game.sceneData.hitman.visible,},{src:ASSETS.HITMAN_BEARD_WALK,size:[16,32],col:6,row:6,scale:.2,offsetX:({sceneData})=>sceneData.hitman.pos.x-2,offsetY:({sceneData})=>sceneData.hitman.pos.y-6,index:game=>{const{pos,goal,anim}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},hidden:game=>!game.sceneData.hitman.visible,},{src:ASSETS.SPACESHIP,col:1,row:2,scale:.8,offsetY:game=>{const time=Math.max(0,game.now-game.sceneTime)/2;return Math.round(Math.min(7,Math.sqrt(time)-30))},offsetX:4,},...standardMenu(),...standardBag(),],},);game.addScene({name:"shop",arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(5),null,RIGHT],],onScene:game=>{game.playTheme(SOUNDS.CHIN_TOK_THEME)},doors:{1:{exit:game=>game.fadeToScene("sarlie-planet-world"),},},map:`
			XXX
			XOX
			X.X
			X1X
			XXX
		`,onSceneRefresh:(game)=>{const{orientation,sceneData,frameIndex}=game;if(sceneData.orientation!==orientation){sceneData.orientation=orientation;if(frameIndex===3){game.frameIndex=0}}},onSceneHoldItem:(game,item)=>{if(item==="gun"){game.useItem=null;game.waitCursor=!0;game.showTip("I don't want to hurt anyone.",()=>{game.waitCursor=!1})}},sprites:[...getRoomMaze("_RED_1"),{src:ASSETS.SHOP,col:2,row:3,index:1,hidden:game=>game.rotation!==0,onClick:game=>{game.gotoScene("shopkeepa")},combine:(item,game)=>{game.gotoScene("shopkeepa");game.useItem=item;return!0},},{src:ASSETS.SHOP,col:2,row:3,index:2,hidden:game=>game.rotation!==0,onClick:game=>{game.gotoScene("slots")},},{src:ASSETS.SHOP,index:4,hidden:game=>game.rotation!==0,onClick:game=>{game.gotoScene("shopkeepa")},combine:(item,game)=>{game.gotoScene("shopkeepa");game.useItem=item;return!0},},{src:ASSETS.SHOP,col:2,row:3,hidden:game=>game.rotation!==0,},...standardMenu(),...standardBag(),],},);game.addScene({name:"shopkeepa",arrowGrid:[[],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onSceneHoldItem:(game,item)=>{if(item==="gun"){game.useItem=null;game.waitCursor=!0;if(game.situation.askedWhereInSpace){game.sceneData.shopkeepaSmiles=0;game.currentScene.startTalk(game,"shopkeepa","Hey, watch what you're doing with that!",game=>{game.dialog.index=13;game.useItem=null;game.waitCursor=!1})}else{game.showTip("I don't want to scare anyone.",()=>{game.waitCursor=!1})}}else if(game.situation.stoleWarpDrive){game.useItem=null;game.currentScene.startTalk(game,"human",["Let's go Yupa,","We're going to find Baby Hitler.",],game=>{game.hideCursor=!0;game.dialog=null;game.fadeToScene("monster-in-space")})}},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="human"){x=2;y=62;game.playSound(SOUNDS.HUM)}else if(talker==="shopkeepa"||talker==="shopkeepa2"||talker==="shopkeepaphoto"){x=4;y=59;game.playSound(SOUNDS.ANIMAL_CRY)}else if(talker==="yupa"||talker==="yupa2"){x=2;y=58;game.playSound(SOUNDS.YUPA)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},onStartDialog:game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Buy",onSelect:(game,dialog)=>{dialog.index++;game.playSound(SOUNDS.BEEP,{volume:.5});game.sceneData.showStats=game.now;if(game.pendingTip){game.pendingTip.end=game.now}},},{msg:"LEAVE",onSelect:game=>{game.dialog=null;game.currentScene.startTalk(game,"shopkeepa",game.countItem("warpdrive")?"Have a good trip to Westrow!":"Hope to see you soon.",game=>{if(game.countItem("warpdrive")){game.currentScene.startTalk(game,"human","We did it Yupa! Let's go find Baby Hitler!",game=>{game.dialog=null;game.fadeToScene("space-adventure",null,3000)})}else{game.dialog=null;game.gotoScene("shop")}})}},],},{options:[{},{},{msg:"Back",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BEEP,{volume:.5});game.sceneData.showStats=0;dialog.index--},},],},{options:[{cantSelect:!0,msg:({sceneData})=>`${sceneData.price} coin${sceneData.price>1?'s':''}?`,},{msg:"Sure",onSelect:(game,dialog)=>{game.removeFromInventory(game.sceneData.forSale);game.addToInventory({item:"coin",count:game.sceneData.price,image:ASSETS.GRAB_COIN,});game.playSound(SOUNDS.PICKUP);game.showTip("Nice doing business with you.",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});const itemObj=game.situation.inventory.filter(({item})=>item===game.sceneData.forSale)[0];if(itemObj&&!itemObj.available){itemObj.available=!0;itemObj.unique=!0}
game.sceneData.showStats=0;dialog.index=0;game.sceneData.forSale=null},},{msg:"No",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BOP,{volume:.5});game.sceneData.showStats=0;dialog.index=0;game.sceneData.forSale=null;if(game.pendingTip){game.pendingTip.end=game.now}},},],},{options:[{cantSelect:!0,msg:({sceneData})=>`${sceneData.price} coin${sceneData.price>1?'s':''}?`,},{msg:game=>game.sceneData.itemToBuy&&game.sceneData.itemToBuy.item==="tip"?"Yes, help me!":"Sure",onSelect:(game,dialog)=>{const{item,name,cost,src,available,msg,onBuy,count}=game.sceneData.itemToBuy;if(cost<=game.countItem("coin")){game.removeFromInventory("coin",cost);if(item==="tip"){game.sceneData.showStats=0;dialog.index++;if(game.pendingTip){game.pendingTip.end=game.now}
if(!game.situation.hints){game.situation.hints={}}
return}else if(!src&&onBuy){game.playSound(SOUNDS.PICKUP);onBuy(game,game=>{game.showTip("Nice doing business with you.",null,null,{x:1,y:15,speed:60,talker:"shopkeepa",removeLock:!0})})}else{game.pickUp({item,image:src,count,onPicked:game=>{game.showTip("Nice doing business with you.",null,null,{x:1,y:15,speed:60,talker:"shopkeepa",removeLock:!0})}});const itemObj=game.situation.inventory.filter(obj=>obj.item===item)[0];if(itemObj&&itemObj.unique){itemObj.available=!1}}}else{game.playErrorSound();game.showTip("I'm sorry, you can't afford this.",null,null,{x:1,y:15,speed:60,talker:"shopkeepa",removeLock:!0})}
game.sceneData.showStats=0;dialog.index=0;game.sceneData.itemToBuy=null},},{msg:"No",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BOP,{volume:.5});game.sceneData.showStats=0;dialog.index=0;game.sceneData.forSale=null;if(game.pendingTip){game.pendingTip.end=game.now}},},],},{options:[{msg:"Fighting tips?",onSelect:(game,dialog)=>{const{cost}=game.sceneData.itemToBuy;game.removeFromInventory("coin",cost);game.sceneData.itemToBuy=null;const HINTS=[["Sometimes, foes attack immediately after blocking.","Be prepare to block yourself."],"With the gun, you can end the battle, but you won't earn any experience.","Blocking will make you hurt less, but you'll still hurt.","You should level up yourself to fight better.","I don't know what else to say.",];game.showTip(HINTS[Math.min(HINTS.length-1,game.situation.hints.battle||0)],null,null,{x:1,y:15,speed:60,talker:"monster"});game.situation.hints.battle=(game.situation.hints.battle||0)+1;dialog.index=0;game.playSound(SOUNDS.PICKUP)}},],},{options:[{msg:"That sucks!",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human","This is terrible!",game=>{game.currentScene.startTalk(game,"shopkeepa","Why is that?",game=>{dialog.index+=2})})},},{msg:"That's great!",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human","Really? that's great!",game=>{game.currentScene.startTalk(game,"shopkeepa","Why is that?",game=>{dialog.index+=1})})},},{},],},{options:[{msg:"I can kill him!",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["Now that he's no longer a baby...","I won't feel any remorse killing him.",],game=>{game.currentScene.startTalk(game,"yupa",["Hey ya dum dum,","If ya kill him, ya gonna die!",],game=>{game.currentScene.startTalk(game,"human",["Oh right, I forgot",]);dialog.index=8})})},},{msg:"Beer buddy.",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["Now I can hang out with him, have a beer and all.",],game=>{game.currentScene.startTalk(game,"yupa",["Ya wanna hava bier wid Hitler?",],game=>{game.currentScene.startTalk(game,"human",["Well... whatever...",]);dialog.index=8})})},},{msg:"Don't know.",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human","Hum.. I don't know why I said that.",game=>{dialog.index=8})},},],},{options:[{msg:"He's too old!",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["He's too old to be turned back into Hitler,","after spending fifteen years in space!","How are we going to do that?",],game=>{game.currentScene.startTalk(game,"yupa",["Ah dun worry abowt dat,","We have wayz, therez a thingy called...","mind purifaya...",],game=>{game.currentScene.startTalk(game,"shopkeepa",["In earth terms, they call that Brain Wash.",],game=>{game.currentScene.startTalk(game,"human",["That's terrible!",])});dialog.index=8})})},},{msg:"Lost time.",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["I was hoping to spend time with Baby Hitler,","Watch him grow and all","All this lost time...",],game=>{game.currentScene.startTalk(game,"yupa",["Ya did watch him grow","Ya just dun rememba da last fifteen years,","We only lost Baby Hitler abowt a year ago.",],game=>{game.currentScene.startTalk(game,"human",["Wait what?!","So I lost fifteen years of memory?",,"And Yupa, you knew that Baby Hitler is a teenager?","And you didn't tell me?","Geez! I keep you around but you're not helping at all!",],game=>{dialog.index=8;game.currentScene.startTalk(game,"yupa",["Hey I dun know maan!","Whyz it so\nimportunt\nhez now teen Hitler? I dun know.",])})})})},},{msg:"Don't know.",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human","Hum.. I don't know why I said that.",game=>{dialog.index=8})},},],},{options:[{msg:"Where in space?",hidden:game=>game.situation.askedWhereInSpace,onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["So where in space are we going to find a human\nteenager?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Well, there aren't many places where humans thrive.","In fact, there's only one\nearthling\ncommunity I know, outside of earth.","Westrow X33, third planet in the Walak system.","That's your best bet!",],game=>{game.currentScene.startTalk(game,"yupa2",["Da Walak system, datz liteyears away!","We'll nevar get there on tame!"],game=>{game.currentScene.startTalk(game,"shopkeepa",["Well, we happen to be selling a very advanced warp drive.","The top notch for space travel.","It can take you there in a couple days!","It is quite costly, but if you can afford it...",],game=>{game.situation.askedWhereInSpace=game.now;if(game.situation.askedWhereInSpace&&game.situation.askedHowHeLookedLike){dialog.index=0}})})})})},},{msg:"How he look like?",hidden:game=>game.situation.askedHowHeLookedLike,onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["How are we going to recognize Baby Hitler?","I don't know how Hitler looks like as a teenager!",],game=>{game.currentScene.startTalk(game,"yupa",["Dun worry, I can racognize dat baby.","We all lived togetha, like big famaly, ya know?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["I'm sure the kid will recognize your face as well,","given the time you've spent together.",],game=>{game.situation.askedHowHeLookedLike=game.now;if(game.situation.askedWhereInSpace&&game.situation.askedHowHeLookedLike){dialog.index=0}})})})},},{},{},],},{options:[{msg:"Let's trade",onSelect:game=>{if(game.situation.proposedTrade){game.currentScene.startTalk(game,"shopkeepa",["Ok, so what do you want for those tickets?",],game=>{game.dialog.index++})}else{game.situation.proposedTrade=game.now;game.currentScene.startTalk(game,"human",["You really want to go to Ecsta City, don't you?",],game=>{game.currentScene.startTalk(game,"shopkeepa2",["You have no idea!","I love Tammy Slow, ever since I was little.","It would mean the world to me, if I could just see her once in concert.",],game=>{game.currentScene.startTalk(game,"human",["Maybe we could come to some kind of ... arrangement",],game=>{game.currentScene.startTalk(game,"shopkeepa",["I see... you'd like to make a deal!","Well, I guess now you know how much I want that ticket.","But no matter, I'm ready to listen.","What would you like in exchange?",],game=>{game.dialog.index++})})})})}},},{msg:"Nevermind",onSelect:game=>{game.currentScene.startTalk(game,"human","Let me think about it.",game=>{game.dialog.index=0})},},],},{options:[{hidden:game=>!game.situation.askedWhereInSpace,msg:"The warp drive",onSelect:game=>{game.currentScene.startTalk(game,"human",["I want the warp drive.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["I guessed you would ask for that...",],game=>{game.currentScene.startTalk(game,"shopkeepa2",["Well, what can I say! I am a sucker for TAMMY SLOW!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["But that warp drive, it's pretty expensive.","I don't know if I can afford to give it away like that...",],game=>{game.currentScene.startTalk(game,"human",["How about you get both tickets?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Both tickets?",],game=>{game.currentScene.startTalk(game,"human",["Listen, we really need that warp drive!","I must find Baby Hitler!","It's a matter of life or death!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Ok ok! I got it.","Sure I'll take both tickets. Maybe I'll find a buyer on the island."],game=>{game.currentScene.startTalk(game,"shopkeepa2",["Still, thank you so much!","I'm finally going to see Tammy Slow in concert! I'm so happy",],game=>{game.removeFromInventory("ticket",2);game.pickUp({item:"warpdrive",image:ASSETS.GRAB_WARP_DRIVE,message:"Finally got it.",onPicked:game=>{game.currentScene.startTalk(game,"human","We did it Yupa! Let's go find find Baby Hitler!",game=>{game.dialog=null;game.fadeToScene("space-adventure",null,3000)})}})})})})})})})})})})},},{msg:"Money",onSelect:game=>{game.currentScene.startTalk(game,"human",["I'm willing to sell.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["You know I can't afford the full price.",],game=>{game.sceneData.shopkeepaSmiles=game.now;game.currentScene.startTalk(game,"shopkeepa2",["But if you're willing to give me a big discount,","I can pay 142 coins!",]);game.dialog.index=12})})},},{msg:"A date",hidden:game=>game.situation.askedForDate&&!game.situation.canAskAgain,onSelect:game=>{if(game.situation.askedForDate){game.currentScene.startTalk(game,"human",["I'd like to ask you out on a date.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Again with the date?",],game=>{game.dialog.index++})})}else{game.situation.askedForDate=game.now;game.currentScene.startTalk(game,"human",["I'd like to ask you out on a date.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["What?",],game=>{game.currentScene.startTalk(game,"human",["A date","On Earth,\nsometimes two people go out together","have a good time, get to know each other...",],game=>{game.currentScene.startTalk(game,"shopkeepa",["I know what a date is.","I'm just confused... Why?",],game=>{game.dialog.index++})})})})}},},{msg:"Your soul",hidden:game=>game.situation.yourSoul,onSelect:game=>{game.situation.yourSoul=game.now;game.currentScene.startTalk(game,"human",["In exchange for those tickets,","I will own your soul!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["I see...","You were just joking.","Oh well... It's ok.","I shouldn't keep my hopes up like this.",],game=>{game.dialog.index--})})},},{msg:"Nevermind",onSelect:game=>{game.currentScene.startTalk(game,"human","Let me think about it.",game=>{game.dialog.index=0})},},],},{options:[{msg:"The warpdrive",hidden:game=>!game.situation.askedWhereInSpace||game.situation.dateForWarpdrive,onSelect:game=>{game.situation.dateForWarpdrive=game.now;game.currentScene.startTalk(game,"human",["I just really need that\nwarpdrive.","I thought maybe we could...",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Hey! I don't know how you do business on your planet,","but here, if you want\nsomething, you just say it!","If you want the warpdrive, we can talk about that,","but don't run around the\nbushes...","... whatever that expression you earthlings have.",],game=>{game.currentScene.startTalk(game,"human",["Okay okay...","Forget what I said."],game=>{game.currentScene.startTalk(game,"shopkeepa2",["Done!",],game=>{game.dialog.index=0})})})})},},{msg:"I'm horny",onSelect:game=>{game.currentScene.startTalk(game,"human",["Listen... I've been stuck in a jail cell for a very long time.","A man, has his needs...","You know what I mean, right? Release tension and stuff!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["I don't really know...",],game=>{game.currentScene.startTalk(game,"human",["I NEED SEX OK? PLEASE, I'M HORNY!..",],game=>{game.delayAction(game=>{game.sceneData.yupaLookAtShopkeepa=game.now},300);game.currentScene.startTalk(game,"shopkeepa",["Hey! Calm down here!","This is a place for business.","Let's keep it that way!",],game=>{game.sceneData.shopkeepaSmiles=game.now;game.currentScene.startTalk(game,"shopkeepa2",["So thanks for your funny little joke, now let's keep it\nprofessional here.",],game=>{game.delayAction(game=>{game.sceneData.yupaLookAtShopkeepa=0},300);game.currentScene.startTalk(game,"human",["Sorry, forget what I said",],game=>{game.currentScene.startTalk(game,"shopkeepa2",["Done!",],game=>{game.sceneData.shopkeepaSmiles=0;game.dialog.index=0})})})})})})})},},{msg:"I like you",onSelect:game=>{game.currentScene.startTalk(game,"human",["Hum... I like you.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Get out of here!",],game=>{game.delayAction(game=>{game.sceneData.shopkeepaSmiles=game.now},5500);game.delayAction(game=>{game.sceneData.yupaLookAtShopkeepa=game.now},6500);game.currentScene.startTalk(game,"human",["Hey for real yo!","You keep raving about Tammy Slow, now I really wanna meet her.","Let's go to that concert together.",],game=>{game.currentScene.startTalk(game,"shopkeepa2",["You're kidding me. You want me to come with you to Ecsta City?",],game=>{game.delayAction(game=>{game.sceneData.yupaLookAtShopkeepa=0},300);game.sceneData.shopkeepaSmiles=0;game.delayAction(game=>{game.sceneData.yupaLookAtShopkeepa=game.now;game.delayAction(game=>{game.sceneData.yupaLookAtShopkeepa=0},1000)},5500);game.delayAction(game=>{game.sceneData.shopkeepaLookAtYupa=game.now;game.delayAction(game=>{game.sceneData.shopkeepaLookAtYupa=0},1000)},6000);game.currentScene.startTalk(game,"human",["Like I said, I like you...","I think you're cute!","So I wanna spend time with you, get to know you better.",],game=>{game.sceneData.yupaLookAtShopkeepa=0;game.sceneData.shopkeepaLookAtYupa=game.now;game.currentScene.startTalk(game,"yupa",["Hey! Waida minut!","One of thoze tickets iz mine!","Ya cant just givewai ma ticket fo free!",],game=>{game.delayAction(game=>{game.sceneData.shopkeepaLookAtYupa=0},500);game.currentScene.startTalk(game,"human",["You're right Yupa.",],game=>{game.dialog.index=14})})})})})})})},},{msg:"Forget it!",hidden:game=>game.situation.forgetIt,onSelect:game=>{game.situation.forgetIt=game.now;game.currentScene.startTalk(game,"human",["Forget what I said","Didn't mean to scare you...",],game=>{game.currentScene.startTalk(game,"shopkeepa2",["Oh no, it's ok!","I was just\nsurprised\nthat's all!",],game=>{game.situation.canAskAgain=!0;game.sceneData.shopkeepaSmiles=0;game.dialog.index=0})})},},],},{options:[{msg:"Sure",onSelect:game=>{game.sceneData.soldTickets=game.now;game.sceneData.shopkeepaSmiles=game.now;game.currentScene.startTalk(game,"human","Sure, that will do.",game=>{game.currentScene.startTalk(game,"shopkeepa2",["Wow, really?","I'm so happy! I'm going to see Tammy Slow in concert!",],game=>{game.sceneData.takeTicket=game.now;game.dialog.paused=!0;game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa2",["I'm very grateful to you for that.",],game=>{game.sceneData.takeTicket=0;game.dialog.paused=!1;game.addToInventory({item:"coin",count:142,image:ASSETS.GRAB_COIN});game.removeFromInventory("ticket");game.dialog.index=0;game.sceneData.shopkeepaSmiles=0})},300)})})},},{msg:"No",onSelect:game=>{game.currentScene.startTalk(game,"human","That's not enough.",game=>{game.sceneData.shopkeepaSmiles=0;game.currentScene.startTalk(game,"shopkeepa","Yeah I figured.",game=>{game.dialog.index=0})})},},{},],},{options:[{msg:"The warp drive",hidden:game=>!game.situation.askedWhereInSpace,onSelect:game=>{const{sceneData}=game;game.waitCursor=!0;game.useItem="gun";game.currentScene.startTalk(game,"human","Give me the warp drive, or else!",game=>{sceneData.yupaLookAtShopkeepa=game.now;game.currentScene.startTalk(game,"shopkeepa","You can't be serious.",game=>{sceneData.yupaLookAtShopkeepa=0;game.waitCursor=!1;game.useItem=null;game.dialog.index+=2})})},},{msg:"Sorry",onSelect:game=>{game.currentScene.startTalk(game,"human","Sorry, I didn't mean to scare you",game=>{game.currentScene.startTalk(game,"shopkeepa","I'm not scared.",game=>{game.dialog.index=0})})},},],},{options:[{msg:"I'll owe you",onSelect:game=>{game.currentScene.startTalk(game,"human",["Thanks for your ticket Yupa. I'll owe you one.",],game=>{game.currentScene.startTalk(game,"yupa",["Scuw ya!",],game=>{game.currentScene.startTalk(game,"human",["So what do you say, will you join me this evening?",],game=>{game.sceneData.yupaLookAtShopkeepa=game.now;game.dialog.paused=!0;game.delayAction(game=>{game.sceneData.shopkeepaCuteSmile=game.now;game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa2",["Okay",],game=>{game.delayAction(game=>{game.dialog=null;game.fadeToScene("concert",null,3000)},1000)},null,200)},2000)},4000)})})})},},{msg:"We'll sneak you in",onSelect:game=>{game.delayAction(game=>{game.sceneData.shopkeepaLookAtYupa=game.now},1000);game.currentScene.startTalk(game,"human",["Don't worry Yupa. I have a plan.","We'll put you inside a bottle like last time and sneak you in!",],game=>{game.currentScene.startTalk(game,"yupa",["Scuw ya!",],game=>{game.delayAction(game=>{game.sceneData.shopkeepaLookAtYupa=0},100);game.currentScene.startTalk(game,"human",["So what do you say, will you join me this evening?",],game=>{game.sceneData.yupaLookAtShopkeepa=game.now;game.dialog.paused=!0;game.delayAction(game=>{game.sceneData.shopkeepaCuteSmile=game.now;game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa2",["Okay",],game=>{game.delayAction(game=>{game.dialog=null;game.fadeToScene("concert",null,3000)},1000)},null,200)},2000)},4000)})})})},},{msg:"Nevermind",onSelect:game=>{game.currentScene.startTalk(game,"human",["Sorry, Yupa's right. I can't really give you his ticket.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Don't worry, I understand.",],game=>{game.dialog.index=0})})},},],},{options:[{msg:"Just kidding.",onSelect:game=>{game.currentScene.startTalk(game,"human","You're right, I was just joking.",game=>{game.currentScene.startTalk(game,"shopkeepa","It was not very funny ...",game=>{game.dialog.index=0})})},},{msg:"I'm serious.",onSelect:game=>{const{sceneData}=game;game.useItem="gun";game.currentScene.startTalk(game,"human",["Oh, I'm very serious!","You wanna know how serious I am? I'll show you!",],game=>{sceneData.yupaLookAtShopkeepa=game.now;game.currentScene.startTalk(game,"shopkeepa",["Cut it out! I got the point.","Alright, here's the warpdrive","configured for Westrow X33, all ready for you.",],game=>{game.situation.stoleWarpDrive=game.now;game.pickUp({item:"warpdrive",image:ASSETS.GRAB_WARP_DRIVE,message:"That's it! The warpdrive!",onPicked:game=>{game.useItem="gun";game.waitCursor=!0;game.currentScene.startTalk(game,"shopkeepa","I hope you're satisfied, now that you got what you want.",game=>{game.currentScene.startTalk(game,"human",["You gave me no choice",],game=>{game.waitCursor=!1;game.delayAction(game=>{sceneData.yupaLookAtShopkeepa=0},50);game.dialog=null})})}})})})},},{},],},],})},onScene:game=>{if(!game.situation.inventory){game.situation.inventory=[{item:"bullet",name:"10 bullets",cost:40,src:ASSETS.GRAB_GUN,available:!0,count:10,msg:"We sell amunition for your gun in packs of 10.",hideFromInventory:!0,},{item:"compass",name:"compass",cost:20,src:ASSETS.GRAB_COMPASS,available:!0,msg:"The red arrow always points to the north.",},{item:"superarm",name:"superarm",cost:500,available:game=>game.data.leftHand!=="super",msg:"This can replace your missing left hand. It delivers a powerful punch.",onBuy:(game,callback)=>{game.data.leftHand="super";game.sceneData.showLeftArm=game.now;game.dialog.paused=!0;game.delayAction(game=>{game.dialog.paused=!1;game.sceneData.showLeftArm=0;callback(game)},3000)},},{item:"hook",name:"hook",cost:50,available:game=>game.data.leftHand!=="hook",msg:"This can replace your missing left hand.",onBuy:(game,callback)=>{game.data.leftHand="hook";game.sceneData.showLeftArm=game.now;game.dialog.paused=!0;game.delayAction(game=>{game.dialog.paused=!1;game.sceneData.showLeftArm=0;callback(game)},3000)},},{item:"shipgun",name:"X-canon",cost:400,available:game=>!game.data.ship||!game.data.ship.superGun,msg:"This is a great canon for your ship. It blasts a continuous powerful lazer that recharges.",onBuy:(game,callback)=>{if(!game.data.ship){game.data.ship={}}
game.data.ship.superGun=!0;game.playSound(SOUNDS.JINGLE);callback(game)},},{item:"shipshield",name:"X-shield",cost:300,available:game=>!game.data.ship||!game.data.ship.superShield,msg:"This is a sturdy rechargeable shield for your ship.",onBuy:(game,callback)=>{if(!game.data.ship){game.data.ship={}}
game.data.ship.superShield=!0;game.playSound(SOUNDS.JINGLE);callback(game)}},{item:"warpdrive",name:"warpdrive",cost:1000,src:ASSETS.GRAB_WARP_DRIVE,available:game=>game.situation.askedWhereInSpace,msg:"Travel to planets lightyears away!",},]}
if(game.useItem){game.currentScene.onStartDialog(game)}else{game.currentScene.startTalk(game,"shopkeepa",game.situation.askedForDate&&!game.situation.canAskAgain?"Hey!":"Hello, handsome!",game=>{game.delayAction(game=>{game.currentScene.onStartDialog(game)},50)})}},sprites:[{name:"shopkeepa",src:ASSETS.SHOPKEEPA,col:6,row:6,index:23,hidden:game=>game.data.shot.shopkeepa,combine:(item,game)=>{if(game.dialog.paused){return!0}
if(item==="photo"){if(game.situation.explainedPhoto){game.sceneData.sheTookPhoto=game.now;game.dialog.paused=!0;game.useItem=null;game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepaphoto",["What a cute baby...","Look at that mustache!"],game=>{game.sceneData.sheTookPhoto=0;game.sceneData.returnPhoto=game.now;game.delayAction(game=>{game.useItem="photo";game.useItem=null;game.delayAction(game=>{game.dialog.paused=!1},300)},300)})},1000)}else{game.situation.explainedPhoto=game.now;game.dialog.paused=!0;game.currentScene.startTalk(game,"shopkeepa","We don't buy back items in this shop.",game=>{game.currentScene.startTalk(game,"human",["Actually, we're looking for this baby.","His name is Baby Hitler.",],game=>{game.currentScene.startTalk(game,"shopkeepa","Oh, ok... let me see the photo.",game=>{game.sceneData.sheTookPhoto=game.now;game.useItem=null;game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa",["That's a human baby.","It's not\nsomething you find every day."],game=>{game.currentScene.startTalk(game,"human",["So I've heard.","Have you ever seen him?"],game=>{game.currentScene.startTalk(game,"shopkeepa",["This baby? No...","I don't even recall the last time I saw a human baby.","There's\nsomething\npeculiar about this photo though...","Let me see...",],game=>{game.sceneData.sheLookPhoto=game.now;game.delayAction(game=>{game.sceneData.sheLookPhoto=0;game.currentScene.startTalk(game,"shopkeepa",["As I suspected...","You'll never find your baby with this.","This photo was taken more than 15 years ago.","Your baby human is now at least a 15 years old!",],game=>{game.sceneData.sheTookPhoto=0;game.sceneData.returnPhoto=game.now;game.delayAction(game=>{game.useItem="photo";game.currentScene.startTalk(game,"human",["Wait, you mean Baby Hitler...","is now Teenage Hitler?!"],game=>{game.currentScene.startTalk(game,"shopkeepa","That's right!",game=>{game.useItem=null;game.dialog.paused=!1;game.dialog.index=5})})},300)})},5000)})})})},1000)})})})}
return!0}else if(item==="coin"){game.useItem=null;game.currentScene.startTalk(game,"shopkeepa","What would you like to buy?",game=>{if(game.dialog){game.dialog.index=1;game.sceneData.showStats=game.now;if(game.pendingTip){game.pendingTip.end=game.now}}});return!0}else if(item==="ticket"){if(game.sceneData.soldTickets){game.currentScene.startTalk(game,"shopkeepa2",["Haha, thanks but I really can't afford a second ticket.","Why don't you go as well? It'll have fun!",],game=>{game.currentScene.startTalk(game,"yupa2","Dat other ticket iz mine!",game=>{game.useItem=null})})}else if(game.situation.showedTickets){game.useItem=null;game.currentScene.startTalk(game,"shopkeepa",["Yeah yeah I know...","You get to go to Ecsta City.","I envy you."]);game.dialog.index=9}else{game.situation.showedTickets=game.now;game.currentScene.startTalk(game,"shopkeepa2",["Wow! you got tickets to Ecsta City!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Oh right, that's your first time here. Pedro must have given you a free pass.",],game=>{game.currentScene.startTalk(game,"shopkeepa2",["I'm so envious! I really wanted to go this time and see...","TAMMY SLOW\nin concert!",],game=>{game.useItem=null;game.currentScene.startTalk(game,"shopkeepa",["But the tickets to Ecsta City are sooo\nexpensive!","If I miss her this time, I'm sure I'll never see her in concert.","Since she rarely visits this planet ...",],game=>{game.dialog.index=9})})})})}
return!0}else{game.currentScene.startTalk(game,"shopkeepa","We don't buy back items in this shop.",game=>{game.useItem=null});return!0}},},{src:ASSETS.SHOPKEEPA,col:6,row:6,index:(game,sprite)=>{const{pendingTip,currentScene,now,sceneData,data}=game;if(data.shot.shopkeepa){const frame=Math.floor((now-data.shot.shopkeepa)/100);return frame>=3?32:19+frame}
if(sceneData.takeTicket){const frame=Math.floor((now-sceneData.takeTicket)/200);if(frame<2){return 8+frame}}
if(sceneData.returnPhoto&&now-sceneData.returnPhoto<800){return Math.max(8,11-Math.floor((now-sceneData.returnPhoto)/100))}
if(sceneData.sheLookPhoto){const frame=15+Math.floor((now-sceneData.sheLookPhoto)/100);if(frame<18){return frame}else if(frame<50){return 18}else{const f=Math.max(14,18-(frame-50));return f===14?11:f}
return Math.min(18,15+Math.floor((now-sceneData.sheLookPhoto)/100))}
if(sceneData.sheTookPhoto){if(pendingTip&&pendingTip.talker==="shopkeepa"&&pendingTip.progress<1){return 11+Math.floor(now/100)%4}
return Math.min(11,8+Math.floor((now-sceneData.sheTookPhoto)/100))}
if(pendingTip&&pendingTip.talker==="yupa2"){return 22}
if(game.sceneData.shopkeepaCuteSmile){if(pendingTip&&(pendingTip.talker==="shopkeepa"||pendingTip.talker==="shopkeepa2")){return 24+(pendingTip.progress<1?Math.floor((now-game.sceneData.shopkeepaCuteSmile)/100)%7:0)}
return 24}
if(pendingTip&&pendingTip.talker==="shopkeepa"){return pendingTip.progress<1?Math.floor(now/100)%4:0}
if(pendingTip&&pendingTip.talker==="shopkeepa2"){return 4+(pendingTip.progress<1?Math.floor(now/100)%4:0)}
if(game.sceneData.shopkeepaSmiles){return 4}
if(game.sceneData.shopkeepaLookAtYupa){return 22}
return 0},},{name:"yupa",src:ASSETS.YUPA_IN_SHOP,col:3,row:4,index:(game,sprite)=>{const{pendingTip,currentScene,now,sceneData}=game;if(pendingTip&&pendingTip.talker==="yupa"){return Math.floor(now/100)%4}
if(pendingTip&&pendingTip.talker==="yupa2"){return 4+Math.floor(now/100)%4}
if(sceneData.sheTookPhoto&&(!pendingTip||pendingTip.talker!=="human")){return 4}
if(sceneData.yupaLookAtShopkeepa){return 4}
if(game.data.shot.shopkeepa&&now-game.data.shot.shopkeepa<3000){return 4}
const frame=Math.floor((game.now-game.sceneTime)/100);return frame>2?0:frame+8},combine:(item,game)=>{game.useItem=null;game.currentScene.startTalk(game,"yupa","Show dat to da shopkeepa, nat me");return!0},onRefresh:game=>{if(game.data.shot.yupa){game.data.shot.yupa=0;game.delayAction(game=>{game.currentScene.startTalk(game,"yupa","Ya know dat thing haz no effact on me")},500)}},},{src:ASSETS.STATS,index:({now,sceneData})=>Math.min(3,Math.floor((now-sceneData.showStats)/100)),hidden:({sceneData})=>!sceneData.showStats,onClick:game=>{},},{custom:(game,sprite,ctx)=>{let space=game.displayTextLine(ctx,{msg:game.countItem("coin")+"",x:1,y:0});game.displayImage(ctx,{src:ASSETS.GRAB_COIN,index:1,offsetX:-10+space,offsetY:-46})},hidden:({now,sceneData})=>(!sceneData.showStats||now-sceneData.showStats<300)&&!sceneData.forSale,},{custom:(game,sprite,ctx)=>{let count=0;const{mouse}=game;ctx.fillStyle="#889933";game.situation.inventory.forEach(({item,name,cost,src,available},index)=>{if(game.evaluate(available)){const yLine=8+count*6;const hovered=mouse&&mouse.y>=yLine&&mouse.y<yLine+6&&mouse.x>=4&&mouse.x<=60;const cantAfford=cost>game.countItem("coin");game.displayImage(ctx,{src:ASSETS.GRAB_COIN_DARKER,index:1,offsetX:41,offsetY:-38+count*6,alpha:cantAfford?.3:1});if(hovered){ctx.fillRect(4,yLine,56,5)}
game.displayTextLine(ctx,{msg:name,x:5,y:yLine});if(cantAfford){ctx.globalAlpha=.3}
game.displayTextLine(ctx,{msg:""+cost,x:42,y:yLine,});if(cost>game.countItem("coin")){ctx.globalAlpha=1}
count ++}})},onClick:game=>{let count=0;const{mouse}=game;game.situation.inventory.filter(({available})=>game.evaluate(available)).forEach((itemToBuy,index)=>{const{item,name,cost,src,available,msg}=itemToBuy;if(available){const yLine=8+count*6;if(mouse&&mouse.y>=yLine&&mouse.y<yLine+6&&mouse.x>=4&&mouse.x<=60){game.sceneData.showStats=0;game.sceneData.itemToBuy=itemToBuy;game.sceneData.price=cost;game.showTip(msg,null,null,{x:1,y:15,speed:60,talker:"shopkeepa",removeLock:!0});game.dialog.index=3;game.playSound(SOUNDS.BEEP,{volume:.5})}
count ++}})},hidden:({now,sceneData})=>!sceneData.showStats||now-sceneData.showStats<300,},{src:ASSETS.SPEECH_OUT,hidden:game=>game.bagOpening||game.useItem||game.pendingTip&&!game.pendingTip.removeLock||game.sceneData.showStats||!game.dialog||game.dialog.paused||game.sceneData.showLeftArm,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/50)),},{src:({data})=>{switch(data.leftHand){case "none":return ASSETS.MISSING_HAND_PUNCH;case "hook":return ASSETS.HOOK_PUNCH;case "super":return ASSETS.SUPER_PUNCH}
return ASSETS.PUNCH},col:4,row:4,side:LEFT,index:12,offsetY:game=>{const time=game.now-game.sceneData.showLeftArm;return Math.max(0,10-time/50)},hidden:game=>!game.sceneData.showLeftArm,},{bag:!0,src:ASSETS.BAG_OUT,index:game=>game.frameIndex,hidden:({arrow,bagOpening,dialog})=>!bagOpening&&(arrow!==BAG||dialog&&dialog.conversation[dialog.index].options.length>2)||dialog&&dialog.paused,alpha:game=>game.emptyBag()?.2:1,onClick:game=>game.clickBag(),}],},);game.addScene({name:"slots",arrowGrid:[[null,null,null,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onScene:game=>{if(!game.situation.initial){const numCoins=game.countItem("coin");game.situation.coinPlayed=0;game.situation.initial={lastCoin:Math.min(20,numCoins),slots:numCoins<5?[0,0,0]:numCoins<10?[1,1,1]:[2,2,2],};game.situation.slots=[0,1,2,]}},onSceneHoldItem:(game,item)=>{if(item==="gun"){game.useItem=null;game.waitCursor=!0;game.showTip("I don't want to cause trouble here.",game=>{game.waitCursor=!1})}},onSceneRefresh:game=>{if(game.sceneData.roll&&game.now>game.sceneData.roll){game.sceneData.roll=0;if(game.situation.slots[0]===game.situation.slots[1]&&game.situation.slots[1]===game.situation.slots[2]){if(game.situation.slots[0]===0){const gains=20;game.addToInventory({item:"coin",count:gains,image:ASSETS.GRAB_COIN});for(let i=0;i<3;i++){game.delayAction(game=>game.playSound(SOUNDS.DUD),50*i)}
game.showTip(`Wow! I won ${gains}`,null,null,{removeLock:!0})}else if(game.situation.slots[0]===1){const gains=100;game.addToInventory({item:"coin",count:gains,image:ASSETS.GRAB_COIN});for(let i=0;i<10;i++){game.delayAction(game=>game.playSound(SOUNDS.DUD),50*i)}
game.showTip(`Wow! I won ${gains}`,null,null,{removeLock:!0})}else if(game.situation.slots[0]===2){const gains=500;game.addToInventory({item:"coin",count:gains,image:ASSETS.GRAB_COIN});for(let i=0;i<20;i++){game.delayAction(game=>game.playSound(SOUNDS.DUD),50*i)}
game.showTip(`Oh wow! I won ${gains}!`,null,null,{removeLock:!0})}}}},sprites:[{src:ASSETS.SLOTS,col:4,row:4,index:9,onClick:game=>{game.gotoScene("shop")},},{src:ASSETS.SLOTS,col:4,row:4,index:game=>{if(!game.sceneData.roll||game.sceneData.roll-game.now<0){return 10+game.situation.slots[0]}
const frame=Math.floor(game.now/50+game.situation.slots[0])%3;return 10+frame},},{src:ASSETS.SLOTS,col:4,row:4,offsetX:11,index:game=>{if(!game.sceneData.roll||game.sceneData.roll-game.now<0){return 10+game.situation.slots[1]}
const frame=Math.floor(game.now/50+game.situation.slots[1])%3;return 10+frame},},{src:ASSETS.SLOTS,col:4,row:4,offsetX:22,index:game=>{if(!game.sceneData.roll||game.sceneData.roll-game.now<0){return 10+game.situation.slots[2]}
const frame=Math.floor(game.now/50+game.situation.slots[2])%3;return 10+frame},},{src:ASSETS.SLOTS,col:4,row:4,index:game=>{if(game.sceneData.putCoin){const frame=Math.floor((game.now-game.sceneData.putCoin)/100);if(frame<=8){return frame}}
return 0},onClick:game=>{game.showTip("It's a slot machine, just like the ones in Vegas!")},combine:(item,game)=>{if(item==="coin"){game.sceneData.putCoin=game.now;game.sceneData.coinSound=0;game.removeFromInventory(item);game.useItem=null;game.delayAction(game=>{game.playSound(SOUNDS.DUD)},400);game.delayAction(game=>{game.playSound(SOUNDS.JINGLE);game.sceneData.roll=game.now+2000;game.situation.coinPlayed++;if(game.situation.coinPlayed===game.situation.initial.lastCoin){game.situation.slots=game.situation.initial.slots}else if(game.situation.coinPlayed<game.situation.initial.lastCoin){game.situation.slots=[Math.floor(Math.random()*3),Math.floor(Math.random()*3),Math.floor(Math.random()*3),];if(game.situation.slots[0]===game.situation.slots[1]){game.situation.slots[2]=(game.situation.slots[1]+1)%3}}else{const chances=1500;const roll=Math.floor(chances*Math.random());if(roll===0){game.situation.slots=[2,2,2]}else if(roll<=5){game.situation.slots=[1,1,1]}else if(roll<=20){game.situation.slots=[0,0,0]}else{game.situation.slots=[Math.floor(Math.random()*3),Math.floor(Math.random()*3),Math.floor(Math.random()*3),];if(game.situation.slots[0]===game.situation.slots[1]){game.situation.slots[2]=(game.situation.slots[1]+1)%3}}}},800);return!0}},},...standardMenu(),...standardBag(),],},);game.addScene({name:"space-adventure",startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"){x=7;y=58;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=22;game.playSound(SOUNDS.YUPA)}
game.showTip(msg,onDone,100,{x,y,talker,removeLock})},drawAsteroid:(game,ctx,{dir,rads,rotation,born})=>{const d=(game.now-born)/2000;if(d<0){return}
const dd=d*d;if(dd<1)return;const speed=2.5;const x=32+Math.cos(dir)*dd*speed;const y=32+Math.sin(dir)*dd*speed;ctx.fillStyle="#444444";ctx.beginPath();rads.forEach((dist,index)=>{const angle=Math.PI*2*(index/rads.length+rotation*game.now/1000);const px=x+Math.cos(angle)*dist*dd;const py=y+Math.sin(angle)*dist*dd;if(index===0){ctx.moveTo(px,py)}else{ctx.lineTo(px,py)}});ctx.closePath();ctx.fill();ctx.fillStyle="#555555";ctx.beginPath();rads.forEach((dist,index)=>{const angle=Math.PI/3+Math.PI*2*(index/rads.length+rotation*game.now/1000);const px=x+Math.cos(angle)*dist*dd*.8;const py=y+Math.sin(angle)*dist*dd*.8;if(index===0){ctx.moveTo(px,py)}else{ctx.lineTo(px,py)}});ctx.closePath();ctx.fill();ctx.fillStyle="#666666";ctx.beginPath();rads.forEach((dist,index)=>{const angle=Math.PI/2+Math.PI*2*(index/rads.length+rotation*game.now/1000);const px=x+Math.cos(angle)*dist*dd*.6;const py=y+Math.sin(angle)*dist*dd*.6;if(index===0){ctx.moveTo(px,py)}else{ctx.lineTo(px,py)}});ctx.closePath();ctx.fill()},onScene:game=>{game.data.stats.life=game.data.stats.maxLife;game.waitCursor=!0;game.sceneData.rads=new Array(9).fill(null).map(a=>Math.random()+1);game.delayAction(game=>{game.currentScene.startTalk(game,"human",["Yupa! Yupa!",],game=>{game.delayAction(game=>{game.currentScene.startTalk(game,"human",["Hey Yupa, did you see that?","We just barely avoided collision with a giant asteroid.",],game=>{game.delayAction(game=>{game.currentScene.startTalk(game,"human",["YUPAAA!",]);game.delayAction(game=>{game.playTheme(null);game.playSound(SOUNDS.RANDOM);game.sceneData.nextScene=game.now;game.delayAction(game=>{game.gotoScene("asteroid-field")},1000)},3000)},5000)})},4000)})},8000)},sprites:[{init:(game,sprite)=>{game.playTheme(SOUNDS.SOUP_CHOU_THEME,{volume:.5});const{sceneData}=game;sceneData.stars=new Array(100).fill(null).map(()=>{return{x:(Math.random()-.5)*64,y:(Math.random()-.5)*64,size:.2,}});for(let i=0;i<100;i++){sprite.onRefresh(game,sprite)}},onRefresh:(game,sprite)=>{const{sceneData,now,sceneTime}=game;sceneData.stars.forEach(star=>{star.x*=1.01;star.y*=1.01;star.size*=1.01;if(star.size>1){star.size=1}
if(Math.abs(star.x)>32||Math.abs(star.y)>32){star.x=(Math.random()-.5)*64;star.y=(Math.random()-.5)*64;star.size=.2}})},custom:(game,sprite,ctx)=>{ctx.fillStyle="#000022";ctx.fillRect(0,0,64,64);ctx.fillStyle="#FFFFFF";const{sceneData}=game;sceneData.stars.forEach(({x,y,size})=>{ctx.fillRect(32+x,32+y,size,size)})},hidden:({sceneData})=>!sceneData.stars,},{custom:(game,sprite,ctx)=>{game.currentScene.drawAsteroid(game,ctx,{dir:Math.PI/3,rotation:1,born:game.sceneTime,rads:game.sceneData.rads,});for(let i=0;i<10;i++){game.currentScene.drawAsteroid(game,ctx,{dir:Math.PI*2*i/10,rotation:i/10,born:game.sceneTime+((i*7)%4)*2000+25000,rads:game.sceneData.rads,})}},},{src:ASSETS.SPACESHIP,col:1,row:2,scale:game=>{if(!game.sceneData.toPlanet){return 1}
const timeProgress=Math.max(0,1-(Math.max(0,game.now-game.sceneData.toPlanet-5000)/3000));return timeProgress*timeProgress},offsetX:(game,sprite)=>{return 10+20-game.evaluate(sprite.scale)*20},offsetY:(game,sprite)=>{return 10+20-game.evaluate(sprite.scale)*20},hidden:(game,sprite)=>!game.evaluate(sprite.scale),},{custom:(game,sprite,ctx)=>{const fade=Math.min(1,(game.now-game.sceneData.nextScene)/1000);const imageData=ctx.getImageData(0,0,64,64);for(let i=0;i<imageData.data.length;i+=4){if(Math.random()<fade){imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255;imageData.data[i+3]=255}}
ctx.putImageData(imageData,0,0)},hidden:game=>!game.sceneData.nextScene,},],},);game.addScene({name:"space-travel",onScene:game=>{game.hideCursor=!0},sprites:[{init:(game,sprite)=>{game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.7});const{sceneData}=game;sceneData.stars=new Array(100).fill(null).map(()=>{return{x:(Math.random()-.5)*64,y:(Math.random()-.5)*64,size:.2,}});for(let i=0;i<100;i++){sprite.onRefresh(game,sprite)}
game.delayAction(game=>{game.fadeToScene("sarlie-planet")},6000)},onRefresh:(game,sprite)=>{const{sceneData,now,sceneTime}=game;sceneData.stars.forEach(star=>{star.x*=1.01;star.y*=1.01;star.size*=1.01;if(star.size>1){star.size=1}
if(Math.abs(star.x)>32||Math.abs(star.y)>32){star.x=(Math.random()-.5)*64;star.y=(Math.random()-.5)*64;star.size=.2}})},custom:(game,sprite,ctx)=>{ctx.fillStyle="#000022";ctx.fillRect(0,0,64,64);ctx.fillStyle="#FFFFFF";const{sceneData}=game;sceneData.stars.forEach(({x,y,size})=>{ctx.fillRect(32+x,32+y,size,size)})},hidden:({sceneData})=>!sceneData.stars,},{src:ASSETS.SPACESHIP,col:1,row:2,scale:game=>{const timeProgress=Math.max(0,1-(Math.max(0,game.now-game.sceneTime-2000)/3000));return timeProgress*timeProgress},offsetX:(game,sprite)=>10+20-game.evaluate(sprite.scale)*20,offsetY:(game,sprite)=>5+20-game.evaluate(sprite.scale)*20,hidden:(game,sprite)=>!game.evaluate(sprite.scale),},...standardMenu(),...standardBag(),],},);game.addScene({name:"stars",arrowGrid:[[null,null,MENU,null,null],[],[],[],[null,null,null,null,null],],onScene:game=>{game.hideCursor=!0;const{sceneData}=game;game.playTheme(SOUNDS.SOUP_CHOU_THEME,{volume:.7});game.delayAction(game=>game.hideCursor=!1,10000);delete game.inventory["access card"];delete game.inventory.key;game.data.leftHand="none";game.data.stats.life=game.data.stats.maxLife},onSceneRefresh:game=>{const{sceneData,now,sceneTime}=game;if(now-sceneTime>5000&&now-sceneTime<10000){game.playTheme(SOUNDS.SOUP_CHOU_THEME,{volume:.7-.4*Math.min(1,(now-(sceneTime+5000))/5000)})}},startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"){x=15;y=23;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=3;y=23;game.playSound(SOUNDS.YUPA)}else if(talker==="alexa"){x=12;y=20;game.playSound(SOUNDS.OKAY);msg=msg.split("").map(a=>" ").join("")}
game.showTip(msg,onDone,talker==="yupa"?140:100,{x,y,talker,removeLock})},sprites:[{init:({sceneData})=>{sceneData.stars=new Array(100).fill(null).map(()=>{return{x:(Math.random()-.5)*64,y:(Math.random()-.5)*64,size:.2,}})},onRefresh:(game,sprite)=>{const{sceneData,now,sceneTime}=game;sceneData.stars.forEach(star=>{star.x*=1.01;star.y*=1.01;star.size*=1.01;if(star.size>1){star.size=1}
if(Math.abs(star.x)>32||Math.abs(star.y)>32){star.x=(Math.random()-.5)*64;star.y=(Math.random()-.5)*64;star.size=.2}})},custom:(game,sprite,ctx)=>{ctx.fillStyle="#000022";ctx.fillRect(0,0,64,64);ctx.fillStyle="#FFFFFF";const{sceneData}=game;sceneData.stars.forEach(({x,y,size})=>{ctx.fillRect(32+x,32+y,size,size)})},},{src:ASSETS.HOTTUB,col:1,row:2,index:({now})=>Math.floor(now/1000)%2,alpha:({now,sceneTime})=>Math.min(1,Math.max(0,now-sceneTime-5000)/3000),scale:({now,sceneTime})=>{const dx=Math.max(0,now-sceneTime-5000)/4000;return 4/Math.min(4,dx*dx)},offsetX:(game,sprite)=>32-32*game.evaluate(sprite.scale),offsetY:(game,sprite)=>16-16*game.evaluate(sprite.scale),},{src:ASSETS.YUPA_HOTTUB,col:1,row:2,index:({now,pendingTip})=>pendingTip&&pendingTip.talker==="yupa"?Math.floor(now/100)%2:0,alpha:({now,sceneTime})=>Math.min(1,Math.max(0,now-sceneTime-5000)/3000),scale:({now,sceneTime})=>{const dx=Math.max(0,now-sceneTime-5000)/4000;return 4/Math.min(4,dx*dx)},offsetX:(game,sprite)=>32-32*game.evaluate(sprite.scale),offsetY:(game,sprite)=>16-16*game.evaluate(sprite.scale),onClick:game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{hidden:game.sceneData.spoken1,msg:game=>game.sceneData.spoken1?"":"This is great!",onSelect:(game)=>{game.waitCursor=!0;game.sceneData.spoken1=game.now;game.currentScene.startTalk(game,"human","This is great!",game=>{game.currentScene.startTalk(game,"yupa","Yuuup!...",game=>{game.currentScene.startTalk(game,"human","What a genius idea to install a hot tub in your spaceship!",game=>{game.waitCursor=!1;game.currentScene.startTalk(game,"yupa","Yuuup!...")})})})},},{hidden:game.sceneData.spoken2,msg:game=>game.sceneData.spoken2?"":"So, what now?",onSelect:(game)=>{game.sceneData.spoken2=game.now;game.waitCursor=!0;game.currentScene.startTalk(game,"human","So, what do we do now?",game=>{game.currentScene.startTalk(game,"yupa",`Chill ~${game.data.name||"Hitman"}~, we jost chill.`,game=>{game.currentScene.startTalk(game,"human","Just chill? Forever?",game=>{game.currentScene.startTalk(game,"yupa","Yuuup!...",game=>{game.waitCursor=!1;game.currentScene.startTalk(game,"human","Haha! Alright Yupa.")})})})})},},{msg:game=>game.calledAlexa?"Nevermind":"Let's drink?",onSelect:game=>{if(game.calledAlexa){game.dialog=null;return}
game.waitCursor=!0;game.currentScene.startTalk(game,"human","Yupa, let's go get a drink. What do you think?",game=>{game.currentScene.startTalk(game,"yupa","Im good but halp yorself wif Alectra",game=>{game.currentScene.startTalk(game,"human","Alright, don't mind if I do.",game=>{game.currentScene.startTalk(game,"human","ALECTRA!",null,!0);game.dialog.index=1;game.dialog.paused=game.now;game.delayAction(game=>{game.calledAlexa=game.now;game.playSound(SOUNDS.DIVING,{volume:.5})},1500);game.delayAction(game=>{game.currentScene.startTalk(game,"alexa","Okay.",game=>{game.dialog.paused=0;game.waitCursor=!1})},3000)})})})},},{},{},],},{options:[{msg:"I want a beer!",onSelect:(game,dialog)=>{game.waitCursor=!0;game.currentScene.startTalk(game,"human","Alectra, bring me a nice cold beer!",game=>{game.currentScene.startTalk(game,"alexa","Okay.",game=>{game.situation.drink="beer";game.sceneData.alexaRotate=game.now;game.playSound(SOUNDS.DIVING,{volume:.5});game.waitCursor=!1;game.dialog=null})})},},{msg:"Bring me cider!",onSelect:(game,dialog)=>{game.waitCursor=!0;game.currentScene.startTalk(game,"human","I want some sparklin' cidah! Gimme some!",game=>{game.currentScene.startTalk(game,"alexa","Okay.",game=>{game.situation.drink="sparklin' cidah";game.sceneData.alexaRotate=game.now;game.playSound(SOUNDS.DIVING,{volume:.5});game.waitCursor=!1;game.dialog=null})})},},{msg:"Got Ramune?",onSelect:(game,dialog)=>{game.waitCursor=!0;game.currentScene.startTalk(game,"human",["Do you know Ramune?","I love that drink, bring me Ramune!"],game=>{game.currentScene.startTalk(game,"alexa","Okay.",game=>{game.situation.drink="Ramune";game.sceneData.alexaRotate=game.now;game.playSound(SOUNDS.DIVING,{volume:.5});game.waitCursor=!1;game.dialog=null})})},},],},],})},},{src:ASSETS.HUMAN_HOTTUB,col:1,row:2,index:({now,pendingTip})=>pendingTip&&pendingTip.talker==="human"?Math.floor(now/100)%2:0,alpha:({now,sceneTime})=>Math.min(1,Math.max(0,now-sceneTime-5000)/3000),scale:({now,sceneTime})=>{const dx=Math.max(0,now-sceneTime-5000)/4000;return 4/Math.min(4,dx*dx)},offsetX:(game,sprite)=>32-32*game.evaluate(sprite.scale),offsetY:(game,sprite)=>16-16*game.evaluate(sprite.scale),},{src:ASSETS.ALEXA,col:4,row:4,index:({now,pendingTip})=>{if(game.sceneData.alexaRotate){return Math.min(5,Math.floor((now-game.sceneData.alexaRotate)/100))+2}
return pendingTip&&pendingTip.talker==="alexa"?Math.floor(now/100)%2:0},offsetY:(game,sprite)=>{const progress=Math.max(0,Math.min(1,1-(game.now-game.calledAlexa)/3000));return Math.round(-30*progress*progress)},hidden:game=>!game.calledAlexa,noHighlight:game=>!game.sceneData.alexaRotate,onClick:game=>{game.gotoScene("zoom-hottub")},},...standardMenu(),...standardBag(),],},);game.addScene({name:"start-screen",touchScreen:game=>{return"start"},onScene:game=>{game.sceneData.shift=0;game.sceneData.maxSlot=0;game.delayAction(game=>{game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.5});const list=game.getSaveList();game.sceneData.loadSave={};for(let name in list){if(name!=="last"){const{image}=list[name];const img=new Image();img.src=image;game.sceneData.loadSave[name]={img,name,}}}
for(let i in game.sceneData.loadSave){const{name}=game.sceneData.loadSave[i];if(!isNaN(parseInt(name))){game.sceneData.maxSlot=Math.max(parseInt(name),game.sceneData.maxSlot)}}
game.currentScene.onStartDialog(game);game.gameLoaded=!0},1000)},sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData,dialog},{index,hoverTime},ctx)=>{if(sceneData.loadSave){const spriteIndex=index+game.sceneData.shift;const{img}=sceneData.loadSave[spriteIndex];if(img){const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const px=2+Math.floor(index/2)*32,py=2+(index%2+2)%2*32;ctx.drawImage(img,px+offsetX,py);if(hoverTime&&!dialog.hovered){ctx.beginPath();ctx.lineWidth="2px"
ctx.strokeStyle="#aaccff";ctx.rect(px+offsetX,py,28,28);ctx.stroke()}
game.displayTextLine(ctx,{msg:`#${spriteIndex+1}`,x:px+offsetX+1,y:py+2,alpha:.8,dark:!0,});game.displayTextLine(ctx,{msg:`#${spriteIndex+1}`,x:px+offsetX+1,y:py+1,})}}},onClick:(game,{index})=>{const spriteIndex=index+game.sceneData.shift;const{sceneData}=game;game.playSound(SOUNDS.SELECT);game.load(sceneData.loadSave[spriteIndex].name)},hidden:({sceneData,dialog},{index})=>{const spriteIndex=index+game.sceneData.shift;return!dialog||dialog.index!==2||!sceneData.loadSave||!sceneData.loadSave[spriteIndex]},}})),{src:ASSETS.SIDE_BUTTONS,side:LEFT,index:({hoverSprite,dialog},sprite)=>hoverSprite===sprite&&!dialog.hovered?1:0,onClick:game=>{game.sceneData.shift-=2;game.sceneData.sideLeft=game.now},hidden:game=>game.sceneData.shift<=0||game.dialog&&game.dialog.hovered,},{src:ASSETS.SIDE_BUTTONS,side:RIGHT,index:({hoverSprite,dialog},sprite)=>hoverSprite===sprite&&(!dialog||!dialog.hovered)?1:0,onClick:game=>{game.sceneData.shift+=2;game.sceneData.sideRight=game.now},hidden:game=>game.sceneData.maxSlot-game.sceneData.shift<=3||game.dialog&&game.dialog.hovered,},{src:ASSETS.MOON_BASE,hidden:({dialog})=>dialog&&dialog.index===2,},{src:ASSETS.MOON_BASE_GUARD,col:1,row:2,side:LEFT,index:({now,sceneTime})=>Math.floor((now-sceneTime)/1000)%2,offsetX:({now,sceneTime})=>-15+Math.floor((now-sceneTime)/1000)%75,offsetY:-2,hidden:({dialog})=>dialog&&dialog.index===2,},{src:ASSETS.MOON_BASE_GUARD,col:1,row:2,side:RIGHT,index:({now,sceneTime})=>Math.floor((now-sceneTime)/1000)%2,offsetX:({now,sceneTime})=>+15-Math.floor((now-sceneTime)/1000)%75,hidden:({dialog})=>dialog&&dialog.index===2,},{custom:(game,sprite,ctx)=>{const fade=1-Math.min(1,(game.now-game.sceneTime)/1000);const imageData=ctx.getImageData(0,0,64,64);for(let i=0;i<imageData.data.length;i+=4){if(Math.random()<fade){imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255;imageData.data[i+3]=255}}
ctx.putImageData(imageData,0,0)},hidden:game=>game.now-game.sceneTime>1000,},{src:ASSETS.HITLER,hidden:({now,sceneData})=>!sceneData.about&&!sceneData.notAbout||sceneData.notAbout&&now-sceneData.notAbout>=1000,alpha:({now,sceneData})=>Math.min(1,sceneData.notAbout?1-(now-sceneData.notAbout)/1000:(now-sceneData.about)/1000),onClick:game=>{if(!game.sceneData.notAbout){game.sceneData.notAbout=game.now;game.sceneData.about=0;game.currentScene.onStartDialog(game)}},},{init:game=>{game.sceneData.credits=`
						This game is the sequel to
						“Kill Baby Hitler”
						a game published on january 2019.

						The first part of this game was released as an entry for september's\n#LOWREZJAM\n2019, a jam to make a game\nentirely fit a 64x64 pixels screen.

						The game was then iterated on.

						This is a\npoint-and-click\nadventure.\nUse the cursor to interact with items and pick them up.\nYou have an\ninventory and stats that you can increase. Use your wits to solve puzzles.

						There is one main ending and three alternate endings to unlock.
					`.split("\n").map((a,index)=>game.wordwrap(a.trim(),13)).join("\n").split("\n")},custom:(game,sprite,ctx)=>{if(game.now-game.sceneData.scrollTime){ctx.fillStyle="#000000";ctx.globalAlpha=Math.min(.6,(game.now-game.sceneData.scrollTime)/5000);ctx.fillRect(0,0,64,64)}
ctx.globalAlpha=.8;const shift=-(game.now-game.sceneData.scrollTime-1000)/200+50;game.sceneData.credits.forEach((line,index)=>{const y=index*7+shift;if(y>0&&y<55){game.displayTextLine(ctx,{msg:line,x:1,y:Math.round(y),alpha:Math.max(0.05,Math.min(.8,y/5,(55-y)/5)),})}})},hidden:game=>!game.sceneData.about,onRefresh:game=>{if(game.sceneData.about){if(game.now-game.sceneData.scrollTime>60000){game.sceneData.notAbout=game.now;game.sceneData.about=0;game.currentScene.onStartDialog(game)}}},},],onStartDialog:game=>{const backSelection={msg:"Back",onSelect:(game,dialog)=>dialog.index=0,};game.startDialog({time:game.now,index:0,highlightColor:"#00998899",conversation:[{options:[{hidden:({sceneData})=>Object.keys(sceneData.loadSave).filter(name=>name!=="clear").length,},{msg:"New Game",onSelect:game=>{game.dialog=null;game.hideCursor=!0;const fadeDuration=3000;game.fadeOut(game.now,{duration:fadeDuration*1.5,fadeDuration,color:"#000000",onDone:game=>{game.gotoScene("origin")}})}},{hidden:({sceneData})=>!Object.keys(sceneData.loadSave).filter(name=>name!=="clear").length,msg:"Load",onSelect:(game,dialog)=>dialog.index=2,},{msg:"Options",onSelect:(game,dialog)=>dialog.index=1,},],},{offsetY:(game,{options})=>(options.filter(({hidden})=>!hidden).length-3)*-7,options:[{msg:"About this game",onSelect:(game,dialog)=>{game.sceneData.about=game.now;game.sceneData.notAbout=0;game.sceneData.scrollTime=game.now;game.dialog=null},},{msg:game=>`Sound ~${!game.mute?"ON":"OFF"}`,onSelect:(game,dialog)=>game.mute=!game.mute,},{msg:()=>`Retro mode ~${scanlines[0].checked?"ON":"OFF"}`,onSelect:(game,dialog)=>toggleScanlines(),},{hidden:!0,msg:"Language",onSelect:(game,dialog)=>game.showTip("Option not yet available"),},{cantSelect:game=>game.disableFullScreen,msg:game=>game.disableFullScreen?"Full screen not supported":document.fullscreenElement?"Exit Full Screen":"Full Screen",onSelect:(game,dialog)=>{game.toggleFullScreen()},},backSelection,],},{options:[{},{},backSelection,],}],})},},);game.addScene({name:"stay-here-baby-hitler",onScene:game=>{game.playTheme(null)},onSceneRefresh:game=>{if(!game.sceneData.lastCrowd||game.now-game.sceneData.lastCrowd>1000){game.playSound(SOUNDS.RANDOM,{volume:.15});game.sceneData.lastCrowd=game.now+Math.random()*1000+500}},sprites:[],},);game.addScene({name:"surface",onScene:game=>{game.save();game.playTheme(null);game.situation.shift={x:0,y:0}},sprites:[{init:({sceneData})=>{const tempCanvas=document.createElement("canvas");tempCanvas.width=64;tempCanvas.height=64;tempCtx=tempCanvas.getContext("2d");sceneData.tempCtx=tempCtx},getRandom:(game,x,y)=>Math.floor(Math.abs(Math.sin(x*7+y*13))*11),custom:(game,sprite,ctx)=>{ctx.fillStyle="#333343";ctx.fillRect(0,0,64,64);tempCtx.clearRect(0,0,64,64);tempCtx.fillStyle="#333343";const{shift}=game.situation;for(let y=Math.floor(shift.y-5);y<shift.y+5;y++){for(let x=Math.floor(shift.x-5);x<shift.x+5;x++){const random=sprite.getRandom(game,x,y);if((random*13)%5==0){const size=(random*13)%10+3;const dx=(random*37)%10-5;const dy=(random*17)%10-5;tempCtx.beginPath();tempCtx.arc(x*10+32+dx,y*10+32+dy,size,0,2*Math.PI);tempCtx.fill()}}}
ctx.shadowColor="#FFFFFF";ctx.shadowBlur=1;ctx.drawImage(tempCtx.canvas,0,0);ctx.shadowBlur=0},},...standardMenu(),...standardBag(),],},);game.addScene({name:"tavern-entrance-zoom",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onScene:game=>{game.save();if(!game.situation.shift){game.situation.shift=0}},sprites:[{src:ASSETS.ZOOM_TAVERN_DOOR,noHighlight:!0,onClick:game=>{game.gotoScene("tavern-entrance")},},{src:ASSETS.ZOOM_TAVERN_DOOR_LADY,col:2,row:2,onClick:game=>{game.playSound(SOUNDS.HUM_LADY);game.showTip(game.situation.revealPassword?["I told all my friends about the password.","Now we can all go in and have fun!",]:["I've been trying to get in as well,","but I don't know the\npassword\neither.",],game=>{game.startDialog({conversation:[{options:[{msg:"Why go in?",onSelect:game=>{game.playSound(SOUNDS.HUM);game.showTip(["Why are you trying to get in?",],game=>{game.playSound(SOUNDS.HUM_LADY);game.showTip(["Everyone knows, this place serves the most\nmarvelous cocktails.","And a lot of young handsome men...",],game=>{},80,{talker:"lady"})},80,{talker:"human"})},},{msg:"Reveal password",hidden:game=>game.situation.revealPassword,onSelect:game=>{game.playSound(SOUNDS.HUM);game.showTip(["Would you like to know the\npassword?",],game=>{game.playSound(SOUNDS.HUM_LADY);game.showTip(["Yes please!",],game=>{game.dialog.index=1},80,{talker:"lady"})},80,{talker:"human"})},},{msg:"I'm poor",hidden:game=>!game.situation.revealPassword||game.countItem("coin"),onSelect:game=>{game.playSound(SOUNDS.HUM);game.showTip(["Can you spare some change?",],game=>{game.playSound(SOUNDS.HUM_LADY);game.showTip(["Sure! Here you go",],game=>{game.pickUp({item:"coin",image:ASSETS.GRAB_COIN,message:"1 coin"})},80,{talker:"lady"})})},},{msg:"LEAVE",onSelect:game=>{game.gotoScene("tavern-entrance")}},],},{options:[{hidden:game=>!game.getSituation("tavern-stranger-zoom").knowPassword,msg:"707 - 8008",onSelect:game=>{game.playSound(SOUNDS.HUM);game.showTip(["Alright, not sure if I can trust you this time,","but I'll take my chances.","Keep it a secret:","To get in, the password is",`${"707 - 8008"}`,],game=>{game.situation.revealPassword=game.now;game.playSound(SOUNDS.HUM_LADY);game.showTip(["707 - 8008, got it.","Thank you! I will tell that to all my friends!","Here's a token of my\ngratitude",],game=>{game.pickUp({item:"coin",image:ASSETS.GRAB_COIN,message:"1 coin",onPicked:game=>{game.playSound(SOUNDS.HUM_LADY);game.showTip(["I'm a rich and\ngenerous lady ...",],null,80,{talker:"lady"})},});game.dialog.index=0},80,{talker:"lady"})})},},{msg:"I don't know",onSelect:game=>{game.playSound(SOUNDS.HUM);game.showTip(["I actually don't know the password.",],game=>{game.playSound(SOUNDS.HUM_LADY);game.showTip(["Pff... get out of here!",],game=>{game.dialog.index=0},80,{talker:"lady"})})},},{msg:"Nevermind",onSelect:game=>{game.dialog.index=0},},],},],})},80,{talker:"lady"})},index:game=>game.pendingTip&&game.pendingTip.talker==="lady"&&game.pendingTip.progress<1?Math.floor(game.now/100)%4:0,},{src:ASSETS.ZOOM_TAVERN_DOOR_SMOKE,col:2,row:2,index:({now})=>Math.floor(now/300)%4,},{src:ASSETS.ZOOM_TAVERN_DOOR_ROBOT,col:3,row:3,offsetY:game=>Math.round(Math.sin(game.now/600)*3),onClick:game=>{game.waitCursor=!0;game.showTip(["The tavern is for members only.",],game=>{game.waitCursor=!1;game.startDialog({conversation:[{options:[{msg:"Got the password",onSelect:game=>{game.waitCursor=!0;game.showTip("Go ahead, enter the password.",game=>{game.dialog=null;game.sceneData.showDigits=game.now;game.delayAction(game=>{game.waitCursor=!1;game.gotoScene("robot-dial")},1000)},80,{talker:"robot"})},},{msg:"Become a member",onSelect:game=>{game.playSound(SOUNDS.HUM);game.showTip("How do I become a member?",game=>{game.showTip("You come inside and talk with the patron.",game=>{game.playSound(SOUNDS.HUM);game.showTip("But I can't come inside if I'm not a member!")},80,{talker:"robot"})})},},{msg:"LEAVE",onSelect:game=>{game.gotoScene("tavern-entrance")}},],},],})},80,{talker:"robot"})},onRefresh:game=>{if(game.pendingTip&&game.pendingTip.talker==="robot"&&game.pendingTip.progress<1){if(!game.sceneData.robotVoice){game.sceneData.robotVoice=!0;game.playSound(SOUNDS.ROBOT_VOICE,{loop:!0})}}else{if(game.sceneData.robotVoice){game.sceneData.robotVoice=!1;game.stopSound(SOUNDS.ROBOT_VOICE)}}},index:game=>{if(game.sceneData.showDigits){return 4+Math.min(3,Math.floor((game.now-game.sceneData.showDigits)/200))}
return game.pendingTip&&game.pendingTip.talker==="robot"&&game.pendingTip.progress<1?Math.floor(game.now/30)%4:0},},...standardMenu(),...standardBag(),],},);game.addScene({name:"tavern-entrance",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,s(12),null,null],],onScene:game=>{game.save();game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.5});if(!game.situation.shift){game.situation.shift=0}
game.sceneData.noTurn=!0},onSceneRefresh:game=>{if(game.mouse&&game.mouse.x>64-5||game.actionDown===RIGHT){game.situation.shift-=.3;game.situation.shift=Math.max(-64,Math.min(0,game.situation.shift))}else if(game.mouse&&game.mouse.x<5||game.actionDown===LEFT){game.situation.shift+=.3;game.situation.shift=Math.max(-64,Math.min(0,game.situation.shift))}},onSceneBackward:game=>{game.fadeToScene("final-planet-world")},onSceneForward:game=>{if(game.situation.beenInTavern){game.fadeToScene("explore-tavern")}else{game.situation.beenInTavern=game.now;game.fadeToScene("look-right-left")}
game.actionDown=FORWARD;return!0},customCursor:(game,ctx)=>{if(game.mouse){const{x,y}=game.mouse;if(x>64-5&&game.situation.shift>-64){game.displayImage(ctx,{src:ASSETS.ARROW_CURSOR,offsetX:x-5,offsetY:y-5,size:[11,11],col:1,row:2,index:1});return"none"}else if(x<5&&game.situation.shift<0){game.displayImage(ctx,{src:ASSETS.ARROW_CURSOR,offsetX:x-5,offsetY:y-5,size:[11,11],col:1,row:2,index:0});return"none"}}},canGo:(game,direction)=>{if(direction===FORWARD){return game.situation.shift>-20&&game.sceneData.openedDoor}
if(direction===RIGHT){return game.situation.shift>-64}
if(direction===LEFT){return game.situation.shift<0}
return!0},openDoor:game=>{game.playSound(SOUNDS.DOOR);game.sceneData.openedDoor=game.now},sprites:[{src:ASSETS.TAVERN_ENTRANCE,col:2,row:5,size:[128,64],offsetX:game=>Math.round(game.situation.shift),index:0,},{src:ASSETS.TAVERN_ENTRANCE,col:2,row:5,size:[128,64],offsetX:game=>Math.round(game.situation.shift),index:game=>{if(game.sceneData.openedDoor){const time=game.now-game.sceneData.openedDoor;return Math.min(9,7+Math.floor(time/200))}
return 7},onClick:game=>{if(game.sceneData.openedDoor){game.currentScene.onSceneForward(game)}else if(game.getSituation("robot-dial").gotPassword){game.currentScene.openDoor(game)}else{game.gotoScene("tavern-entrance-zoom")}},},{src:ASSETS.TAVERN_ENTRANCE,col:2,row:5,size:[128,64],offsetX:game=>Math.round(game.situation.shift),index:4,onClick:game=>{game.gotoScene("tavern-posters")},},{src:ASSETS.TAVERN_ENTRANCE,col:2,row:5,size:[128,64],offsetX:game=>Math.round(game.situation.shift),index:game=>Math.floor(game.now/300)%10===0?2:1,onClick:game=>{game.gotoScene("tavern-entrance-zoom")},},{src:ASSETS.TAVERN_ENTRANCE,col:2,row:5,size:[128,64],offsetX:game=>Math.round(game.situation.shift),offsetY:game=>Math.round(Math.sin(game.now/400)*1.5),index:3,onClick:game=>{game.gotoScene("tavern-entrance-zoom")},},{src:ASSETS.TAVERN_ENTRANCE,col:2,row:5,size:[128,64],offsetX:game=>Math.round(game.situation.shift),index:game=>Math.floor(game.now/300)%13===5?6:5,onClick:game=>{game.gotoScene("tavern-stranger-zoom")},},...standardMenu(),...standardBag(),],},);game.addScene({name:"tavern-phone",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onScene:game=>{game.sceneData.digitDown=[];game.sceneData.numberDialed="";if(!game.situation.coin){game.situation.coin=0}
game.sceneData.canCall=game.situation.yupaPhone;game.playTheme(SOUNDS.TURTLE_SONG_THEME,{volume:.2});if(game.situation.yupaAndBrutus){game.sceneData.phoneSplit=game.now-1000;game.sceneData.pickup=game.now-1000;game.sceneData.yupaPhone=game.now;game.sceneData.talker="brutus";game.currentScene.startTalk(game,"yupa",["So dats how I save da day! ...","Oh, my frend iz here","He wantz to tolk"],game=>{game.sceneData.pickup=game.now-1000;game.sceneData.putBack=0;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=game.now;game.currentScene.brutusOnPhone(game)})}},brutusOnPhone:game=>{game.sceneData.pickup=game.now-1000;if(!game.sceneData.phoneSplit||game.sceneData.phoneOut){game.sceneData.phoneSplit=game.now;game.sceneData.phoneOut=0}
game.sceneData.talker="brutus";game.currentScene.startTalk(game,"phone",[!game.situation.startedTalking?"Mr. Ruber is busy.":"Yes?",],game=>{game.situation.startedTalking=game.now;game.startDialog({conversation:[{options:[{msg:"Who are you?",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human","Who is it on the phone?",game=>{game.currentScene.startTalk(game,"phone","I'm Brutus")})},},{msg:"Please hold",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["Can you please hold?",],game=>{game.dialog=null})},},{msg:"Bye",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["Bye for now.",],game=>{game.playSound(SOUNDS.HIT);game.sceneData.phoneOut=game.now;game.sceneData.phoneSplit=0;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=0;game.sceneData.numberDialed="";game.situation.yupaAndBrutus=0;game.dialog=null})},},],},],})})},onDial:(game,sprite)=>{const digit=(sprite.index-12)%10;game.sceneData.digitDown[digit]=game.now;if(game.sceneData.canCall){if(game.sceneData.numberDialed.length<7){game.sceneData.numberDialed+=digit;if(game.sceneData.pickup||game.situation.yupaPhone){game.setTone(5,digit)}
const PASSWORD="7078008";if(game.sceneData.numberDialed.length===7){game.waitCursor=!0;game.delayAction(game=>{if(game.sceneData.numberDialed===PASSWORD){game.sceneData.canCall=0;game.setTone(4);game.delayAction(game=>{game.setTone(0);game.playSound(SOUNDS.HIT);game.sceneData.phoneSplit=game.now;game.sceneData.phoneOut=0;game.sceneData.talker="bartender";game.delayAction(game=>{game.currentScene.startTalk(game,"phone",["Hello","This is Westrow's tavern.","How can I assist you?",],game=>{game.waitCursor=!1;if(game.situation.yupaPhone){game.currentScene.startTalk(game,"yupa",[`Ma frend ~${game.data.name||"Hitman"}~ wanna talk to yu.`,],game=>{game.sceneData.pickup=game.now-1000;game.sceneData.putBack=0;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=game.now})}
game.startDialog({conversation:[{options:[{msg:"Order pizza",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["Hey so... I'd like to order a pizza.",],game=>{game.currentScene.startTalk(game,"phone",["Sorry, we don't deliver...","and we also don't make pizza!"],game=>{game.playSound(SOUNDS.HIT);game.sceneData.phoneOut=game.now;game.sceneData.phoneSplit=0;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=0;game.sceneData.numberDialed="";game.dialog=null})})}},{msg:"Dick Ruber",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["Is Dick Ruber around?","I'd like to talk to him.",],game=>{game.currentScene.startTalk(game,"phone",["Oh yes, he's here.","Give me a second.",],game=>{game.getSituation("explore-tavern").confirmDick=game.now;game.gotoScene("call-gangsta")})})},},{msg:"Wrong number",onSelect:(game,dialog)=>{game.currentScene.startTalk(game,"human",["Sorry I dialed the wrong\nnumber.",],game=>{game.playSound(SOUNDS.HIT);game.sceneData.phoneOut=game.now;game.sceneData.phoneSplit=0;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=0;game.sceneData.numberDialed="";game.dialog=null})},},],},],})})},500)},5000)}else{game.waitCursor=!1;game.playSound(SOUNDS.INVALID_NUMBER,{volume:.2,loop:!0});game.showTip("Wrong number...",null,null,{removeLock:!0})}},600)}}}
console.log(game.sceneData.numberDialed)},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="human"){x=2;y=55;game.playSound(SOUNDS.HUM)}else if(talker==="human2"){x=2;y=35;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=5;y=40;game.playSound(SOUNDS.YUPA)}else if(talker==="phone"){x=2;y=45;game.playSound(game.sceneData.talker==="brutus"?SOUNDS.YES_BOSS:SOUNDS.HELLO_HUMAN,{volume:.5})}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},putBackPhone:game=>{if(game.sceneData.pickup){game.sceneData.pickup=0;game.sceneData.putBack=game.now;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=0;game.sceneData.numberDialed="";game.delayAction(game=>{game.playSound(SOUNDS.HIT,{volume:.5});game.setTone(0);game.stopSound(SOUNDS.INVALID_NUMBER);if(game.sceneData.phoneSplit){game.sceneData.phoneOut=game.now;game.sceneData.phoneSplit=0;game.situation.yupaAndBrutus=0}
if(game.sceneData.canCall){game.delayAction(game=>{game.playSound(SOUNDS.DUD,{volume:.5});game.situation.droppedCoins=(game.situation.droppedCoins||0)+1},100)}
game.sceneData.canCall=!1},200)}},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#00000088";ctx.fillRect(48,0,16,64)},noHighlight:!0,onClick:game=>{game.stopSound(SOUNDS.INVALID_NUMBER);if(game.sceneData.pickup){game.currentScene.putBackPhone(game)}else{game.gotoScene("explore-tavern")}},},{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:26,onClick:game=>{if(game.dialog){return}
if(game.sceneData.pickup&&!game.situation.yupaPhone){if(game.sceneData.talker==="brutus"&&game.sceneData.phoneSplit){if(game.situation.explainedToYupa){game.currentScene.startTalk(game,"human2",["You're ready to keep that guy busy on the phone?",],game=>{game.currentScene.startTalk(game,"yupa",["Shure! I gat latza thingz to talkabowt.",],game=>{game.situation.yupaPhone=game.now;game.currentScene.startTalk(game,"yupa",["Halo?","Wanna hear an awesume storey?",],game=>{game.situation.yupaAndBrutus=game.now;game.gotoScene("explore-tavern")})})})}else{game.waitCursor=!0;game.situation.explainedToYupa=!0;game.currentScene.startTalk(game,"human2",["Listen Yupa,","One of Dick Ruber's\nbodyguard is on the other line.","I'm gonna need you to keep him on the phone as long as possible.","Just make up a conversation,","you can talk about your life in the parallel universe..."],game=>{game.currentScene.startTalk(game,"yupa",["Oh dat's rite!","Itz a prutty awesume story!",],game=>{game.situation.yupaPhone=game.now;game.currentScene.startTalk(game,"yupa",["Halo?","Wanna hear an awesume storey?",],game=>{game.situation.yupaAndBrutus=game.now;game.waitCursor=!1;game.gotoScene("explore-tavern")})})})}}else{game.situation.yupaPhone=game.now;game.currentScene.startTalk(game,"yupa",["Halo?","Whoz on da fone?",])}}else if(game.situation.yupaPhone){game.currentScene.startTalk(game,"yupa",[`Ma frend ~${game.data.name||"Hitman"}~ wanna talk to yu.`,],game=>{game.sceneData.pickup=game.now-1000;game.sceneData.putBack=0;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=game.now;game.situation.yupaAndBrutus=0})}else{game.currentScene.startTalk(game,"yupa",["Who ya ganna call?",])}},},{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,},{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:({now})=>Math.floor(now/50)%3+1,hidden:({pendingTip})=>!pendingTip||pendingTip.progress>=1||pendingTip.talker!=="yupa",},{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:24,tip:"“- Lift handle.\n- Wait for the tone.\n- Insert coin.\n- Dial number.”",},{custom:({sceneData},sprite,ctx)=>{ctx.fillStyle="#002222";ctx.fillRect(28,10,3,3);const PASSWORD="7078008";ctx.fillStyle=game.sceneData.numberDialed===PASSWORD?"#00FF77":game.sceneData.numberDialed.length===7?"#cc4400":sceneData.canCall?"#0088aa":"#000000";ctx.fillRect(28,10,2,2)},},{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:({now,sceneData})=>{if(sceneData.insertCoin){const frame=4+Math.floor((now-sceneData.insertCoin)/100);return frame>8?4:frame}
return 4},combine:(item,game)=>{if(item==="coin"){game.useItem=null;game.delayAction(game=>{game.playSound(SOUNDS.DUD);if(!game.sceneData.pickup&&!game.situation.yupaPhone){game.delayAction(game=>{game.playSound(SOUNDS.DUD);game.situation.droppedCoins=(game.situation.droppedCoins||0)+1},300)}else{game.sceneData.canCall=!0;game.setTone(2)}},500);game.sceneData.insertCoin=game.now;game.situation.coin=(game.situation.coin||0)+1;game.removeFromInventory("coin");return!0}},tip:"“Insert 1 coin”",},...new Array(10).fill(null).map((a,idx)=>{return{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:12+(1+idx),onClick:(game,sprite)=>game.currentScene.onDial(game,sprite),offsetX:({now,sceneData},{index})=>now-sceneData.digitDown[(index-12)%10]<100?-1:0,offsetY:({now,sceneData},{index})=>now-sceneData.digitDown[(index-12)%10]<100?1:0,}}),{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:25,onClick:game=>{game.currentScene.putBackPhone(game)},},{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:28,hidden:game=>!game.situation.droppedCoins,onClick:game=>{game.pickUp({item:"coin",count:game.situation.droppedCoins,image:ASSETS.GRAB_COIN,message:""});game.situation.droppedCoins=0},},{src:ASSETS.INSIDE_TAVERN_PHONE,col:5,row:6,index:({now,sceneData,situation})=>{if(situation.yupaPhone){return 23}
if(sceneData.yupaReturnPhone&&game.now-sceneData.yupaReturnPhone<150){return 29}
if(sceneData.putBack){const frame=Math.max(9,12-Math.floor((now-sceneData.putBack)/150));return frame}
if(sceneData.pickup){const frame=9+Math.floor((now-sceneData.pickup)/150);return frame>12?-1:frame}
return 9},onClick:game=>{if(!game.sceneData.pickup){game.sceneData.numberDialed="";game.sceneData.pickup=game.now;game.sceneData.putBack=0;game.situation.yupaPhone=0;game.sceneData.yupaReturnPhone=0;game.situation.callingDick=0;game.delayAction(game=>{game.playSound(SOUNDS.HIT,{volume:.5});game.delayAction(game=>{game.setTone(1)},500)},400)}},},{src:ASSETS.PHONE_SPLIT,col:3,row:3,offsetX:game=>{if(game.sceneData.phoneOut){return Math.max(-32,-Math.round((game.now-game.sceneData.phoneOut)/10))}
return Math.min(0,-32+Math.round((game.now-game.sceneData.phoneSplit)/10))},offsetY:game=>{if(game.sceneData.phoneOut){return Math.max(-32,-Math.round((game.now-game.sceneData.phoneOut)/10))}
return Math.min(0,-32+Math.round((game.now-game.sceneData.phoneSplit)/10))},hidden:game=>!game.sceneData.phoneSplit&&!game.sceneData.phoneOut,index:({sceneData,pendingTip,now})=>{if(sceneData.talker==="bartender"){return pendingTip&&pendingTip.talker==="phone"&&pendingTip.progress<1?Math.floor(now/100)%4:0}else{return pendingTip&&pendingTip.talker==="phone"&&pendingTip.progress<1?4+Math.floor(now/100)%4:4}},noHighlight:game=>game.dialog,onClick:game=>{if(!game.dialog&&game.sceneData.talker==="brutus"){game.currentScene.brutusOnPhone(game)}},},...standardMenu(),...standardBag(),],},);game.addScene({name:"tavern-posters",onScene:game=>{game.waitCursor=!0;if(!game.situation.seenPoster){game.situation.seenPoster=game.now;game.showTip(["Hey, it looks like Yupa and I.","We're worth a lot of money!"],game=>{game.gotoScene("tavern-entrance")})}else{game.showTip([`Wanted: Yupa and ~${game.data.name||"Hitman"}~`],game=>{game.gotoScene("tavern-entrance")})}},sprites:[{src:ASSETS.POSTERS,},],},);const GANSTER_NAME="Dick Ruber";const PASSWORD="707 - 8008";game.addScene({name:"tavern-stranger-zoom",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y,speed=null;if(talker==="human"){x=2;y=62;game.playSound(SOUNDS.HUM)}else if(talker==="stranger"||talker==="strangerslow"){x=3;y=45;speed=talker==="strangerslow"?250:null;game.playSound(SOUNDS.HUM_LADY)}
game.showTip(msg,onDone,speed,{x,y,talker,removeLock})},onSceneHoldItem:(game,item)=>{if(item==="gun"){game.useItem=null;game.showTip("I don't want to scare anyone.")}},onScene:game=>{const{currentScene,situation,now,sceneData}=game;if(!situation.cigLit){game.delayAction(({sceneData,now})=>{sceneData.takeOutCig=now},1000);currentScene.startTalk(game,"stranger",["Damn it's\nfreaking cold out here.","You got light?",])}else if(game.inventory["ace of hearts"]){currentScene.startTalk(game,"stranger",["You already know what to do.",`Go find ${GANSTER_NAME} and beat him at the game.`,"To get into the tavern, the password is:",],game=>{currentScene.startTalk(game,"strangerslow",[`${PASSWORD}`,],game=>{currentScene.startTalk(game,"stranger",[`That's the same as their phone number.`,],game=>{game.gotoScene("tavern-entrance")})})})}else{currentScene.startTalk(game,"stranger","Hey, it's you again.",game=>{currentScene.startDiscussion(game)})}},startDiscussion:game=>{const{currentScene}=game;game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Who are you?",onSelect:game=>{if(game.situation.introduced){currentScene.startTalk(game,"stranger","I'm just a regular at the tavern.")}else{game.situation.introduced=game.now;currentScene.startTalk(game,"human","Who are you? Are you a member of the tavern?",game=>{currentScene.startTalk(game,"stranger",["Yeah... you can say I'm a regular at the tavern.",],game=>{currentScene.startTalk(game,"human","How often do you come here?",game=>{currentScene.startTalk(game,"stranger","Damn, I pratically live here.")})})})}},},{msg:"How to get in?",onSelect:game=>{currentScene.startTalk(game,"human","How can I get into the tavern?",game=>{currentScene.startTalk(game,"stranger",["The tavern is reserved for members.","We all know the password to get in.","But it's a secret. Most members never share it.",],game=>{game.dialog.index++})})},},{msg:"LEAVE",onSelect:game=>{game.dialog=null;game.gotoScene("tavern-entrance")}},],},{options:[{msg:"How about you?",onSelect:game=>{currentScene.startTalk(game,"human",["How about you?","Are you most members?",],game=>{currentScene.startTalk(game,"stranger",["Well it depends...","What business do you have in this tavern?",],game=>{game.dialog.index ++})})},},{msg:"Give me the pass!",onSelect:game=>{currentScene.startTalk(game,"human",["Give me the pass, or else!",],game=>{currentScene.startTalk(game,"stranger",["Are you\nthreatening me?","Why don't you freaking tell me...","What the hell are you looking for in this tavern?",],game=>{game.dialog.index ++})})},},{msg:"Please, help me!",onSelect:game=>{currentScene.startTalk(game,"human",["Please, help me out dude!","I need to get in. It's a matter of life or death.",],game=>{currentScene.startTalk(game,"stranger",["Hum... really?","What's so\ngoddamn\nimportant in that tavern?",],game=>{game.dialog.index ++})})},},],},{options:[{msg:"Baby Hitler.",onSelect:game=>{currentScene.startTalk(game,"human",["I'm looking for someone...","A kid, his name is...","Baby Hitler!"],game=>{currentScene.startTalk(game,"stranger",["Baby...","Hitler...","I might know that name, or might not...","That depends...","What do you want from him?",],game=>{game.dialog.index ++})})},},{msg:"I can't tell you.",onSelect:game=>{currentScene.startTalk(game,"human",["It's secret! I can't tell you.","I'm on a secret mission.",],game=>{currentScene.startTalk(game,"stranger",["Well it's ok,\nbutthead.","You're not\nsharing, and I'm not sharing."],game=>{game.dialog.index=0})})},},{msg:"I need to pee",onSelect:game=>{currentScene.startTalk(game,"human",["I really need to use the\nrestroom.","My blatter is about to explode!",],game=>{currentScene.startTalk(game,"stranger",["Better piss your pants then. The tavern isn't open for that.",],game=>{game.dialog.index=0})})},},],},{options:[{msg:"He can save me.",onSelect:game=>{currentScene.startTalk(game,"human",["I need his help.","It's a matter of life and death."],game=>{currentScene.startTalk(game,"stranger",["Who are you to him?","I'm not sure I can trust a bloke like you.",])})},},{msg:"Just talk.",onSelect:game=>{currentScene.startTalk(game,"human",["I mean no harm to him.","Just want to talk.",],game=>{currentScene.startTalk(game,"stranger",["How can I be sure I can trust you?",])})},},],},{options:[{msg:"A playing card?",onSelect:game=>{currentScene.startTalk(game,"human","A playing card?",game=>{currentScene.startTalk(game,"stranger",["This is not just any playing card.",`It's the only card that will let you beat ${GANSTER_NAME}.`,])})},},{msg:"What's that mark?",onSelect:game=>{currentScene.startTalk(game,"human",["The card is signed with a marker.","Does that mean anything?",],game=>{currentScene.startTalk(game,"stranger",[`It means\nsomething to ${GANSTER_NAME.split(" ")[0]}.`,])})},},{msg:"LEAVE",onSelect:game=>{currentScene.startTalk(game,"human",["Thank you. I'll be on my way.",],game=>{currentScene.startTalk(game,"stranger",["Good luck! You'll need it.",],game=>{currentScene.startTalk(game,"human",["I thought that game didn't involve any luck.",],game=>{currentScene.startTalk(game,"stranger",["I wasn't talking about the game,","but what happens afterwards...",],game=>{game.dialog=null;game.gotoScene("tavern-entrance")})})})})},}],},],})},rightHandState:({sceneData,now},state)=>{sceneData.retractHand=0;sceneData.grabCard=0;sceneData.lookAtPhoto=0;sceneData.returnPhoto=0;if(state){sceneData[state]=now}},sprites:[{src:ASSETS.DARK_CLOTH_STRANGER,col:5,row:5,noHighlight:!0,index:20,onClick:game=>{if(!game.dialog){game.gotoScene("tavern-entrance")}},},{src:ASSETS.POSTERS,offsetX:45,offsetY:-20,scale:.8,onClick:game=>{if(!game.dialog){game.gotoScene("tavern-posters")}},},{name:"stranger",src:ASSETS.DARK_CLOTH_STRANGER,col:5,row:5,index:({pendingTip,now})=>pendingTip&&pendingTip.progress<1&&pendingTip.talker==="stranger"?Math.floor(now/100)%4:Math.floor(now/300)%30===0?4:0,onRefresh:game=>{const{sceneData,now,pendingTip}=game;if(sceneData.nextPuff&&now>sceneData.nextPuff){if(pendingTip&&pendingTip.talker==="stranger"&&pendingTip.progress<1){sceneData.nextPuff=now+5000}else{sceneData.nextPuff=now+15000;sceneData.puffing=now+500}}},noHighlight:game=>game.situation.cigLit,onClick:game=>{if(!game.situation.cigLit){game.showTip("I think he wants me to light up his cig.")}},combine:(item,game)=>{const{situation,now,sceneData,currentScene}=game;switch(item){case "photo":if(situation.cigLit){game.dialog.paused=!0;currentScene.rightHandState(game,"grabCard");game.delayAction(game=>{game.useItem=null},200);game.delayAction(game=>{currentScene.rightHandState(game,"lookAtPhoto")},1000);game.delayAction(game=>{currentScene.startTalk(game,"stranger","That photo... is it...",game=>{currentScene.startTalk(game,"human",["That's right. It's the only photo I have of Baby Hitler.","It was taken fifteen years ago... I've lost my memory ever since...","So I don't know how we got\nseparated...","But I want to bring us all back together.","Like a family. Me, Yupa, and Baby Hitler.",],game=>{currentScene.startTalk(game,"stranger",["Family huh?","How touching... almost made me throw up.",],game=>{currentScene.rightHandState(game,"returnPhoto");game.delayAction(game=>{currentScene.rightHandState(game,"retractHand");currentScene.startTalk(game,"stranger",["Alright, not sure if I can trust you this time,","but I'll take my chances.","Keep it a secret:","To get in, the password is",],game=>{currentScene.startTalk(game,"strangerslow",[`${PASSWORD}`,],game=>{currentScene.startTalk(game,"stranger",["Same as the tavern's phone number."],game=>{game.situation.knowPassword=game.now;currentScene.startTalk(game,"human",["Thanks for your help...",],game=>{currentScene.startTalk(game,"stranger",["Once inside, to get to Baby Hitler,",`you'll have to deal with a man named ${GANSTER_NAME}.`,"He's the freaking gang boss.","He won't let go of that kid, unless you beat him","at a card game.",],game=>{currentScene.startTalk(game,"human",["Well then, I'll just have to be lucky.",],game=>{currentScene.startTalk(game,"stranger",["That game has nothing to do with luck.",],game=>{currentScene.rightHandState(game,"grabCard");currentScene.startTalk(game,"stranger",["Here, take this with you.",],game=>{currentScene.rightHandState(game,"retractHand");game.pickUp({item:"ace of hearts",image:ASSETS.GRAB_PLAYING_CARD,message:"The ace of hearts.\nSomething's written on it.",onPicked:game=>{game.dialog.paused=!1;game.dialog.index=4},})})})})})})})})})},1000)})})})},2000)}else{game.useItem=null;game.showTip("I think he wants me to light his cig first.")}
return!0;case "lighter":game.useItem=null;if(situation.cigLit){game.showTip("Already lit his cig.")}else{game.waitCursor=!0;situation.cigLit=now;sceneData.puffing=now+1000;game.delayAction(game=>{const message=["Thanks.",];currentScene.startTalk(game,"stranger",message,game=>{game.waitCursor=!1;sceneData.nextPuff=now+15000;currentScene.startDiscussion(game)})},3000)}
return!0;case "coin":currentScene.startTalk(game,"stranger","I'm not asking for charity.");return!0;default:break}},},{src:ASSETS.DARK_CLOTH_STRANGER,col:5,row:5,index:({sceneData,now})=>{if(sceneData.retractHand){const frame=Math.min(2,Math.floor((now-sceneData.retractHand)/200));if(frame<2){return 6-frame}}
if(sceneData.grabCard){return 5+Math.min(1,Math.floor((now-sceneData.grabCard)/200))}
if(sceneData.lookAtPhoto){return 6+Math.min(2,Math.floor((now-sceneData.lookAtPhoto)/200))}
if(sceneData.returnPhoto){return 8-Math.min(2,Math.floor((now-sceneData.returnPhoto)/200))}
return 21},},{src:ASSETS.DARK_CLOTH_STRANGER,col:5,row:5,index:({sceneData,now,situation})=>{if(sceneData.puffing){const frame=Math.max(0,Math.floor((now-sceneData.puffing)/200));if(frame<=3){return 16+frame}}
if(situation.cigLit){return 12+Math.floor(now/200)%4}
if(sceneData.takeOutCig){return 9+Math.min(2,Math.floor((now-sceneData.takeOutCig)/200))}
return 21},},{src:ASSETS.SPEECH_OUT,hidden:game=>!game.dialog||game.dialog.paused||game.bagOpening||game.useItem||game.pendingTip,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/50)),},...standardMenu(),...standardBag(),],},);game.addScene({name:"temp-end",onScene:game=>{game.showTip("Thanks for playing so far. I will unlock the rest of the game once I've completed it.",game=>{game.gameOver()})},sprites:[{fade:1,fadeColor:"#5588cc"}],},);game.addScene({name:"the-date",onScene:game=>{game.waitCursor=!0;game.situation.talked={};game.playTheme(SOUNDS.SOFT_THEME,{volume:.8});game.delayAction(game=>{game.sceneData.eyesWideOpened=game.now;game.currentScene.startTalk(game,"shopkeepa",["I had a great time!","It was better than I ever imagined!",],game=>{game.sceneData.eyesWideOpened=0;game.currentScene.startTalk(game,"shopkeepa",["So tell me,","what do you think about Tammy Slow?",],game=>{game.waitCursor=!1;game.currentScene.onDialog(game)})})},8000)},onWaiter:game=>{game.dialog.paused=!0;game.sceneData.waiter=game.now;game.delayAction(game=>{game.sceneData.lookRight=game.now},3000);game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa","Hello",game=>{game.currentScene.startTalk(game,"waiter",["Welcome, I'm here to take your order",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Great, I'd like a hot bun with spicy hot sauce,","with hot pepper, crushberries, and lots of honey!",],game=>{game.currentScene.startTalk(game,"waiter",["Excellent choice, Miss.",],game=>{game.sceneData.waiterServeHuman=game.now;game.delayAction(game=>{game.sceneData.lookRight=0},100);game.currentScene.startTalk(game,"waiter",["And for the gentleman?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Order something.","Tonight, it is my treat...",],game=>{game.currentScene.startTalk(game,"human",["Huh... I don't know what to order.","Are you sure it's safe?","Earlier, someone gave me a cake that was so corrosive,","it burned through metal when lit on fire.",],game=>{game.currentScene.startTalk(game,"waiter",["No need to\nworry, sir.","We accommodate for every species, including humans.",],game=>{game.currentScene.startTalk(game,"human","So what's on the menu?",game=>{game.currentScene.startTalk(game,"waiter",["We serve\neverything.\nChoose anything you'd like!",],game=>{game.currentScene.startTalk(game,"human","Anything?",game=>{game.dialog.paused=!1;game.dialog.index++})})})})})})})})})})})},3500)},laugh:game=>{game.sceneData.laughing=game.now;game.playSound(SOUNDS.ANIMAL_CRY)},onDialog:(game,index)=>{game.startDialog({index,conversation:[{options:[{msg:"Amazing!",onSelect:game=>{game.currentScene.startTalk(game,"human",["She is so amazing!",],game=>{game.dialog.paused=!0;game.sceneData.eyesWideOpened=0;game.currentScene.laugh(game);game.delayAction(game=>{game.sceneData.laughing=0;game.currentScene.startTalk(game,"shopkeepa",["Sounds like she got a new fan!","Her voice is so unique. It takes a very special person to appreciate it.",],game=>{game.currentScene.onWaiter(game)})},3000)})},},{msg:"Awful!",onSelect:game=>{game.currentScene.startTalk(game,"human",["To be honest","This was awful!",],game=>{game.dialog.paused=!0;game.sceneData.eyesWideOpened=0;game.currentScene.laugh(game);game.delayAction(game=>{game.currentScene.startTalk(game,"human",["I can't even begin to describe...","how painful it was to sit through that concert","for five hours straight!",],game=>{game.sceneData.laughing=0;game.currentScene.startTalk(game,"shopkeepa",["Did you know that Tammy's voice","exceeds far beyond the\naudible range of most humans?","I can image, it must have been hard for you. Since you can barely hear any of the music.",],game=>{game.currentScene.startTalk(game,"human",["Well that explains a lot ...","At least I had your company,","that I enjoyed!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["How sweet...",],game=>{game.currentScene.onWaiter(game)})})})},3000)},2000)})},},{msg:"Tammy who?",onSelect:game=>{game.currentScene.startTalk(game,"human",["Tammy who?",],game=>{game.dialog.paused=!0;game.sceneData.eyesWideOpened=0;game.currentScene.laugh(game);game.delayAction(game=>{game.sceneData.laughing=0;game.currentScene.startTalk(game,"shopkeepa",["Did you fall asleep halfway or what?","I know that humans, unlike most species in this universe,","can't really appreciate a slow and mellow song,","but they enjoy fast repetitive music ...","Humans are so weird!",],game=>{game.currentScene.onWaiter(game)})},1500)})},},],},{options:[{msg:"Fried T-Rex",onSelect:game=>{game.currentScene.startTalk(game,"human","Ok, I'll have a fried T-rex, please",game=>{game.currentScene.startTalk(game,"waiter","Right away, sir",game=>{game.sceneData.waiterLeave=game.now;game.currentScene.startTalk(game,"human","Wait, does he even know what a T-rex is?",game=>{game.currentScene.startTalk(game,"shopkeepa",["Your choice is irrelevant.","Here, they\nanalyze your thoughts and feelings,","and produce a dish perfectly tailored to your taste.",],game=>{game.currentScene.startTalk(game,"human","Outstanding!",game=>game.dialog.index++)})})})})},},{msg:"Crisp salad",onSelect:game=>{game.currentScene.startTalk(game,"human","I'll just have a crisp salad.",game=>{game.currentScene.startTalk(game,"waiter","Right away, sir",game=>{game.sceneData.waiterLeave=game.now;game.currentScene.startTalk(game,"human","Better stay safe with my choices of food.",game=>{game.currentScene.startTalk(game,"shopkeepa",["Your choice is irrelevant.","Here, they\nanalyze your thoughts and feelings,","and produce a dish perfectly tailored to your taste.",],game=>{game.currentScene.startTalk(game,"human","Outstanding!",game=>game.dialog.index++)})})})})},},{msg:"Spicy Yupa",onSelect:game=>{game.currentScene.startTalk(game,"human","How about a spicy ... Yupa?",game=>{game.currentScene.startTalk(game,"waiter","Right away, sir",game=>{game.sceneData.waiterLeave=game.now;game.currentScene.startTalk(game,"human",["Hey, wait up! I was kidding!","He's not gonna cut up Yupa in pieces and serve that to me, is he?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Your choice is irrelevant. It's just for the experience.","Here, they\nanalyze your thoughts and feelings,","and produce a dish perfectly tailored to your taste.",],game=>{game.currentScene.startTalk(game,"human","Outstanding!",game=>game.dialog.index++)})})})})},},],},{options:[{msg:"Whats your name?",hidden:(game,{msg})=>game.situation.talked[msg],onSelect:(game,dialog,conversation,{msg})=>{game.situation.talked[msg]=game.now;game.currentScene.startTalk(game,"human",["So, I never introduced myself.",`I'm ~${game.data.name || "Hitman"}`,"What is your name?",],game=>{dialog.paused=!0;game.delayAction(game=>{dialog.paused=!1;game.currentScene.startTalk(game,"shopkeepa",["My name is\nAmari.",],game=>{game.currentScene.startTalk(game,"human",["Amari","That's a pretty name...","What does it mean?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["You'll find out eventually...",],game=>{})})})},1000)})},},{msg:"Earth music",hidden:(game,{msg})=>game.situation.talked[msg],onSelect:(game,dialog,conversation,{msg})=>{game.dialog.paused=!0;game.situation.talked[msg]=game.now;game.currentScene.startTalk(game,"human",["That Tammy, she's really something...","So there's no music from Earth that you actually listen to?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Hum, I tried to, but the range of sound is so limited.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["What kind of music do you like?",],game=>{game.dialog.paused=!1;game.dialog.index ++})})})},},{msg:"Where you from?",hidden:(game,{msg})=>game.situation.talked[msg],onSelect:(game,dialog,conversation,{msg})=>{game.dialog.paused=!0;game.situation.talked[msg]=game.now;game.currentScene.startTalk(game,"human",["So, tell me...",],game=>{game.sceneData.neutral=game.now;game.currentScene.startTalk(game,"human",["What planet are you from?",],game=>{game.sceneData.neutral=0;game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa",["I grew up in a planet called Salamanda.","A beautiful place, light years from here.","Filled with flowers that grow tall,\nhundreds of meters.",],game=>{game.currentScene.startTalk(game,"human",["You must miss your home!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Yes, very much. But I like it here. It's not so lonely.",]);game.dialog.paused=!1})})},500)})})},},{msg:"Any friends?",hidden:(game,{msg})=>game.situation.talked[msg]||!game.situation.talked["Where you from?"],onSelect:(game,dialog,conversation,{msg})=>{game.dialog.paused=!0;game.situation.talked[msg]=game.now;game.currentScene.startTalk(game,"human",["Tell me about your friends.",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Well, not many people live in this area of town.","There's Pedro, who's selling tickets to tourists.","He's such a funny guy!","Doctor Sarlie is nice too.","Sometimes I bring fruits to his office, and we like to chat around a cup of warm chutea.",],game=>{game.delayAction(game=>{game.sceneData.neutral=game.now},1500);game.currentScene.startTalk(game,"human",["Any... boyfriend?",],game=>{game.sceneData.neutral=0;game.currentScene.laugh(game);game.delayAction(game=>{game.sceneData.laughing=0;game.currentScene.startTalk(game,"shopkeepa",["No! Oh my, Why do you ask?",],game=>{game.currentScene.startTalk(game,"human",["Just curious, that's all!",],game=>{game.dialog.paused=!1})})},2000)})})})},},{msg:"Your dreams",hidden:(game,{msg})=>game.situation.talked[msg],onSelect:(game,dialog,conversation,{msg})=>{game.dialog.paused=!0;game.situation.talked[msg]=game.now;game.currentScene.startTalk(game,"human",["What are your dreams? Any plans in life?",],game=>{game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa",["Hum... not much I guess.","Perhaps I'd like to start a family someday.","And together, we would travel all over the universe ...",],game=>{game.dialog.paused=!1})},500)})},},{msg:"Travel?",hidden:(game,{msg})=>game.situation.talked[msg]||!game.situation.talked["Your dreams"],onSelect:(game,dialog,conversation,{msg})=>{game.dialog.paused=!0;game.situation.talked[msg]=game.now;game.currentScene.startTalk(game,"human",["Where would you like to travel?",],game=>{game.delayAction(game=>{game.currentScene.startTalk(game,"shopkeepa",["Hum... there are so many great planets to visit...","The snowy planet of Udan...","Or the peaceful desert of Solaris...","But there's really one place that I want to visit the most...",],game=>{game.currentScene.startTalk(game,"human",["Which one is it?",],game=>{game.dialog.paused=!1;game.currentScene.startTalk(game,"shopkeepa","Earth.")})})},500)})},},{msg:"Lets keep quiet",onSelect:(game,dialog,conversation,{msg})=>{game.dialog.paused=!0;game.situation.talked[msg]=game.now;game.currentScene.startTalk(game,"human",["Let's enjoy this peaceful moment ...",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Sure",],game=>{game.dialog=null})})},},],},{options:[{msg:"Classical",onSelect:game=>{game.dialog.paused=!0;game.currentScene.startTalk(game,"human",["I quite enjoy classical music!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Oh, classical... like what?",],game=>{game.currentScene.startTalk(game,"human",["I listen to Mozart!",],game=>{game.sceneData.eyesWideOpened=game.now;game.currentScene.startTalk(game,"shopkeepa",["Mozart... hey I know Mozart! Yeah he's great!",],game=>{game.sceneData.eyesWideOpened=0;game.currentScene.startTalk(game,"human",["Hey, but you said you never listen to Earth music?",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Haha, Mozart is actually an being from planet Zorxis.","He's stayed on Earth disguised as a human to make music for you all.",],game=>{game.currentScene.laugh(game);game.delayAction(game=>{game.sceneData.laughing=0;game.currentScene.startTalk(game,"shopkeepa",["Oh, the secret messages he puts in his music.","So funny!...",],game=>{game.dialog.paused=!1;game.dialog.index=2})},1000)})})})})})})},},{msg:"Techno",onSelect:game=>{game.currentScene.startTalk(game,"human",["I listen to Techno Music! Yeah!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Techno? What is that?",],game=>{game.currentScene.startTalk(game,"human",["It's very fast and repetitive music",],game=>{game.dialog.paused=!0;game.currentScene.laugh(game);game.delayAction(game=>{game.sceneData.laughing=0;game.currentScene.startTalk(game,"shopkeepa",["You even admit it!","Human music is so weird!",],game=>{game.dialog.paused=!1;game.dialog.index=2})},1000)})})})},},{msg:"Pop music",onSelect:game=>{game.currentScene.startTalk(game,"human",["I just listen to Pop Music.","Everyone on Earth loves it!",],game=>{game.currentScene.startTalk(game,"shopkeepa",["Pop music, huh? Tell me more about it.",],game=>{game.currentScene.startTalk(game,"human",["Well, there's this singer who's very\npopular in my time,","her name is Taylor Swift",],game=>{game.dialog.paused=!0;game.currentScene.laugh(game);game.delayAction(game=>{game.sceneData.laughing=0;game.currentScene.startTalk(game,"shopkeepa",["Taylor Swift?","With a name like that,","I'm sure she sings super fast, and jumps up and down?",],game=>{game.currentScene.startTalk(game,"human",["Right! Exactly."],game=>{game.dialog.paused=!1;game.dialog.index=2})})},2000)})})})},},],},],})},onSceneRefresh:game=>{game.fade=Math.min(1,1-(game.now-game.sceneTime)/10000)},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="human"){x=2;y=62;game.playSound(SOUNDS.HUM)}else if(talker==="shopkeepa"){x=4;y=57;game.playSound(SOUNDS.ANIMAL_CRY)}else if(talker==="waiter"){x=5;y=50;game.playSound(SOUNDS.WAITER)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},sprites:[{src:ASSETS.DATE_TABLE,col:4,row:5,index:18,noHighlight:game=>game.dialog&&!game.dialog.paused,onClick:game=>{if(!game.dialog){game.currentScene.onDialog(game,2)}else{game.dialog.paused=!1}},},{src:ASSETS.DATE_TABLE,col:4,row:5,index:({now,sceneTime,sceneData,pendingTip})=>{const frame=Math.floor(now/100);if(sceneData.laughing){return frame%2+8}
if(sceneData.eyesWideOpened){return 10+(pendingTip&&pendingTip.talker==="shopkeepa"&&pendingTip.progress<1?frame%4:0)}
if(sceneData.lookRight){return 14+(pendingTip&&pendingTip.talker==="shopkeepa"&&pendingTip.progress<1?frame%4:0)}
if(pendingTip&&pendingTip.talker==="shopkeepa"&&pendingTip.progress<1){return frame%5+3}
if(sceneData.neutral){return 19}
return Math.min(3,frame%100)},},{src:ASSETS.CAFEE,col:3,row:3,index:game=>Math.floor(game.now/300)%7,},{src:ASSETS.CAFEE,col:3,row:3,index:game=>Math.floor((game.now-500)/300)%7,},{src:ASSETS.CAFEE,col:3,row:3,index:game=>Math.floor((game.now-1000)/300)%7,},{src:ASSETS.CANDLE,index:game=>Math.floor(game.now/150)%4,},{src:ASSETS.WAITER,col:2,row:3,index:({pendingTip,now,sceneData})=>{if(sceneData.waiterLeave){return 4}
if(pendingTip&&pendingTip.talker==="waiter"&&pendingTip.progress<1){return(sceneData.waiterServeHuman?2:0)+Math.floor((now/100)%2)}
return sceneData.waiterServeHuman?2:0},offsetX:game=>{if(game.sceneData.waiterLeave){return Math.min(30,(game.now-game.sceneData.waiterLeave)/50)}
return Math.max(5,Math.floor(20-(game.now-game.sceneData.waiter)/100))},hidden:game=>!game.sceneData.waiter,},{src:ASSETS.NEXT_SCENE,hidden:game=>{return game.dialog||game.hideCursor||game.waitCursor},onClick:game=>game.fadeToScene("evening-date",null,5000),},{custom:(game,sprite,ctx)=>{game.displayTextLine(ctx,{msg:"skip",x:50,y:47,})},hidden:game=>!game.hoverSprite||game.hoverSprite.src!==ASSETS.NEXT_SCENE,},],});game.addScene({name:"tile-hole",sprites:[{src:ASSETS.TILE_HOLE,preventClick:game=>!game.data.pickedUp.gun,onClick:game=>{game.gotoScene("jail-cell");game.rotation=4},},{name:"gun",src:ASSETS.GUN,hidden:(game,{name})=>game.data.pickedUp[name],onClick:(game,{name})=>{game.addToInventory({item:"bullet",count:6,});game.pickUp({item:name,image:ASSETS.GRAB_GUN,message:"A loaded gun! Did I hide this in here?",onPicked:game=>{game.gotoScene("jail-cell");game.rotation=4}})},},{bag:!0,src:ASSETS.BAG_OUT,index:game=>game.frameIndex,hidden:game=>!game.bagOpening,},],},);game.addScene({name:"toilet-monster",onScene:game=>{game.hideCursor=!0;game.playTheme(null)},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/100)-50;if(frame<50){if(Math.floor(frame/2)<5){game.sceneData.frame=Math.max(0,Math.floor(frame/4))}else{game.sceneData.frame=Math.min(13,5+(frame-10));if(frame>13&&!game.sceneData.eat){game.sceneData.eat=game.now;game.playSound(SOUNDS.EAT)}}}else{if(!game.data.gameOver){game.gameOver("  “What a sad way\n         to die!”")}}},sprites:[{src:ASSETS.TOILET_MONSTER,col:4,row:4,index:game=>game.sceneData.frame||0,},],},);game.addScene({name:"toilet-zoom",sprites:[{src:ASSETS.TOILET_ZOOM_BACKGROUND,onClick:game=>game.gotoScene("toilets"),},{src:ASSETS.TOILET_ZOOM,offsetX:-3,offsetY:-3,onClick:game=>{game.startDialog({time:game.now,index:0,conversation:[{message:"",options:[{},{msg:"Sit on toilet",onSelect:game=>{game.gotoScene("toilet-monster")}},{msg:"CANCEL",onSelect:game=>{game.dialog=null}},],},],})},},{src:ASSETS.SPEECH_OUT,offsetY:9,hidden:game=>game.pendingTip||!game.dialog,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/80)),},],},);game.addScene({name:"toilets",arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(5),null,RIGHT],],onScene:game=>{game.save()},doors:{1:{exit:game=>game.fadeToScene("maze-2",{door:2}),},},map:`
			XXX
			XOX
			X.X
			X1X
			XXX
		`,onSceneRefresh:(game)=>{const{orientation,sceneData,frameIndex}=game;if(sceneData.orientation!==orientation){sceneData.orientation=orientation;if(frameIndex===3){game.frameIndex=0}}},sprites:[...getRoomMaze(""),{src:ASSETS.TOILETS,side:LEFT,offsetX:5,offsetY:1,combineMessage:(item,game)=>{if(item==="empty bottle"){return"Why get the water from the toilet when there's a water fountain next to it?"}
return `The ${item} has no effect on the toilet.`},onClick:game=>{game.gotoScene("toilet-zoom")},hidden:game=>game.rotation!==0,},{src:ASSETS.TOILETS,side:RIGHT,tip:()=>"I wonder if the water is drinkable.",combine:(item,game)=>{if(item==="empty bottle"){game.removeFromInventory("empty bottle");game.useItem=null;game.pickUp({item:"water bottle",image:ASSETS.GRAB_WATER_BOTTLE,message:"It does look like water... so far."});return!0}},hidden:game=>game.rotation!==0,},...standardMenu(),...standardBag(),],},);game.addScene({name:"training-room",onScene:game=>{game.save()},arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,s(7),s(8),s(7),RIGHT],[LEFT,s(7),s(9),s(7),RIGHT],],map:`
			XXXXXXXXXXX
			X1......2mX
			XXXXX|XXXXX
			XXXXXXXXXXX
		`,sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...getCommonMaze("_BLUE_1"),makeFoe('battle-dummy',ASSETS.DUMMY),makeFoe('slimo',ASSETS.SLIMO),...standardBattle(),...standardMenu(),...standardBag(),],...makeOnSceneBattle(),doors:{1:{scene:"maze",door:3,exit:(game,{scene,door})=>game.fadeToScene(scene,{door},1000),},2:{},},...makeOnSceneBattle(),events:{'|':{foe:"battle-dummy",foeLife:800000000,foeBlockChance:1,attackSpeed:10000000,riposteChance:1,attackPeriod:100,foeDamage:0,foeDefense:10000,xp:0,belowTheBelt:!1,dummyBattle:!0,blocking:!0,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt,dummyBattle})=>{const{data,now}=game;game.chest=null;if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,dummyBattle,}}
return!0},},'m':{foe:"slimo",foeLife:60,foeBlockChance:.6,attackSpeed:2500,riposteChance:.7,attackPeriod:100,foeDamage:6,foeDefense:12,xp:3,belowTheBelt:!0,blocking:!0,chest:!0,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt})=>{const{data,now}=game;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,}}
return!0},onWin:game=>game.findChest(game.now+2000,{item:"fruit?",image:ASSETS.GRAB_APPLE,}),},},},);game.addScene({name:"vending-machine",arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(5),null,RIGHT],],map:`
			XXX
			XOX
			X.X
			X1X
			XXX
		`,doors:{1:{exit:game=>game.fadeToScene("maze-2",{door:3}),},},onScene:game=>{game.save()},sprites:[...getRoomMaze("_BLUE"),{src:ASSETS.VENDING_MACHINE,hidden:game=>game.rotation!==0,},{src:ASSETS.MACHINE,col:2,row:2,index:game=>{return(game.getSituation("zoom-vending-machine").grabbedBottle?1:0)|(game.getSituation("zoom-vending-machine").grabbedApple?2:0)},tip:"Looks like a vending machine. There's a big hole in it.",onClick:game=>game.gotoScene("zoom-vending-machine"),combine:(item,game)=>{if(item==="coin"){game.gotoScene("zoom-vending-machine");game.useItem=item;return!0}},hidden:game=>game.rotation!==0,},{name:"coin 1",src:ASSETS.COIN_1,hidden:(game,{name})=>game.data.pickedUp[name]||game.rotation!==0,onClick:(game,{name})=>{game.data.pickedUp[name]=game.now;game.pickUp({item:"coin",image:ASSETS.GRAB_COIN,message:""})},},{name:"coin 2",src:ASSETS.COIN_2,hidden:(game,{name})=>game.data.pickedUp[name]||game.rotation!==0,onClick:(game,{name})=>{game.data.pickedUp[name]=game.now;game.pickUp({item:"coin",image:ASSETS.GRAB_COIN,message:""})},init:({now,data},{name})=>{data.pickedUp[name]=now},},{name:"coin 3",src:ASSETS.COIN_2,offsetX:-5,offsetY:1,hidden:(game,{name})=>game.data.pickedUp[name]||game.rotation!==0,onClick:(game,{name})=>{game.data.pickedUp[name]=game.now;game.pickUp({item:"coin",image:ASSETS.GRAB_COIN,message:""})},init:({now,data},{name})=>{data.pickedUp[name]=now},},...standardMenu(),...standardBag(),],},);game.addScene({name:"we-take-care-of-you",onScene:game=>{game.playTheme(null);game.startDialog({conversation:[{options:[{msg:"We'll take care",onSelect:game=>{game.hideCursor=!0;game.dialog=null;game.playSound(SOUNDS.HUM);game.showTip(["Don't worry.","We will take care of you,\nBaby Hitler."],game=>{game.sceneData.showBoy=game.now;game.delayAction(game=>game.sceneData.boySmile=game.now,2500);game.delayAction(game=>game.gotoScene("panic-exit"),5000)},null,{talker:"human"})},},{msg:"Don't move",onSelect:game=>{game.hideCursor=!0;game.dialog=null;game.playSound(SOUNDS.HUM);game.showTip(["Don't go\nanywhere.","You should stay with us,\nBaby Hitler.",],game=>{game.sceneData.showBoy=game.now;game.delayAction(game=>game.sceneData.boySmile=game.now,2500);game.delayAction(game=>game.gotoScene("panic-exit"),5000)},null,{talker:"human"})},},{msg:"I'll protect you",onSelect:game=>{game.hideCursor=!0;game.dialog=null;game.playSound(SOUNDS.HUM);game.showTip(["I'm here to protect you.","Don't you worry,\nBaby Hitler."],game=>{game.sceneData.showBoy=game.now;game.delayAction(game=>game.sceneData.boySmile=game.now,2500);game.delayAction(game=>game.gotoScene("panic-exit"),5000)},null,{talker:"human"})},},],},],})},onSceneRefresh:game=>{if(!game.sceneData.lastCrowd||game.now-game.sceneData.lastCrowd>1000){game.playSound(SOUNDS.RANDOM,{volume:.15});game.sceneData.lastCrowd=game.now+Math.random()*1000+500}},sprites:[{src:ASSETS.HITMAN_FROM_ABOVE,index:({pendingTip,now})=>{return pendingTip&&pendingTip.talker==="human"&&pendingTip.progress<1?Math.floor(now/100)%4:0},},{src:ASSETS.BEARD_SHAVED,col:3,row:3,scale:.7,offsetY:-5,offsetX:20,index:({pendingTip,now})=>{return pendingTip&&pendingTip.talker==="human"&&pendingTip.progress<1?Math.floor(now/100)%4:0},},{src:ASSETS.BOY_SMILE,index:game=>{if(game.sceneData.boySmile){return 2}
return Math.floor((game.now-game.sceneData.showBoy)/100)%10===0?1:0},hidden:game=>!game.sceneData.showBoy,},],},);game.addScene({name:"what-so-funny",onScene:game=>{game.hideCursor=!0;game.showTip(["Hahaha...","Even in this situation, I'm glad I can laugh with you guys.","By the way, what's so funny?"],game=>{game.gotoScene("cake-face")})},sprites:[{src:ASSETS.POOR_HITMAN_BACK,},{src:ASSETS.POOR_HITMAN,hidden:({pendingTip})=>pendingTip&&pendingTip.index<2,index:({pendingTip,now})=>pendingTip&&pendingTip.progress<1?Math.floor(now/150)%4:0,},{src:ASSETS.HITMAN_LAUGH,hidden:({pendingTip})=>!pendingTip||pendingTip.index>=2,index:({pendingTip,now})=>pendingTip&&pendingTip.progress<1&&pendingTip.index!==0?Math.floor(now/150)%4:Math.floor(now/150)%2,},{src:ASSETS.POOR_HITMAN_GUARD,index:game=>Math.floor((game.now-game.sceneTime)/200)%4,},],},);game.addScene({name:"yupa-sarlie",onScene:game=>{game.playTheme(SOUNDS.JAIL_CELL_THEME);game.startDialog({time:game.now,index:0,findBabyHitler:game=>{game.sceneData.hitmanSurprised=0;game.sceneData.looking=0;game.currentScene.startTalk(game,"yupa",["Okay, ya dun seem sure","Are ya sure?",],game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{},{msg:"Yes, I'm sure.",onSelect:game=>{game.currentScene.startTalk(game,"human",["Yes I'm sure, let's do it",],game=>{game.currentScene.startTalk(game,"yupa",["Okey, lets go look for da baby.",],game=>{game.currentScene.startTalk(game,"doctar",["You might start with the island's shopkeeper.","Many people drop by that shop.","Maybe someone\nmentioned\nsomething about your baby.",],game=>{game.currentScene.startTalk(game,"human",["Thanks doctor.","Yupa, let's go.",],game=>{game.dialog=null;game.data.seen.doctor=game.now;game.fadeToScene("sarlie-planet-world",null,null,game=>{game.sceneData.fromDoctor=!0})})})})})},},{msg:"Not sure.",onSelect:game=>{game.currentScene.startTalk(game,"human",["Actually, I'm not sure.","Give me some time to think about it",],game=>{game.gotoScene("doctar-room");game.sceneData.from=null;game.sceneData.to="door";game.sceneData.toReach=null})},},],},],})})},conversation:[{options:[{},{msg:"I made a decision.",onSelect:(game,dialog)=>{const{currentScene}=game;currentScene.startTalk(game,"human",["I have made a decision.",],game=>{game.dialog.index ++;currentScene.startTalk(game,"doctar","Sure, what have you decided?")})}},{msg:"LEAVE",onSelect:game=>{game.gotoScene("doctar-room");game.sceneData.from=null;game.sceneData.to="door";game.sceneData.toReach=null}},],},{options:[{},{msg:"Find Baby Hitler.",onSelect:(game,dialog)=>{const{currentScene}=game;currentScene.startTalk(game,"human",["Let's go find Baby Hitler,","bring him back to Earth,","and let history unfold...",],game=>{dialog.findBabyHitler(game)})},},{msg:"Forget the baby.",onSelect:(game,dialog)=>{const{currentScene}=game;currentScene.startTalk(game,"human",["Forget Baby Hitler.",],game=>{game.sceneData.looking=game.now;if(game.situation.forgetTheBaby){game.dialog.index=4;return}
currentScene.startTalk(game,"human",["I can't let history repeat itself.",],game=>{game.dialog.paused=game.now;game.delayAction(game=>{game.sceneData.looking=0;currentScene.startTalk(game,"yupa",["But ya ganna disappear,","Wayi would yo du dat?",],game=>{dialog.index++;dialog.paused=!1})},1000)})})},},],},{onSelect:(game,dialog,conversation)=>{const{currentScene}=game;dialog.paused=!0;currentScene.startTalk(game,"human",["I can't let Hitler return to earth.","In my timeline, he killed millions of people.","I'd rather die.",],game=>{game.sceneData.looking=game.now;game.delayAction(game=>{currentScene.startTalk(game,"yupa",["I told ya","Humaz are wierd."],game=>{currentScene.startTalk(game,"doctar",["You weren't kidding."],game=>{game.sceneData.looking=0;game.dialog.paused=0;game.dialog.index ++;currentScene.startTalk(game,"yupa",[`Ya know ~${game.data.name||"Hitman"}~,`,"I know someone who killed a lat more peepol than Hitlah",])})})},1000)})},options:[{msg:"To stop Hitler.",onSelect:(game,dialog,conversation)=>{conversation.onSelect(game,dialog,conversation)},},{msg:"To save humans.",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human","I want to save mankind.",game=>{conversation.onSelect(game,dialog,conversation)})},},{msg:"Changed my mind.",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human",["Wait, I changed my mind,","Forget what I said. Let me start over."],game=>{game.dialog.index=0})},},],},{onSelect:(game,dialog,conversation)=>{const{currentScene}=game;dialog.paused=!0;currentScene.startTalk(game,"yupa",["No ya dum dum.","Im talkin abowt YOU!"],game=>{currentScene.startTalk(game,"human",["What?!?!",],game=>{currentScene.startTalk(game,"human2",["That's insane!","I might be a hitman,","but I'm not a mass murderer!"],game=>{game.sceneData.looking=game.now;currentScene.startTalk(game,"doctar",["I don't think he realizes."],game=>{game.sceneData.looking=0;currentScene.startTalk(game,"yupa",[`${game.data.name||"Hitman"}~,`,`yo rememba wat ya did before?`,`Ya travel back in tam, from da year ~${game.babyHitlerYear()}~ to 1889`,"To kell da babi.",],game=>{currentScene.startTalk(game,"human2",["Yes I know. And I did not kill him.","We just took Baby Hitler into space.","And I lived my life starting 1889... with you and Baby Hitler!",],game=>{currentScene.startTalk(game,"yupa",["Rite, so wad da ya think happen",`to 7 billionz humanz who wure living in ~${game.babyHitlerYear()}~?`,],game=>{game.sceneData.hitmanSurprised=game.now;game.delayAction(game=>{currentScene.startTalk(game,"human2",[".. they ...","well, they ... didn't die","did they?","I mean they didn't ...","suffer ...","... right?",],game=>{game.sceneData.hitmanSurprised=0;currentScene.startTalk(game,"yupa",["Rite they just gat erazed from existenss.","Theyll nevar finish deir livez.","Thatz not same as dyin for ya?",],game=>{game.sceneData.hitmanSurprised=game.now;currentScene.startTalk(game,"human2",["Oh no! You're right!","I did it! I killed them all!","I'm the biggest mass murderer in history!",],game=>{game.sceneData.hitmanSurprised=0;currentScene.startTalk(game,"yupa",["Chill itz okaaay","My point, ya dun have take it so seriasly","Just live, enjuy lafe! Stay wid us.","Idz juzt a game aftar all!",],game=>{game.situation.forgetTheBaby=game.now;game.sceneData.hitmanSurprised=game.now;game.dialog.paused=!1;game.dialog.index++})})})})},1000)})})})})})})})},options:[{msg:"Joseph Stalin?",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human","You mean Joseph Stalin?",game=>{conversation.onSelect(game,dialog,conversation)})},},{msg:"Genghis Khan?",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human","You're talking about Genghis Khan?",game=>{conversation.onSelect(game,dialog,conversation)})},},{msg:"Donald Trump?",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human","Who? Donald Trump?",game=>{conversation.onSelect(game,dialog,conversation)})},},],},{options:[{},{msg:"I wanna die.",onSelect:(game,dialog,conversation)=>{const{currentScene}=game;currentScene.startTalk(game,"human2",["I really don't deserve to live, after what I've done.","Let me go, I choose to die,","I'll dizupeer from dis world!",],game=>{game.dialog.paused=game.now;game.sceneData.hitmanSurprised=0;game.sceneData.looking=game.now;game.delayAction(game=>{currentScene.startTalk(game,"yupa",["Ya know what am thinkin?"],game=>{currentScene.startTalk(game,"doctar",["Hum... not really, but you can tell me later",],game=>{game.sceneData.looking=0;game.dialog.paused=0;game.dialog.index ++;currentScene.startTalk(game,"yupa",[`Okai, ~${game.data.name||"hitman"}~,`,"We let you go.","Just lay dawn on da bench, we'll giv ya somethin","To halp reduz da suffarin...",])})})},1000)})},},{msg:"I wanna live.",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human2",["Okay Yupa, you are right!","Screw humans, screw everything!","I just want to live. Let's find Baby Hitler and bring him back to earth!",],game=>{dialog.findBabyHitler(game)})},},],},{options:[{msg:"Suffering?",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human",["Wait, something to ease suffering?","What something?"],game=>{game.currentScene.startTalk(game,"yupa",["Just truss mey,","it will halp!",],game=>{game.dialog=null;game.fadeToScene("doom")})})},},{msg:"Thank you",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human",["Thank you Yupa","I will never forget what you did for me.",],game=>{game.currentScene.startTalk(game,"yupa",["Wad ya mean? Ya will disappear","Ya wunt be able to think."],game=>{game.currentScene.startTalk(game,"human",["Oh right. Then please remember me.",],game=>{game.currentScene.startTalk(game,"yupa",["Of corse I cont rememba ya","I will not even knaw ya existed.",],game=>{game.currentScene.startTalk(game,"human",["Nevarmind! Let's just get on with it!",],game=>{game.dialog=null;game.fadeToScene("doom")})})})})})},},{msg:"Changed my mind.",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human",["Wait, I changed my mind,","Forget what I said. Let me start over.","...","Hum.. so you guys actually forgot everything I said, right?",],game=>{game.currentScene.startTalk(game,"yupa",["Wad wur we\ntokin abowt?"],game=>{game.dialog.index=0})})},},],},{options:[{msg:"Get on with it!",onSelect:game=>{game.currentScene.startTalk(game,"human",["Let's get on with it! I want to die!",],game=>{game.currentScene.startTalk(game,"yupa",["Okay.",],game=>{game.fadeToScene("doom")})})},},{msg:"Changed my mind.",onSelect:(game,dialog,conversation)=>{game.currentScene.startTalk(game,"human",["I changed my mind, I don't want to die anymore!","Forget everything I said. Let me start over!",],game=>{game.dialog.index=0})},},],},],})},arrowGrid:[[null,null,null,null,null],[],[],[],[null,null,BAG,null,null],],startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"||talker==="human2"){x=2;y=64;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=22;game.playSound(SOUNDS.YUPA)}else if(talker==="doctar"){x=5;y=21;game.playSound(SOUNDS.HUHUH)}
game.showTip(msg,onDone,talker==="yupa"?100:80,{x,y,talker,removeLock})},sprites:[{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:4,},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,offsetY:3,index:game=>{if(game.sceneData.looking){if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="yupa"){return Math.floor(game.now/100)%2+16}
return 16}
if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="yupa"){return Math.floor(game.now/100)%2===0?5:18}
return 5},},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,offsetY:5,index:game=>{if(game.sceneData.looking){if(game.pendingTip&&pendingTip.progress<1&&game.pendingTip.talker==="doctar"){return Math.floor(game.now/100)%2+19}
return 19}
if(game.pendingTip&&pendingTip.progress<1&&game.pendingTip.talker==="doctar"){return Math.floor(game.now/100)%2===0?6:21}
return 6},},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#967A8F";ctx.fillRect(0,0,64,64)},hidden:game=>!game.sceneData.hitmanSurprised&&(!game.pendingTip||game.pendingTip.talker!=="human2"),},{src:ASSETS.HITMAN_ARGUES,col:3,row:3,index:(game,sprite)=>{const{pendingTip,now,sceneData}=game;if(sceneData.hitmanSurprised){return pendingTip&&pendingTip.progress<1?Math.floor(now/100)%4+4:4}
return pendingTip&&pendingTip.progress<1?Math.floor(now/100)%4:0},hidden:game=>!game.sceneData.hitmanSurprised&&(!game.pendingTip||game.pendingTip.talker!=="human2"),},{src:ASSETS.BEARD_SHAVED,col:3,row:3,offsetY:-16,offsetX:-6.5,scale:1.2,index:(game,sprite)=>{const{pendingTip,now}=game;return pendingTip&&pendingTip.progress<1?Math.floor(now/100)%4:0},hidden:game=>!game.sceneData.hitmanSurprised&&(!game.pendingTip||game.pendingTip.talker!=="human2"),},{src:ASSETS.ARGUE_MOUTH,col:3,row:3,index:(game,sprite)=>{const{pendingTip,now,sceneData}=game;if(sceneData.hitmanSurprised){return pendingTip&&pendingTip.progress<1?Math.floor(now/100)%4+4:4}
return pendingTip&&pendingTip.progress<1?Math.floor(now/100)%4:0},hidden:game=>!game.sceneData.hitmanSurprised&&(!game.pendingTip||game.pendingTip.talker!=="human2"),},...standardMenu(),...standardBag(),],},);game.addScene({name:"zoom-arcade",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onScene:({sceneData,now,situation})=>{sceneData.hand={dx:0,dy:0,lastMove:0,};if(!situation.highscores){situation.highscores=[{score:HIGHSCORE,player:0},{score:1075,player:1},{score:210,player:2},{score:135,player:3},{score:95,player:4},];situation.initial=3}
sceneData.gameStarted=0;situation.coin=situation.coin||0;sceneData.score=0;sceneData.missiles=[];sceneData.alienMissiles=[];sceneData.dusts=[];sceneData.aliens=[{orgX:21,orgY:16,nextShot:now+5000*Math.random(),born:0,destroyed:now+3000},{orgX:30,orgY:16,nextShot:now+5000*Math.random(),born:0,destroyed:now+4000},{orgX:40,orgY:16,nextShot:now+5000*Math.random(),born:0,destroyed:now+3000},];sceneData.gameScreen={x:17,y:9,width:28,height:32,};const{gameScreen}=sceneData;sceneData.stars=new Array(10).fill(null).map(()=>{return{x:Math.floor(Math.random()*gameScreen.width+gameScreen.x),y:Math.floor(Math.random()*gameScreen.height+gameScreen.y),dy:Math.random()/4,}});sceneData.ship={x:gameScreen.x+gameScreen.width/2,y:gameScreen.y+gameScreen.height-2,born:now,destroyed:0,lives:2,}},onSceneRefresh:game=>{const{sceneData,situation,now}=game;const{gameScreen,hand}=sceneData;const{showHighScore}=situation;if(showHighScore){return}
if(situation.putCoin&&now-situation.putCoin>400){situation.putCoin=0;game.playSound(SOUNDS.DUD);game.situation.coin=(game.situation.coin||0)+1}
if(sceneData.gameStarted){const{ship}=sceneData;if(game.mouse){const{x,y}=game.mouse;const{gameScreen}=sceneData;if(x>=gameScreen.x+1&&x<=gameScreen.x+gameScreen.width-2&&y>=gameScreen.y+10&&y<=gameScreen.y+gameScreen.height-2){const dx=x-ship.x;const dy=y-ship.y;if(dx!==0||dy!==0){hand.dx=dx;hand.dy=dy;hand.lastMove=now}
ship.x=x;ship.y=y}}
if(ship.destroyed&&now-ship.destroyed>8000){if(ship.lives>0){ship.x=gameScreen.x+gameScreen.width/2;ship.y=gameScreen.y+gameScreen.height-2;if(game.mouse){game.mouse.x=ship.x;game.mouse.y=ship.y}
ship.born=now;ship.destroyed=0;ship.lives --}else if(sceneData.score>situation.highscores[situation.highscores.length-1].score&&!situation.showHighScore){situation.highscores[situation.highscores.length-1]={score:sceneData.score,player:4};situation.highscores.sort((a,b)=>b.score-a.score);situation.showHighScore=now;situation.gotHighScore=now;situation.initial=0;game.showTip(`That was fun!`);game.playTheme(null)}else if(!situation.showHighScore){sceneData.gameStarted=0;sceneData.joy=0;if(!ship.lives&&ship.destroyed&&sceneData.score<=situation.highscores[situation.highscores.length-1].score){game.showTip(`Darn it! I can do better. I wanna play again`);game.playTheme(null)}}}
const maxDistDown=ship.destroyed?Math.min(15,Math.max(5000+ship.destroyed-now,0)/100):Math.min(15,(now-ship.born)/3000*15);sceneData.aliens.forEach(alien=>{if(alien.destroyed){if(now>alien.destroyed+2000){alien.destroyed=0;alien.born=now}else{return}}
const time=now-alien.born;alien.x=Math.round(3*Math.sin(time/500)+alien.orgX);alien.y=Math.round(alien.orgY+Math.max(0,Math.sin(time/2000))*maxDistDown);if(now>alien.nextShot){alien.nextShot=now+Math.random()*5000;if(!ship.destroyed){sceneData.alienMissiles.push({x:alien.x,y:alien.y,})}}});sceneData.stars.forEach(star=>{star.y+=star.dy;if(star.y>gameScreen.y+gameScreen.height){star.y=gameScreen.y;star.x=Math.floor(Math.random()*gameScreen.width+gameScreen.x);star.dy=Math.random()/4}});sceneData.missiles.forEach(missile=>missile.y-=1);sceneData.alienMissiles.forEach(missile=>missile.y+=.5);sceneData.dusts.forEach(dust=>{dust.x+=dust.dx;dust.y+=dust.dy});sceneData.missiles.forEach(missile=>{const{x,y}=missile;sceneData.aliens.forEach(alien=>{if(alien.destroyed){return}
if(Math.abs(alien.x-x)<=2&&Math.abs(alien.y-y)<=2){alien.destroyed=now;missile.destroyed=now;game.playSound(SOUNDS.HIT_LAND);sceneData.score=Math.min(9999,sceneData.score+5);for(let i=0;i<5;i++){sceneData.dusts.push({x:alien.x,y:alien.y,dx:Math.random()-.5,dy:-Math.random(),color:"#cc6699",})}
if(Math.random()<.4){sceneData.alienMissiles.push({x:alien.x,y:alien.y,})}}})});if(!ship.destroyed){sceneData.alienMissiles.forEach(missile=>{const{x,y,destroyed}=missile;if(destroyed){return}
if(Math.abs(ship.x-x)<=1&&Math.abs(ship.y-y)<=2){ship.destroyed=now;missile.destroyed=now;game.playSound(SOUNDS.PLAYER_HURT);for(let i=0;i<10;i++){sceneData.dusts.push({x:ship.x,y:ship.y,dx:(Math.random()-.5)*2,dy:(Math.random()-.5)*2,color:"#4488aa",})}}});sceneData.aliens.forEach(({x,y,destroyed})=>{if(destroyed){return}
if(Math.abs(ship.x-x)<=2&&Math.abs(ship.y-y)<=2){ship.destroyed=now;game.playSound(SOUNDS.PLAYER_HURT);for(let i=0;i<10;i++){sceneData.dusts.push({x:ship.x,y:ship.y,dx:(Math.random()-.5)*2,dy:(Math.random()-.5)*2,color:"#4488aa",})}}})}
sceneData.missiles=sceneData.missiles.filter(({x,y,destroyed})=>y>gameScreen.y+2);sceneData.alienMissiles=sceneData.alienMissiles.filter(({y,destroyed})=>!destroyed&&y<=gameScreen.y+gameScreen.height);sceneData.dusts=sceneData.dusts.filter(({x,y})=>{return x<gameScreen.x+gameScreen.width&&x>gameScreen.x&&y<gameScreen.y+gameScreen.height&&y>gameScreen.y})}},customCursor:game=>{const{x,y}=game.mouse;const{sceneData,situation}=game;const{gameScreen,gameStarted}=sceneData;if(gameStarted&&!situation.showHighScore){if(x>=gameScreen.x&&x<=gameScreen.x+gameScreen.width&&y>=gameScreen.y&&y<=gameScreen.y+gameScreen.height){return Cursor.NONE}else{return Cursor.WAIT}}},shouldDisplayHighScore:game=>{if(game.situation.shotScreenPosition&&!game.sceneData.gameStarted&&game.situation.initial===3&&!game.situation.coin&&(Math.floor(game.now/50)%30!==0&&Math.floor(game.now/100)%13!==3&&Math.floor(game.now/200)%7!==5&&Math.floor(game.now/50)%4!==2)){return!0}
return game.situation.showHighScore},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#7E7A18";ctx.fillRect(0,0,64,64)},onClick:game=>{const{sceneData,situation}=game;const{gameStarted}=sceneData;if(!gameStarted||game.currentScene.shouldDisplayHighScore(game)){game.gotoScene("arcade-room")}},},{hidden:({situation,sceneData})=>!sceneData.gameStarted,custom:(game,sprite,ctx)=>{const{sceneData,situation}=game;const{gameScreen}=sceneData;if(game.currentScene.shouldDisplayHighScore(game)){return}
ctx.fillStyle="#000012";ctx.fillRect(gameScreen.x,gameScreen.y,gameScreen.width,gameScreen.height);ctx.fillStyle="#222233";sceneData.stars.forEach(({x,y})=>{ctx.fillRect(Math.round(x),Math.round(y),1,1)});ctx.lineWidth=1;const{ship}=sceneData;{ctx.strokeStyle="#4488aa";ctx.beginPath();const{x,y,destroyed}=ship;if(!destroyed){const px=Math.round(x)+.5;const py=Math.round(y)+.5;ctx.moveTo(px,py);ctx.lineTo(px-1,py+2);ctx.lineTo(px+1,py+2);ctx.lineTo(px,py)}
for(let i=0;i<ship.lives;i++){const lx=gameScreen.x+1+i*4+.5,ly=gameScreen.y+1+.5;ctx.moveTo(lx,ly);ctx.lineTo(lx-1,ly+2);ctx.lineTo(lx+1,ly+2);ctx.lineTo(lx,ly)}
ctx.stroke()}
ctx.strokeStyle="#FFFFFF";ctx.beginPath();sceneData.missiles.forEach(({x,y,destroyed})=>{if(destroyed){return}
ctx.moveTo(x,y);ctx.lineTo(x,y-3)});ctx.stroke();ctx.strokeStyle="#FFFF99";ctx.lineWidth=.5;ctx.beginPath();sceneData.alienMissiles.forEach(({x,y,destroyed})=>{if(destroyed){return}
ctx.moveTo(x+.5,y);ctx.lineTo(x+.5,y-2)});ctx.stroke();ctx.fillStyle="#cc6699";sceneData.aliens.forEach(({x,y,destroyed})=>{if(destroyed){return}
ctx.beginPath();ctx.moveTo(x+.5,y+.5-2);ctx.lineTo(x+.5+2,y+.5);ctx.lineTo(x+.5,y+.5+2);ctx.lineTo(x+.5-2,y+.5);ctx.closePath();ctx.fill()});sceneData.dusts.forEach(({x,y,color})=>{ctx.fillStyle=color;ctx.fillRect(x,y,1,1)})},onClick:game=>{const{sceneData,situation,now}=game;const{gameScreen,ship,gameStarted,missiles}=sceneData;const{showHighScore}=situation;ship.lastShot=now;if(gameStarted){const{x,y}=game.mouse;if(missiles.length>2){return}
if(x>=gameScreen.x&&x<=gameScreen.x+gameScreen.width&&y>=gameScreen.y&&y<=gameScreen.y+gameScreen.height){if(!ship.destroyed){game.playSound(SOUNDS.LAZER);const px=Math.round(ship.x)+.5;const py=Math.round(ship.y)+.5;missiles.push({x:px,y:py})}}}},onRefresh:(game,sprite)=>{const{sceneData,situation,now,mouseDown}=game;const{gameScreen,ship,gameStarted,missiles}=sceneData;if(gameStarted){if(mouseDown){if(now-ship.lastShot>200){sprite.onClick(game)}}else{ship.lastShot=0}}},tip:({sceneData})=>sceneData.gameStarted?null:"That looks like a fun game!",},{hidden:({situation,sceneData})=>!sceneData.gameStarted,custom:(game,sprite,ctx)=>{const{sceneData,situation}=game;const{score}=sceneData;const{showHighScore}=situation;if(showHighScore){return}
const ALIEN_DIGIT_0=1000;const str=game.toAlienDigits(score,4);game.displayTextLine(ctx,{msg:str,x:30,y:9,})},},{src:ASSETS.FLASH_SCREEN,col:2,row:2,hidden:({situation,now,sceneData})=>{const{ship}=sceneData;const{gameStarted}=sceneData;return gameStarted&&now>=gameStarted&&(ship.lives||!ship.destroyed)},index:({situation,now,sceneData})=>{if(game.currentScene.shouldDisplayHighScore(game)){return 3}
const{ship}=sceneData;if(situation.coin&&!sceneData.gameStarted){return Math.floor(now/500)%2}else if(sceneData.gameStarted&&sceneData.gameStarted>now){return Math.floor(now/80)%2}
return!ship.lives&&ship.destroyed&&sceneData.gameStarted?2:0},combineMessage:(item,game)=>{if(item==="coin"){return"That goes into the coin slot."}else{return `I can't use ${item} like that.`}},combine:(item,game)=>{if(item==="coin"){game.situation.putCoin=game.now;game.removeFromInventory(item);game.useItem=null;return!0}},onHover:({sceneData,now})=>{sceneData.hoverScreen=now;sceneData.hoverOutScreen=0},onHoverOut:({sceneData,now})=>{sceneData.hoverScreen=0;sceneData.hoverOutScreen=now},onClick:(game)=>{const{sceneData,now,situation}=game;const{ship,aliens}=sceneData;if(situation.coin>0&&!sceneData.gameStarted){const splashTime=2500;sceneData.gameStarted=now+splashTime;sceneData.joy=game.now;sceneData.score=0;situation.coin --;ship.destroyed=0;ship.lastShot=now;ship.born=now;ship.lives=2;aliens[0].destroyed=now+splashTime+3000;aliens[1].destroyed=now+splashTime+4000;aliens[2].destroyed=now+splashTime+3000;game.playTheme(null);game.playSound(SOUNDS.JINGLE);game.delayAction(()=>game.playTheme(SOUNDS.BATTLE_THEME,{volume:.7}),2500)}else if(situation.showHighScore){ship.lastShot=now;game.playSound(SOUNDS.ERROR);if(situation.initial===3){situation.showHighScore=0;situation.initial=0;ship.destroyed=0;sceneData.gameStarted=0;sceneData.joy=0}else{situation.initial=(situation.initial||0)+1}}else if(situation.gotHighScore){situation.showHighScore=game.now;situation.initial=3}},onShot:(game,sprite)=>{if(!game.situation.shotScreenPosition){game.situation.shotScreenPosition={x:game.mouse.x-32,y:game.mouse.y-32,}}},},{hidden:game=>!game.currentScene.shouldDisplayHighScore(game),custom:({sceneData,situation},sprite,ctx)=>{const{gameScreen}=sceneData;const ALIEN_DIGIT_0=1000;for(let i=0;i<situation.highscores.length;i++){let s=situation.highscores[i].score;let str="";while(s>0||str.length<4){const num=s%10;str=ALPHAS[ALIEN_DIGIT_0+s%10].char+str;s=Math.floor(s/10)}
game.displayTextLine(ctx,{msg:str,x:gameScreen.x+14,y:gameScreen.y+2+i*6,})}},},{hidden:({situation,now,sceneData})=>sceneData.gameStarted&&now>=sceneData.gameStarted,custom:(game,sprite,ctx)=>{const{sceneData,situation}=game;const{score}=sceneData;if(game.currentScene.shouldDisplayHighScore(game)){return}
const ALIEN_DIGIT_0=1000;let s=score;let str=`${ALPHAS[ALIEN_DIGIT_0 + Math.min(9, situation.coin||0)].char}/${ALPHAS[ALIEN_DIGIT_0 + 1].char}`;game.displayTextLine(ctx,{msg:str,x:27,y:35,})},},{src:ASSETS.TOP_5,col:3,row:4,index:0,offsetY:({situation},{index})=>{const{highscores}=situation;for(let i=0;i<highscores.length;i++){if(highscores[i].player===index){return i*6}}
return 0},hidden:game=>!game.currentScene.shouldDisplayHighScore(game),},{src:ASSETS.TOP_5,col:3,row:4,index:1,offsetY:({situation},{index})=>{const{highscores}=situation;for(let i=0;i<highscores.length;i++){if(highscores[i].player===index){return i*6}}
return 0},hidden:game=>!game.currentScene.shouldDisplayHighScore(game),},{src:ASSETS.TOP_5,col:3,row:4,index:2,offsetY:({situation},{index})=>{const{highscores}=situation;for(let i=0;i<highscores.length;i++){if(highscores[i].player===index){return i*6}}
return 0},hidden:game=>!game.currentScene.shouldDisplayHighScore(game),},{src:ASSETS.TOP_5,col:3,row:4,index:3,offsetY:({situation},{index})=>{const{highscores}=situation;for(let i=0;i<highscores.length;i++){if(highscores[i].player===index){return i*6}}
return 0},hidden:game=>!game.currentScene.shouldDisplayHighScore(game),},{src:ASSETS.TOP_5,col:3,row:4,index:({now,situation})=>{if(situation.initial===3){return 9}
const index=4+(situation.initial||0)*2;return Math.floor(now/200)%2+index},offsetY:({situation},{index})=>{const{highscores}=situation;for(let i=0;i<highscores.length;i++){if(highscores[i].player===4){return i*6}}
return 0},hidden:game=>!game.currentScene.shouldDisplayHighScore(game),},{src:ASSETS.ZOOM_ARCADE,combine:(item,game)=>{if(item==="coin"){game.situation.putCoin=game.now;game.removeFromInventory(item);game.useItem=null;return!0}},},{src:ASSETS.COINSTART,index:game=>Math.min(3,Math.floor((game.now-game.situation.putCoin)/100)),hidden:game=>!game.situation.putCoin,},{src:ASSETS.SCREEN_FRACTURE,offsetX:game=>game.situation.shotScreenPosition.x,offsetY:game=>game.situation.shotScreenPosition.y,hidden:game=>!game.situation.shotScreenPosition,},{src:ASSETS.SCREEN_FRACTURE,offsetX:game=>game.situation.shotScreenPosition.x,offsetY:game=>game.situation.shotScreenPosition.y,hidden:game=>!game.situation.shotScreenPosition,flipH:!0,},{src:ASSETS.ARCADE_HANDS,side:LEFT,offsetY:gane=>{const{sceneData,now,situation}=game;const{coin,showHighScore}=situation;if(sceneData.gameStarted){const{hand}=sceneData;if(hand.lastMove&&now-hand.lastMove<50){return hand.dy<0?0:hand.dy>0?2:1}}else if((coin||showHighScore&&situation.initial<3)&&sceneData.hoverScreen){const diff=now-sceneData.hoverScreen;return Math.max(0,40-diff/5)}else if((coin||showHighScore&&situation.initial<3)&&sceneData.hoverOutScreen){const diff=now-sceneData.hoverOutScreen;return Math.max(0,diff/5)}else{return 40}},offsetX:({sceneData,now})=>{const{hand}=sceneData;if(hand.lastMove&&now-hand.lastMove<100){return hand.dx<0?-2:hand.dx>0?0:-1}
return 0},},{src:ASSETS.ARCADE_HANDS,side:RIGHT,offsetY:game=>{const{sceneData,now,situation}=game;const{coin}=situation;const{ship}=sceneData;const buttonDown=ship.lastShot&&now-ship.lastShot<100?1:0;if(sceneData.gameStarted){return buttonDown}else if((coin||game.currentScene.shouldDisplayHighScore(game)&&situation.initial<3)&&sceneData.hoverScreen){const diff=now-sceneData.hoverScreen;return Math.max(0,40-diff/5)+buttonDown}else if((coin||game.currentScene.shouldDisplayHighScore(game)&&situation.initial<3)&&sceneData.hoverOutScreen){const diff=now-sceneData.hoverOutScreen;return Math.max(0,diff/5)}else{return 40}},},...standardBag(),],},);game.addScene({name:"zoom-guards",arrowGrid:[[],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onSceneHoldItem:(game,item)=>{if(item==="gun"){game.waitCursor=!0;game.showTip("...",()=>{game.waitCursor=!1;game.gotoScene("jail-cell");game.hideCursor=!0;game.sceneData.guardAlert=game.now})}},onScene:game=>{game.delayAction(game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:game=>game.data.seen.badguards?"Hey":game.data.seen.writing&&game.data.saidHelloToGuard?"Hello again":"Hello",onSelect:(game,dialog)=>{game.playSound(SOUNDS.HELLO);dialog.guardSpeaking=!0;game.waitCursor=!0;game.showTip("...",()=>{dialog.guardSpeaking=!1;game.waitCursor=!1});dialog.index=1;game.data.saidHelloToGuard=game.now}},{hidden:game=>!game.data.seen.writing||game.data.seen.badguards,msg:"My birthday!",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BIRTHDAY);dialog.guardSpeaking=!0;game.waitCursor=!0;game.showTip("... did he\nunderstand? ...",game=>{game.gotoScene("bring-cake")})}},{msg:"LEAVE",onSelect:game=>game.gotoScene("jail-cell")},],},{options:[{msg:"Let me out?",onSelect:(game,dialog)=>{game.playSound(SOUNDS.HAHAHA);dialog.guardSpeaking=!0;game.waitCursor=!0;game.showTip("... seems like he's laughing at me ...",()=>{dialog.guardSpeaking=!1;game.waitCursor=!1})}},{hidden:game=>!game.data.seen.writing,msg:"It's my birthday",onSelect:(game,dialog)=>{if(game.data.seen.badguards){game.showTip("Let's just keep that to myself")}else if(DEMO){game.gotoScene("temp-end")}else{game.playSound(SOUNDS.BIRTHDAY);dialog.guardSpeaking=!0;game.waitCursor=!0;game.showTip("... did he\nunderstand? ...",game=>{game.gotoScene("bring-cake")})}}},{msg:"LEAVE",onSelect:game=>game.gotoScene("jail-cell")},],},],})},50)},sprites:[{name:"zoom-guards",src:ASSETS.ZOOM_GUARDS,index:game=>{if(game.dialog&&game.dialog.guardSpeaking){return Math.floor((game.now-game.sceneTime)/100)%4}
const frame=Math.floor((game.now-game.sceneTime)/200);return frame%31===1?1:0},combineMessage:(item,game)=>`The guard shrugs at my ${item}.`,},{src:ASSETS.ZOOM_GUARD_ALERT,hidden:game=>game.useItem!=="gun",},{src:ASSETS.SPEECH_OUT,hidden:game=>game.bagOpening||game.useItem||game.pendingTip,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/50)),},...standardBag(),],},);game.addScene({name:"zoom-hottub-2",onScene:game=>{game.hideCursor=!0},sprites:[{init:({sceneData})=>{sceneData.stars=new Array(100).fill(null).map(()=>{return{x:(Math.random()-.5)*64,y:(Math.random()-.5)*64,size:.2,}})},onRefresh:(game,sprite)=>{const{sceneData,now,sceneTime}=game;sceneData.stars.forEach(star=>{star.x*=1.01;star.y*=1.01;star.size*=1.01;if(star.size>1){star.size=1}
if(Math.abs(star.x)>32||Math.abs(star.y)>32){star.x=(Math.random()-.5)*64;star.y=(Math.random()-.5)*64;star.size=.2}})},custom:(game,sprite,ctx)=>{ctx.fillStyle="#000022";ctx.fillRect(0,0,64,64);ctx.fillStyle="#FFFFFF";const{sceneData}=game;sceneData.stars.forEach(({x,y,size})=>{ctx.fillRect(32+x,32+y,size,size)})},},{src:ASSETS.HOTTUP_CLOSE_UP,col:6,row:7,index:({sceneData,pendingTip,now})=>{if(pendingTip){if(pendingTip.talker==="human"){return Math.floor(now/100)%2+26}
if(pendingTip.talker==="human2"){return(Math.floor(now/100)%2)+30}
if(pendingTip.talker==="yupa"){return(Math.floor(now/100)%2)+28}
if(pendingTip.talker==="yupa2"){return(Math.floor(now/100)%2)+32}
if(pendingTip.talker==="yupa3"){return(Math.floor(now/100)%2)+34}
if(pendingTip.talker==="alexa"){return(Math.floor(now/100)%2)+35}}
return sceneData.frame},startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"||talker==="human2"){x=5;y=60;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"||talker==="yupa2"||talker==="yupa3"){x=2;y=60;game.playSound(SOUNDS.YUPA)}else if(talker==="alexa"){x=12;y=20;game.playSound(SOUNDS.OKAY);msg=msg.split("").map(a=>" ").join("")}
game.showTip(msg,onDone,talker==="yupa"?140:100,{x,y,talker,removeLock})},init:(game,sprite)=>{const{sceneData}=game;sceneData.frame=27;sceneData.script=[game=>{sprite.startTalk(game,"human",`I have no left hand!`,game=>{sprite.startTalk(game,"yupa","Wat ya mean?",game=>{sprite.startTalk(game,"human","My left hand, it's gone!",game=>{sprite.startTalk(game,"yupa","Ya never had left hand",game=>{sprite.startTalk(game,"human2","What? Of course I had a left hand!",game=>{sprite.startTalk(game,"yupa2","When was last tam ya remember usin it?",game=>{sprite.startTalk(game,"human2","Well I... I don't remember.",games=>{sprite.startTalk(game,"yupa2","Seee....?",game=>{sprite.startTalk(game,"human2","But I don't recall ever missing a left hand!",game=>{sprite.startTalk(game,"yupa2","I dun rememba ya miss a tail either, dun mean ya had one.",game=>{sprite.startTalk(game,"human2","Listen! We need to find out what happened to my left hand",game=>{sprite.startTalk(game,"yupa2",["Oke oke.. i know frend dat can halp ya"],game=>{sprite.startTalk(game,"yupa2",["Alectra!"])})})})})})})})})})})})});return!0},({pendingTip})=>{return!pendingTip},game=>{sprite.startTalk(game,"alexa","Okay",game=>{sprite.startTalk(game,"yupa3","Tek us to doctar Sarlie",game=>{sprite.startTalk(game,"alexa","Okay")})});return!0},({pendingTip})=>{return!pendingTip},game=>{sceneData.frame=Math.min(40,38+Math.floor((game.now-game.sceneData.scriptTime)/100));return sceneData.frame===40},game=>{game.gotoScene("space-travel")},]},onRefresh:game=>{const{script}=game.sceneData;if(script&&script.length){while(script.length&&script[0](game)){if(!game.sceneTime){break}
script.shift();game.sceneData.scriptTime=game.now}}},},{src:ASSETS.HOTTUB_WATER_WAVE,col:1,row:2,index:({now})=>Math.floor(now/1000)%2,}],},);game.addScene({name:"zoom-hottub",onScene:game=>{game.hideCursor=!0},sprites:[{init:({sceneData})=>{sceneData.stars=new Array(100).fill(null).map(()=>{return{x:(Math.random()-.5)*64,y:(Math.random()-.5)*64,size:.2,}})},onRefresh:(game,sprite)=>{const{sceneData,now,sceneTime}=game;sceneData.stars.forEach(star=>{star.x*=1.01;star.y*=1.01;star.size*=1.01;if(star.size>1){star.size=1}
if(Math.abs(star.x)>32||Math.abs(star.y)>32){star.x=(Math.random()-.5)*64;star.y=(Math.random()-.5)*64;star.size=.2}})},custom:(game,sprite,ctx)=>{ctx.fillStyle="#000022";ctx.fillRect(0,0,64,64);ctx.fillStyle="#FFFFFF";const{sceneData}=game;sceneData.stars.forEach(({x,y,size})=>{ctx.fillRect(32+x,32+y,size,size)})},},{src:ASSETS.HOTTUP_CLOSE_UP,col:6,row:7,index:({sceneData,pendingTip,now})=>{if(pendingTip){if(pendingTip.talker==="human"){return Math.floor(now/100)%2+13}
if(pendingTip.talker==="alexa"){return(Math.floor(now/100)%2)*2+13}
if(pendingTip.talker==="human2"){return(Math.floor(now/100)%3)+20}}
return sceneData.frame},startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"||talker==="human2"){x=5;y=60;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=3;y=23;game.playSound(SOUNDS.YUPA)}else if(talker==="alexa"){x=12;y=20;game.playSound(SOUNDS.OKAY);msg=msg.split("").map(a=>" ").join("")}
game.showTip(msg,onDone,talker==="yupa"?140:100,{x,y,talker,removeLock})},init:(game,sprite)=>{const{sceneData}=game;sceneData.script=[({now,sceneTime,sceneData})=>{sceneData.frame=Math.floor((now-sceneTime)/100)%2;return now-sceneTime>=500},({now,sceneTime,sceneData})=>{sceneData.frame=Math.min(13,Math.floor((now-game.sceneData.scriptTime)/100));if(sceneData.frame>=4&&!sceneData.alexaTurned){game.playSound(SOUNDS.DIVING,{volume:.3});sceneData.alexaTurned=game.now}
return sceneData.frame>=13},game=>{sprite.startTalk(game,"human",`Thanks Alectra! I love ${game.getSituation("stars").drink||"it"}!`,game=>{sprite.startTalk(game,"alexa","Okay")});return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sceneData.frame=15+Math.floor((now-sceneData.scriptTime)/300);if(sceneData.frame>19){sceneData.frame=18+(sceneData.frame)%2}
return now-sceneData.scriptTime>3000},({now,sceneTime,sceneData})=>{sceneData.frame=18+Math.floor((now-sceneData.scriptTime)/100)%2;return now-sceneData.scriptTime>1000},({now,sceneTime,sceneData})=>{sceneData.frame=20+Math.floor((now-sceneData.scriptTime)/100)%3;sprite.startTalk(game,"human2","How come they make these so hard to open?");return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sceneData.frame=23+Math.floor((now-sceneData.scriptTime)/100)%2;return now-sceneData.scriptTime>2000},({now,sceneTime,sceneData})=>{sceneData.frame=23;return now-sceneData.scriptTime>500},({now})=>{sceneData.frame=25
return now-sceneData.scriptTime>1000},game=>{game.gotoScene("i-have-no-hand");return!0},]},onRefresh:game=>{const{script}=game.sceneData;if(script&&script.length){while(script.length&&script[0](game)){if(!game.sceneTime){break}
script.shift();game.sceneData.scriptTime=game.now}}},},{src:ASSETS.HOTTUB_WATER_WAVE,col:1,row:2,index:({now})=>Math.floor(now/1000)%2,}],},);game.addScene({name:"zoom-shop-monster",onSceneHoldItem:(game,item)=>{if(!item){return}
game.useItem=null;switch(item){case "gun":game.showTip("No way, not my gun!");break;case "coin":game.playSound(SOUNDS.WAITER);game.showTip("You can't sell money, dumb human!",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});break;case "water bottle":case "empty bottle":game.dialog.index=2;game.sceneData.price=1;game.sceneData.forSale=item;game.playSound(SOUNDS.WAITER);game.showTip(`${item}... I'll give you one coin for that.`,null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});break;case "fruit?":game.dialog.index=2;game.sceneData.price=2;game.sceneData.forSale=item;game.playSound(SOUNDS.WAITER);game.showTip(`Ah, that's a woompachuice. I'll take it for two coins.`,null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});break;case "lighter":game.playSound(SOUNDS.WAITER);game.showTip(["A lighter","Not worth much, it's been already used!"],null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});break;case "photo":game.playSound(SOUNDS.WAITER);game.showTip(["A photo of a newborn human?","That's worthless!"],game=>{game.playSound(SOUNDS.HUM);game.showTip("Actually, I just wanted to know if you've seen this baby before.",game=>{game.playSound(SOUNDS.WAITER);game.showTip("All humans more or less look the same to me.",game=>{game.playSound(SOUNDS.WAITER);game.showTip("But no, I've never seen a newborn human before.",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0})},null,{x:1,y:15,speed:60,talker:"monster"})})},null,{x:1,y:15,speed:60,talker:"monster"});break;case "key":game.dialog.index=2;game.sceneData.price=8;game.sceneData.forSale=item;game.playSound(SOUNDS.WAITER);game.showTip("Oh, you found a key. I'll take it for 8 coins",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});break;case "access card":game.dialog.index=2;game.sceneData.price=10;game.sceneData.forSale=item;game.playSound(SOUNDS.WAITER);game.showTip("An access card. You sure you want to sell it? I'll take it for 10 coins",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});break;default:game.playSound(SOUNDS.WAITER);game.showTip("That's worthless!",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});break}
return!0},onScene:game=>{if(!game.situation.inventory){game.situation.inventory=[{item:"tip",name:"tip",cost:1,available:!0,msg:"Don't know what to do? I can give you a hint.",},{item:"lighter",name:"lighter",cost:6,src:ASSETS.GRAB_LIGHTER,available:!1,msg:"You want your lighter back? You can have it.",},{item:"fruit?",name:"fruit",cost:4,src:ASSETS.GRAB_APPLE,available:!0,msg:"We call it a woompachuice. You can have it for 4 coins.",},{item:"water bottle",name:"water",cost:2,src:ASSETS.GRAB_WATER_BOTTLE,available:!0,msg:"Fresh water to quensh your thirst. Only 2 coins.",},{item:"bullet",name:"bullet",cost:5,src:ASSETS.GRAB_GUN,available:!0,msg:"A bit expensive, but it'll help you out in a fight.",hideFromInventory:!0,},{item:"access card",name:"access card",cost:20,src:ASSETS.GRAB_ACCESS_CARD,available:!1,msg:"I warned you, you should have kept this. 20 coins to get it back.",},{item:"key",name:"key",cost:7,src:ASSETS.GRAB_KEY,available:!1,msg:"You can have your key back for 15 coins.",},]}
const initialDialog=game.situation.metBefore?"So, wanna trade?":["Oh.. you're the human.","Looks like you managed to escape from your cage. Impressive, hahaha..","Don't worry, I'm not gonna rat you out. I'm here to do business. With anyone!","So, got anything to trade?",];const removeLock=game.situation.metBefore?!0:!1;game.situation.metBefore=game.now;const dialogCallback=game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Buy",onSelect:(game,dialog)=>{dialog.index++;game.playSound(SOUNDS.BEEP,{volume:.5});game.sceneData.showStats=game.now;if(game.pendingTip){game.pendingTip.end=game.now}},},{msg:"Sell",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BEEP,{volume:.5});game.clickBag();if(game.pendingTip){game.pendingTip.end=game.now}},},{msg:"LEAVE",onSelect:game=>{game.dialog=null;game.playSound(SOUNDS.WAITER);game.showTip("Come back soon!.",game=>{game.gotoScene("first-prison-cell")},null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0})}},],},{options:[{},{},{msg:"Back",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BEEP,{volume:.5});game.sceneData.showStats=0;dialog.index--},},],},{options:[{cantSelect:!0,msg:({sceneData})=>`${sceneData.price} coin${sceneData.price>1?'s':''}?`,},{msg:"Sure",onSelect:(game,dialog)=>{game.removeFromInventory(game.sceneData.forSale);game.addToInventory({item:"coin",count:game.sceneData.price,image:ASSETS.GRAB_COIN,});game.playSound(SOUNDS.PICKUP);game.playSound(SOUNDS.WAITER);game.showTip("Nice doing business with you.",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});const itemObj=game.situation.inventory.filter(({item})=>item===game.sceneData.forSale)[0];if(itemObj&&!itemObj.available){itemObj.available=!0;itemObj.unique=!0}
game.sceneData.showStats=0;dialog.index=0;game.sceneData.forSale=null},},{msg:"No",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BOP,{volume:.5});game.sceneData.showStats=0;dialog.index=0;game.sceneData.forSale=null;if(game.pendingTip){game.pendingTip.end=game.now}},},],},{options:[{cantSelect:!0,msg:({sceneData})=>`${sceneData.price} coin${sceneData.price>1?'s':''}?`,},{msg:game=>game.sceneData.itemToBuy&&game.sceneData.itemToBuy.item==="tip"?"Yes, help me!":"Sure",onSelect:(game,dialog)=>{const{item,name,cost,src,available,msg}=game.sceneData.itemToBuy;if(cost<=game.countItem("coin")){game.removeFromInventory("coin",cost);if(item==="tip"){game.sceneData.showStats=0;dialog.index++;if(game.pendingTip){game.pendingTip.end=game.now}
if(!game.situation.hints){game.situation.hints={}}
return}else{game.pickUp({item,image:src,onPicked:game=>{game.playSound(SOUNDS.WAITER);game.showTip("Nice doing business with you.",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0})}});const itemObj=game.situation.inventory.filter(obj=>obj.item===item)[0];if(itemObj&&itemObj.unique){itemObj.available=!1}}}else{game.playErrorSound();game.playSound(SOUNDS.WAITER);game.showTip("Hey, you don't have enough! Don't try to trick me.",null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0})}
game.sceneData.showStats=0;dialog.index=0;game.sceneData.itemToBuy=null},},{msg:"No",onSelect:(game,dialog)=>{game.playSound(SOUNDS.BOP,{volume:.5});game.sceneData.showStats=0;dialog.index=0;game.sceneData.forSale=null;if(game.pendingTip){game.pendingTip.end=game.now}},},],},{options:[{msg:"Locker code?",onSelect:(game,dialog)=>{const{cost}=game.sceneData.itemToBuy;game.removeFromInventory("coin",cost);game.sceneData.itemToBuy=null;const HINTS=[["One guard kept bragging about his score at the arcade.","...perhaps he used that as his locker code."],"To get ranked on the arcade, you'll need to destroy at least 20 ships.","The locker code is in Urrzi. Same as the arcade machine.",["I almost saw the code once.",`I think it starts with ${game.toAlienDigits(Math.floor(HIGHSCORE/1000), 1)} and ends with ${game.toAlienDigits(HIGHSCORE%10, 1)}.`],"I don't know what else to say.",];game.playSound(SOUNDS.WAITER);game.showTip(HINTS[Math.min(HINTS.length-1,game.situation.hints.locker||0)],null,null,{x:1,y:15,speed:60,talker:"monster"});game.situation.hints.locker=(game.situation.hints.locker||0)+1;dialog.index=0;game.playSound(SOUNDS.PICKUP)}},{msg:"Where's the key?",onSelect:(game,dialog)=>{const{cost}=game.sceneData.itemToBuy;game.removeFromInventory("coin",cost);game.sceneData.itemToBuy=null;const HINTS=[["The key should be somewhere on this floor.","Explore every corner of it."],"The key is probably somewhere in the previous area.","Make sure to explore every corners of the maps.","I don't know what else to say.",];game.playSound(SOUNDS.WAITER);game.showTip(HINTS[Math.min(HINTS.length-1,game.situation.hints.key||0)],null,null,{x:1,y:15,speed:60,talker:"monster"});game.situation.hints.key=(game.situation.hints.key||0)+1;dialog.index=0;game.playSound(SOUNDS.PICKUP)}},{msg:"Fighting tips?",onSelect:(game,dialog)=>{const{cost}=game.sceneData.itemToBuy;game.removeFromInventory("coin",cost);game.sceneData.itemToBuy=null;const HINTS=[["Sometimes, foes attack immediately after blocking.","Be prepare to block yourself."],"With the gun, you can end the battle, but you won't earn any experience.","Blocking will make you hurt less, but you'll still hurt.","You should level up yourself to fight better.","I don't know what else to say.",];game.playSound(SOUNDS.WAITER);game.showTip(HINTS[Math.min(HINTS.length-1,game.situation.hints.battle||0)],null,null,{x:1,y:15,speed:60,talker:"monster"});game.situation.hints.battle=(game.situation.hints.battle||0)+1;dialog.index=0;game.playSound(SOUNDS.PICKUP)}},],},],})};if(removeLock){dialogCallback(game)}
game.delayAction(game=>{game.playSound(SOUNDS.WAITER);game.showTip(initialDialog,removeLock?null:dialogCallback,null,{x:1,y:15,speed:60,talker:"monster",removeLock})},300)},sprites:[{src:ASSETS.ZOOM_SHOP_MONSTER,index:({pendingTip,now})=>pendingTip&&pendingTip.talker==="monster"&&pendingTip.progress<1?Math.floor(now/150)%4:0,},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#00000088";ctx.fillRect(0,0,64,20)},},{src:ASSETS.STATS,index:({now,sceneData})=>Math.min(3,Math.floor((now-sceneData.showStats)/100)),hidden:({sceneData})=>!sceneData.showStats,onClick:game=>{},},{custom:(game,sprite,ctx)=>{let space=game.displayTextLine(ctx,{msg:game.countItem("coin")+"",x:1,y:0});game.displayImage(ctx,{src:ASSETS.GRAB_COIN,index:1,offsetX:-10+space,offsetY:-46})},hidden:({now,sceneData})=>(!sceneData.showStats||now-sceneData.showStats<300)&&!sceneData.forSale,},{custom:(game,sprite,ctx)=>{let count=0;const{mouse}=game;ctx.fillStyle="#889933";game.situation.inventory.forEach(({item,name,cost,src,available},index)=>{if(available){const yLine=8+count*6;game.displayImage(ctx,{src:ASSETS.GRAB_COIN_DARKEN,index:1,offsetX:41,offsetY:-38+count*6});if(mouse&&mouse.y>=yLine&&mouse.y<yLine+6&&mouse.x>=4&&mouse.x<=60){ctx.fillRect(4,yLine,56,5)}
game.displayTextLine(ctx,{msg:name,x:5,y:yLine});game.displayTextLine(ctx,{msg:""+cost,x:43,y:yLine});count ++}})},onClick:game=>{let count=0;const{mouse}=game;game.situation.inventory.forEach((itemToBuy,index)=>{const{item,name,cost,src,available,msg}=itemToBuy;if(available){const yLine=8+count*6;if(mouse&&mouse.y>=yLine&&mouse.y<yLine+6&&mouse.x>=4&&mouse.x<=60){game.sceneData.showStats=0;game.sceneData.itemToBuy=itemToBuy;game.sceneData.price=cost;game.showTip(msg,null,null,{x:1,y:15,speed:60,talker:"monster",removeLock:!0});game.dialog.index=3;game.playSound(SOUNDS.BEEP,{volume:.5})}
count ++}})},hidden:({now,sceneData})=>!sceneData.showStats||now-sceneData.showStats<300,},...standardBag(),{src:({sceneData,inventory})=>inventory[sceneData.forSale].image,index:3,hidden:({sceneData})=>!sceneData.forSale,},],},);game.addScene({name:"zoom-vending-machine",onScene:({sceneData})=>{sceneData.putCoin=0;game.startDialog({time:game.now,index:0,conversation:[{message:"",options:[{},{msg:"LEAVE",onSelect:game=>game.gotoScene("vending-machine"),},],},],})},arrowGrid:[[],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onSceneRefresh:game=>{if(game.situation.gotBottle&&!game.situation.grabbedBottle){const frame=Math.floor((game.now-game.situation.gotBottle))/100;if(frame>4){game.pickUp({item:"water bottle",image:ASSETS.GRAB_WATER_BOTTLE,message:"Looks like water."});game.situation.grabbedBottle=game.now}}
if(game.situation.gotApple&&!game.situation.grabbedApple){const frame=Math.floor((game.now-game.situation.gotApple))/100;if(frame>4){game.pickUp({item:"fruit?",image:ASSETS.GRAB_APPLE,message:"Looks eatable."});game.situation.grabbedApple=game.now}}},sprites:[{src:ASSETS.VENDING_MACHINE_CLOSEUP},{src:ASSETS.VENDING_MACHINE_BOTTLE,col:2,row:3,index:game=>!game.situation.gotBottle?0:Math.min(4,Math.floor((game.now-game.situation.gotBottle)/100)),onClick:game=>{if(!game.situation.coin||game.situation.gotBottle){game.playSound(SOUNDS.ERROR);game.delayAction(game=>game.playSound(SOUNDS.ERROR),100)}else{game.situation.coin--;if(!game.situation.coin){delete game.situation.coin}
game.situation.gotBottle=game.now;game.playSound(SOUNDS.DUD)}},tip:game=>game.situation.pickedUpBottle?"Nothing left.":"Looks like a bottle. Is that water?",combineMessage:(item,game)=>item==="coin"?"That goes in the coin slot.":null,},{src:ASSETS.VENDING_MACHINE_APPLE,col:2,row:3,index:game=>!game.situation.gotApple?0:Math.min(4,Math.floor((game.now-game.situation.gotApple)/100)),onClick:game=>{if((game.situation.coin||0)<3||game.situation.gotApple){game.playSound(SOUNDS.ERROR);game.delayAction(game=>game.playSound(SOUNDS.ERROR),100)}else{game.situation.coin-=3;if(!game.situation.coin){delete game.situation.coin}
game.situation.gotApple=game.now;game.playSound(SOUNDS.DUD)}},tip:game=>game.situation.pickedUpBottle?"Nothing left.":"I hope that's food. I'm getting hungry.",combineMessage:(item,game)=>item==="coin"?"That goes in the coin slot.":null,},{src:ASSETS.VENDING_MACHINE_GLASS},{custom:({now,situation},sprite,ctx)=>{ctx.fillStyle="#aa6666";ctx.fillRect(13,33,6,2);ctx.fillRect(38,33,2,2);ctx.fillRect(34,33,2,2);ctx.fillRect(30,33,2,2);if(now%1000<500){ctx.fillStyle="#66cc66";if(situation.coin>0){ctx.fillRect(13,33,6,2)}
if(situation.coin>0){ctx.fillRect(30,33,2,2)}
if(situation.coin>1){ctx.fillRect(34,33,2,2)}
if(situation.coin>2){ctx.fillRect(38,33,2,2)}}},},{name:"coin-slot",src:ASSETS.VENDING_MACHINE_COIN_SLOT,index:({now,sceneData})=>Math.min(3,Math.floor((now-sceneData.putCoin)/100)),combine:(item,game)=>{if(item==="coin"){game.useItem=null;game.playSound(SOUNDS.DUD);game.sceneData.putCoin=game.now;game.situation.coin=(game.situation.coin||0)+1;game.removeFromInventory("coin");return!0}}},{src:ASSETS.VENDING_MACHINE_COIN_RETURN,index:({now,sceneData})=>sceneData.returnCoin&&now-sceneData.returnCoin<100?1:0,onClick:game=>{const{now,situation,sceneData}=game;const coins=["coin 1","coin 2","coin 3",];if(situation.coin){sceneData.returnCoin=now;game.playSound(SOUNDS.DUD)}else{game.playErrorSound()}
while(situation.coin){situation.coin--;for(let i=0;i<coins.length;i++){if(game.data.pickedUp[coins[i]]){delete game.data.pickedUp[coins[i]];break}}}
delete situation.coin},},{src:ASSETS.SPEECH_OUT,offsetY:9,hidden:game=>game.bagOpening||game.useItem||game.pendingTip,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/80)),},...standardBag(),],},)