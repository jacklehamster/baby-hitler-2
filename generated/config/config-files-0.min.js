game.addScene({name:"9-months",onScene:game=>{game.stopSound(SOUNDS.CHIN_TOK_THEME,!0);game.playTheme(SOUNDS.CHIN_TOK_THEME,{volume:.8});game.hideCursor=!0;game.delayAction(game=>{game.currentScene.startTalk(game,"yupa",["Common Pedro!","Stop messin wid uz!",],game=>{game.currentScene.startTalk(game,"pedro",["No, me telling ya the truth!","She dun't know who da father is.",],game=>{game.currentScene.startTalk(game,"yupa",["Ya dun wanna admit","I'm shure itz you!","Ya horn doug",],game=>{game.currentScene.startTalk(game,"pedro",["Hey, me and miss Amari, we not like that!","What's more strange, I'd say","Miss Amari swears she still a virgin!","As far as she remembers",],game=>{game.currentScene.startTalk(game,"yupa",["Meybe she forgat","Ya know, what happenz in Ecsta City ...",],game=>{game.currentScene.startTalk(game,"pedro",["Stop talking nonsense, Yupa!",],game=>{game.sceneData.lookAtCamera=game.now;game.currentScene.startTalk(game,"pedro",["Oh look, here comes doctor Sarlie","and our beautiful new mommy!",],game=>{game.sceneData.frontView=game.now;game.sceneData.showAmari=game.now+2000;game.currentScene.showAmari(game)})})})})})})})},10000)},showAmari:game=>{game.currentScene.startTalk(game,"doctar",["Greeting boys,","I'm happy to\nannounce ...","we have a\nhalf-human boy!",],game=>{game.sceneData.frontView=0;game.sceneData.surprised=game.now;game.currentScene.startTalk(game,"all","A HALF-HUMAN BOY!",game=>{game.currentScene.startTalk(game,"pedro",["I told you dufus, I'm not da father!",],game=>{game.sceneData.frontView=game.now;game.sceneData.lookAtAmari=game.now;game.currentScene.startTalk(game,"amari",["I don't\nunderstand what happened and I don't care.",],game=>{game.currentScene.startTalk(game,"amari",["This is a little miracle from God that I\nwelcome with open arms!",],game=>{game.currentScene.startTalk(game,"doctar",["So, how are you going to name your baby?",],game=>{game.gotoScene("amari-baby")})})})})})})},sprites:[{custom:(game,sprite,ctx)=>{ctx.clearRect(0,0,64,64)},hidden:game=>game.now-game.sceneTime>=10000,},{custom:(game,sprite,ctx)=>{ctx.globalAlpha=game.evaluate(sprite.alpha);game.displayTextLine(ctx,{msg:"9 MONTHS",x:10,y:22});game.displayTextLine(ctx,{msg:"LATER",x:17,y:29});ctx.globalAlpha=1},hidden:game=>game.now-game.sceneTime>=10000||game.now===game.sceneTime,alpha:game=>{const time=game.now-game.sceneTime;return time<5000?Math.min(1,time/3000):Math.max(0,1-(time-5000)/3000)},},{src:ASSETS.DOCTOR_LOBBY,col:3,row:3,hidden:game=>game.now-game.sceneTime<10000,index:({sceneData,pendingTip,now})=>{if(sceneData.surprised){return pendingTip&&pendingTip.talker==="pedro"&&pendingTip.progress<1?6+Math.floor(now/100)%2:6}
const frame=Math.floor(now/100)%2;if(pendingTip&&pendingTip.progress<1&&frame){switch(pendingTip.talker){case "pedro":return sceneData.lookAtCamera?5:2;case "yupa":return 1;case "yula":return 3}
if(game.pendingTip.talker==="pedro"){return 2}}
return sceneData.lookAtCamera?4:0},onRefresh:game=>{if(game.pendingTip&&(game.pendingTip.talker==="pedro"||game.pendingTip.talker==="all")&&game.pendingTip.progress<1){if(!game.sceneData.yapping){game.sceneData.yapping=!0;game.playSound(SOUNDS.YAP,{loop:!0})}}else{if(game.sceneData.yapping){game.sceneData.yapping=!1;game.stopSound(SOUNDS.YAP)}}
if(!game.pendingTip||game.pendingTip.talker!=="yupa"){if(game.sceneData.yupaTalking){game.sceneData.yupaTalking=!1}}},},{src:ASSETS.DOCTOR_LOBBY_SARLIE,hidden:({sceneData})=>!sceneData.frontView,index:({sceneData,pendingTip,now})=>{if(pendingTip&&pendingTip.talker==="doctar"&&pendingTip.progress<1){if(sceneData.lookAtAmari){return 2+Math.floor(now/100)%2}else{return Math.floor(now/100)%2}}
return sceneData.lookAtAmari?3:0},},{src:ASSETS.DOCTOR_LOBBY_AMARI,offsetX:({sceneData,now})=>Math.round(-40+40*Math.sqrt(Math.min(1,Math.max(0,now-sceneData.showAmari)/4000))),hidden:({sceneData})=>!sceneData.frontView,index:({pendingTip,now})=>{return 3+(pendingTip&&pendingTip.talker==="amari"&&pendingTip.progress<1?Math.floor(now/100)%2:0)}},],startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y,maxLines=3;if(talker==="yupa"){x=2;y=63;game.playSound(SOUNDS.YUPA)}else if(talker==="pedro"){x=4;y=63}else if(talker==="yula"){x=7;y=63;game.playSound(SOUNDS.YULA)}else if(talker==="doctar"){x=2;y=60;maxLines=2;game.playSound(SOUNDS.HUHUH)}else if(talker==="amari"){x=2;y=62;maxLines=2;game.playSound(SOUNDS.ANIMAL_CRY)}else if(talker==="all"){x=3;y=62;game.playSound(SOUNDS.YUPA)}
game.showTip(msg,onDone,speed||(talker==="yupa"?100:80),{x,y,talker,removeLock,maxLines})},},);game.addScene({name:"alien",onScene:game=>{game.hideCursor=!0},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/100)-10;if(frame<15){game.sceneData.frame=0}else if(frame<25){game.sceneData.frame=1}else if(frame<33){game.sceneData.frame=0}else if(frame<35){game.sceneData.frame=2}else if(frame<70){if(!game.sceneData.ate){game.sceneData.ate=game.now;game.playSound(SOUNDS.EAT)}
game.sceneData.frame=3+frame%3}else if(frame<75){game.sceneData.frame=3}else if(frame<90){if(!game.sceneData.ache){game.sceneData.ache=game.now;game.playSound(SOUNDS.DRINK)}
game.sceneData.frame=6}else if(frame<120){game.sceneData.frame=6+Math.min(4,Math.floor((frame-90)))}else if(frame<150){game.sceneData.frame=10+Math.floor((game.now-game.sceneTime)/10)%4}else if(frame<200){if(!game.sceneData.explode){game.playSound(SOUNDS.GUN_SHOT);game.delayAction(game=>game.playSound(SOUNDS.GUN_SHOT),50);game.delayAction(game=>game.playSound(SOUNDS.GUN_SHOT),50);game.sceneData.explode=game.now;game.sceneData.pieces=new Array(500).fill(null).map(a=>{const byte=Math.max(0x10,Math.floor(Math.random()*0xaa)).toString(16);const color=`#cc${byte}${byte}`;const size=Math.random()<.5?1:2;const p={x:[26+10*(Math.random()-.5)],y:[30+Math.random()*2],dx:Math.random()-.5,dy:-Math.random()*3,size,color,appear:game.now+4000*Math.random(),};return p})}
game.sceneData.frame=14}else if(frame<240){game.sceneData.frame=Math.min(24,frame-200+17);if(!game.sceneData.alienSound){game.sceneData.alienSound=!0;game.playSound(SOUNDS.ALIEN)}}else{if(!game.data.gameOver){getMedal("Death by alien");game.gameOver(" “~That was\n             not cake!~”")}}},sprites:[{src:ASSETS.ALIEN_EATER,col:5,row:5,index:game=>game.sceneData.frame||0,},{custom:(game,sprite,ctx)=>{if(game.sceneData.explode){const pieces=game.sceneData.pieces||[];pieces.forEach(piece=>{const{x,y,preX,preY,dx,dy,size,color,appear}=piece;if(appear<game.now){ctx.fillStyle=color;for(let i=0;i<x.length;i++){ctx.fillRect(x[i],y[i],size-i*.1,size-i*.1)}
if(x.length<5){x.push(x[x.length-1]);y.push(y[y.length-1])}
for(let i=x.length-1;i>=1;i--){x[i]=x[i-1];y[i]=y[i-1]}
piece.x[0]+=dx;piece.y[0]+=dy;piece.dy+=.15}})}},},],},);game.addScene({name:"amari-baby",onScene:game=>{game.playSound(SOUNDS.ANIMAL_CRY);game.showTip([`I will name you ...`,`Baby\n~${game.data.name||"Hitman"}~!`,],game=>{game.playTheme(null);game.sceneData.cry=game.now;game.playSound(SOUNDS.BABY_CRY);game.delayAction(game=>{game.sceneData.cry=game.now;game.playSound(SOUNDS.BABY_CRY)},1000);game.delayAction(game=>{game.sceneData.cry=game.now;game.playSound(SOUNDS.BABY_CRY)},2000);game.delayAction(game=>{game.stopSound(SOUNDS.GOLDMAN_THEME,!0);game.playTheme(SOUNDS.GOLDMAN_THEME,{volume:.8});game.sceneData.creditStart=game.now;getMedal("REBORN ENDING")},3000)});game.hideCursor=!0;game.sceneData.credits=`${game.title||" Where in Space is\n  BABY HITLER?"}

				A game from
				DOBUKI STUDIO
				by
				Jack Le Hamster

				Coded in JavaScript
				with Sublime Text

				Art made with Piskel

				Music made with BeepBox

				Sound effects made with VoiceChanger.io and Brfx

				Music covers:
				“La Soupe aux Choux”
				(Raymond Lefèvre)

				“Elle a fait un bébé toute seule”
				(Jean-Jacques Goldman)

				This game is a sequel to “Kill Baby Hitler”. The first part of this game was released for
				#LOWREZJAM\n2019\nas “Escape from Labbyrithe”.

				I kept working my ass off on this game, to make a proper ending, which you didn't reach yet.

				But along the way, I got sidetracked with this alternate storyline, where you fall for Amari, spend the night with her, and vanish the next morning.

				This is the only ending where you get to hear a cover from Jean-Jacques Goldman's song, a true delight!				

				Anyway, thanks for playing.

				Please make sure to follow my games, share them, and say great things about them to your family and friends.

				You have finished the game, with
				REBORN ENDING.

				Congratulations, dad!

				Have a nice day!
			`.split("\n").map((a,index)=>index>2?game.wordwrap(a.trim(),9):a).join("\n").split("\n")},onSceneRefresh:game=>{const shift=-(game.now-game.sceneTime)/200+50;if(game.sceneData.credits.length*6+shift<-25){if(!game.sceneData.showGameOver){game.sceneData.showGameOver=game.now;game.gameOver(" ",!0)}}},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle=`#000000`;ctx.fillRect(0,0,64,64)},},{src:ASSETS.AMARI_BABY,col:2,row:3,index:game=>{return game.sceneData.cry&&game.now-game.sceneData.cry<500?1:0},},{src:ASSETS.BEARD_SHAVED,col:3,row:3,offsetY:-12,index:game=>{return game.sceneData.cry&&game.now-game.sceneData.cry<500?1:0},},{src:ASSETS.AMARI_BABY,col:2,row:3,index:4,},{hidden:game=>!game.sceneData.creditStart,custom:(game,sprite,ctx)=>{if(game.now-game.sceneData.creditStart){ctx.fillStyle="#000000";ctx.globalAlpha=Math.min(.7,(game.now-game.sceneData.creditStart)/3000);ctx.fillRect(0,0,64,64)}
ctx.globalAlpha=1;const shift=-(game.now-game.sceneData.creditStart-2000)/200+50;game.sceneData.credits.forEach((line,index)=>{const y=index*6+shift;if(y>0&&y<55){game.displayTextLine(ctx,{msg:line,x:1,y:Math.round(y),alpha:Math.max(0.05,Math.min(.8,y/5,(55-y)/5)),})}})},},],},);game.addScene({name:"arcade-room",arrowGrid:[[null,null,MENU,null,null],[],[],[],[],],onScene:game=>{game.save();game.playTheme(SOUNDS.CHIN_TOK_THEME,{volume:.2});game.startDialog({time:game.now,index:0,conversation:[{message:"",options:[{},{},{msg:"LEAVE",onSelect:game=>{const fadeDuration=1000;game.fadeOut(game.now,{duration:fadeDuration*1.5,fadeDuration,color:"#000000",onDone:game=>{game.gotoScene("maze-2",{door:4})}})}},],},],})},sprites:[{src:ASSETS.ARCADE_ROOM,},{src:ASSETS.ARCADE,onClick:game=>game.gotoScene("zoom-arcade"),},{src:ASSETS.SPEECH_OUT,offsetY:15,hidden:game=>game.bagOpening||game.useItem||game.pendingTip,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/80)),},...standardMenu(),],},);game.addScene({name:"asteroid-field",startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"){x=7;y=58;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=22;game.playSound(SOUNDS.YUPA)}
game.showTip(msg,onDone,100,{x,y,talker,removeLock})},customCursor:(game,ctx)=>{return game.sceneData.lives>0?Cursor.NONE:null},onScene:game=>{game.save();game.delayAction(game=>{game.sceneData.joy=game.now;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8})},1000);game.sceneData.missiles=[];game.sceneData.lastShot=game.now;game.sceneData.maxLives=30;game.sceneData.lives=game.sceneData.maxLives;game.sceneData.maxShots=300;game.sceneData.shots=game.sceneData.maxShots;game.delayAction(game=>{console.log(game.sceneData.lives)},90000);game.delayAction(game=>{if(game.data.gameOver){return}
game.sceneData.asteroids=[];game.sceneData.passed=game.now;game.waitCursor=!0;game.currentScene.startTalk(game,"yupa","Hey good moaning? Wad happan?",game=>{game.currentScene.startTalk(game,"human","Damnit Yupa! While you were dozing off, we just passed through\nan asteroid field!",game=>{game.currentScene.startTalk(game,"yupa",["Ya were drivin da ship?","Why not let Alectra drave? She can dogge asteroiz, itz pisca cake!",],game=>{game.currentScene.startTalk(game,"human",["What?!! You're kidding me!",],game=>{game.currentScene.startTalk(game,"yupa",["Hey next tam dhere prablem,","dunt try be a heru! Just wak me up!"],game=>{game.currentScene.startTalk(game,"human",["Yupa, I'm gonna kill you!",],game=>{game.sceneData.liftOff=game.now;game.playSound(SOUNDS.DIVING);game.delayAction(game=>{game.fadeToScene("final-planet")},3000)})})})})})})},85000)},onSceneRefresh:({now,sceneData})=>{const time=(sceneData.shakeTime-now);if(time>0){sceneData.shiftX=Math.round((Math.random()*time)/200);sceneData.shiftY=Math.round((Math.random()*time)/200)}else{sceneData.shiftX=0;sceneData.shiftY=0}},drawAsteroid:(game,ctx,{rads,rotation,distance,x,y,heating,cooling})=>{const{shiftX,shiftY}=game.sceneData;ctx.fillStyle=cooling?"#554444":heating?"#884444":"#444444";ctx.beginPath();rads.forEach((dist,index)=>{const angle=Math.PI*2*(index/rads.length+rotation*game.now/1000);const px=x+Math.cos(angle)*dist*distance;const py=y+Math.sin(angle)*dist*distance;if(index===0){ctx.moveTo(px+shiftX,py+shiftY)}else{ctx.lineTo(px+shiftX,py+shiftY)}});ctx.closePath();ctx.fill();ctx.fillStyle=cooling?"#665555":heating?"#aa5555":"#555555";ctx.beginPath();rads.forEach((dist,index)=>{const angle=Math.PI/3+Math.PI*2*(index/rads.length+rotation*game.now/1000);const px=x+Math.cos(angle)*dist*.8*distance;const py=y+Math.sin(angle)*dist*.8*distance;if(index===0){ctx.moveTo(px+shiftX,py+shiftY)}else{ctx.lineTo(px+shiftX,py+shiftY)}});ctx.closePath();ctx.fill();ctx.fillStyle=cooling?"#886666":heating?"#bb6666":"#666666";ctx.beginPath();rads.forEach((dist,index)=>{const angle=Math.PI/2+Math.PI*2*(index/rads.length+rotation*game.now/1000);const px=x+Math.cos(angle)*dist*.6*distance;const py=y+Math.sin(angle)*dist*.6*distance;if(index===0){ctx.moveTo(px+shiftX,py+shiftY)}else{ctx.lineTo(px+shiftX,py+shiftY)}});ctx.closePath();ctx.fill()},makeDust:({sceneData},{x,y,dx,dy},color)=>{if(sceneData.dusts){for(let i=0;i<10;i++){sceneData.dusts.push({x,y,dx:Math.random()-.5+dx,dy:Math.random()-.5+dy,color:color||"#cc6699",size:3,})}}},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#000011";ctx.fillRect(0,0,64,64)},},{mouseHovered:!0,onClick:game=>{const{sceneData,now}=game;if(sceneData.shots>0){game.playSound(SOUNDS.LAZER);sceneData.missiles.push({x:sceneData.ship.x+Math.random()-.5,y:sceneData.ship.y-5,});sceneData.lastShot=now;sceneData.shots --}else{game.playSound(SOUNDS.ERROR);sceneData.lastShot=now}},onRefresh:(game,sprite)=>{const{sceneData,mouseDown,now,data}=game;if(data.gameOver){return}
const delay=200;if(mouseDown&&now-sceneData.lastShot>delay){sprite.onClick(game)}else if(!mouseDown){sceneData.lastShot=0}},hidden:game=>game.data.ship&&game.data.ship.superGun,},{init:game=>{game.sceneData.stars=new Array(100).fill(null).map(a=>{const d=Math.random();return{d,col:Math.floor(d*100),x:Math.random()*64,y:Math.random()*64,speed:(1+d)/20,}})},custom:(game,sprite,ctx)=>{const{shiftX,shiftY}=game.sceneData;const imageData=ctx.getImageData(0,0,64,64);game.sceneData.stars.forEach(star=>{const index=Math.floor(Math.round(star.x+shiftX)+Math.round(star.y+shiftY)*64)*4;const col=star.col;imageData.data[index]=col;imageData.data[index+1]=col;imageData.data[index+2]=col;imageData.data[index+3]=255;star.y+=star.speed;if(star.y>64){star.x=Math.random()*64;star.y=-1}});ctx.putImageData(imageData,0,0)},},{custom:({now,sceneTime,sceneData,mouseDown},sprite,ctx)=>{if(now-sceneTime>1000&&sceneData.ship&&mouseDown&&sceneData.shots>0){const{x,y}=sceneData.ship;const rx=Math.round(x),ry=Math.round(y);ctx.fillStyle="#ffdddd";ctx.fillRect(rx-3,ry-64,6,64)}},onRefresh:(game,sprite)=>{const{sceneData,mouseDown,now,data}=game;if(data.gameOver){return}
const delay=150;let didShoot=!1;if(mouseDown&&now-sceneData.lastShot>delay){if(sceneData.shots>0){game.playSound(SOUNDS.LAZER);sceneData.shots-=2.5;didShoot=!0}else{game.playSound(SOUNDS.ERROR)}
sceneData.lastShot=now}else if(!mouseDown){sceneData.lastShot=0}
if(!didShoot){if(!sceneData.lastRecharge||now-sceneData.lastRecharge>delay){sceneData.shots=Math.min(game.sceneData.maxShots,sceneData.shots+1);sceneData.lastRecharge=now}}},hidden:game=>!game.data.ship||!game.data.ship.superGun,},{init:game=>{if(!game.sceneData.ship){game.sceneData.ship={}}
game.sceneData.ship.x=32;game.sceneData.ship.y=32},custom:({now,sceneTime,sceneData},sprite,ctx)=>{if(now-sceneTime>1000){const{x,y}=sceneData.ship;ctx.fillStyle="#ffffff";ctx.beginPath();ctx.arc(x,y,5,0,2*Math.PI);ctx.fill();ctx.fillStyle="#75b0d0";ctx.beginPath();ctx.arc(x,y,3,0,2*Math.PI);ctx.fill();ctx.fillStyle="#aacccc";ctx.beginPath();ctx.arc(x-1,y-1,1,0,2*Math.PI);ctx.fill()}},onRefresh:({mouse,sceneData,now,sceneTime})=>{if(mouse&&!sceneData.liftOff){sceneData.ship.x+=(mouse.x-sceneData.ship.x)/2;sceneData.ship.y+=(mouse.y-sceneData.ship.y)/2}else if(sceneData.liftOff){const accel=(now-sceneData.liftOff)/500;sceneData.ship.y-=accel}},hidden:game=>{return game.sceneData.lives<=0},},{initialize:(game,asteroid)=>{asteroid.x=Math.random()*64;asteroid.y=-Math.random()*64;asteroid.dx=Math.random()-.5;asteroid.dy=Math.random()+.5;asteroid.rads=new Array(9).fill(null).map(a=>(Math.random()+1));asteroid.rotation=Math.random()+.5;asteroid.distance=3+Math.random();return asteroid},init:(game,sprite)=>{const{sceneData}=game;sceneData.rads=new Array(9).fill(null).map(a=>(Math.random()+1));sceneData.asteroids=[]},custom:(game,sprite,ctx)=>{const{sceneData}=game;sceneData.asteroids.forEach(asteroid=>{game.currentScene.drawAsteroid(game,ctx,asteroid)})},destroyAsteroid:(asteroid,game,sprite)=>{asteroid.destroyed=game.now;game.playSound(SOUNDS.HIT_LAND);if(asteroid.distance>2){const debris=[sprite.initialize(game,{}),sprite.initialize(game,{}),];debris.forEach(debris=>{debris.x=asteroid.x;debris.y=asteroid.y;debris.dx=asteroid.dx+Math.random()-.5;debris.dy=asteroid.dy/2;debris.distance=asteroid.distance/2;game.sceneData.asteroids.push(debris)})}
game.currentScene.makeDust(game,asteroid)},onRefresh:(game,sprite)=>{const{sceneData,now,sceneTime,mouseDown}=game;sceneData.asteroids.forEach((asteroid,index)=>{const shipDist=2+asteroid.distance;const hitDist=4+asteroid.distance;asteroid.x+=asteroid.dx;asteroid.y+=asteroid.dy;sceneData.asteroids.forEach((asteroidCollided,indexCollided)=>{if(indexCollided>index){const distX=asteroid.x-asteroidCollided.x;const distY=asteroid.y-asteroidCollided.y;const dist=Math.sqrt(distX*distX+distY*distY);if(dist<asteroid.distance+asteroidCollided.distance){const tempDx=asteroid.dx*asteroid.distance;const tempDy=asteroid.dy*asteroid.distance;asteroid.dx=(asteroidCollided.dx*asteroidCollided.distance)/asteroid.distance;asteroid.dy=(asteroidCollided.dy*asteroidCollided.distance)/asteroid.distance;asteroidCollided.dx=tempDx/asteroidCollided.distance;asteroidCollided.dy=tempDy/asteroidCollided.distance;asteroid.x+=asteroid.dx;asteroid.y+=asteroid.dy;asteroidCollided.x+=asteroidCollided.dx;asteroidCollided.y+=asteroidCollided.dy}}});if(Math.abs(asteroid.x-sceneData.ship.x)<shipDist&&Math.abs(asteroid.y-sceneData.ship.y)<shipDist){if(sceneData.lives>0){game.playSound(game.data.ship&&game.data.ship.superShield?SOUNDS.DUD:SOUNDS.PLAYER_HURT);asteroid.destroyed=!0;const speed=Math.sqrt(asteroid.dx*asteroid.dx+asteroid.dy*asteroid.dy);if(!game.data.ship||!game.data.ship.superShield){sceneData.shakeTime=Math.max(now+(asteroid.distance*speed*400),sceneData.shakeTime||0)}
game.currentScene.makeDust(game,asteroid,"#882200");const damage=(asteroid.distance*speed)/(sceneData.lives<sceneData.maxLives/4?2:1);sceneData.lives-=game.data.ship&&game.data.ship.superShield?Math.sqrt(damage):damage;if(sceneData.lives<=0){game.currentScene.makeDust(game,asteroid,"#888888");game.gameOver("    “~The odds of\n    navigating an\n    asteroid field\n    is 3721 to 1~”")}}}else{sceneData.missiles.forEach(missile=>{const{x,y}=missile;if(Math.abs(asteroid.x-x)<=hitDist&&Math.abs(asteroid.y-y)<=hitDist){missile.destroyed=game.now;sprite.destroyAsteroid(asteroid,game,sprite)}});let shot=!1;if(game.data.ship&&game.data.ship.superGun&&mouseDown&&sceneData.shots>0){const{x,y}=sceneData.ship;if(Math.abs(asteroid.x-x)<hitDist&&asteroid.y<y){const intensity=hitDist/Math.max(1,Math.max(asteroid.x-x));const direction=asteroid.x<x?-1:1;asteroid.dx+=direction*intensity/50;asteroid.dy-=.1;shot=!0;if(Math.random()<.15){if(!asteroid.destroyed){sprite.destroyAsteroid(asteroid,game,sprite)}}
if(!asteroid.heating){asteroid.heating=game.now;asteroid.cooling=0}}}
if(!shot){if(asteroid.heating&&!asteroid.cooling){asteroid.heating=0;asteroid.cooling=game.now}}}});sceneData.asteroids=sceneData.asteroids.filter(({x,y,destroyed})=>{return y>=-5&&y<70&&x>=-5&&x<70&&!destroyed});const maxAsteroid=Math.min((now-sceneTime-2000)/2000,25,25-(now-sceneTime-70000)/500);if(sceneData.asteroids.length<maxAsteroid&&!game.sceneData.passed){sceneData.asteroids.push(sprite.initialize(game,{}))}},},{init:({sceneData})=>{sceneData.dusts=[]},custom:({sceneData},sprite,ctx)=>{const{shiftX,shiftY}=sceneData;sceneData.dusts.forEach(({x,y,color,size})=>{ctx.fillStyle=color;ctx.fillRect(x-size/2+shiftX,y-size/2+shiftY,size,size)})},onRefresh:({sceneData})=>{sceneData.dusts.forEach(dust=>{dust.x+=dust.dx;dust.y+=dust.dy;dust.dx*=.9;dust.dy*=.9;dust.size*=.9});sceneData.dusts=sceneData.dusts.filter(({size})=>size>.5)},},{custom:({sceneData},sprite,ctx)=>{const{shiftX,shiftY}=sceneData;ctx.fillStyle="#cccccc";sceneData.missiles.forEach(({x,y})=>{ctx.fillRect(Math.round(x+shiftX),y+shiftY,1,2)});ctx.fillStyle="#FFFFaa";sceneData.missiles.forEach(({x,y})=>{ctx.fillRect(Math.round(x+shiftX),y+2+shiftY,1,2)});sceneData.missiles.forEach(missile=>{missile.y-=2});sceneData.missiles=sceneData.missiles.filter(({y,destroyed})=>y>-5&&!destroyed)},},{custom:({sceneData},sprite,ctx)=>{const{shiftX,shiftY}=sceneData;ctx.globalAlpha=.7;ctx.fillStyle="#222222";ctx.fillRect(61,4,1,5);ctx.fillRect(4,4,1,5);ctx.fillRect(5,4,56,1);ctx.fillRect(5,6,56,1);ctx.fillRect(5,8,56,1);ctx.globalAlpha=.5;ctx.fillStyle=sceneData.lives/sceneData.maxLives<1/4&&Math.floor(game.now/200)%3===0?"#660000":"#990000";ctx.fillRect(5,5,56,1);ctx.fillStyle=sceneData.shots<=0&&Math.floor(game.now/200)%3===0?"#888888":"#111111";ctx.fillRect(5,7,56,1);ctx.globalAlpha=1;if(sceneData.lives>0){ctx.fillStyle=game.data.ship&&game.data.ship.superShield?"#88bbaa":"#44bb44";ctx.fillRect(5,5,56*sceneData.lives/sceneData.maxLives,1)}
ctx.fillStyle="#bbbb44";if(sceneData.shots>0){ctx.fillRect(5,7,56*sceneData.shots/sceneData.maxShots,1)}},hidden:game=>game.now-game.sceneTime>83000||game.sceneData.lives<=0,},{custom:(game,sprite,ctx)=>{const fade=1-Math.min(1,(game.now-game.sceneTime)/1000);const imageData=ctx.getImageData(0,0,64,64);for(let i=0;i<imageData.data.length;i+=4){if(Math.random()<fade){imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255;imageData.data[i+3]=255}}
ctx.putImageData(imageData,0,0)},hidden:game=>game.now-game.sceneTime>1000,},],},);game.addScene({name:"birthday",onScene:game=>{game.waitCursor=!0;if(!game.data.seen.writing){game.data.seen.writing=game.now;game.showTip(["Hey, it looks like I carved a birthday cake on the wall.","I can't remember but could it be... it's my BIRTHDAY?!"],game=>{game.gotoScene("jail-cell");game.rotation=6})}else{game.showTip("♪♪ Happy\nbirthday\nto me ♪♪",game=>{game.gotoScene("jail-cell");game.rotation=6})}},sprites:[{src:ASSETS.BIRTHDAY,},],},);game.addScene({name:"bring-cake",onScene:game=>{game.waitCursor=!0;game.sceneData.scenario=0},onSceneRefresh:game=>{if(game.sceneData.scenario===0){const frame=Math.floor((game.now-game.sceneTime)/300);if(frame>=10){game.showTip(["...","Wait... why did he just leave?","That's odd.","Maybe he went to get me a birthday cake.","Wouldn't that be funny?!?",],game=>{game.sceneData.scenario=2;game.sceneData.scenarioTime=game.now});game.sceneData.scenario=1}}else if(game.sceneData.scenario===2){const frame=Math.floor((game.now-game.sceneData.scenarioTime)/500);if(frame>=5){game.sceneData.scenario=3;game.showTip("OMG!",game=>{game.gotoScene("poor-hitman")})}}},sprites:[{src:ASSETS.JAIL,col:3,row:3,index:()=>Math.random()<.1?1:0,},{src:ASSETS.DIMMING_LIGHT,index:()=>Math.random()<.1?1:0,},{src:ASSETS.RIGHT_GUARD,col:3,row:3,index:0,},{src:ASSETS.BRING_CAKE,col:3,row:3,index:game=>{if(game.sceneData.scenario===0){const frame=Math.floor((game.now-game.sceneTime)/300);return Math.min(frame,3)}else if(game.sceneData.scenario===1){return 3}else if(game.sceneData.scenario===2){const frame=Math.floor((game.now-game.sceneData.scenarioTime)/500);return Math.min(6,frame+4)}
const frame=Math.floor((game.now-game.sceneTime)/300);return 5+frame%2},},{src:ASSETS.CAGE,col:2,row:3,index:0,},],},);game.addScene({name:"bring-it-on",onScene:game=>{game.save();game.data.stats.life=game.data.stats.maxLife;game.hideCursor=!0;game.playTheme(null)},onSceneRefresh:game=>{if(!game.sceneData.nextScene){if(!game.sceneData.lastCrowd||game.now-game.sceneData.lastCrowd>1000){game.playSound(SOUNDS.RANDOM,{volume:.15});game.sceneData.lastCrowd=game.now+Math.random()*1000+500}}},sprites:[{src:ASSETS.BRING_IT_ON,index:game=>game.pendingTip&&game.pendingTip.progress<1?Math.floor(game.now/100)%4:0,init:game=>{game.delayAction(game=>{game.playSound(SOUNDS.HUM);game.showTip(["Bring it on!",],game=>{game.playSound(SOUNDS.RANDOM,{volume:.5});game.sceneData.nextScene=game.now;game.delayAction(game=>{game.gotoScene("final-fight")},1000)})},2000)},},{src:ASSETS.BEARD_SHAVED,col:3,row:3,scale:1.4,offsetX:0,offsetY:-19,index:game=>game.pendingTip&&game.pendingTip.progress<1?Math.floor(game.now/100)%4:0,},{custom:(game,sprite,ctx)=>{const fade=Math.min(1,(game.now-game.sceneData.nextScene)/1000);const imageData=ctx.getImageData(0,0,64,64);for(let i=0;i<imageData.data.length;i+=4){if(Math.random()<fade){imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255;imageData.data[i+3]=255}}
ctx.putImageData(imageData,0,0)},hidden:game=>!game.sceneData.nextScene,},],},);game.addScene({name:"cake-face",onScene:game=>{game.hideCursor=!0},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/200);if(frame>1&&!game.sceneData.caked){game.sceneData.caked=game.now;game.playSound(SOUNDS.EAT);game.playTheme(null)}
if(frame>10){game.gotoScene("guards-laughing-2")}},sprites:[{src:ASSETS.POOR_HITMAN_BACK,},{src:ASSETS.HITMAN_CAKE_FACE,index:({now,sceneTime})=>Math.min(4,Math.floor((now-sceneTime)/200)),},],},);game.addScene({name:"call-gangsta",onScene:game=>{game.playTheme(SOUNDS.TURTLE_SONG_THEME,{volume:.5});game.delayAction(game=>{game.sceneData.waving=game.now;game.currentScene.startTalk(game,"bartender",["Hey Dick","Someone on the phone wants to talk to you!",],game=>{game.delayAction(game=>{game.currentScene.startTalk(game,"dick",["Hey Brutus, go and check what they want.","I'm busy here.",],game=>{game.currentScene.startTalk(game,"brutus",["Right away, boss."],game=>{game.delayAction(game=>{game.gotoScene("tavern-phone");game.currentScene.brutusOnPhone(game)},1000)})})},2500)})},1000)},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="human"){x=5;y=15;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=44;game.playSound(SOUNDS.YUPA)}else if(talker==="bartender"){x=4;y=40;game.playSound(SOUNDS.HELLO_HUMAN,{volume:.2})}else if(talker==="dick"){x=2;y=60;game.playSound(SOUNDS.GRUMP)}else if(talker==="brutus"){x=1;y=20;game.playSound(SOUNDS.YES_BOSS)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},sprites:[{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:game=>{if(game.sceneData.waving&&game.now-game.sceneData.waving<2000){return Math.floor(game.now/150)%2+4}
return 2},},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:3,hidden:({now,pendingTip})=>Math.floor(now/150)%2===0||!pendingTip||pendingTip.progress>=1||pendingTip.talker!=="bartender",},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:6,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,side:LEFT,index:game=>{if(game.pendingTip&&game.pendingTip.talker==="brutus"&&game.pendingTip.progress<1){return 7+Math.floor(game.now/100)%2}
return 7},},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,side:RIGHT,index:7,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:10,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:game=>{if(game.sceneData.dickTurnHead){return 12}
if(game.pendingTip&&game.pendingTip.talker==="dick"){return game.pendingTip.progress<1?Math.floor(game.now/100)%2+12:12}
return game.sceneData.gangstaLookUp?14:11},},],},);game.addScene({name:"cards-showdown",onScene:game=>{game.delayAction(game=>{game.sceneData.showLeft=game.now;game.delayAction(game=>{game.playSound(SOUNDS.HIT);game.sceneData.shakeTime=game.now},200)},100);game.delayAction(game=>{game.sceneData.showRight=game.now;game.delayAction(game=>{game.playSound(SOUNDS.HIT);game.sceneData.shakeTime=game.now},200);game.delayAction(game=>{if(game.getSituation("ernest-card-dealing").aceOfHearts){game.gotoScene("gangsta-check-cards")}else{game.getSituation("ernest-card-dealing").lostGame=game.now;game.gotoScene("ernest-card-dealing")}},3000)},1500)},sprites:[{src:ASSETS.CARDS_SHOWDOWN,col:2,row:3,index:2,},{src:ASSETS.CARDS_SHOWDOWN,col:2,row:3,index:3,offsetY:game=>{const speedFactor=20;const time=game.now-game.sceneData.showLeft;return Math.min(0,-100+(time/speedFactor)*(time/speedFactor))},hidden:game=>!game.sceneData.showLeft,},{src:ASSETS.CARDS_SHOWDOWN,col:2,row:3,index:game=>game.getSituation("ernest-card-dealing").aceOfHearts?4:5,offsetY:game=>{const speedFactor=20;const time=game.now-game.sceneData.showRight;return Math.min(0,-100+(time/speedFactor)*(time/speedFactor))},hidden:game=>!game.sceneData.showRight,},],},);game.addScene({name:"ceiling-maze",onScene:game=>{if(!game.getSituation('lab').shotTank){game.save()}},arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,s(7),s(8),s(7),RIGHT],[LEFT,s(7),s(9),s(7),RIGHT],],map:`
			XXXXXXXXXXX
			X5......HXX
			XXXXXXXXXXX
		`,onSceneHoldItem:(game,item)=>{if(game.battle){if(item==="gun"){game.battle.ball=game.now;game.battle.preventAttack=!0;game.battle.belowTheBelt=!0;game.battle.fatalKick=!0;game.playSound(SOUNDS.FEMBOT)}else{game.battle.restoreBot=game.now+1000}}},checkHole:game=>{game.pendingTip=null;game.startDialog({time:game.now,index:0,conversation:[{options:[{},{msg:game=>game.situation.roppedLadder?"Go down":"Jump down",onSelect:game=>{if(game.situation.roppedLadder){game.fadeToScene("final-corridor",{door:"L"},500)}else{game.fadeToScene("deadly-landing",{door:5},500)}}},{msg:"CANCEL",onSelect:game=>{game.dialog=null;game.pendingTip=null;game.situation.viewingHole=0}},],},],})},sprites:[...getCommonMaze("_RED_1"),{src:ASSETS.HOLE_BOTTOM,hidden:game=>!game.situation.viewingHole,onClick:game=>{game.currentScene.checkHole(game)},},{src:ASSETS.LADDER,hidden:game=>game.situation.viewingHole||!game.facingEvent()||!game.facingEvent().hole||game.rotation%2!==0||game.moving,tip:game=>game.battle?null:game.situation.roppedLadder?"This should hold.":"The ladder is broken.",combine:(item,game)=>{if(game.battle){return}
if(item==="rope"){game.situation.roppedLadder=game.now;game.showTip("This should hold",null,null,{removeLock:!0});game.removeFromInventory(item);return!0}},},{src:ASSETS.HOLE,index:game=>game.situation.roppedLadder?1:0,hidden:game=>game.situation.viewingHole||!game.facingEvent()||!game.facingEvent().hole||game.rotation%2!==0||game.moving,onClick:game=>{if(game.battle){return}
if(!game.getSituation("lab").shotTank){game.showTip("It looks deep.",game=>{game.currentScene.checkHole(game)},null,{removeLock:!0})}
game.situation.viewingHole=game.now;if(!game.getSituation("final-corridor").monsterLetOut){game.getSituation("final-corridor").monsterSide=null}
game.save()},combineMessage:(item,game)=>{return `I don't want to throw the ${item} in that hole!`},},{onRefresh:game=>{if(game.battle.restoreBot){const frame=Math.min(3,Math.floor((game.now-game.battle.restoreBot)/100));if(frame>=3){game.battle.restoreBot=0;game.battle.ball=0;game.battle.preventAttack=!1;game.battle.belowTheBelt=!1;game.battle.fatalKick=!1;game.playSound(SOUNDS.FEMBOT)}}
if(game.battle.foeDefeated){if(Math.min(16,11+Math.floor((game.now-game.battle.foeDefeated)/60))>=16){game.battle=null;game.delayAction(game=>{game.playSound(SOUNDS.GUN_SHOT,{volume:.4});game.playSound(SOUNDS.FEMBOT,{volume:.2})},500);game.showTip("Goal!!",null,null,{removeLock:!0})}}},src:ASSETS.FEMBOT,col:4,row:4,offsetX:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-.5)*Math.min(10,200/hitTime)):0},offsetY:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-1)*Math.min(10,200/hitTime)):0},index:({now,battle,data})=>{if(!battle||data.gameOver){return 0}
if(battle.foeDefeated){return Math.min(16,11+Math.floor((now-battle.foeDefeated)/60))}
if(game.battle.ball){if(game.battle.restoreBot){const frame=Math.max(0,Math.min(3,Math.floor((game.now-game.battle.restoreBot)/100)));return frame>=3?0:9+2-frame}
const frame=Math.min(2,Math.floor((game.now-game.battle.ball)/100));return 9+frame}
const hitTime=Math.max(1,now-battle.playerAttackLanded);if(hitTime<400){return 9}
if(battle.foeBlock&&now-battle.foeBlock<200){return 8}
if(now>battle.nextAttack){return 4+Math.floor((now-battle.nextAttack)/100)%4}
return Math.floor(now/200)%4},hidden:({battle,now})=>{if(!battle||battle.foe!=="fembot"){return!0}
return battle.foeDefeated&&Math.min(16,11+Math.floor((now-battle.foeDefeated)/60))>=17},onShot:(game,sprite)=>{const{battle,data}=game;game.delayAction(game=>{game.playSound(SOUNDS.DUD)},200)},combine:(item,game)=>{game.battle.nextAttack=Math.min(game.now+3000,game.battle.nextAttack);if(item==="gun"){game.showTip("I'm out of ammo.",null,50,{removeLock:!0})}else if(item==="photo"){game.showTip("Have you seen this baby?",null,50,{removeLock:!0})}else{game.showTip(`Would you like this ${item}?`,null,50,{removeLock:!0})}
return!0},},makeYupa(),{src:ASSETS.THE_HOLE,hidden:game=>!game.situation.viewingHole,onClick:game=>{if(game.situation.viewingHole){game.situation.viewingHole=0;game.dialog=null;game.pendingTip=null;game.save()}},},{hidden:game=>!game.situation.viewingHole||!game.getSituation("lab").shotTank,index:game=>{const frame=Math.floor((game.now-game.getSituation("final-corridor").monsterHole)/100);if(frame>5||frame<0){return 10}
return(game.getSituation("final-corridor").monsterSide==='left-right'?0:5)+Math.max(frame,0)},src:ASSETS.LAB_MONSTER_THROUGH_HOLE,col:3,row:4,onRefresh:game=>{if(game.getSituation("final-corridor").monsterLetOut){return}
let justSwitchedSide=!1;if(!game.getSituation("final-corridor").monsterSide){game.getSituation("final-corridor").monsterSide="left-right";game.getSituation("final-corridor").monsterHole=game.now+1000;justSwitchedSide=!0}else{const frame=Math.floor((game.now-game.getSituation("final-corridor").monsterHole)/100);if(frame>10){game.getSituation("final-corridor").monsterHole=game.now+(game.getSituation("final-corridor").monsterSide==="left-right"?4000:10000);game.getSituation("final-corridor").monsterSide=game.getSituation("final-corridor").monsterSide==="left-right"?"right-left":"left-right";justSwitchedSide=!0}}
if(game.getSituation("final-corridor").gateOpened&&!game.getSituation("final-corridor").gateClosed){if(game.getSituation("final-corridor").monsterSide==="left-right"&&justSwitchedSide){game.getSituation("final-corridor").monsterLetOut=game.now}}},},{src:ASSETS.HOLE,index:game=>2,hidden:game=>!game.situation.viewingHole||!game.facingEvent()||!game.facingEvent().hole||game.rotation%2!==0||game.moving,},{src:ASSETS.ROPE_CEILING,offsetX:game=>{if(game.sceneData.shakeRopeTime){const time=game.now-game.sceneData.shakeRopeTime;if(time>0){return 1.5*Math.sin(time/300)*(Math.max(0,6000-time)/6000)*(game.sceneData.shakeRopeDirection==="left-right"?1:-1)}}
return 0},hidden:game=>!game.situation.viewingHole||!game.situation.roppedLadder||!game.facingEvent()||!game.facingEvent().hole||game.rotation%2!==0||game.moving,onRefresh:game=>{if(game.getSituation("final-corridor").monsterHole){const time=game.now-game.getSituation("final-corridor").monsterHole;if(time>0){game.sceneData.shakeRopeDirection=game.getSituation("final-corridor").monsterSide;game.sceneData.shakeRopeTime=game.getSituation("final-corridor").monsterHole}}},},...standardBattle(),...standardMenu(),...standardBag(),],...makeOnSceneBattle(),doors:{5:{wayDown:!0,scene:"cell-maze",door:5,exit:(game,{scene,door})=>game.fadeToScene(scene,{door},1000),},},events:{'H':{blocking:!0,hole:!0,showBag:!0,foe:"fembot",foeLife:100,foeBlockChance:1,attackSpeed:4000,riposteChance:.2,attackPeriod:100,foeDamage:5,foeDefense:10,xp:0,invincible:!0,belowTheBelt:!1,blocking:!0,battleCry:SOUNDS.FEMBOT,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt,invincible,battleCry})=>{const{data,now}=game;const{yupa}=game.data;if(yupa){yupa.rotation=(game.rotation+4)%8}
if(game.situation.defeatedBot){return}
game.chest=null;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,invincible,battleCry,}}
return!0},onWin:game=>{game.situation.defeatedBot=game.now},},},},);game.addScene({name:"cell-maze-2",onScene:game=>{game.save()},arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,s(7),s(8),s(7),RIGHT],[LEFT,s(7),s(9),s(7),RIGHT],],map:`
			XXXXXXXXXXX
			X5.......XX
			XXXXXXXXXXX
		`,sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...getCommonMaze("_1"),...standardBattle(),...standardMenu(),...standardBag(),],...makeOnSceneBattle(),doors:{5:{wayDown:!0,scene:"cell-maze",door:5,exit:(game,{scene,door})=>game.fadeToScene(scene,{door},1000),},},events:{},},);game.addScene({name:"cell-maze",onScene:game=>{game.save();if(!game.situation.gateOpened){game.situation.gateOpened={}}
if(!game.situation.chestCleared){game.situation.chestCleared={}}},arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,s(7),s(8),s(7),RIGHT],[LEFT,s(7),s(9),s(7),RIGHT],],map:`
			XXXXXXXXXXX
			XXXXXXXX5XX
			XYXXMXXX.XX
			X4.._....XX
			XQXX.XXXXXX
			XXXX.XXXXXX
			X^1._..1öXX
			XXXX.XXXXXX
			XXXX.XXX8XX
			X3.._...1XX
			XCXX.XXXXXX
			XXXX.XXXXXX
			X2.._XXXXXX
			XXXXXXXXXXX
		`,onDialog:game=>{game.sceneData.zoomYupa=game.now;game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Hello Yupa!",onSelect:(game,dialog)=>{game.playSound(SOUNDS.YUPA);game.waitCursor=!0;game.showTip("Who ar yoouu?",()=>{game.waitCursor=!1},null,{x:1,y:15,speed:80,talker:"yupa"});dialog.index=1},},{msg:"LEAVE",onSelect:game=>{game.sceneData.zoomYupa=0;game.dialog=null},},],},{options:[{msg:game=>game.data.name?`It's me ~${game.data.name}`:"It's me...",onSelect:(game,dialog)=>{if(game.data.name){game.playSound(SOUNDS.HUM);game.showTip(`It's me, your friend ~${game.data.name}~!`,game=>{game.playSound(SOUNDS.YUPA);game.showTip("A still don know youu",()=>{game.waitCursor=!1},null,{x:1,y:15,speed:80,talker:"yupa"})})}else{game.dialog=null;const currentSceneName=game.sceneName;game.gotoScene("name-screen");game.sceneData.returnScene=currentSceneName}},},{msg:"You're alive!",onSelect:(game,dialog)=>{game.playSound(SOUNDS.YUPA);game.waitCursor=!0;game.showTip(["Yes, Aa waz travel round, til you soak me!",],()=>{game.waitCursor=!1},null,{x:1,y:15,speed:80,talker:"yupa"});dialog.index ++},},{msg:"LEAVE",onSelect:game=>{game.sceneData.zoomYupa=0;game.dialog=null},},],},{options:[{msg:"Travel? Where?",onSelect:(game,dialog)=>{game.playSound(SOUNDS.YUPA);game.waitCursor=!0;game.showTip(["Aye was travellin in parrlel uverse.","Life here so boring in cage. Just had to get out.","Oh that's right, yo can't do that coz you a human.",],()=>{game.waitCursor=!1},null,{x:1,y:15,speed:80,talker:"yupa"});dialog.index ++},},{msg:"Travel? How?",onSelect:(game,dialog)=>{game.playSound(SOUNDS.HUM);game.showTip("How can you travel? You were locked up?",()=>{game.playSound(SOUNDS.YUPA);game.waitCursor=!0;game.showTip(["Oh yah, yo a human. You cant do that...","Us Yupa, we can travel to parallel uverses.","Haha, only one life. Must be so boring!",],()=>{game.waitCursor=!1},null,{x:1,y:15,speed:80,talker:"yupa"})});dialog.index ++},},{msg:"LEAVE",onSelect:game=>{game.sceneData.zoomYupa=0;game.dialog=null},},],},{options:[{msg:"How long...",onSelect:(game,dialog)=>{game.playSound(SOUNDS.HUM);game.showTip("How long have you been in here?",()=>{game.playSound(SOUNDS.YUPA);game.waitCursor=!0;game.showTip("Fiew monts? Fiew years. Dunt know.",()=>{game.playSound(SOUNDS.HUM);game.showTip("A few years?!!!",()=>{game.waitCursor=!1})},null,{x:1,y:15,speed:80,talker:"yupa"})});dialog.index=1},},{msg:"LEAVE",onSelect:game=>{game.sceneData.zoomYupa=0;game.dialog=null},},],},{options:[{},{},{msg:"LEAVE",onSelect:game=>{game.sceneData.zoomYupa=0;game.dialog=null},},],},],})},onSceneHoldItem:(game,item)=>{if(item==="gun"&&game.facingEvent()&&game.facingEvent().yupa){game.showTip("I don't want to use my gun now!");game.useItem=null}},sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...getCommonMaze("_1"),makeFoe('guard',ASSETS.GUARD_2),makeFoe('monster',ASSETS.MONSTER),makeFoe('slime',ASSETS.SLIME),{src:ASSETS.SKELETON,hidden:game=>!game.facingEvent()||!game.facingEvent().skeleton||game.rotation%2!==0||game.moving,},{src:ASSETS.SKELETON_ROPE,col:1,row:2,hidden:game=>!game.facingEvent()||!game.facingEvent().skeletonRope||game.rotation%2!==0||game.moving,index:game=>game.situation.skeletonRopeFound?1:0,onClick:game=>{if(!game.situation.gateOpened[game.frontCell()]){return}
game.situation.skeletonRopeFound=game.now;game.pickUp({item:"rope",image:ASSETS.GRAB_ROPE,message:"This rope might come handy."})},},{src:ASSETS.YUPA_SHAKE,col:3,row:4,hidden:game=>game.data.yupa||!game.situation.wokeYupa||!game.facingEvent()||!game.facingEvent().yupa||game.rotation%2!==0||game.moving,index:game=>{const time=game.now-game.situation.wokeYupa;if(time<5000){return Math.floor(time/100)%4}else if(time<7000){return 4+Math.floor(time/20)%8}else{return 0}},combine:(item,game,sprite)=>{game.useItem=item;game.currentScene.onDialog(game);return!0},onClick:(game,sprite)=>{if(game.now-game.situation.wokeYupa<7000){game.showTip("He looks a bit shaken.",null,null,{removeLock:!0})}else{game.currentScene.onDialog(game)}},},{src:ASSETS.YUPA_ZOOM,col:3,row:3,hidden:game=>!game.sceneData.zoomYupa||!game.situation.wokeYupa,},{src:ASSETS.YUPA_DRY,hidden:game=>game.situation.wokeYupa||!game.facingEvent()||!game.facingEvent().yupa||game.rotation%2!==0||game.moving,tip:game=>game.situation.waterYupa?"I must water Yupa! Quick!":game.situation.gateOpened[game.frontCell()]?"Oh no! It's.. it's my friend Yupa!":"What's behind the bars? It looks like an alien corpse.",onClick:game=>{if(!game.situation.gateOpened[game.frontCell()]){return}
if(game.situation.waterYupa){game.showTip("I must water Yupa! Quick!",null,null,{removeLock:!0});return}
game.sceneData.zoomYupa=game.now;game.waitCursor=!0;if(!game.situation.seenYupa){game.situation.seenYupa=game.now;game.showTip(["Oh no!!!","This.. this was my alien friend.. Yupa!","He took me on his spaceship, and we travelled the stars together...","I recognize him. Oh Yupa, what have they done to you...","His body is all dried up. He must have been dead for a long time...","I swear Yupa. I will avenge you."],game=>{game.sceneData.zoomYupa=0;game.waitCursor=!1})}else{game.waitCursor=!0;game.showTip(["I swear Yupa. I will avenge you."],game=>{game.sceneData.zoomYupa=0;game.waitCursor=!1})}},combine:(item,game)=>{if(item==="water bottle"){game.useItem=null;game.removeFromInventory("water bottle");if(game.situation.waterYupa){game.playSound(SOUNDS.DRINK);game.addToInventory({item:"empty bottle",image:ASSETS.GRAB_BOTTLE});game.showTip("I hope this helps!",onDone=>{game.playSound(SOUNDS.YUPA);game.situation.wokeYupa=game.now})}else{game.waitCursor=!0;game.showTip(["With this water","I shall bless you in the after life,","my dear friend Yupa."],game=>{game.situation.waterYupa=game.now;game.playSound(SOUNDS.DRINK);game.addToInventory({item:"empty bottle",image:ASSETS.GRAB_BOTTLE});game.delayAction(game=>{game.showTip(["Well that's odd. He's kinda moving... It's like he is...","Wait a minute! Is he still alive?!!","I must pour more water on him. Quick!",],game=>{game.waitCursor=!1})},2000)})}
return!0}else if(item==="fruit?"){game.showTip("I don't think he can eat in his state.")}},index:game=>{if(!game.situation.waterYupa){return 0}
return Math.floor(((Math.sin(game.now/100)+1)/2)*4)},},{src:ASSETS.CAGE_OPENED,col:2,row:2,index:game=>game.situation.gateOpened[game.frontCell()]?Math.min(3,Math.floor((game.now-game.situation.gateOpened[game.frontCell()])/100)):0,hidden:game=>!game.facingEvent()||!game.facingEvent().cage||game.rotation%2!==0||game.moving,},{name:"scanner",src:ASSETS.SCAN_CARD,col:1,row:2,index:game=>game.situation.gateOpened[game.frontCell()]?1:0,combine:(item,game)=>{if(item==="access card"){game.useItem=null;game.playSound(SOUNDS.DRINK);game.situation.gateOpened[game.frontCell()]=game.now;game.dialog=null;return!0}},hidden:game=>!game.facingEvent()||!game.facingEvent().cage||game.rotation%2!==0||game.moving,},{src:ASSETS.YUPA_DRY_CLOSE,hidden:game=>!game.sceneData.zoomYupa||game.situation.wokeYupa,onClick:()=>{},},{src:ASSETS.YUPA_ZOOM,col:3,row:3,hidden:game=>!game.sceneData.zoomYupa||!game.situation.wokeYupa,index:game=>{const{pendingTip,now,sceneData}=game;if(pendingTip&&pendingTip.talker==="yupa"){return 4+Math.floor(now/50)%4}
return game.useItem?4:Math.min(3,Math.floor((now-sceneData.zoomYupa)/50))},combine:(item,game)=>{game.useItem=null;if(!game.data.name){game.showTip("I should introduce myself before giving him anything.");game.currentScene.onDialog(game)}else{switch(item){case "water bottle":game.playSound(SOUNDS.YUPA);game.showTip("Im good naow. Thanx.",null,null,{x:1,y:15,speed:80,talker:"yupa"});break;case "photo":game.sceneData.yupa_photo=game.now;game.waitCursor=!0;game.dialog=null;break;default:game.playSound(SOUNDS.YUPA);game.showTip("I dunt need dat.",null,null,{x:1,y:15,speed:80,talker:"yupa"});break}}
return!0},onClick:()=>{},},{src:ASSETS.YUPA_GRAB_PHOTO,col:2,row:3,hidden:game=>!game.sceneData.yupa_photo,index:game=>{const frame=Math.floor((game.now-game.sceneData.yupa_photo)/80);if(frame<30){return Math.min(frame,3)}else if(frame<60){return frame%2+4}else if(frame<85){return 3}else{return Math.max(0,3+85-frame)}},onRefresh:game=>{const frame=Math.floor((game.now-game.sceneData.yupa_photo)/80);if(frame>30&&!game.sceneData.yupalaugh){game.sceneData.yupalaugh=game.now;game.playSound(SOUNDS.YUPA_HAHA)}
if(frame>100){game.useItem=null;game.sceneData.yupa_photo=0;game.currentScene.onDialog(game);game.playSound(SOUNDS.YUPA);game.showTip(["Hey yeeh! I rememba you now!","You da time travlar from da future!","You diden know wat to do, so I save yo ass by taking you on my saucer.","And we kidnap baby hitler. Hahaha! So funney!",],game=>{game.playSound(SOUNDS.HUM);game.showTip(["So you rememba me! That's great!","Do you know what happened to the baby?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip([`I dun remembah which planet we left him on.`,],game=>{game.playSound(SOUNDS.HUM);game.showTip(["I need to look for him.","Will you come with me? Let's escape from this prison together","and look for Baby Hitler.",],game=>{game.playSound(SOUNDS.YUPA);game.showTip([`Sure my man ~${game.data.name||"Hitman"}~!`,`I be rite behind ya.`,],game=>{game.dialog=null;game.waitCursor=!1;game.sceneData.zoomYupa=0;game.data.yupa={rotation:game.rotation,joined:game.now,position:-12,};game.showTip("Yupa has joined me! Now I don't feel lonely anymore.",null,null,{removeLock:!0})},null,{x:1,y:15,speed:80,talker:"yupa"})})},null,{x:1,y:15,speed:80,talker:"yupa"})})},null,{x:1,y:15,speed:80,talker:"yupa"})}},},makeYupa(),...standardBattle(),...standardMenu(),...standardBag(),],...makeOnSceneBattle(),doors:{1:{},2:{scene:"maze-4",door:2,exit:(game,{scene,door})=>game.fadeToScene(scene,{door},1000),},3:{lock:!0,},4:{lock:!0,},5:{lock:!0,wayUp:!0,scene:"ceiling-maze",door:5,exit:(game,{scene,door})=>game.fadeToScene(scene,{door},1000),},},events:{'^':{chest:!0,blocking:!0,blockMap:!0,onEvent:(game,event)=>{const{data,now}=game;game.findChest(now,{item:"fruit?",image:ASSETS.GRAB_APPLE,cleared:game.situation.chestCleared[game.frontCell()],})},},'C':{blocking:!0,cage:!0,showBag:!0,blockMap:!0,skeletonRope:!0,onEvent:(game,event)=>{},},'Y':{blocking:!0,cage:!0,showBag:!0,blockMap:!0,yupa:!0,onEvent:(game,event)=>{},},'Q':{skeleton:!0,blocking:!0,cage:!0,showBag:!0,blockMap:!0,onEvent:(game,event)=>{},},'8':{foe:"guard",foeLife:150,foeBlockChance:.7,attackSpeed:5000,riposteChance:.6,attackPeriod:100,foeDamage:9,foeDefense:10,xp:10,belowTheBelt:!1,blocking:!0,chest:!0,blockMap:!0,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt})=>{const{data,now}=game;game.chest=null;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,}}
return!0},onWin:game=>game.findChest(game.now+2000,{item:"water bottle",image:ASSETS.GRAB_WATER_BOTTLE,}),},'ö':{foe:"monster",foeLife:150,foeBlockChance:.8,attackSpeed:1500,riposteChance:.6,attackPeriod:100,foeDamage:7,foeDefense:12,xp:12,belowTheBelt:!1,blocking:!0,blockMap:!0,chest:!0,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt})=>{const{data,now}=game;game.chest=null;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,}}
return!0},onWin:game=>game.findChest(game.now+2000,{item:"fruit?",image:ASSETS.GRAB_APPLE,}),},},},);let val=0;const magicnum=13;game.addScene({name:"concert",onScene:game=>{game.playTheme(SOUNDS.MUSETTE,{volume:.8});game.hideCursor=!0;game.delayAction(game=>{game.hideCursor=!1},15000)},onSceneRefresh:game=>{game.fade=Math.min(1,1-(game.now-game.sceneTime)/10000)},sprites:[{src:ASSETS.TAMMY_SLOW,index:({now})=>Math.floor(now/800)%4,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>2+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>4+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>6+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>2+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>4+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER,size:[32,32],col:3,row:3,index:({now},{shift})=>6+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>2+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>4+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>6+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>2+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>4+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_2,size:[32,32],col:3,row:3,index:({now},{shift})=>6+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_3,size:[32,32],col:3,row:3,index:({now},{shift})=>Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_3,size:[32,32],col:3,row:3,index:({now},{shift})=>2+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_3,size:[32,32],col:3,row:3,index:({now},{shift})=>4+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_3,size:[32,32],col:3,row:3,index:({now},{shift})=>6+Math.floor((now+shift)/400)%2,offsetX:Math.round(-20+(magicnum*val++)%100),offsetY:({now},{shift})=>32+Math.floor((now+shift)/200)%2,},{shift:Math.random()*10000,src:ASSETS.DANCER_4,size:[32,32],col:3,row:3,index:({now},{shift})=>Math.floor((now+shift)/400)%2,offsetX:-10,offsetY:({now},{shift})=>32+2*Math.floor((now+shift)/200)%2,scale:2,},{shift:Math.random()*10000,src:ASSETS.DANCER_4,size:[32,32],col:3,row:3,index:({now},{shift})=>2+Math.floor((now+shift)/400)%2,offsetX:5,offsetY:({now},{shift})=>32+2*Math.floor((now+shift)/200)%2,scale:2,},{shift:Math.random()*10000,src:ASSETS.DANCER_4,size:[32,32],col:3,row:3,index:({now},{shift})=>4+Math.floor((now+shift)/400)%2,offsetX:10,offsetY:({now},{shift})=>32+2*Math.floor((now+shift)/200)%2,scale:2,},{shift:Math.random()*10000,src:ASSETS.DANCER_4,size:[32,32],col:3,row:3,index:({now},{shift})=>6+Math.floor((now+shift)/400)%2,offsetX:25,offsetY:({now},{shift})=>32+2*Math.floor((now+shift)/200)%2,scale:2,},{src:ASSETS.NEXT_SCENE,hidden:game=>game.hideCursor||game.waitCursor,onClick:game=>game.fadeToScene("the-date",null,5000),},{custom:(game,sprite,ctx)=>{game.displayTextLine(ctx,{msg:"skip",x:50,y:47,})},hidden:game=>!game.hoverSprite||game.hoverSprite.src!==ASSETS.NEXT_SCENE,},],},);game.addScene({name:"congrats",onScene:game=>{game.fade=0;game.hideCursor=!0;game.showTip(["Congratulation, you win!","This game was produced for #LOWREZJAM\n2019.","By Jack Le\nHamster (that's\nme applauding and looking very impressed).","I didn't actually finished making this game, which is supposed to be a sequel to a previous game I made.","But please come back again and follow this game's progress.","Hopefully, when I'm done, you can play the game as it was meant to be...",],game=>{const fadeDuration=3000;game.fadeOut(game.now,{duration:fadeDuration*1.5,fadeDuration,color:"#000000",onDone:game=>{game.gotoScene("final-title")}})})},sprites:[{src:"assets/congrats.png|darken",col:3,row:3,index:({now})=>Math.floor(now/100)%9,},],},);game.addScene({name:"creator",onScene:game=>{game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.5});game.sceneData.frames=[{frames:[0],duration:2000,time:1},{frames:[1],duration:2000},{frames:[2],duration:1000},{frames:[3],duration:1000},{frames:[4,5],duration:1000,period:200},{frames:[6,7,8,9,10],duration:1000,period:50},{frames:[11],duration:100},{frames:[12],duration:100},{frames:[13,14,15,16,],duration:1500,period:50},{frames:[17],duration:2000},{frames:[18],duration:500},{frames:[19],duration:500},{frames:[20],duration:1000},{frames:[21],duration:1000},{frames:[22],duration:500},{frames:[23],duration:1500},{frames:[24],duration:1000},{frames:[25],duration:1000},{frames:[26]},];for(let i=1;i<game.sceneData.frames.length;i++){game.sceneData.frames[i].duration*=3}
for(let i=1;i<game.sceneData.frames.length;i++){game.sceneData.frames[i].time=game.sceneData.frames[i-1].time+game.sceneData.frames[i-1].duration}
game.sceneData.frames.forEach(({frames,time,period})=>{game.delayAction(game=>{game.sceneData.currentFrames=frames;game.sceneData.period=period},time)});game.sceneData.credits=`${game.title||" Where in Space\n          is\n BABY HITLER?"}



				A game from
				DOBUKI STUDIO
				by
				Jack Le Hamster

				Coded in JavaScript
				with Sublime Text

				Art made with Piskel

				Music made with BeepBox

				Sound effects made with VoiceChanger.io and Brfx

				Music covers:
				“La Soupe aux Choux”
				(Raymond Lefevre)

				This game is a sequel to “Kill Baby Hitler”. The first part of this game was released for
				#LOWREZJAM\n2019\nas “Escape from Labbyrithe”.

				You have found the CREATOR, who restored your left hand and gave you answers to all your questions.

				You felt fulfilled, yet a bit melancholic. As you realized that the world no longer holds any mystery.

				You have finished the game, with
				CREATOR ENDING.

				What happened next?

				Who knows... From that point on, anything was possible.

				You'll just have to imagine it.

				Have a nice day!
			`.split("\n").map((a,index)=>index>2?game.wordwrap(a.trim(),7):a).join("\n").split("\n")},onSceneRefresh:game=>{const shift=-(game.now-game.sceneData.creditStart)/200+50;if(game.sceneData.credits.length*6+shift<10){if(!game.sceneData.showGameOver){game.sceneData.showGameOver=game.now;game.gameOver(" ",!0)}}},sprites:[{custom:(game,sprite,ctx)=>{ctx.clearRect(0,0,64,64)},hidden:game=>!game.sceneData.creditStart,},{hidden:game=>!game.sceneData.creditStart,custom:(game,sprite,ctx)=>{const shift=-(game.now-game.sceneData.creditStart-2000)/200+50;game.sceneData.credits.forEach((line,index)=>{const y=index*6+shift;if(y>0&&y<55){game.displayTextLine(ctx,{msg:line,x:5,y:Math.round(y),alpha:Math.max(0.05,Math.min(.8,y/5,(55-y)/5)),})}})},},{src:ASSETS.CREATOR,col:5,row:6,index:game=>{if(game.sceneData.currentFrames){const time=game.now/(game.sceneData.period||1);const frameIndex=Math.floor(time)%game.sceneData.currentFrames.length;return game.sceneData.currentFrames[frameIndex]}
return 0},onRefresh:(game,sprite)=>{if(game.evaluate(sprite.index)===26&&!game.sceneData.creditStart){game.playTheme(SOUNDS.SOFT_THEME,{volume:.8});game.sceneData.creditStart=game.now;getMedal("CREATOR ENDING")}},},],},);game.addScene({name:"crowd",onScene:game=>{game.hideCursor=!0;game.playTheme(null)},onSceneRefresh:game=>{if(!game.sceneData.lastCrowd||game.now-game.sceneData.lastCrowd>1000){game.playSound(SOUNDS.RANDOM,{volume:.15});game.sceneData.lastCrowd=game.now+Math.random()*1000+500}},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#352727";ctx.fillRect(0,0,64,64)},},...new Array(10).fill(null).map((dummy,idx)=>{const offsetY=Math.max(10,(idx/10)*50);const startTime=Math.random()*2000;return{src:ASSETS[`RUNNER${idx % 6}`],scale:offsetY/64,index:(game,sprite)=>Math.floor((game.now-game.evaluate(sprite.startRun))/50)%4,offsetX:(game,sprite)=>{return(sprite.scale*(game.now-game.evaluate(sprite.startRun))/10)%100-30},offsetY:offsetY*.6-10,startRun:game=>game.sceneTime-startTime,flipH:Math.random()<.5,}}),{src:ASSETS.CRAWLING_BOY,col:3,row:3,index:game=>game.sceneData.putHand?game.sceneData.boyIndex:Math.round((Math.sin(game.now/150)+1)/2*4),init:game=>{game.sceneData.boyX=150},onRefresh:(game,sprite)=>{const index=game.evaluate(sprite.index);if(!game.sceneData.putHand){if(index>0&&index<4){game.sceneData.boyX=Math.max(0,game.sceneData.boyX-.8)}
if((index===0||index===4)&&game.sceneData.boyX===0){game.sceneData.boyIndex=index;game.sceneData.putHand=game.now;game.delayAction(game=>{game.playSound(SOUNDS.HUM);game.showTip("You stay here!",game=>{game.gotoScene("we-take-care-of-you")},null,{x:10,y:12})},500)}}},offsetX:game=>{return Math.round(game.sceneData.boyX)},offsetY:game=>{if(game.sceneData.putHand){const handTime=80;if(game.now-game.sceneData.putHand<handTime){return Math.max(0,-27+30*(game.now-game.sceneData.putHand)/handTime)}
return Math.max(0,3-(game.now-game.sceneData.putHand-handTime)/10)}
return 0},},{src:ASSETS.CRAWLING_BOY,col:3,row:3,index:6,offsetY:game=>{const handTime=80;if(game.now-game.sceneData.putHand<handTime){return-27+30*(game.now-game.sceneData.putHand)/handTime}
return Math.max(0,3-(game.now-game.sceneData.putHand-handTime)/10)},hidden:game=>!game.sceneData.putHand,},{src:ASSETS.CRAWLING_BOY,col:3,row:3,index:5,hidden:game=>!game.sceneData.putHand||game.now-game.sceneData.putHand<1000,},],},);game.addScene({name:"deadly-landing",map:`
			XXXXXXXXX
			X5.C....X
			XXXXXXXXX
		`,onScene:game=>{game.hideCursor=!0;game.playTheme(null);game.playSound(SOUNDS.DIVING)},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/50);if(!game.sceneData.landed&&frame-10>2){game.sceneData.landed=game.now;game.sceneData.shakeTime=game.now;game.playSound(SOUNDS.HIT_LAND)}
if(!game.data.yupa||game.data.yupa.inBottle){if(!game.sceneData.showGameOver&&frame>150){game.hideCursor=!1;getMedal("Deep dive");game.gameOver(" “~You're no\n          Superman!”~")}}else{if(!game.sceneData.yupaTalked&&frame>150){game.sceneData.yupaTalked=game.now;game.playSound(SOUNDS.YUPA);game.showTip("Whadda stupid...",game=>{game.hideCursor=!1;getMedal("Deep dive");game.gameOver()},null,{talker:"yupa"})}}},sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...getCommonMaze("_1"),{src:ASSETS.CEILING_HOLE,col:3,row:4,hidden:game=>!game.facingEvent()||!game.facingEvent().ceilinghole||game.rotation%2!==0||game.moving,index:game=>{const frame=Math.floor((game.now-game.sceneTime)/50);if(frame<10){return 0}
if(frame<100||!game.data.yupa||game.data.yupa.inBottle){return 2+Math.min(2,frame-10)}
if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="yupa"){return 7+Math.floor(game.now/100)%2}
return 5+Math.min(1,frame-100)},},...standardMenu(),...standardBag(),],doors:{},events:{'C':{ceilinghole:!0,onEvent:(game,event)=>{},},},},);game.addScene({name:"disk-screen",onScene:game=>{game.sceneData.shift=0;game.sceneData.maxSlot=0;game.sceneData.currentSaves={};game.sceneData.undoes={};game.currentScene.refreshImages(game);game.startDialog({time:game.now,index:0,highlightColor:"#00998899",conversation:[{options:[{},{},{msg:"Back",onSelect:(game,dialog)=>game.gotoScene(game.sceneData.returnScene,null,!0),},],}],})},sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index},ctx)=>{if(sceneData.loadSave){const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const spriteIndex=index+sceneData.shift;const{img}=sceneData.loadSave[spriteIndex];const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;ctx.drawImage(img,px+2+offsetX,py+2)}},hidden:({sceneData},{index})=>{const spriteIndex=index+sceneData.shift;return!sceneData.loadSave||!sceneData.loadSave[spriteIndex]},}})),...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index},ctx)=>{if(sceneData.loadSave){const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const spriteIndex=index+sceneData.shift;const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;game.displayTextLine(ctx,{msg:`#${spriteIndex+1}`,x:px+offsetX+1,y:py+2,alpha:.8,dark:!0,});game.displayTextLine(ctx,{msg:`#${spriteIndex+1}`,x:px+offsetX+1,y:py+1,})}},}})),...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index,hoverTime},ctx)=>{if(sceneData.loadSave){const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;const left=2+px+offsetX;const top=py;const width=28,height=28;const x=left+width/2-6;const y=top+height/2-6;ctx.fillStyle=hoverTime?"#8888cc":"#00008899";ctx.fillRect(x-1,y-1,15,7);game.displayTextLine(ctx,{msg:"load",x,y,})}},onClick:(game,{index})=>{const{sceneData}=game;const spriteIndex=index+game.sceneData.shift;game.load(spriteIndex)},hidden:({sceneData},{index})=>{const spriteIndex=index+sceneData.shift;return!sceneData.loadSave||!sceneData.loadSave[spriteIndex]||sceneData.currentSaves[spriteIndex]}}})),...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index,hoverTime},ctx)=>{if(sceneData.loadSave){const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;const left=2+px+offsetX;const top=py;const width=28,height=28;const x=left+width/2-10;const y=top+height/2+9;ctx.fillStyle=hoverTime?"#cc8888":"#88000099";ctx.fillRect(x-1,y-1,22,7);game.displayTextLine(ctx,{msg:"delete",x,y,})}},onClick:(game,{index})=>{const spriteIndex=index+game.sceneData.shift;if(!game.sceneData.currentSaves[spriteIndex]){game.sceneData.undoes[spriteIndex]=game.getLoadData(spriteIndex)}else{delete game.sceneData.currentSaves[spriteIndex]}
game.deleteSave(spriteIndex);game.currentScene.refreshImages(game);game.playSound(SOUNDS.HIT_LAND)},hidden:({sceneData},{index})=>{const spriteIndex=index+sceneData.shift;if(sceneData.currentSaves&&sceneData.currentSaves[spriteIndex]){return!0}
return!sceneData.loadSave||!sceneData.loadSave[spriteIndex]}}})),...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index,hoverTime},ctx)=>{const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;const left=2+px+offsetX;const top=py;const width=28,height=28;const x=left+width/2-5;const y=top+height/2-3;ctx.beginPath();ctx.lineWidth="3px"
ctx.strokeStyle="#334444";ctx.rect(2+left,2+top,24,24);ctx.stroke()},hidden:({sceneData},{index})=>{const spriteIndex=index+sceneData.shift;return!sceneData.loadSave||sceneData.loadSave[spriteIndex]}}})),...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index,hoverTime},ctx)=>{const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;const left=2+px+offsetX;const top=py;const width=28,height=28;const x=left+0.5;const y=top+2.5;ctx.beginPath();ctx.lineWidth=3;ctx.strokeStyle="black";ctx.rect(x,y,27,27);ctx.stroke();ctx.beginPath();ctx.fillStyle="black";ctx.fillRect(x-.5,y-.5,28,8);ctx.lineWidth=1;ctx.strokeStyle="#33aa00";ctx.rect(x,y,27,27);ctx.stroke();game.displayTextLine(ctx,{msg:"saved",x:x+4.5,y:y+1.5,})},hidden:({sceneData},{index})=>{const spriteIndex=index+sceneData.shift;return!sceneData.currentSaves||!sceneData.currentSaves[spriteIndex]}}})),...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index,hoverTime},ctx)=>{const spriteIndex=index+sceneData.shift;const hasUndo=sceneData.undoes[spriteIndex];const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;const left=2+px+offsetX;const top=py;const width=28,height=28;const x=left+width/2-7;const y=top+height/2-(hasUndo?8:3);ctx.fillStyle=hoverTime?"#88cc88":"#008800bb";ctx.fillRect(x-1,y-1,16,7);game.displayTextLine(ctx,{msg:"save",x,y,})},onClick:(game,{index})=>{const spriteIndex=index+game.sceneData.shift;delete game.sceneData.undoes[spriteIndex];const savedData=game.sceneData.savedData;const screenshot=game.sceneData.screenshot;game.saveData(spriteIndex,screenshot,savedData);game.sceneData.currentSaves[spriteIndex]=!0;game.currentScene.refreshImages(game);game.playSound(SOUNDS.JINGLE)},hidden:({sceneData},{index})=>{const spriteIndex=index+sceneData.shift;return!sceneData.loadSave||sceneData.loadSave[spriteIndex]}}})),...(new Array(8).fill(null).map((a,idx)=>{const index=idx-2;return{index,isSaveFile:!0,custom:({sceneData},{index,hoverTime},ctx)=>{if(sceneData.loadSave){const sideLeft=sceneData.sideLeft||0;const sideRight=sceneData.sideRight||0;const delay=100;const time=Math.min(delay,game.now-Math.max(sideLeft,sideRight));const offsetX=time>=delay?0:sideLeft>sideRight?-30*(delay-time)/delay:sideLeft<sideRight?30*(delay-time)/delay:0;const px=Math.floor(index/2)*32,py=(index%2+2)%2*32;const left=2+px+offsetX;const top=py;const width=28,height=28;const x=left+width/2-7;const y=top+height/2+4;ctx.fillStyle=hoverTime?"#cc88bb":"#880066bb";ctx.fillRect(x-1,y-1,17,7);game.displayTextLine(ctx,{msg:"undo",x,y,})}},onClick:(game,{index})=>{const spriteIndex=index+game.sceneData.shift;const undo=game.sceneData.undoes[spriteIndex];game.saveData(spriteIndex,null,undo);delete game.sceneData.undoes[spriteIndex];game.currentScene.refreshImages(game)},hidden:({sceneData},{index})=>{const spriteIndex=index+sceneData.shift;return!sceneData.undoes||!sceneData.undoes[spriteIndex]}}})),{src:ASSETS.SIDE_BUTTONS,side:LEFT,index:({hoverSprite,dialog},sprite)=>hoverSprite===sprite&&!dialog.hovered?1:0,onClick:game=>{game.sceneData.shift-=2;game.sceneData.sideLeft=game.now},hidden:game=>game.sceneData.shift<=0||game.dialog&&game.dialog.hovered,},{src:ASSETS.SIDE_BUTTONS,side:RIGHT,index:({hoverSprite,dialog},sprite)=>hoverSprite===sprite&&!dialog.hovered?1:0,onClick:game=>{game.sceneData.shift+=2;game.sceneData.sideRight=game.now},hidden:game=>game.sceneData.maxSlot+1-game.sceneData.shift<=3||game.dialog&&game.dialog.hovered,},],refreshImages:game=>{const list=game.getSaveList();game.sceneData.loadSave={};for(let name in list){if(name!=="last"){const{image}=list[name];const img=new Image();img.src=image;game.sceneData.loadSave[name]={img,name,}}}
game.sceneData.maxSlot=0;for(let i in game.sceneData.loadSave){const{name}=game.sceneData.loadSave[i];if(!isNaN(parseInt(name))){game.sceneData.maxSlot=Math.max(parseInt(name),game.sceneData.maxSlot)}}},},);game.addScene({name:"doctar-room",onScene:game=>{game.save();game.playTheme(SOUNDS.JAIL_CELL_THEME);game.sceneData.reached={};if(!game.sceneData.to){game.sceneData.from=null;game.sceneData.to="seat";game.sceneData.toReach=null}
game.sceneData.switchTime=game.now;game.sceneData.fadeSpeed=2000;if(!game.data.seen.doctor){if(!game.getSituation("doctar-room").thoughtIndex){game.getSituation("doctar-room").thoughtIndex=0}else{game.getSituation("doctar-room").thoughtIndex --}
game.sceneData.thoughts=["... so here we are ...","... and to think killing Baby Hitler ...","... was the most difficult part ...","... I thought this was all behind ...","... avoiding the holocaust, spare the baby's life ...","... it all seemed too easy ...","... how foolish of me ...","... as a hitman, I never feared death ...","... I was willing to give my life for the cause ...","... and yet ...","... the thought of being erased from existence ...","... it's something different ...","... nobody will never know I ever existed ...","... it is worst than being dead ...","... being ... NOTHING ...","... no more fond memories of traveling in space with Yupa ...","... it's like those never happened ...","... my life has no meaning ...","... the world has no meaning to me ...","... and I mean nothing to the world ...","... ... ...","... goodby cruel world ...","... it was nice never knowing you ...","... I should feel sad, but yet, I feel nothing ...","... ... ...","... so how long are you going to keep listening to by bullshit? ...","... just keep playing the game already ...",].concat(new Array(100).fill("... watch me, I'm going to say the same thing over and over and bore you to death ...")).concat(["... oh my god! you're still here ...","... I ... I have nothing to say ...","... this is ... unbelievable ...","... am I stuck in some kind of loop? ...","... let's start over from the beginning ...",]);game.sceneData.thoughts=game.sceneData.thoughts.concat(game.sceneData.thoughts).concat(["... actually no, I can't ...","... I cannot believe it ...","... you broke the game ...",]).concat(Game.toString().split("{").join("♪").split("}").join("♪").split("=").join("♪").split("\n").join(" ").split(" ").map(a=>a.trim()).filter(a=>a.length).join("\n")).concat(game.sceneData.thoughts);game.delayAction(()=>{game.currentScene.keepThinking(game)},3000)}},keepThinking:game=>{const msg=game.sceneData.thoughts[game.getSituation("doctar-room").thoughtIndex];game.showTip(msg,game=>{game.currentScene.keepThinking(game)},msg.length>100?50:150,{removeLock:!0,y:64,maxLines:msg.length>100?10:2});game.getSituation("doctar-room").thoughtIndex=(game.getSituation("doctar-room").thoughtIndex+1)%game.sceneData.thoughts.length},arrowGrid:[[null,null,MENU,null,null],[],[],[],[null,null,BAG,null,null],],sprites:[{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:1,onClick:game=>{if(game.sceneData.to!=="seat"){game.sceneData.from=game.sceneData.to;game.sceneData.to="seat";game.sceneData.switchTime=game.now}
game.sceneData.toReach="seat"},},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:3,onClick:game=>{if(game.sceneData.to!=="mirror"){game.sceneData.from=game.sceneData.to;game.sceneData.to="mirror";game.sceneData.switchTime=game.now}
game.sceneData.toReach="mirror"},},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:22,hidden:game=>!game.data.seen.doctor,onClick:game=>{game.sceneData.to="door";game.sceneData.from=null;game.sceneData.switchTime=game.now-game.sceneData.fadeSpeed;game.sceneData.toReach=null;game.fadeToScene("sarlie-planet-world",null,null,game=>{game.sceneData.fromDoctor=!0})},},{src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:2,onClick:game=>{if(game.sceneData.to!=="door"){game.sceneData.from=game.sceneData.to;game.sceneData.to="door";game.sceneData.switchTime=game.now}
game.sceneData.toReach="door"},hidden:game=>game.data.seen.doctor,},{id:"mirror",src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:7,alpha:({sceneData,now},{id})=>{if(sceneData.to===id){return Math.min(1,(now-sceneData.switchTime)/sceneData.fadeSpeed)}else if(sceneData.from===id){return 1-Math.min(1,(now-sceneData.switchTime)/sceneData.fadeSpeed)}},hidden:({sceneData,now},{id})=>(sceneData.to!==id||now<=sceneData.switchTime)&&(sceneData.from!==id||(now-sceneData.switchTime)/sceneData.fadeSpeed>=1),onRefresh:(game,sprite)=>{if(game.sceneData.toReach===sprite.id&&!game.sceneData.reached[sprite.id]&&game.now-game.sceneData.switchTime>=game.sceneData.fadeSpeed){game.sceneData.reached[sprite.id]=game.now;sprite.onReach(game,sprite)}},onReach:(game,sprite)=>{game.gotoScene("mirror")},},{id:"mirror",src:ASSETS.BEARD_SHAVED,scale:.25,offsetX:38,offsetY:17,flipH:!0,alpha:({sceneData,now},{id})=>{if(game.sceneData.to===id){return.5*Math.min(1,(game.now-game.sceneData.switchTime)/sceneData.fadeSpeed)}else if(game.sceneData.from===id){return.5*(1-Math.min(1,(game.now-game.sceneData.switchTime)/sceneData.fadeSpeed))}},hidden:({sceneData,now},{id})=>(sceneData.to!==id||now<=sceneData.switchTime)&&(sceneData.from!==id||(now-sceneData.switchTime)/sceneData.fadeSpeed>=1),},{id:"door",src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:8,alpha:({sceneData,now},{id})=>{if(sceneData.to===id){return Math.min(1,(now-sceneData.switchTime)/sceneData.fadeSpeed)}else if(sceneData.from===id){return 1-Math.min(1,(now-sceneData.switchTime)/sceneData.fadeSpeed)}},hidden:({sceneData,now},{id})=>(sceneData.to!==id||now<=sceneData.switchTime)&&(sceneData.from!==id||(now-sceneData.switchTime)/sceneData.fadeSpeed>=1),onRefresh:(game,sprite)=>{if(game.sceneData.toReach===sprite.id&&!game.sceneData.reached[sprite.id]&&game.now-game.sceneData.switchTime>=game.sceneData.fadeSpeed){game.sceneData.reached[sprite.id]=game.now;sprite.onReach(game,sprite)}},onReach:(game,sprite)=>{game.gotoScene("yupa-sarlie")},},{id:"seat",src:ASSETS.DOCTAR_ROOM,col:5,row:5,index:9,alpha:({sceneData,now},{id})=>{if(game.sceneData.to===id){return Math.min(1,(game.now-game.sceneData.switchTime)/sceneData.fadeSpeed)}else if(game.sceneData.from===id){return 1-Math.min(1,(game.now-game.sceneData.switchTime)/sceneData.fadeSpeed)}},hidden:({sceneData,now},{id})=>(sceneData.to!==id||now<=sceneData.switchTime)&&(sceneData.from!==id||(now-sceneData.switchTime)/sceneData.fadeSpeed>=1),onRefresh:(game,sprite)=>{if(game.sceneData.toReach===sprite.id&&!game.sceneData.reached[sprite.id]&&game.now-game.sceneData.switchTime>=game.sceneData.fadeSpeed){game.sceneData.reached[sprite.id]=game.now;sprite.onReach(game,sprite)}},onReach:(game,sprite)=>{},},{id:"seat",src:ASSETS.BEARD_SHAVED,size:[32,64],scale:.3,offsetX:15,offsetY:35,alpha:({sceneData,now},{id})=>{if(game.sceneData.to===id){return Math.min(1,(game.now-game.sceneData.switchTime)/sceneData.fadeSpeed)}else if(game.sceneData.from===id){return 1-Math.min(1,(game.now-game.sceneData.switchTime)/sceneData.fadeSpeed)}},hidden:({sceneData,now},{id})=>(sceneData.to!==id||now<=sceneData.switchTime)&&(sceneData.from!==id||(now-sceneData.switchTime)/sceneData.fadeSpeed>=1),},...standardMenu(),...standardBag(),],},);game.addScene({name:"doctar",onScene:game=>{game.waitCursor=!0;game.playTheme(SOUNDS.JAIL_CELL_THEME)},sprites:[{src:ASSETS.DOCTAR,col:4,row:5,hidden:({sceneData,pendingTip})=>pendingTip&&pendingTip.talker==="human4",index:({sceneData,pendingTip,dialog,now})=>{if(pendingTip){if(pendingTip.talker==="human"){return(pendingTip.progress>=1?0:Math.floor(now/100)%2)*2+7}
if(pendingTip.talker==="human2"){return Math.floor(pendingTip.progress>=1?0:now/100)%2+11}
if(pendingTip.talker==="human3"){return Math.floor(pendingTip.progress>=1?0:now/100)%2+18}
if(pendingTip.talker==="doctar"){return(pendingTip.progress>=1?0:Math.floor(now/100)%2)+7}
if(pendingTip.talker==="doctar2"){return(pendingTip.progress>=1?0:Math.floor(now/100)%2)*2+15}
if(pendingTip.talker==="doctarzoom"){return(pendingTip.progress>=1?0:Math.floor(now/100)%4)+2}
if(pendingTip.talker==="yupa2"){if(game.now<pendingTip.time+500){return(pendingTip.progress>=1?0:Math.floor(now/100)%2)+13}
return(pendingTip.progress>=1?0:Math.floor(now/100)%2)+15}
if(pendingTip.talker==="yupa"){return(pendingTip.progress>=1?0:Math.floor(now/100)%2)+15}}
if(dialog){const f=Math.floor(now/100)%20;return Math.min(1,f)+6}
return sceneData.frame},startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"||talker==="human2"||talker==="human3"||talker==="human4"){x=5;y=60;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"||talker==="yupa2"){x=2;y=62;game.playSound(SOUNDS.YUPA)}else if(talker==="doctar"||talker==="doctar2"){x=5;y=23;game.playSound(SOUNDS.HUHUH)}else if(talker==="doctarzoom"){x=5;y=18;game.playSound(SOUNDS.HUHUH)}else if(talker==="offscreen"){game.playSound(SOUNDS.HUHUH)}else if(talker==="offscreenyupa"){game.playSound(SOUNDS.YUPA)}
game.showTip(msg,onDone,80,{x,y,talker,removeLock})},init:(game,sprite)=>{const{sceneData}=game;sceneData.scriptTime=game.now;sceneData.script=[({now,sceneTime,sceneData})=>{const f=Math.floor((now-sceneTime)/100)%20;sceneData.frame=Math.min(2,f);return now-sceneData.scriptTime>=3000},({now,sceneTime,sceneData})=>{const f=Math.floor((now-sceneTime)/100)%20;sceneData.frame=Math.min(1,f)+6;return now-sceneData.scriptTime>=3000},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"doctar","Well, I can tell you one thing.");return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{game.waitCursor=!1;game.startDialog({time:now,index:0,conversation:[{options:[{},{msg:game=>"Tell me",onSelect:(game,dialog)=>{game.waitCursor=!0;game.dialog=null;sprite.startTalk(game,"human","Tell me doctor.")},},{msg:game=>"Don't tell me",onSelect:(game,dialog)=>{game.waitCursor=!0;game.dialog=null;sprite.startTalk(game,"human","Don't tell me...")},},],},],});return!0},({pendingTip,dialog})=>{return!pendingTip&&!dialog},({now,sceneTime,sceneData})=>{const f=Math.floor((now-sceneTime)/100)%20;sceneData.frame=Math.min(1,f)+6;return now-sceneData.scriptTime>=1000},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"doctarzoom","You never had a left hand.");return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"human2","What? I said already!",game=>{game.waitCursor=!1;game.startDialog({time:now,index:0,conversation:[{options:[{},{msg:game=>"Not true!",onSelect:(game,dialog)=>{game.waitCursor=!0;game.dialog=null;sprite.startTalk(game,"human2","I never lacked a limb my whole life!")},},{msg:game=>"It's true!",onSelect:(game,dialog)=>{game.waitCursor=!0;game.dialog=null;sprite.startTalk(game,"human2",["You're right! I never had a left hand.","I just never noticed until you brought it up!"])},},],},],})});return!0},({pendingTip,dialog})=>{return!pendingTip&&!dialog},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"yupa2",["Since I met him","I nevar saw hiz left hand."]);return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"doctar2","Where did you find this human?");return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"yupa",["Youll nevar guess!","He was travlin bak in tam.","Tryin to kill a baby! Haha!"]);return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"doctar2","Well did he do it?");return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"yupa","What ya mean?");return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"doctarzoom","Did he kill the baby?");return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"human3",["Hey I'm here, you two!","No, I did not kill Baby Hitler.","I failed my mission.","Instead, we kidnapped him.",]);return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"yupa",["Dat's true!","We took da baby with us! Haha!","But we lost him."]);return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"doctarzoom",["I see...","I think I know what might have happened!",]);return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sceneData.timeline=now;sprite.startTalk(game,"offscreen",["You travelled back in time and altered history by taking the baby.","As a result, an alternate universe was created.","One in which, you do not exist.","And that universe is trying to rectify itself","by erasing your existence, slowly.",]);return!0},({pendingTip})=>{return!pendingTip},({now,sceneTime,sceneData})=>{sprite.startTalk(game,"offscreenyupa",["If he dun exist, wad he still doin hee?",]);return!0},({pendingTip})=>!pendingTip,({now,sceneTime,sceneData})=>{game.sceneData.pushDownYupa=now;sprite.startTalk(game,"offscreen",["I'm getting to that."],game=>{game.sceneData.lineBack=game.now;sprite.startTalk(game,"offscreen",["I believe there is still a slim chance","for this human to restore the future where he exists.",])});return!0},({pendingTip})=>!pendingTip,({now,sceneTime,sceneData})=>{sceneData.timeline=0;sceneData.jumpin=now;sprite.startTalk(game,"human4",["Really doctor?","Please tell me!","What do I have to do?","I'll do it!",]);return!0},({pendingTip})=>!pendingTip,({now,sceneTime,sceneData})=>{sprite.startTalk(game,"doctarzoom",["I believe","you already know the answer to that question."]);return!0},({pendingTip})=>!pendingTip,game=>{const{now,sceneTime,sceneData}=game;sceneData.human_wah=now;game.delayAction(game=>{sprite.startTalk(game,"human4",["Oh no!","You mean I have to...","help Baby Hitler become\nHITLER!    ",],game=>{game.sceneData.canGoNextScene=game.now})},1000);return!0},game=>{return game.sceneData.canGoNextScene},game=>{game.fadeToScene("doctar-room");return!0},]},onRefresh:game=>{const{script}=game.sceneData;if(script){while(script.length&&script[0](game)){if(!game.sceneTime){break}
script.shift();game.sceneData.scriptTime=game.now}}},},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#222255";ctx.fillRect(0,0,64,64)},hidden:game=>!game.sceneData.timeline,},{src:ASSETS.HITMAN_WALK,size:[16,21],offsetX:46,offsetY:26,hidden:game=>{const phase1_start=game.sceneData.timeline;const phase1_duration=1000;const phase1_progress=Math.min(1,(game.now-phase1_start)/phase1_duration);return phase1_progress<1||!game.sceneData.timeline},},{src:ASSETS.HITMAN_BEARD_WALK,size:[16,21],offsetX:46,offsetY:26,hidden:game=>{const phase1_start=game.sceneData.timeline;const phase1_duration=1000;const phase1_progress=Math.min(1,(game.now-phase1_start)/phase1_duration);return phase1_progress<1||!game.sceneData.timeline},},{src:ASSETS.HITMAN_WALK,size:[16,21],alpha:game=>{const phase1_start=game.sceneData.timeline;const phase1_duration=1000;const phase1_progress=Math.min(1,(game.now-phase1_start)/phase1_duration);const phase2_start=phase1_start+phase1_duration;const phase2_duration=5000;const phase2_progress=Math.min(1,(game.now-phase2_start)/phase2_duration);const phase3_start=phase2_start+phase2_duration;const phase3_duration=4000;const phase3_progress=Math.min(1,(game.now-phase3_start)/phase3_duration);const phase4_start=phase3_start+phase3_duration;const phase4_duration=2000;const phase4_progress=Math.min(1,(game.now-phase4_start)/phase4_duration);const phase5_start=phase4_start+phase4_duration;const phase5_duration=1000;const phase5_progress=Math.min(1,(game.now-phase5_start)/phase5_duration);const phase6_start=phase5_start+phase5_duration;const phase6_duration=1000;const phase6_progress=Math.min(1,(game.now-phase6_start)/phase6_duration);return Math.max(.2,1-(game.now-phase4_start-10500)/5000)},offsetX:46,offsetY:1,hidden:game=>{const phase1_start=game.sceneData.timeline;const phase1_duration=1000;const phase1_progress=Math.min(1,(game.now-phase1_start)/phase1_duration);const phase2_start=phase1_start+phase1_duration;const phase2_duration=5000;const phase2_progress=Math.min(1,(game.now-phase2_start)/phase2_duration);const phase3_start=phase2_start+phase2_duration;const phase3_duration=4000;const phase3_progress=Math.min(1,(game.now-phase3_start)/phase3_duration);const phase4_start=phase3_start+phase3_duration;const phase4_duration=2000;const phase4_progress=Math.min(1,(game.now-phase4_start)/phase4_duration);const phase5_start=phase4_start+phase4_duration;const phase5_duration=1000;const phase5_progress=Math.min(1,(game.now-phase5_start)/phase5_duration);const phase6_start=phase5_start+phase5_duration;const phase6_duration=1000;const phase6_progress=Math.min(1,(game.now-phase6_start)/phase6_duration);return phase4_progress<1||!game.sceneData.timeline},},{src:ASSETS.HITMAN_BEARD_WALK,size:[16,21],alpha:game=>{const phase1_start=game.sceneData.timeline;const phase1_duration=1000;const phase1_progress=Math.min(1,(game.now-phase1_start)/phase1_duration);const phase2_start=phase1_start+phase1_duration;const phase2_duration=5000;const phase2_progress=Math.min(1,(game.now-phase2_start)/phase2_duration);const phase3_start=phase2_start+phase2_duration;const phase3_duration=4000;const phase3_progress=Math.min(1,(game.now-phase3_start)/phase3_duration);const phase4_start=phase3_start+phase3_duration;const phase4_duration=2000;const phase4_progress=Math.min(1,(game.now-phase4_start)/phase4_duration);const phase5_start=phase4_start+phase4_duration;const phase5_duration=1000;const phase5_progress=Math.min(1,(game.now-phase5_start)/phase5_duration);const phase6_start=phase5_start+phase5_duration;const phase6_duration=1000;const phase6_progress=Math.min(1,(game.now-phase6_start)/phase6_duration);return Math.max(.2,1-(game.now-phase4_start-10500)/5000)},offsetX:46,offsetY:1,hidden:game=>{const phase1_start=game.sceneData.timeline;const phase1_duration=1000;const phase1_progress=Math.min(1,(game.now-phase1_start)/phase1_duration);const phase2_start=phase1_start+phase1_duration;const phase2_duration=5000;const phase2_progress=Math.min(1,(game.now-phase2_start)/phase2_duration);const phase3_start=phase2_start+phase2_duration;const phase3_duration=4000;const phase3_progress=Math.min(1,(game.now-phase3_start)/phase3_duration);const phase4_start=phase3_start+phase3_duration;const phase4_duration=2000;const phase4_progress=Math.min(1,(game.now-phase4_start)/phase4_duration);const phase5_start=phase4_start+phase4_duration;const phase5_duration=1000;const phase5_progress=Math.min(1,(game.now-phase5_start)/phase5_duration);const phase6_start=phase5_start+phase5_duration;const phase6_duration=1000;const phase6_progress=Math.min(1,(game.now-phase6_start)/phase6_duration);return phase4_progress<1||!game.sceneData.timeline},},{custom:(game,sprite,ctx)=>{const phase1_start=game.sceneData.timeline;const phase1_duration=1000;const phase1_progress=Math.min(1,(game.now-phase1_start)/phase1_duration);const phase2_start=phase1_start+phase1_duration;const phase2_duration=5000;const phase2_progress=Math.min(1,(game.now-phase2_start)/phase2_duration);const phase3_start=phase2_start+phase2_duration;const phase3_duration=4000;const phase3_progress=Math.min(1,(game.now-phase3_start)/phase3_duration);const phase4_start=phase3_start+phase3_duration;const phase4_duration=2000;const phase4_progress=Math.min(1,(game.now-phase4_start)/phase4_duration);const phase5_start=phase4_start+phase4_duration;const phase5_duration=1000;const phase5_progress=Math.min(1,(game.now-phase5_start)/phase5_duration);const phase6_start=phase5_start+phase5_duration;const phase6_duration=1000;const phase6_progress=Math.min(1,(game.now-phase6_start)/phase6_duration);const shiftY=-10;ctx.strokeStyle="#bbcccc";ctx.lineWidth="1px";ctx.setLineDash([]);ctx.beginPath();ctx.moveTo(2,shiftY+40.5);ctx.lineTo(2+Math.sqrt(phase1_progress)*42,shiftY+40.5);if(phase3_progress>0){ctx.moveTo(8,shiftY+40.5);ctx.lineTo(8+10*phase3_progress,shiftY+40.5-20*phase3_progress)}
if(phase4_progress>0){ctx.moveTo(18,shiftY+20.5);ctx.lineTo(18+25*phase4_progress,shiftY+20.5)}
ctx.stroke();if(phase2_progress>0){ctx.beginPath();ctx.setLineDash([3,2]);ctx.arc(26,shiftY+23,25,Math.PI/2-.8,Math.PI/2-.8+.8*2*phase2_progress);if(game.sceneData.lineBack){const progress=Math.min(1,(game.now-game.sceneData.lineBack)/3000);ctx.moveTo(30,shiftY+20.5);ctx.lineTo(30+10*progress,shiftY+20.5+20*progress)}
ctx.stroke()}
ctx.beginPath();ctx.setLineDash([]);ctx.lineWidth="2px";ctx.strokeStyle="#aa0000";if(phase5_progress>0){ctx.moveTo(49,shiftY+10);ctx.lineTo(49+10*phase5_progress,shiftY+10+15*phase5_progress)}
if(phase6_progress>0){ctx.moveTo(49,shiftY+25);ctx.lineTo(49+10*phase6_progress,shiftY+25-15*phase6_progress)}
ctx.stroke()},hidden:game=>!game.sceneData.timeline,},{src:ASSETS.YUPA_WOOPSIE,hidden:({pendingTip})=>(!pendingTip||pendingTip.talker!=="offscreenyupa")&&!game.sceneData.pushDownYupa,index:game=>game.sceneData.pushDownYupa?2:Math.floor(game.now/100)%2,offsetY:game=>{if(game.sceneData.pushDownYupa){const time=(game.now-game.sceneData.pushDownYupa)/50;return Math.min(Math.round(time),30)}
const time=game.now-game.pendingTip.time;return Math.max(0,10-time/100)},},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#000000";ctx.fillRect(0,0,64,64)},hidden:game=>!game.sceneData.human_wah,},{src:ASSETS.HUMAN_WAH,col:3,row:3,index:({pendingTip,now,sceneData})=>{if(sceneData.human_wah){if(pendingTip){return 4+(pendingTip&&pendingTip.progress>=1?0:Math.floor(now/100)%4)}
return 4}
return pendingTip.talker==="human4"&&pendingTip.progress<1?Math.floor(now/100)%4:0},hidden:({pendingTip,sceneData})=>!sceneData.human_wah&&(!pendingTip||pendingTip.talker!=="human4"),offsetY:({pendingTip,now,sceneData})=>{if(sceneData.human_wah){return 0}
return pendingTip&&pendingTip.talker==="human4"?Math.max(0,50-(now-sceneData.jumpin)):0},},],},);game.addScene({name:"doom",onScene:game=>{game.playTheme(null);game.hideCursor=!0;game.showTip(["And that was it.","I took those painkillers, prescribed by Yupa and the doctor,","Laid on the bench, and closed my eyes.","My life as the hitman who was supposed to kill Baby Hitler, ended here.","I would simply vanish, as if I never existed.","Future generations will live in peace, not ever knowing what it was like...","to live in a world, where Hitler rose to power.","As I contemplate that future I imagined, my mind started to fade, peacefully...","Actually, it didn't really feel that peaceful at all, I was feeling pain","Hey, did that medecine they give me really work? I'm feeling very painful here!","The pain, the suffering, it is getting worst and worst...","Is this really how it feels like to die!?!","I've never felt pain like this my whole life, this is absolute torture!","My brain, my limbs, my genitals, everything in my body feels like it's being ripped apart by demons!!","The sensation of drenched in acide bath...","The feeling of being fried in burning oil...","The pain of being impaled on a stick...","All those feelings overwhelm me at the same time.","This is worst than hell! Please get me out of here!","PUT ME OUT OF MY MISERY!!!!....",],game=>{game.gotoScene("human-woke")},100,{maxLines:10})},sprites:[{custom:(game,sprite,ctx)=>{const time=game.now-game.sceneTime;const hex=(100+Math.floor(Math.random()*30*Math.min(1,Math.max(0,time-40000)/30000))).toString().substr(1);ctx.fillStyle=`#${hex}0000`;ctx.fillRect(0,0,64,64)},},],},);game.addScene({name:"drink-yupa",onScene:game=>{game.playTheme(null);game.hideCursor=!0;game.playSound(SOUNDS.YUPA);game.showTip([`Dont do it,\n~${game.data.name||"Hitman"}~!`,"I warn ya, ya ganna regret it!"],game=>{},null,{x:2,y:22,speed:80,talker:"yupa"})},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);if(!game.sceneData.drankYupa&&frame>=80){game.sceneData.drankYupa=game.now;game.playSound(SOUNDS.YUPA,{loop:!0});game.showTip("Don't!",null,null,{x:2,y:22,speed:10,talker:"yupa"});game.delayAction(game=>{game.stopSound(SOUNDS.YUPA);game.playSound(SOUNDS.DRINK);game.pendingTip=null},800);game.delayAction(game=>{game.playSound(SOUNDS.JINGLE);game.playTheme(SOUNDS.GOGOL);game.sceneData.tripping=game.now;game.showTip(["Oh, yeesss.... now I have....","Yupa Suppapawaa!!!!","I can.... liqueefaiiii","Oh yeahh.... Imma supayupa yumaaannn...","Immaaa supppaa mmaann"],game=>{game.sceneData.crazy=game.now;game.delayAction(game=>{game.stopSound(SOUNDS.GOGOL);game.playSound(SOUNDS.YUPA);game.showTip("Yu are very stuped man",game=>{game.playSound(SOUNDS.HUM);game.showTip("I know",game=>{getMedal("Yupalicious!");game.gameOver(" “~YUPA is not\n     mean YOPLAIT!~”")},null,{x:20,y:30,speed:100,talker:"human"})},null,{x:2,y:22,speed:80,talker:"yupa"})},8000)})},1200)}
if(game.data.gameOver){game.fade=Math.min(.7,Math.max(0,(game.now-game.data.gameOver)/1000))}},sprites:[{custom:(game,sprite,ctx)=>{ctx.clearRect(0,0,64,64)},hidden:game=>game.sceneData.tripping&&!game.sceneData.crazy,},{offsetX:game=>game.sceneData.tripping&&!game.sceneData.crazy?Math.sin(game.now/50)*Math.sin(game.now/1000)*5:0,offsetY:game=>game.sceneData.tripping&&!game.sceneData.crazy?Math.cos(game.now/150)*Math.cos(game.now/700)*5:0,globalCompositeOperation:game=>game.sceneData.tripping&&!game.sceneData.crazy?(Math.random()<.3?"overlay":Math.random()<.5?"darken":"lighten"):null,src:ASSETS.DRINK_YUPA,col:7,row:7,index:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);if(frame<80){if(game.pendingTip&&game.pendingTip.talker==="yupa"){return Math.floor(game.now/100)%4}}else if(!game.sceneData.crazy){return Math.min(frame-80,9)}else{const f=Math.floor((game.now-game.sceneData.crazy)/100);if(game.pendingTip&&game.pendingTip.talker==="yupa"){return f%2+43}else if(game.pendingTip&&game.pendingTip.talker==="human"){return f%2+45}
return Math.max(9,Math.min(f,42))}},},],},);game.addScene({name:"ecstacity",onScene:game=>{delete game.inventory.ticket;game.situation.wentToEcstaCity=game.now;game.situation.needToBuyWarpDrive=game.now;game.showTip(["How many nights are you staying in EcstaCity?",],game=>{game.startDialog({conversation:[{msg:"How many nights?",options:[{msg:"Two nights",onSelect:game=>{game.showTip(["You spent two nights in EcstaCity.","You earned 1000 coins.","but all the partying got a toll on you.","You lost 1 point in attack and defense, and 10 in maxlife.",],game=>{game.data.stats.maxLife-=10;game.data.stats.defense-=1;game.data.stats.damage-=1;game.addToInventory({item:"coin",image:ASSETS.GRAB_COIN,count:1000});game.waitCursor=!1;game.gotoScene("sarlie-planet-world")})},},{msg:"Three nights",onSelect:game=>{game.showTip(["You spent three nights in EcstaCity.","You earned 1200 coins.","but all the partying got a toll on you.","You lost 2 point in attack and defense, and 20 in maxlife.",],game=>{game.data.stats.maxLife-=20;game.data.stats.defense-=2;game.data.stats.damage-=2;game.addToInventory({item:"coin",image:ASSETS.GRAB_COIN,count:1200});game.waitCursor=!1;game.gotoScene("sarlie-planet-world")})},},{msg:"One week",onSelect:game=>{game.showTip(["You spent one week in EcstaCity.","You earned 2000 coins.","but all the partying got a toll on you.","You lost 50% of your attack and defense, and maxlife.",],game=>{game.data.stats.maxLife=Math.ceil(game.data.stats.maxLife/2);game.data.stats.defense=Math.ceil(game.data.stats.defense/2);game.data.stats.damage=Math.ceil(game.data.stats.damage/2);game.addToInventory({item:"coin",image:ASSETS.GRAB_COIN,count:2000});game.waitCursor=!1;game.gotoScene("sarlie-planet-world")})},},],},],})})},sprites:[{custom:(game,sprite,ctx)=>{ctx.clearRect(0,0,64,64)},},],},);game.addScene({name:"ending",onScene:game=>{game.hideCursor=!0;game.playTheme(null);game.delayAction(game=>{game.currentScene.startTalk(game,"human",["We did it Yupa!","We defeated Dick Ruber's gang.",],game=>{game.currentScene.startTalk(game,"yupa",[`Yu da man,\n~${game.data.name||"hitman"}`,"Naice wok wid dat gun bak there.",],game=>{game.sceneData.hitmanToYupa=game.now;game.delayAction(game=>{game.sceneData.yupaToHitman=game.now},1000);game.currentScene.startTalk(game,"human",["How did you bring the\nspacehip here?",],game=>{game.currentScene.startTalk(game,"yupa",["Pisca cake!",],game=>{game.sceneData.holdRemote=game.now;game.currentScene.startTalk(game,"yupa",["I olways bring remothe wid mi","To coll Electra.",],game=>{game.currentScene.startTalk(game,"human",["Great! Now that we finally found Baby Hitler,","We can go back to Earth.",],game=>{game.gotoScene("not-so-fast")})})})})})})},5000)},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="yupa"){x=2;y=63;game.playSound(SOUNDS.YUPA)}else if(talker==="human"){x=8;y=63;game.playSound(SOUNDS.HUM)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},sprites:[{custom:(game,sprite,ctx)=>{ctx.clearRect(0,0,64,64)},},{src:ASSETS.WE_DID_IT,col:4,row:5,},{src:ASSETS.WE_DID_IT,col:4,row:5,index:game=>{const base=game.sceneData.yupaToHitman?13:5;return base+(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="yupa"?Math.floor(game.now/100)%4:0)},},{src:ASSETS.WE_DID_IT,col:4,row:5,index:17,hidden:game=>!game.sceneData.holdRemote,},{src:ASSETS.WE_DID_IT,col:4,row:5,index:game=>{const base=game.sceneData.hitmanToYupa?9:1;return base+(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="human"?Math.floor(game.now/100)%4:0)},},{src:ASSETS.BEARD_SHAVED,col:3,row:3,scale:1.4,offsetX:-5,offsetY:-20,index:game=>game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="human"?Math.floor(game.now/100)%4:0,},],},);game.addScene({name:"ernest-card-dealing",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onScene:game=>{game.waitCursor=!0;if(game.situation.lostGame){game.sceneData.zoomDick=game.now;game.currentScene.startTalk(game,"dick",["You lost.","Well, that figures.","There's one thing you should know.","I always win at this game."],game=>{game.sceneData.zoomDick=0;game.currentScene.bodyguardShoot(game)});return}
if(!game.situation.waitForPickup){game.playSound(SOUNDS.HIT,{volume:.5});game.sceneData.dealingDick=game.now;game.delayAction(game=>{game.sceneData.dealingDick=0;game.playSound(SOUNDS.HIT,{volume:.5});game.sceneData.dealingHitman=game.now},600);game.delayAction(game=>{game.sceneData.dealingHitman=0;game.delayAction(game=>{game.sceneData.turnToDick=game.now},3000);game.currentScene.startTalk(game,"ernest",["Very well\ngentlemen. Is there anything else I can do for you?",],game=>{game.sceneData.dickToErnest=game.now;game.currentScene.startTalk(game,"dick",["Thank you Ernest, that'll be it for now.",],game=>{game.currentScene.startTalk(game,"ernest",["You are very\nwelcome.",],game=>{game.sceneData.turnToDick=0;game.delayAction(game=>{game.sceneData.dickToErnest=0},200);game.currentScene.startTalk(game,"ernest",["How about you sir?",],game=>{game.waitCursor=!1;game.startDialog({conversation:[{options:[{msg:"Gimme an Ace",onSelect:game=>{game.currentScene.startTalk(game,"human",["I wanna win this hand.","Can you give me an ace?",],game=>{game.currentScene.startTalk(game,"ernest",["Perhaps I already did, sir.",])})},},{msg:"That's all.",onSelect:game=>{game.currentScene.startTalk(game,"human",["That'll be all. Thanks Ernest.",],game=>{game.currentScene.startTalk(game,"ernest",["You are very\nwelcome, sir. Enjoy the game!",],game=>{game.playTheme(SOUNDS.JAIL_CELL_THEME);game.situation.ernestLeave=game.now;game.dialog=null;game.currentScene.startTalk(game,"dick",["Are you ready to die?","Pick up your card and let's show our hands",],game=>{game.situation.waitForPickup=game.now})})})},},],},],})})})})})},1500)}else{game.waitCursor=!1;game.playTheme(SOUNDS.JAIL_CELL_THEME)}},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="ernest"){x=1;y=50;game.playSound(SOUNDS.YES_SIR)}else if(talker==="dick"){x=2;y=game.sceneData.zoomDick?22:54;game.playSound(SOUNDS.GRUMP)}else if(talker==="bodyguard"){x=5;y=44;game.playSound(SOUNDS.YES_BOSS)}else if(talker==="human"){x=4;y=62;game.playSound(SOUNDS.HUM)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},onSceneHoldItem:(game,item)=>{if(item==="gun"){game.useItem=null;game.waitCursor=!0;game.currentScene.bodyguardShoot(game,!0);game.dialog=null;if(!game.situation.ernestLeave){game.situation.ernestLeave=game.now}
game.delayAction(game=>{game.currentScene.startTalk(game,"bodyguard",["I saw him take out his gun, boss.",],game=>{game.currentScene.startTalk(game,"dick",["You did well, Baxter.","You did very well ...",],game=>{game.gameOver("  “~I needed a\n      distraction.~”")})})},800)}else if(item==="ace of hearts"){if(game.situation.waitForPickup){game.sceneData.switcharoo=game.now;game.useItem=null;game.delayAction(game=>{game.situation.aceOfHearts=game.now;game.sceneData.switcharoo=0;game.sceneData.lookAtCard=game.now;game.playSound(SOUNDS.PICKUP);game.showTip(["Hehe... they didn't notice that I switched the card.",],game=>{game.sceneData.doneLookAtCard=game.now;game.currentScene.timeForShowdown(game)})},5000)}}},timeForShowdown:game=>{game.currentScene.startTalk(game,"dick","Show your hand!",game=>{game.gotoScene("cards-showdown")})},onSceneRefresh:game=>{if(game.sceneData.bodyguardShoot){const progress=Math.min(1,(game.now-game.sceneData.bodyguardShoot)/3000);game.fade=game.sceneData.bodyguardShoot?.6*progress:0;game.fadeColor="#990000";if(progress>=1&&!game.data.gameOver&&!game.sceneData.overrideGameOver){game.gameOver("“~The odds were\n   stacked against\n   you.~”")}}},bodyguardShoot:(game,overrideGameOver)=>{game.sceneData.overrideGameOver=overrideGameOver;game.sceneData.bodyguardShoot=game.now;game.playSound(SOUNDS.GUN_SHOT)},sprites:[{src:ASSETS.TAVERN_GANGSTA_CARD_GAME,col:5,row:6,index:24,},{src:ASSETS.TAVERN_GANGSTA_CARD_GAME,col:5,row:6,side:RIGHT,index:({pendingTip,now})=>{if(game.sceneData.bodyguardShoot){return pendingTip&&pendingTip.talker==="bodyguard"&&pendingTip.progress<1?25+Math.floor(now/100)%3:25}
return pendingTip&&pendingTip.talker==="bodyguard"&&pendingTip.progress<1?20+Math.floor(now/100)%3:20},tip:"Let's be careful, that bodyguard has an eye on me.",},{src:ASSETS.TAVERN_GANGSTA_CARD_GAME,col:5,row:6,side:LEFT,index:20,tip:"Let's be careful, that bodyguard has an eye on me.",hidden:game=>game.getSituation("tavern-phone").yupaAndBrutus,},{src:ASSETS.TAVERN_GANGSTA_CARD_GAME,col:5,row:6,index:({pendingTip,now,sceneTime,sceneData,situation})=>{if(situation.lostGame){return 29}
if(sceneData.dealingHitman){return Math.min(7,Math.floor(3+(now-sceneData.dealingHitman)/100))}
if(sceneData.dealingDick){return Math.min(3,Math.floor((now-sceneData.dealingDick)/100))}
if(sceneData.dickToErnest){return pendingTip&&pendingTip.talker==="dick"&&pendingTip.progress<1?9+Math.floor(now/100)%2:9}
return pendingTip&&pendingTip.talker==="dick"&&pendingTip.progress<1?7+Math.floor(now/100)%2:7},},{src:ASSETS.TAVERN_GANGSTA_CARD_GAME,col:5,row:6,index:19,onClick:game=>{game.situation.aceOfHearts=0;game.sceneData.switcharoo=0;game.sceneData.lookAtCard=game.now;game.playSound(SOUNDS.PICKUP);game.showTip(["Rats!!",],game=>{game.sceneData.doneLookAtCard=game.now;game.currentScene.timeForShowdown(game)})},tip:"What is it going to be? Is it an Ace?",hidden:({now,sceneData,situation})=>sceneData.lookAtCard||sceneData.dealingDick||sceneData.dealingHitman&&Math.min(7,Math.floor(3+(now-sceneData.dealingHitman)/100))<7||situation.lostGame,},{src:ASSETS.TAVERN_GANGSTA_CARD_GAME,col:5,row:6,index:({pendingTip,now,sceneTime,sceneData})=>{if(sceneData.coinForErnest){return pendingTip&&pendingTip.talker==="ernest"&&pendingTip.progress<1?17+Math.floor(now/100)%2:17}
if(sceneData.dealingHitman){return 12}
if(sceneData.dealingDick){return 11}
if(sceneData.turnToDick){return pendingTip&&pendingTip.talker==="ernest"&&pendingTip.progress<1?13+Math.floor(now/100)%2:13}
return pendingTip&&pendingTip.talker==="ernest"&&pendingTip.progress<1?15+Math.floor(now/100)%2:15},side:LEFT,offsetX:game=>{if(game.situation.ernestLeave){return Math.max(-30,-((game.now-game.situation.ernestLeave)/300))}
return 0},combine:(item,game)=>{if(item==="coin"){game.removeFromInventory(item);game.useItem=null;game.sceneData.coinForErnest=game.now;game.playSound(SOUNDS.PICKUP);game.currentScene.startTalk(game,"ernest",["Thank you sir!","Your generosity is appreciated.",],game=>{game.sceneData.coinForErnest=0});return!0}else if(item==="ace of hearts"){game.useItem=null;game.showTip("I better keep that card.");return!0}},hidden:game=>game.situation.lostGame,},{src:ASSETS.TAVERN_GANGSTA_CARD_GAME,col:5,row:6,index:28,hidden:game=>!game.sceneData.bodyguardShoot||game.now-game.sceneData.bodyguardShoot>100,},{src:ASSETS.SWITCHAROO,index:2,hidden:game=>!game.sceneData.switcharoo,},{src:ASSETS.SWITCHAROO,index:1,hidden:game=>!game.sceneData.switcharoo,offsetX:game=>{const time=game.now-game.sceneData.switcharoo;if(time>=2800){return 4+Math.min(64,(time-2800)/20)}
return 4},offsetY:game=>{const time=game.now-game.sceneData.switcharoo;if(time>=2500){return-2}
return 0},},{src:ASSETS.SWITCHAROO,index:0,offsetX:game=>{const time=game.now-game.sceneData.switcharoo;if(time<2000){return(2000-time)/100}
if(time>=2500){return Math.min(64,(time-2500)/20)}
return 0},offsetY:game=>{const time=game.now-game.sceneData.switcharoo;if(time<2000){return 0}
return Math.min(7,(time-2000)/30)},hidden:game=>!game.sceneData.switcharoo,},{src:ASSETS.CARDS_SHOWDOWN,col:2,row:3,index:game=>game.situation.aceOfHearts?0:1,offsetY:game=>{if(game.sceneData.doneLookAtCard){return Math.min(50,(game.now-game.sceneData.doneLookAtCard)/5)}
return Math.max(0,20-(game.now-game.situation.aceOfHearts)/10)},hidden:game=>!game.sceneData.lookAtCard&&!game.sceneData.doneLookAtCard,},{src:ASSETS.ZOOM_DICK,index:game=>{if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="dick"){return Math.floor(game.now/100)%4}
return 0},flipH:!0,hidden:game=>!game.sceneData.zoomDick,},...standardMenu(),...standardBag(),],},);game.addScene({name:"ernest",onScene:game=>{game.waitCursor=!0;game.delayAction(game=>{game.currentScene.startTalk(game,"ernest",["Greetings. I will be your dealer for tonight.","I can assure you, I will remain impartial throughout the whole game.",],game=>{game.sceneData.zoomDick=game.now;game.currentScene.startTalk(game,"dick",["Go ahead, Ernest. Deal us the cards.","We're playing WAR!",],game=>{game.sceneData.zoomDick=0;game.currentScene.startTalk(game,"ernest",["Right away sir.",],game=>{game.sceneData.shuffling=game.now;game.delayAction(game=>{game.sceneData.shiftyEyes=game.now},4000);game.delayAction(game=>{game.sceneData.shiftyEyes=0},8000);game.delayAction(game=>{game.sceneData.shuffling=0;game.gotoScene("ernest-card-dealing")},12000)})})})},1500)},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="ernest"){x=2;y=50;game.playSound(SOUNDS.YES_SIR)}else if(talker==="dick"){x=2;y=24;game.playSound(SOUNDS.GRUMP)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#453737";ctx.fillRect(0,0,64,64)},},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#816d45";ctx.fillRect(0,47,64,17);ctx.fillStyle="black";ctx.fillRect(0,46,64,1)},hidden:game=>game.sceneData.zoomDick,},{src:ASSETS.ERNEST,col:2,row:3,offsetX:game=>{const d=Math.min(0,game.now-game.sceneTime-1000)/50;return-d*d},index:({pendingTip,now})=>{if(pendingTip&&pendingTip.talker==="ernest"&&pendingTip.progress<1){return Math.floor(now/100)%4}
return 0},hidden:game=>game.sceneData.zoomDick,},{src:ASSETS.ERNEST,col:2,row:3,index:4,offsetY:2,hidden:game=>game.sceneData.zoomDick,},{src:ASSETS.ZOOM_DICK,index:game=>{if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="dick"){return Math.floor(game.now/100)%4}
return 0},hidden:game=>!game.sceneData.zoomDick,},{src:ASSETS.SHUFFLE_CARDS,col:3,row:3,index:game=>Math.floor(game.now/100)%7,hidden:game=>!game.sceneData.shuffling,onRefresh:(game,sprite)=>{const index=game.evaluate(sprite.index);if(index<5&&(!game.sceneData.lastShuffleSound||game.now-game.sceneData.lastShuffleSound>50)){game.playSound(SOUNDS.HIT,{volume:game.sceneData.shiftyEyes?.05:.1});game.sceneData.lastShuffleSound=game.now}},},{src:ASSETS.SHIFTY_EYES,index:game=>Math.round((Math.sin(game.now/100)+1)/2*3),hidden:game=>!game.sceneData.shiftyEyes,},],},);game.addScene({name:"evening-date",onScene:game=>{game.playTheme(SOUNDS.SOFT_THEME,{volume:.8});game.hideCursor=!0;game.delayAction(game=>{game.showTip(["We spent that evening together ...","I told her all the stories of my childhood ...","things I never told anyone ...","I really felt at peace ...","All my stress, all my anger ... everything started to fade away ...","At that moment, deep inside my heart, I knew only one thing for sure ...","I would be ...","without a shadow of a doubt ...",],game=>{game.fadeOut(game.now,{duration:5000,fadeDuration:5000,color:"#000000"});game.showTip([" ... spending the rest of my life by her side.",],game=>{game.delayAction(game=>{game.gotoScene("morning-after")},1000)},120)},100)},8000)},onSceneRefresh:game=>{if(game.now-game.sceneTime<=10000){game.fade=Math.min(1,1-(game.now-game.sceneTime)/5000)}},sprites:[{src:ASSETS.EVENING_DATE,},],},);game.addScene({name:"explore-tavern",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[BACKWARD,BACKWARD,null,null,null],],customCursor:(game,ctx)=>{if(game.mouse){const{x,y}=game.mouse;if(x>64-5&&game.situation.shift>-64){game.displayImage(ctx,{src:ASSETS.ARROW_CURSOR,offsetX:x-5,offsetY:y-5,size:[11,11],col:1,row:2,index:1});return"none"}else if(x<5&&game.situation.shift<0){game.displayImage(ctx,{src:ASSETS.ARROW_CURSOR,offsetX:x-5,offsetY:y-5,size:[11,11],col:1,row:2,index:0});return"none"}}},onSceneBackward:game=>{game.fadeToScene("tavern-entrance")},canGo:(game,direction)=>{if(direction===BACKWARD){return game.situation.shift>-20}
if(direction===RIGHT){return game.situation.shift>-64}
if(direction===LEFT){return game.situation.shift<0}
return!1},onScene:game=>{game.save();game.playTheme(SOUNDS.TURTLE_SONG_THEME,{volume:.7});if(!game.situation.shift){game.situation.shift=0}
game.sceneData.noTurn=!0},onSceneRefresh:game=>{if(game.mouse&&game.mouse.x>64-5||game.actionDown===RIGHT){game.situation.shift-=.3;game.situation.shift=Math.max(-64,Math.min(0,game.situation.shift))}else if(game.mouse&&game.mouse.x<5||game.actionDown===LEFT){game.situation.shift+=.3;game.situation.shift=Math.max(-64,Math.min(0,game.situation.shift))}},sprites:[{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:4,offsetX:game=>Math.round(game.situation.shift),tip:"There's a phone booth in the corner.",onClick:game=>{game.gotoScene("tavern-phone")},},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:5,offsetX:game=>Math.round(game.situation.shift),tip:"There are two musicians on stage, playing a funky tune.",onClick:game=>{},},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:6,offsetX:game=>Math.round(game.situation.shift),tip:game=>game.situation.confirmDick?"That's Dick Ruber's table.":"I bet that's Dick Ruber's table.",onClick:game=>{game.gotoScene("gangsta-table")},},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:7,offsetX:game=>Math.round(game.situation.shift),tip:game=>game.getSituation("tavern-phone").yupaAndBrutus?"One bodyguard is busy talking to Yupa.\nThis should help dealing with Dick.":"The bartender is talking with a drunk customer.",onClick:game=>{},},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:game=>Math.floor(game.now/500)%2,offsetX:game=>Math.round(game.situation.shift),},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:10,offsetX:game=>Math.round(game.situation.shift),hidden:game=>!game.getSituation("tavern-phone").yupaAndBrutus,},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:game=>{if(game.getSituation("tavern-phone").yupaAndBrutus){return 8}
return 9},offsetX:game=>Math.round(game.situation.shift),},...standardMenu(),...standardBag(),],},);game.addScene({name:"final-corridor",onScene:game=>{if(!game.getSituation("lab").shotTank){game.save()}},arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,s(7),s(8),s(7),RIGHT],[LEFT,s(7),s(9),s(7),RIGHT],],map:`
			XXXXXXXXX
			XL.C..8EX
			XXXXXXXXX
		`,sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...getCommonMaze("_1"),{src:ASSETS.CEILING_HOLE_ONLY,col:3,row:3,hidden:game=>{if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().ceilinghole){return!1}
if(game.currentEvent()&&game.currentEvent().ceilinghole){return!1}
if(game.behindEvent()&&game.behindEvent().ceilinghole&&game.frameIndex===3&&game.moving){return!1}
return!0},index:game=>{if(game.facingEvent()&&game.facingEvent().ceilinghole){return 5+(game.moving?game.frameIndex:0)}
if(game.currentEvent()&&game.currentEvent().ceilinghole){return 1+(game.moving?game.frameIndex:0)}
if(game.behindEvent()&&game.behindEvent().ceilinghole&&game.frameIndex===3){return 0}
return 0},onClick:game=>{game.sceneData.lookUp=game.now},},{src:ASSETS.LAB_DOOR,hidden:game=>{if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().lab&&!game.moving){return!1}
return!0},onClick:game=>{if(game.situation.yupaOpenedDoor){game.situation.labVisited=game.now;game.data.yupa.inBottle=0;game.data.yupa.noMoreBottle=game.now;game.gotoScene("lab",{door:'E'});return}
if(game.situation.yupaDropped){game.waitCursor=!0;game.showTip("Sweet, you're inside. Do you think you can open the door?",game=>{game.playSound(SOUNDS.YUPA);game.showTip("Shure, lemme see.",()=>{game.situation.yupaOpenedDoor=game.now+1500;game.delayAction(game=>{game.playSound(SOUNDS.DIVING)},1800);game.delayAction(game=>{game.playSound(SOUNDS.YUPA);game.waitCursor=!1;game.showTip("That waz eazy.",null,null,{x:1,y:20,speed:80,talker:"yupa",removeLock:!0})},2500)},null,{x:1,y:20,speed:80,talker:"yupa"})});return}
if(!game.sceneData.seenLab){game.sceneData.seenLab=!0;game.showTip(["I can see through the glass door. It looks like some kind of lab.","The entrance is locked."])}else{game.showTip("The entrance is locked.",null,null,{removeLock:!0})}},combineMessage:(item,game)=>{if(game.situation.yupaDropped){return null}
return `I can't use ${item} on the door.`},},{src:ASSETS.LAB_ENTRANCE,col:3,row:3,hidden:game=>{if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().lab){return!1}
if(game.furtherEvent()&&game.furtherEvent().lab){return!1}
return!0},index:game=>{if(game.facingEvent()&&game.facingEvent().lab){return game.moving?game.frameIndex:0}
if(game.furtherEvent()&&game.furtherEvent().lab){return 4+(game.moving?game.frameIndex:0)}
return 0},},{src:ASSETS.YUPA_IN_LAB,col:5,row:6,hidden:game=>{if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().lab&&!game.moving){return!game.situation.yupaDropped}
return!0},index:game=>{if(game.situation.labVisited){return game.getSituation("lab").shotTank?25:24}
if(game.situation.yupaOpenedDoor){const frame=12+Math.floor((game.now-game.situation.yupaOpenedDoor)/100);if(game.pendingTip&&game.pendingTip.talker==="yupa"){return 18+frame%5}
if(frame<=20){return Math.max(13,frame)}
return 20+(frame%40===0?-1:0)}
const frame=Math.floor((game.now-game.situation.yupaDropped)/100);if(game.pendingTip&&game.pendingTip.talker==="yupa"){return 8+frame%5}
return frame<0?(frame%10===0?1:0):frame<=8?frame:frame%40===0?9:8},},{src:ASSETS.ELECTRO_DIAL,col:2,row:3,index:game=>{if(game.sceneData.lastError&&game.now-game.sceneData.lastError<500){return 4}
if(!game.sceneData.zoomDial){return Math.floor(game.now/500)%2}else{return 2+Math.floor(game.now/500)%2}
return 0},hidden:game=>{if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().lab&&!game.moving){return!1}
return!0},onClick:game=>{if(!game.sceneData.zoomDial){game.sceneData.zoomDial=game.now;game.pendingTip=null}else{const padDim={x0:12,y0:6,x1:50,y1:53};const{x,y}=game.mouse;if(padDim.x0<=x&&x<=padDim.x1&&padDim.y0<=y&&y<=padDim.y1){if(game.mouse&&game.mouseDown){const{x,y}=game.mouse;for(let i=0;i<9;i++){const xx=17+12*(i%3);const yy=10+11*Math.floor(i/3);if(xx<=x&&x<=xx+5&&yy<=y&&y<=yy+6){game.sceneData.beepCount=(game.sceneData.beepCount||0)+1;if(game.sceneData.beepCount%5===0){game.playSound(SOUNDS.BOP);game.delayAction(game=>game.playSound(SOUNDS.BOP),150);game.sceneData.lastError=game.now}else{game.playSound(SOUNDS.BEEP)}
break}}}}else{game.sceneData.zoomDial=0;game.pendingTip=null}}}},{src:ASSETS.BOTTLE_SLOT,col:3,row:3,index:game=>{if(!game.sceneData.zoomSlot){return 0}else{if(game.sceneData.justDropped){if(game.now-game.sceneData.justDropped.time<500){if(game.sceneData.justDropped.item==="empty bottle"){return 2}else if(game.sceneData.justDropped.item==="water bottle"){return 3}else{return 4}}}
return 1}},hidden:game=>{if(game.sceneData.zoomDial){return!0}
if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().lab&&!game.moving){return!1}
return!0},onClick:game=>{if(!game.sceneData.zoomSlot){game.sceneData.zoomSlot=game.now}else{game.sceneData.zoomSlot=0}
game.pendingTip=null},combine:(item,game)=>{if(!game.sceneData.zoomSlot){game.sceneData.zoomSlot=game.now;game.pendingTip=null;return!0}},},{src:ASSETS.BOTTLE_SLOT,col:3,row:3,index:5,hidden:game=>!game.sceneData.zoomSlot,onClick:game=>{if(!game.sceneData.readText){game.sceneData.readText=game.now;game.showTip(["It's some kind of alien dialect","I can't read.",])}else{game.showTip(["I can't read.",],null,null,{removeLock:!0})}},},{src:ASSETS.BOTTLE_SLOT,col:3,row:3,index:6,hidden:game=>{if(!game.sceneData.zoomSlot){return!0}
if(game.sceneData.justDropped){if(game.now-game.sceneData.justDropped.time<500){return!0}}
return!1},onClick:game=>{if(!game.sceneData.checkSlot){game.sceneData.checkSlot=game.now;game.showTip(["It's a round slot.","I think it must be used to drop samples into the lab.",])}else{game.showTip(["I think it's for dropping samples into the lab.",],null,null,{removeLock:!0})}},combine:(item,game)=>{switch(item){case "water bottle":case "empty bottle":case "yupa bottle":game.removeFromInventory(item);game.sceneData.justDropped={item,time:game.now,};game.playSound(SOUNDS.EAT);game.useItem=null;if(item!=="yupa bottle"){game.delayAction(game=>{game.showTip(`Not sure what that accomplished, beside losing a bottle.`,null,null,{removeLock:!0})},1000)}else{game.waitCursor=!0;game.situation.yupaDropped=game.now+3000;game.delayAction(game=>{game.sceneData.zoomSlot=0},1000);game.delayAction(game=>{game.playSound(SOUNDS.DRINK)},3200);game.delayAction(game=>{game.waitCursor=!1},4000)}
return!0;break}},combineMessage:(item,game)=>{return `I don't want to drop my ${item} into the slot.`},},{custom:(game,sprite,ctx)=>{const ALIEN_DIGIT_0=1000;if(game.mouse&&game.mouseDown){const{x,y}=game.mouse;ctx.fillStyle="#555599";for(let i=0;i<9;i++){const xx=17+12*(i%3);const yy=10+11*Math.floor(i/3);if(xx<=x&&x<=xx+5&&yy<=y&&y<=yy+6){ctx.fillRect(xx,yy,5,6)}}}
game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+0].char,x:18,y:11,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+1].char,x:31,y:11,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+2].char,x:42,y:11,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+3].char,x:18,y:22,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+4].char,x:30,y:22,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+5].char,x:42,y:22,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+6].char,x:18,y:33,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+7].char,x:30,y:33,});game.displayTextLine(ctx,{msg:ALPHAS[ALIEN_DIGIT_0+8].char,x:42,y:33,})},hidden:game=>!game.sceneData.zoomDial,},{src:ASSETS.CEILING_ROPE_MOVE,col:3,row:3,hidden:game=>{if(game.rotation%2!==0){return!game.currentEvent()||!game.currentEvent().ceilinghole}
if(game.facingEvent()&&game.facingEvent().ceilinghole){return!1}
if(game.currentEvent()&&game.currentEvent().ceilinghole){return!1}
if(game.behindEvent()&&game.behindEvent().ceilinghole&&game.frameIndex===3&&game.moving){return!1}
return!0},index:game=>{if(game.facingEvent()&&game.facingEvent().ceilinghole){return 5+(game.moving?game.frameIndex:0)}
if(game.currentEvent()&&game.currentEvent().ceilinghole){return 1+(game.moving?game.frameIndex:0)}
if(game.behindEvent()&&game.behindEvent().ceilinghole&&game.frameIndex===3){return 0}
return 0},},{src:ASSETS.EXIT_OUT_CARNAGE,col:3,row:3,index:game=>{return 0},hidden:game=>{if(!game.situation.monsterLetOut){return!0}
if(game.rotation%2!==0){return!0}
if(!game.situation.gateOpened||game.situation.gateClosed){return!0}
if(game.facingEvent()&&game.facingEvent().exit){return game.moving}
return!0},onClick:game=>{game.waitCursor=!0;game.fadeToScene("outside-carnage",null,2000)},},{src:ASSETS.EXIT_OUT_CARNAGE,col:3,row:3,index:game=>{if(game.facingEvent()&&game.facingEvent().exit){return(game.moving?game.frameIndex:0)}
if(game.furtherEvent()&&game.furtherEvent().exit){return(game.moving?game.frameIndex:0)+4}
return 0},hidden:game=>{if(!game.situation.monsterLetOut){return!0}
if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().exit){return!1}
if(game.furtherEvent()&&game.furtherEvent().exit){return!1}
return!0}},{src:ASSETS.EXIT_OUT,col:3,row:3,index:game=>{return 0},hidden:game=>{if(game.situation.monsterLetOut){return!0}
if(game.rotation%2!==0){return!0}
if(!game.situation.gateOpened||game.situation.gateClosed){return!0}
if(game.facingEvent()&&game.facingEvent().exit){return game.moving}
return!0},tip:game=>{return"There are several guards outside! Thankfully, they didn't notice me."},onClick:game=>{if(!game.battle){game.fadeToScene("outside",null,2000)}},},{src:ASSETS.EXIT_OUT,col:3,row:3,index:game=>{if(game.facingEvent()&&game.facingEvent().exit){return(game.moving?game.frameIndex:0)}
if(game.furtherEvent()&&game.furtherEvent().exit){return(game.moving?game.frameIndex:0)+4}
return 0},hidden:game=>{if(game.situation.monsterLetOut){return!0}
if(game.rotation%2!==0){return!0}
if(game.facingEvent()&&game.facingEvent().exit){return!1}
if(game.furtherEvent()&&game.furtherEvent().exit){return!1}
return!0}},{src:ASSETS.EXIT_GATE,col:3,row:3,index:game=>{if(game.facingEvent()&&game.facingEvent().exit){return(game.moving?game.frameIndex:0)}
return 0},hidden:game=>{if(game.rotation%2!==0){return!0}
if(game.situation.gateOpened){if(!game.situation.gateClosed||game.now-game.situation.gateClosed<1000||game.moving){return!0}}
if(game.facingEvent()&&game.facingEvent().exit){return!1}
return!0},},{src:ASSETS.GATE_OPEN,col:3,row:3,index:game=>{if(game.situation.gateClosed){const frame=Math.floor((game.now-game.situation.gateClosed)/100);return 8-Math.min(frame,8)}
const frame=Math.floor((game.now-game.situation.gateOpened)/100);return Math.min(frame,8)},hidden:game=>{if(game.rotation%2!==0||game.moving){return!0}
if(!game.situation.gateOpened){return!0}
if(game.facingEvent()&&game.facingEvent().exit){return!1}
return!0}},{name:"scanner",src:ASSETS.SCAN_CARD,col:1,row:2,index:game=>game.situation.gateOpened?1:0,offsetX:-1,combine:(item,game)=>{if(item==="access card"){game.useItem=null;game.playSound(SOUNDS.DRINK);if(!game.situation.gateOpened||game.situation.gateClosed){game.situation.gateClosed=0;game.situation.gateOpened=game.now}else{game.situation.gateClosed=game.now}
game.dialog=null;return!0}},hidden:game=>!game.facingEvent()||!game.facingEvent().exit||game.rotation%2!==0||game.moving,onClick:game=>{game.showTip("Looks like some kind of card reader.",null,null,{removeLock:!0})},},makeYupa(),{src:ASSETS.HOLE_IN_CEILING_BACK,hidden:game=>!game.sceneData.lookUp,onClick:game=>{game.sceneData.lookUp=0},},{src:ASSETS.HOLE_IN_CEILING_HOLE,hidden:game=>!game.sceneData.lookUp,onClick:game=>{game.fadeToScene("ceiling-maze",{door:'H'},1000,game=>{game.rotation=(game.rotation+4)%8})},},{src:ASSETS.HOLE_IN_CEILING_ROPE,hidden:game=>!game.sceneData.lookUp,},{src:ASSETS.LAB_MONSTER_BATTLE,col:3,row:3,offsetX:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-.5)*Math.min(10,200/hitTime)):0},offsetY:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-1)*Math.min(10,200/hitTime)):0},index:({now,battle,data})=>{if(!battle||data.gameOver){return 0}
const hitTime=Math.max(1,now-battle.playerAttackLanded);if(hitTime<400){return 9}
if(battle.foeBlock&&now-battle.foeBlock<200){return 8}
if(now>battle.nextAttack){return 4+Math.floor((now-battle.nextAttack)/100)%4}
return Math.floor(now/200)%4},hidden:({battle,now})=>{if(!battle||battle.foe!=="lab-monster"){return!0}
return battle.foeDefeated&&Math.min(16,11+Math.floor((now-battle.foeDefeated)/60))>=17},combine:(item,game)=>{return!0},},makeFoe('guard',ASSETS.GUARD_2),...standardBattle(),...standardMenu(),...standardBag(),],...makeOnSceneBattle(),onSceneRefresh:game=>{if(!game.getSituation("lab").shotTank||game.waitCursor){return}
const frame=Math.floor((game.now-game.sceneTime)/100);if(game.situation.monsterLetOut||frame<130&&game.situation.monsterSide!=="right-left"||game.sceneData.labMonsterBattle){return}
if(game.rotation!==2&&game.situation.monsterSide!=="right-left"){if(!game.sceneData.turning){game.waitCursor=!0;game.sceneData.turning=game.now;game.sceneData.lookUp=0;if(game.rotation===4||game.rotation===6){game.turnLeft(game.now,game=>{if(game.rotation!==2){game.turnLeft(game.now,game=>{game.waitCursor=!1})}else{game.waitCursor=!1}})}else if(game.rotation===0){game.turnRight(game.now,game=>{game.waitCursor=!1})}}
return}
const{data,now}=game;game.sceneData.labMonsterBattle=now;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe:"lab-monster",fist:LEFT,attackSpeed:4000,playerHit:0,playerBlock:0,foeBlockChance:1,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife:100,invincible:!0,foeMaxLife:100,foeBlock:0,foeDefense:10,foeDefeated:0,attackPeriod:60,riposteChance:.2,foeDamage:25,xp:0,belowTheBelt:!1,noBlock:!0,battleCry:SOUNDS.EAT,}}},doors:{},events:{'E':{exit:!0,blocking:!0,wall:!0,showBag:!0,onEvent:(game,events)=>{},},'L':{lab:!0,hideYupa:!0,blocking:!0,showBag:!0,onEvent:(game,event)=>{const{yupa}=game.data;if(yupa){yupa.rotation=(game.rotation+4)%8}},},'C':{ceilinghole:!0,noMenu:!0,onEvent:(game,event)=>{},},'8':{foe:"guard",foeLife:150,foeBlockChance:.7,attackSpeed:5000,riposteChance:.6,attackPeriod:100,foeDamage:9,foeDefense:10,xp:10,belowTheBelt:!1,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt})=>{if(game.getSituation("lab").shotTank){return}
const{data,now}=game;game.chest=null;const theme=data.theme?data.theme.song:null;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,theme,}}
return!0},onWin:game=>game.findChest(game.now+2000,{item:"bullet",image:ASSETS.GRAB_GUN,message:"I found one bullet for my gun.",hideFromInventory:!0,}),},},},);game.addScene({name:"final-credit",onScene:game=>{getMedal("NOBLE ENDING");game.playTheme(SOUNDS.SOFT_THEME,{volume:.8});game.hideCursor=!0;game.sceneData.credits=`${game.title||" Where in Space is\n  BABY HITLER?"}



				A game from
				DOBUKI STUDIO
				by
				Jack Le Hamster

				Coded in JavaScript
				with Sublime Text

				Art made with Piskel

				Music made with BeepBox

				Sound effects made with VoiceChanger.io and Brfx

				Music covers:
				“La Soupe aux Choux”
				(Raymond Lefevre)

				This game is a sequel to “Kill Baby Hitler”. The first part of this game was released for
				#LOWREZJAM\n2019\nas “Escape from Labbyrithe”.

				I worked more on this game to continue the story, until the point where you reach Baby Hitler.
				
				Of course, you didn't reach Baby Hitler since you weaseled out.

				(I'm kidding, it was the noble thing to do.)

				Anyway, thanks for playing.

				Please make sure to follow my games, share them, and say great things about them to your family and friends.

				You have finished the game, with
				NOBLE ENDING.

				Humanity has been spared Hitler, thanks to you.

				The course of mankind has been altered.

				For better or worst?

				Who knows...

				Have a nice day!
			`.split("\n").map((a,index)=>index>2?game.wordwrap(a.trim(),9):a).join("\n").split("\n")},onSceneRefresh:game=>{const shift=-(game.now-game.sceneTime)/200+50;if(game.sceneData.credits.length*6+shift<10){if(!game.sceneData.showYupa){game.sceneData.showYupa=game.now}}},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle=`#000000`;ctx.fillRect(0,0,64,64)},},{src:ASSETS.YUPA_DANCE,col:4,row:4,scale:game=>Math.min(1,Math.pow(Math.max(.01,game.now-game.sceneData.showYupa)/5000,2)),offsetX:(game,{scale})=>32-32*game.evaluate(scale),offsetY:(game,{scale})=>32-32*game.evaluate(scale),index:(game,{scale})=>{const{dialog,now,pendingTip,moving}=game;if(pendingTip&&pendingTip.talker==="yupa"){return 8+(pendingTip.progress<1?Math.floor(now/100)%3:0)}
return game.evaluate(scale)<1?Math.floor(now/120)%4+12:0},onRefresh:(game,{scale})=>{if(!game.sceneData.yupaTalk&&game.evaluate(scale)>=1){game.playSound(SOUNDS.YUPA);game.sceneData.yupaTalk=game.now;game.showTip(["Hey, ya still here!","Im glad ya stuck arownd","I know ya feel good abowt yarself","Ya made the nuble choize, saving mankind","Yadi yada","Letz be real. Ya curius abowt findin Baby Hitler, rite?","Juz hit dat tryagain buttun and letz go find da baby, for goat steak!!!",],game=>{game.gameOver(" ")},null,{talker:"yupa",})}},hidden:game=>!game.sceneData.showYupa,},{custom:(game,sprite,ctx)=>{const shift=-(game.now-game.sceneTime)/200+50;game.sceneData.credits.forEach((line,index)=>{const y=index*6+shift;if(y>0&&y<55){game.displayTextLine(ctx,{msg:line,x:1,y:Math.round(y),alpha:Math.max(0.05,Math.min(.8,y/5,(55-y)/5)),})}})},},],},);game.addScene({name:"final-doom",onScene:game=>{game.playTheme(null);game.hideCursor=!0;game.showTip(["This time, they let me go for real.","I close my eyes, and waited to fade away.","Turns out, it wasn't painful at all.","That drug to simulate death was just a scam.","As my spirit fades away","I felt ...","absolutely\nNOTHING.",],game=>{game.gotoScene("final-credit")},100,{maxLines:10})},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle=`#000000`;ctx.fillRect(0,0,64,64)},},],},);game.addScene({name:"final-exit",arrowGrid:[[null,null,MENU,null,null],[null,null,s(4),null,null],[null,null,s(4),null,null],[null,null,s(4),null,null],[null,null,BAG,null,null],],onScene:game=>{game.save();game.startDialog({time:game.now,index:0,conversation:[{message:"",options:[{},{msg:"LEAVE",onSelect:game=>{const fadeDuration=1000;game.fadeOut(game.now,{duration:fadeDuration*1.5,fadeDuration,color:"#000000",onDone:game=>{game.gotoScene("maze-4",{door:2})}})}},],},],})},onSceneRefresh:game=>{if(!game.sceneData.forwardUnlocked&&game.situation.openGate&&(game.situation.openGate-game.now)/1000<-15){game.sceneData.forwardUnlocked=game.now}},onSceneForward:game=>{if(!game.sceneData.clickedExit){game.hideCursor=!0;game.sceneData.clickedExit=!0;const fadeDuration=3000;game.fadeOut(game.now,{duration:fadeDuration*1.5,fadeDuration,color:"#FFFFFF",onDone:game=>{game.gotoScene("congrats")}})}},sprites:[{src:ASSETS.OUTDOOR,hidden:game=>!game.situation.openGate,},{src:ASSETS.GATE,offsetY:game=>!game.situation.openGate?0:Math.max(-20,(game.situation.openGate-game.now)/1000),},{src:ASSETS.FINAL_EXIT,},{name:"scanner",src:ASSETS.SCAN_CARD,col:1,row:2,combine:(item,game)=>{if(item==="access card"){game.useItem=null;game.playSound(SOUNDS.DRINK);game.situation.openGate=game.now;game.dialog=null;return!0}},},{src:ASSETS.SPEECH_OUT,offsetY:9,hidden:game=>game.situation.openGate||game.bagOpening||game.useItem||game.pendingTip,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/80)),},...standardMenu(),...standardBag(),],},);game.addScene({name:"final-fight",arrowGrid:[[null,null,null,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onScene:game=>{game.hideCursor=!0;game.playTheme(null);game.delayAction(game=>{game.hideCursor=!1;game.playTheme(SOUNDS.BATTLE_THEME);game.sceneData.battleStarted=game.now},1000);game.sceneData.shift=-32;game.useItem="gun";game.sceneData.showLifebar=!0;game.sceneData.actionScequence=game.now},onSceneRefresh:game=>{if(!game.sceneData.bossEntering){if(game.mouse&&game.mouse.x>64-5||game.actionDown===RIGHT){game.sceneData.shift-=.3;game.sceneData.shift=Math.max(-64,Math.min(0,game.sceneData.shift))}else if(game.mouse&&game.mouse.x<5||game.actionDown===LEFT){game.sceneData.shift+=.3;game.sceneData.shift=Math.max(-64,Math.min(0,game.sceneData.shift))}
if(game.now-game.sceneTime>30000){game.sceneData.bossEntering=game.now;game.playSound(SOUNDS.WELCOME_TO_YOUR_DOOM)}}else if(Math.abs(game.sceneData.shift- -32)>1){game.sceneData.shift+=(-32-game.sceneData.shift)/10}else{game.sceneData.shift=-32}},customCursor:(game,ctx)=>{if(game.mouse&&!game.sceneData.bossEntering){const{x,y}=game.mouse;if(x>64-5&&game.sceneData.shift>-64){game.displayImage(ctx,{src:ASSETS.ARROW_CURSOR,offsetX:x-5,offsetY:y-5,size:[11,11],col:1,row:2,index:1});return"none"}else if(x<5&&game.sceneData.shift<0){game.displayImage(ctx,{src:ASSETS.ARROW_CURSOR,offsetX:x-5,offsetY:y-5,size:[11,11],col:1,row:2,index:0});return"none"}}},checkBossEntrance:(game)=>{if(game.sceneData.shotLeft2nd&&game.sceneData.shotRight2nd&&game.sceneData.shotCenter2nd){if(!game.sceneData.bossEntering){game.sceneData.bossEntering=game.now;game.playSound(SOUNDS.WELCOME_TO_YOUR_DOOM)}}},sprites:[{custom:(game,sprite,ctx)=>{ctx.clearRect(0,0,64,64)},},{src:ASSETS.SHOOT_OUT,size:[128,64],col:3,row:8,offsetX:game=>Math.round(game.sceneData.shift),},{src:game=>game.sceneData.left2nd?ASSETS.SHOOT_OUT_2:ASSETS.SHOOT_OUT,size:[128,64],col:3,row:8,side:LEFT,offsetX:game=>Math.round(game.sceneData.shift),period:100,frames:[1,2,3,3,4,3,3,3,3,3,2,1,-1],index:(game,sprite)=>{if(!game.sceneData.leftShooter){return-1}
if(game.sceneData.leftShot){const time=game.now-game.sceneData.leftShot;const index=Math.floor(time/150);return index<2?5+index:-1}
const time=game.now-game.sceneData.leftShooter;const index=Math.floor(time/sprite.period);return sprite.frames[Math.min(sprite.frames.length-1,index)]},onRefresh:(game,sprite)=>{if(!game.sceneData.leftShooter){if(!game.sceneData.nextLeftShooter||game.now>game.sceneData.nextLeftShooter){if(!game.sceneData.bossEntering){game.sceneData.leftShooter=game.now}}}else if(game.sceneData.leftShooter){const time=game.now-game.sceneData.leftShooter;const frame=Math.floor(time/sprite.period);if(frame>=sprite.frames.length){game.sceneData.leftShooter=0;game.sceneData.nextLeftShooter=game.now+1000+Math.random()*4000}else{const frameId=game.evaluate(sprite.index,sprite);if(frameId===1){game.sceneData.leftDidShoot=0}
if(frameId===4&&!game.sceneData.leftDidShoot){game.playSound(SOUNDS.GUN_SHOT);game.sceneData.leftDidShoot=game.now;game.damagePlayer(10)}}}},onShot:(game,sprite)=>{if(!game.sceneData.leftShot){game.sceneData.leftShot=game.now;if(!game.sceneData.left2nd){game.delayAction(game=>{game.sceneData.left2nd=game.now;game.sceneData.leftShot=0},5000+5000+Math.random())}else if(!game.sceneData.shotLeft2nd){game.sceneData.shotLeft2nd=game.now;game.currentScene.checkBossEntrance(game)}}},hidden:game=>!game.sceneData.battleStarted,},{src:game=>game.sceneData.right2nd?ASSETS.SHOOT_OUT_2:ASSETS.SHOOT_OUT,size:[128,64],col:3,row:8,side:RIGHT,offsetX:game=>Math.round(game.sceneData.shift),period:100,frames:[1,2,3,3,4,3,3,3,3,3,2,1,-1],index:(game,sprite)=>{if(!game.sceneData.rightShooter){return-1}
if(game.sceneData.rightShot){const time=game.now-game.sceneData.rightShot;const index=Math.floor(time/150);return index<2?5+index:-1}
const time=game.now-game.sceneData.rightShooter;const index=Math.floor(time/sprite.period);return sprite.frames[Math.min(sprite.frames.length-1,index)]},onRefresh:(game,sprite)=>{if(!game.sceneData.rightShooter){if(!game.sceneData.nextRightShooter||game.now>game.sceneData.nextRightShooter){if(!game.sceneData.bossEntering){game.sceneData.rightShooter=game.now}}}else if(game.sceneData.rightShooter){const time=game.now-game.sceneData.rightShooter;const frame=Math.floor(time/sprite.period);if(frame>=sprite.frames.length){game.sceneData.rightShooter=0;game.sceneData.nextRightShooter=game.now+1000+Math.random()*4000}else{const frameId=game.evaluate(sprite.index,sprite);if(frameId===1){game.sceneData.rightDidShoot=0}
if(frameId===4&&!game.sceneData.rightDidShoot){game.playSound(SOUNDS.GUN_SHOT);game.sceneData.rightDidShoot=game.now;game.damagePlayer(10)}}}},onShot:(game,sprite)=>{if(!game.sceneData.rightShot){game.sceneData.rightShot=game.now;if(!game.sceneData.right2nd){game.delayAction(game=>{game.sceneData.right2nd=game.now;game.sceneData.rightShot=0},5000+5000+Math.random())}else if(!game.sceneData.shotRight2nd){game.sceneData.shotRight2nd=game.now;game.currentScene.checkBossEntrance(game)}}},hidden:game=>!game.sceneData.battleStarted,},{src:game=>game.sceneData.center2nd?ASSETS.SHOOT_OUT_2:ASSETS.SHOOT_OUT,size:[128,64],col:3,row:8,offsetX:game=>Math.round(game.sceneData.shift),period:150,frames:[7,7,7,8,9,-1],index:(game,sprite)=>{if(!game.sceneData.centerMoving){return-1}
const time=game.now-game.sceneData.centerMoving;const index=Math.floor(time/sprite.period);return sprite.frames[Math.min(sprite.frames.length-1,index)]},onRefresh:(game,sprite)=>{if(game.sceneData.centerMoving){const time=game.now-game.sceneData.centerMoving;const index=Math.floor(time/sprite.period);if(index>=sprite.frames.length){game.sceneData.centerShooterReady=game.now}}else{game.sceneData.centerMoving=game.now}},hidden:game=>!game.sceneData.battleStarted||game.sceneData.centerShooterReady,},{src:game=>game.sceneData.center2nd?ASSETS.SHOOT_OUT_2:ASSETS.SHOOT_OUT,size:[128,64],col:3,row:8,offsetX:game=>Math.round(game.sceneData.shift),period:100,frames:[10,11,12,12,13,12,12,12,12,12,11,10,-1],index:(game,sprite)=>{if(!game.sceneData.centerShooter){return-1}
if(game.sceneData.centerShot){const time=game.now-game.sceneData.centerShot;const index=Math.floor(time/150);return index<2?14+index:-1}
const time=game.now-game.sceneData.centerShooter;const index=Math.floor(time/sprite.period);return sprite.frames[Math.min(sprite.frames.length-1,index)]},onRefresh:(game,sprite)=>{if(!game.sceneData.centerShooter){if(!game.sceneData.nextCenterShooter||game.now>game.sceneData.nextCenterShooter){if(!game.sceneData.bossEntering){game.sceneData.centerShooter=game.now}}}else if(game.sceneData.centerShooter){const time=game.now-game.sceneData.centerShooter;const frame=Math.floor(time/sprite.period);if(frame>=sprite.frames.length){game.sceneData.centerShooter=0;game.sceneData.nextCenterShooter=game.now+1000+Math.random()*4000}else{const frameId=game.evaluate(sprite.index,sprite);if(frameId===10){game.sceneData.centerDidShoot=0}
if(frameId===13&&!game.sceneData.centerDidShoot){game.playSound(SOUNDS.GUN_SHOT);game.sceneData.centerDidShoot=game.now;game.damagePlayer(10)}}}
game.sceneData.centerMoving=0},onShot:(game,sprite)=>{if(!game.sceneData.centerShot){game.sceneData.centerShot=game.now;if(!game.sceneData.center2nd){game.delayAction(game=>{game.sceneData.center2nd=game.now;game.sceneData.centerShooterReady=0;game.sceneData.centerShot=0},5000+5000+Math.random())}else if(!game.sceneData.shotCenter2nd){game.sceneData.shotCenter2nd=game.now;game.currentScene.checkBossEntrance(game)}}},hidden:game=>!game.sceneData.battleStarted||!game.sceneData.centerShooterReady,},{src:ASSETS.SHOOT_OUT,size:[128,64],col:3,row:8,offsetX:game=>Math.round(game.sceneData.shift),period:150,frames:[16,17,18,19,20,21,22],index:(game,sprite)=>{const time=game.now-game.sceneData.bossEntering;const index=Math.floor(time/sprite.period);return sprite.frames[Math.min(sprite.frames.length-1,index)]},hidden:game=>!game.sceneData.battleStarted||!game.sceneData.bossEntering||game.data.battle,onRefresh:(game,sprite)=>{if(!game.data.battle){const frame=game.evaluate(sprite.index,sprite);if(frame===22){const foeLife=1000;game.data.battle={time:game.now,foe:"boss",fist:LEFT,attackSpeed:1500,playerHit:0,playerBlock:0,foeBlockChance:.8,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:45,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense:12,foeDefeated:0,attackPeriod:100,riposteChance:.6,foeDamage:10,preventEscape:!0,gunDamage:200,nextAttack:game.now,onWin:game=>{game.sceneData.defeatedBoss=game.now;game.fadeToScene("ending")},xp:0,belowTheBelt:!1,theme:"none",}}}},},{src:ASSETS.GANGSTA_FIGHTER,col:4,row:4,offsetX:({now,battle,sceneData})=>{const hitTime=Math.max(1,now-(battle.playerAttackLanded||0));return 5+32+Math.round(sceneData.shift)+(hitTime<500?Math.round((Math.random()-.5)*Math.min(10,200/hitTime)):0)},offsetY:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-1)*Math.min(10,200/hitTime)):0},index:({now,battle,data})=>{if(!battle||data.gameOver){return 0}
if(battle.foeDefeated){return Math.min(15,9+Math.floor((now-battle.foeDefeated)/100))}
const hitTime=Math.max(1,now-battle.playerAttackLanded);if(hitTime<400){return 9}
if(battle.foeBlock&&now-battle.foeBlock<200){return 8}
if(now>battle.nextAttack){return 4+Math.floor((now-battle.nextAttack)/100)%4}
return Math.floor(now/200)%4},hidden:({battle,now})=>!battle||battle.foe!='boss'||battle.foeDefeated&&now-battle.foeDefeated>=2000,onShot:(game,sprite)=>{const{battle,data}=game;if(!battle.invincible){game.damageFoe(100,{shot:!0})}},combine:(item,game)=>{if(game.battle){game.battle.nextAttack=Math.min(game.now+3000,game.battle.nextAttack)}
if(item==="gun"){game.showTip("I'm out of ammo.",null,50,{removeLock:!0})}else if(item==="photo"){game.playSound(SOUNDS.HUM);game.showTip("Have you seen this baby?",null,50,{removeLock:!0})}else{game.playSound(SOUNDS.HUM);game.showTip(`Would you like this ${item}?`,null,50,{removeLock:!0})}
return!0},},{custom:(game,sprite,ctx)=>{const fade=1-Math.min(1,(game.now-game.sceneTime)/1000);const imageData=ctx.getImageData(0,0,64,64);for(let i=0;i<imageData.data.length;i+=4){if(Math.random()<fade){imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255;imageData.data[i+3]=255}}
ctx.putImageData(imageData,0,0)},hidden:game=>game.now-game.sceneTime>1000,},...standardBattle(),...standardBag(),],...makeOnSceneBattle(),},);game.addScene({name:"final-planet-world",arrowGrid:[[null,null,MENU,null,null],[],[null,null,null,null,null],[null,s(7),s(7),s(7),null],[null,s(7),BAG,s(7),null],],onScene:game=>{game.save();game.playTheme(SOUNDS.MYSTICA_THEME,{volume:.6});if(!game.situation.firstStep){game.situation.firstStep=game.now;game.pos={x:0,y:0}}
game.sceneData.forwardUnlocked=!0;game.sceneData.freeFormMove=!0;game.sceneData.finalTarget={x:230,y:-350};game.sceneData.nextFoe=100;game.sceneData.anim=[[12,13,14,15],[16,17,18,19],[24,25,26,27],[4,5,6,7],[0,1,2,3],[8,9,10,11],[28,29,30,31],[20,21,22,23],]},onEscapeBattle:game=>{game.battle=null;game.playTheme(null);game.sceneData.escaping=game.now;for(let i=0;i<5;i++){game.delayAction(game=>{game.playSound(SOUNDS.HIT,{volume:.3})},150*i+1)}
game.delayAction(game=>{game.playTheme(SOUNDS.MYSTICA_THEME,{volume:.6})},2000)},onSceneRefresh:game=>{if(game.sceneData.leavingScene){return}
if(game.sceneData.escaping&&game.now-game.sceneData.escaping<2000){const angle=game.rotation/8*Math.PI*2;const rx=Math.cos(angle),ry=Math.sin(angle);const speed=.2*(1-(game.now-game.sceneData.escaping)/2000);game.pos.x+=speed*ry;game.pos.y+=-speed*rx;return}
if(game.mouseDown&&!game.dialog&&!game.pendingTip){if(!game.hoverSprite||game.hoverSprite.allowMove){const{mouse,pos}=game;const mx=mouse.x-32;const my=mouse.y-50;if(mx&&game.canTurn(mx<0?"left":"right")){game.rotation-=mx*.002;game.rotation=(game.rotation+8)%8}
if(my&&game.canMove(pos,my<0?-1:+1)){const angle=game.rotation/8*Math.PI*2;const rx=Math.cos(angle),ry=Math.sin(angle);const mov=Math.max(-.1,Math.min(.1,my*.010));game.pos.x+=mov*ry;game.pos.y+=-mov*rx;game.sceneData.nextFoe-=Math.abs(mov);if(game.sceneData.nextFoe<0){const monsters=["m","b"];game.triggerEvent(monsters[Math.floor(Math.random()*monsters.length)]);game.sceneData.nextFoe=10+Math.random()*200}}}}},onSceneForward:game=>{return!0},onSceneBackward:game=>{return!0},onSceneRotate:(game,arrow)=>{return!0},getTemplate:(game,x,y,scaleMul)=>{const{pos}=game;const angle=game.rotation/8*Math.PI*2;const rx=Math.cos(angle),ry=Math.sin(angle);const absoluteDx=x-pos.x;const absoluteDy=y-pos.y;const dx=rx*absoluteDx+ry*absoluteDy;const dy=ry*absoluteDx-rx*absoluteDy+2;const scale=(scaleMul||1)*Math.pow(2,dy);return{scale,dx,dy}},sprites:[{src:ASSETS.FINAL_PLANET,col:1,row:2,index:1,offsetX:game=>64*(game.rotation%2)+128,},{src:ASSETS.FINAL_PLANET,col:1,row:2,index:1,offsetX:game=>64*(game.rotation%2)+64,},{src:ASSETS.FINAL_PLANET,col:1,row:2,index:1,offsetX:game=>64*(game.rotation%2),},{src:ASSETS.FINAL_PLANET,col:1,row:2,index:1,offsetX:game=>64*(game.rotation%2)-64,},{src:ASSETS.FINAL_PLANET,col:1,row:2,index:1,offsetX:game=>64*(game.rotation%2)-128,},{moonX:0,moonY:-1000,closeDist:200,custom:(game,sprite,ctx)=>{const[moonX,moonY]=[sprite.moonX-game.pos.x,sprite.moonY-game.pos.y];const dist=Math.sqrt(moonX*moonX+moonY*moonY);const size=5*1000/dist;const outline=size/5*7;const rot=game.rotation-4;ctx.fillStyle="#ffffff11";ctx.beginPath();ctx.arc(20+rot*64,20,outline,0,2*Math.PI);ctx.fill();ctx.fillStyle="#ffffff";ctx.beginPath();ctx.arc(20+rot*64,20,size,0,2*Math.PI);ctx.fill();if(dist<sprite.closeDist){ctx.fill();ctx.fillStyle="#000000cc";ctx.fillRect(31,17,2,4)}},onRefresh:(game,sprite)=>{const{sceneData,now}=game;const[moonX,moonY]=[sprite.moonX-game.pos.x,sprite.moonY-game.pos.y];const dist=Math.sqrt(moonX*moonX+moonY*moonY);if(!sceneData.moonLand&&dist<sprite.closeDist){sceneData.moonLand=now;game.hideCursor=!0}},},{src:ASSETS.MOUNTAINS,col:1,row:2,offsetY:-24,alpha:.6,index:0,offsetX:game=>{const rot=game.rotation;return 64*((rot+4)%8-4)-64}},{src:ASSETS.MOUNTAINS,col:1,row:2,offsetY:-24,alpha:.6,index:1,offsetX:game=>{const rot=game.rotation;return 64*((rot+5)%8-4)-64}},{custom:(game,sprite,ctx)=>{const{pos}=game;const{x,y}=pos;const ddx=game.sceneData.finalTarget.x-x;const ddy=game.sceneData.finalTarget.y-y;const dist=Math.sqrt(ddx*ddx+ddy*ddy);if(dist<100){ctx.globalAlpha=Math.min(.5,sprite.base/Math.max(0.0001,dist));ctx.fillStyle="#009900";ctx.fillRect(0,40,64,24);ctx.globalAlpha=1}},base:2,},{init:game=>{},getTileIndex:(game,x,y)=>{const ddx=game.sceneData.finalTarget.x-x;const ddy=game.sceneData.finalTarget.y-y;const dist=ddx*ddx+ddy*ddy;if(dist<3600){if(dist<2500&&(Math.abs(ddx)<=.5||Math.abs(ddy)<=.5||Math.abs(Math.abs(ddx)-Math.abs(ddy))<=.5)){return 9}
return Math.abs(Math.floor((Math.sin(x)+Math.cos(y))*1000000))%2+10}
const rand=Math.abs(Math.floor((Math.sin(x)+Math.cos(y))*1000000))%17;return rand<9?rand:-1},displayTemplate:{src:ASSETS.CRATER,col:3,row:4,},custom:(game,sprite,ctx)=>{const{pos}=game;const{displayTemplate}=sprite;const angle=game.rotation/8*Math.PI*2;const rx=Math.cos(angle),ry=Math.sin(angle);for(let y=Math.floor(pos.y-5);y<pos.y+5;y++){for(let x=Math.floor(pos.x-5);x<pos.x+5;x++){const index=sprite.getTileIndex(game,x,y);if(index<=11){const absoluteDx=x-pos.x;const absoluteDy=y-pos.y;const dx=rx*absoluteDx+ry*absoluteDy;const dy=ry*absoluteDx-rx*absoluteDy+2;if(dy<-3.5&&index!==9){continue}
if(dy<2&&dy>-5){const mul=index===9?5:(index>=10?2:1);const scale=Math.pow(2,dy);displayTemplate.index=index;displayTemplate.alpha=scale*mul;displayTemplate.scale=scale/2*mul;displayTemplate.offsetX=32-32*displayTemplate.scale+scale*dx*10*5;displayTemplate.offsetY=40-32*displayTemplate.scale+scale*10;game.displayImage(ctx,displayTemplate)}}}}},},{src:ASSETS.HITMAN_WALK,size:[16,32],col:6,row:6,offsetX:(game,{scale})=>{return 31-10*game.evaluate(scale)},offsetY:(game,{scale})=>{return 22+40*game.evaluate(scale)},index:game=>{const anim=game.sceneData.anim;const animation=game.getAnimation(0,-1);const frame=!0?Math.floor(game.now/100)%4:0;return anim[animation][frame]},scale:game=>{const timeArrive=20000;const time=game.now-game.sceneData.moonLand;return Math.max(.001,1-Math.sqrt(time/timeArrive))},onRefresh:game=>{const time=game.now-game.sceneData.moonLand;if(time>25000){game.gotoScene("creator")}},hidden:game=>!game.sceneData.moonLand,},{src:ASSETS.YUPA_BACK_WALK,offsetX:(game,{scale})=>{return 31+3*game.evaluate(scale)},offsetY:(game,{scale})=>{return 25+40*game.evaluate(scale)},index:game=>!0?Math.floor(game.now/100)%4:0,scale:game=>{const timeArrive=20000;const time=game.now-game.sceneData.moonLand;return Math.max(.001,1-Math.sqrt(time/timeArrive))*.7},hidden:game=>!game.sceneData.moonLand,},{src:ASSETS.SPACESHIP,col:1,row:2,scale:game=>game.sceneData.spaceshipTemplate?game.sceneData.spaceshipTemplate.scale/2:1,offsetX:game=>{const{dx,dy,scale}=game.sceneData.spaceshipTemplate;return 32-32*scale/2+scale*dx*10*5},offsetY:game=>{const{dx,dy,scale}=game.sceneData.spaceshipTemplate;return 40-32*scale/2+scale*(10-5)},onRefresh:game=>{game.sceneData.spaceshipTemplate=game.currentScene.getTemplate(game,0,1)},init:(game,sprite)=>{sprite.onRefresh(game,sprite)},index:game=>{const{dx,dy,scale}=game.sceneData.spaceshipTemplate;return dy>=2?-1:0},tip:"We landed in the middle of nowhere!",hidden:game=>game.battle,allowMove:!0,},{src:ASSETS.PLANET_ITEMS,col:4,row:4,size:[128,128],scale:game=>game.sceneData.signTemplate.scale/2,offsetX:game=>{const{dx,dy,scale}=game.sceneData.signTemplate;return 32-64*scale/2+scale*dx*10*5},offsetY:game=>{const{dx,dy,scale}=game.sceneData.signTemplate;return 40-64*scale/2+scale*(10-30)},getLocation:(game,x,y)=>{return[Math.round(x/20)*20,Math.round((y-5)/20)*20+5]},onRefresh:(game,sprite)=>{const{pos}=game;const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);game.sceneData.signTemplate=game.currentScene.getTemplate(game,xLoc,yLoc)},init:(game,sprite)=>{sprite.onRefresh(game,sprite)},index:game=>{const{dx,dy,scale}=game.sceneData.signTemplate;return dy>=2?-1:0},tip:(game,sprite)=>{const{pos}=game;if(!pos){return}
const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);const dx=game.sceneData.finalTarget.x-xLoc;const dy=game.sceneData.finalTarget.y-yLoc;return `“Westrow tavern is ~${Math.abs(dx)}m~ ~${dx<0?"West":"East"}~ and ~${Math.abs(dy)}m~ ~${dy<0?"South":"North"}~ from here”`},hidden:game=>game.battle,allowMove:!0,},{src:ASSETS.PLANET_ITEMS,col:4,row:4,size:[128,128],scale:game=>game.sceneData.nomadTemplate?game.sceneData.nomadTemplate.scale/2:1,offsetX:game=>{const{dx,dy,scale}=game.sceneData.nomadTemplate;return 32-64*scale/2+scale*dx*10*5},offsetY:game=>{const{dx,dy,scale}=game.sceneData.nomadTemplate;return 40-64*scale/2+scale*(10-30)},onRefresh:(game,sprite)=>{const{pos}=game;const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);game.sceneData.nomadTemplate=game.currentScene.getTemplate(game,xLoc,yLoc)},init:(game,sprite)=>{sprite.onRefresh(game,sprite);if(!game.situation.talkedAbout){game.situation.talkedAbout={}}
if(!game.sceneData.seenNomad){game.sceneData.seenNomad={}}},index:game=>{const{dx,dy,scale}=game.sceneData.nomadTemplate;return dy>=2?-1:1},getLocation:(game,x,y)=>{return[Math.round((x-10)/23)*23+10,Math.round((y-5)/23)*23+5]},hidden:(game,sprite)=>{const{pos}=game;if(!game.sceneData.nomadTemplate||game.battle){return!0}
if(!pos){return!1}
const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);return game.sceneData.seenNomad[`${xLoc}_${yLoc}`]},noHighlight:(game,sprite)=>{const{pos}=game;const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);return(Math.abs(x-xLoc)>=1.5||Math.abs(y-yLoc)>=1.5)},onClick:(game,sprite)=>{if(game.evaluate(sprite.noHighlight,sprite)){return}
const moonMessages=[["That bright shiny object is the sky is Westrow's moon.","You can see it by looking south.",],["You can use the moon for direction.","Or, if you have a compass, it's a bit easier.",],["Something's odd about that moon in the south...",],["The moon aways faces south from this point.",],["As you get closer, the moon tends to get very large...",],];game.pendingTip=null;game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Ask direction",onSelect:game=>{game.showTip([`You are currently facing ${game.getOrientationText()}.`,],null,null,{removeLock:!0})},},{msg:"Ask info...",onSelect:game=>{game.dialog.index ++}},{msg:"LEAVE",onSelect:game=>{game.dialog=null}},],},{options:[{msg:"The moon...",onSelect:game=>{if(game.dialog.moonTalk===undefined){game.dialog.moonTalk=(game.situation.moonTalk||0);game.situation.moonTalk=(game.dialog.moonTalk+1)%moonMessages.length}
game.showTip(moonMessages[game.dialog.moonTalk],game=>{},null,{removeLock:!0})},},{msg:"Nomads...",hidden:game=>game.situation.talkedAbout.tavern,onSelect:game=>{game.showTip(["Us nomads roam around Westrow's desert.","Other humans gather around a village near Westrow's tavern.",],game=>{const{pos}=game;const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);game.sceneData.seenNomad[`${xLoc}_${yLoc}`]=game.now;game.situation.talkedAbout.tavern=game.now},null,{removeLock:!0});game.dialog=null},},{msg:"The Tavern...",hidden:game=>!game.situation.talkedAbout.tavern||game.situation.talkedAbout.password,onSelect:game=>{game.showTip(["You can't get inside Westrow's tavern without the password.","Unfortunately I don't know it.",],game=>{const{pos}=game;const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);game.sceneData.seenNomad[`${xLoc}_${yLoc}`]=game.now;game.situation.talkedAbout.password=game.now},null,{removeLock:!0});game.dialog=null},},{msg:"Tavern Password",hidden:game=>!game.situation.talkedAbout.password||game.situation.talkedAbout.blackCloth,onSelect:game=>{game.showTip(["I don't know the password.","I think one of the nomads does though.","He likes to dress in a pitch black cloth.",],game=>{const{pos}=game;const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);game.sceneData.seenNomad[`${xLoc}_${yLoc}`]=game.now;game.situation.talkedAbout.blackCloth=game.now},null,{removeLock:!0});game.dialog=null},},{msg:"Black cloth nomad",hidden:game=>!game.situation.talkedAbout.blackCloth,onSelect:game=>{game.showTip([`I think I've seen him, near the tavern.`,"He usually hangs around there.",],game=>{const{pos}=game;const{x,y}=pos;const[xLoc,yLoc]=sprite.getLocation(game,x,y);game.sceneData.seenNomad[`${xLoc}_${yLoc}`]=game.now},null,{removeLock:!0});game.dialog=null},},{msg:"Where are we?",onSelect:game=>{game.showTip(["This is the wasteland of Westrow.","It's also the game scene with the most buggy implementation.","You gotta forgive the creator...",],null,null,{removeLock:!0})},},{msg:"Back",onSelect:game=>{game.dialog.index --},},],},],})},allowMove:!0,},{src:ASSETS.PLANET_ITEMS,col:4,row:4,size:[128,128],scale:game=>game.sceneData.treeTemplate?game.sceneData.treeTemplate.scale/2:1,offsetX:game=>{const{dx,dy,scale}=game.sceneData.treeTemplate;return 32-64*scale/2+scale*dx*10*5},offsetY:game=>{const{dx,dy,scale}=game.sceneData.treeTemplate;return 40-64*scale/2+scale*(10-30)},onRefresh:game=>{const{pos}=game;const{x,y}=pos;game.sceneData.treeTemplate=game.currentScene.getTemplate(game,Math.round((x)/30)*30,Math.round((y-15)/30)*30+15)},init:(game,sprite)=>{sprite.onRefresh(game,sprite)},index:game=>{const{dx,dy,scale}=game.sceneData.treeTemplate;return dy>=2?-1:6},allowMove:!0,},{src:ASSETS.GRAB_APPLE,scale:game=>game.sceneData.treeTemplate?game.sceneData.treeTemplate.scale/2:1,offsetX:game=>{const{dx,dy,scale}=game.sceneData.treeTemplate;return 32-64*scale/2+scale*(dx*10*5+10)},offsetY:game=>{const{dx,dy,scale}=game.sceneData.treeTemplate;return 40-64*scale/2+scale*(10-30)},onRefresh:game=>{const{pos}=game;const{x,y}=pos;game.sceneData.treeTemplate=game.currentScene.getTemplate(game,Math.round((x)/30)*30,Math.round((y-15)/30)*30+15)},init:(game,sprite)=>{sprite.onRefresh(game,sprite)},index:game=>{const{dx,dy,scale}=game.sceneData.treeTemplate;return dy>=2?-1:1},tip:"There's a fruit on that tree.",allowMove:!0,hidden:game=>{return game.sceneData.grabbedFruit&&game.now-game.sceneData.grabbedFruit<100000},onClick:game=>{game.sceneData.grabbedFruit=game.now;game.pickUp({item:"fruit?",image:ASSETS.GRAB_APPLE})},},{src:ASSETS.PLANET_ITEMS,col:4,row:4,size:[128,128],scale:game=>game.sceneData.fountainTemplate?game.sceneData.fountainTemplate.scale/4:1,offsetX:game=>{if(!game.sceneData.fountainTemplate){return 0}
const{dx,dy,scale}=game.sceneData.fountainTemplate;return 32-64*scale/2+scale*dx*10*5},offsetY:game=>{if(!game.sceneData.fountainTemplate){return 0}
const{dx,dy,scale}=game.sceneData.fountainTemplate;return 40-64*scale/2+scale*(10-5)},onRefresh:game=>{const{pos}=game;const{x,y}=pos;game.sceneData.fountainTemplate=game.currentScene.getTemplate(game,Math.round((x)/39)*39,Math.round((y-15)/39)*39+7)},init:(game,sprite)=>{sprite.onRefresh(game,sprite)},index:game=>{if(!game.sceneData.fountainTemplate){return-1}
const{dx,dy,scale}=game.sceneData.fountainTemplate;return dy>=2?-1:3},combine:(item,game)=>{if(item==="empty bottle"){game.removeFromInventory("empty bottle");game.useItem=null;game.pickUp({item:"water bottle",image:ASSETS.GRAB_WATER_BOTTLE,message:"The water looks clear."});return!0}},tip:"There's water pouring out of this fountain.",hidden:game=>game.battle,allowMove:!0,},{src:ASSETS.PLANET_ITEMS,col:4,row:4,size:[128,128],yyy:-10,scale:(game,sprite)=>game.sceneData.templeTemplate?game.sceneData.templeTemplate.scale/2:1,offsetX:(game,sprite)=>{if(!game.sceneData.templeTemplate){return 0}
const{dx,dy,scale}=game.sceneData.templeTemplate;return 32-64*scale/2+scale*dx*10*5},offsetY:(game,sprite)=>{if(!game.sceneData.templeTemplate){return 0}
const{dx,dy,scale}=game.sceneData.templeTemplate;return 40-64*scale/2+scale*(10-30+sprite.yyy)},scaleMul:10,onRefresh:(game,sprite)=>{const{pos}=game;const{x,y}=pos;game.sceneData.templeTemplate=game.currentScene.getTemplate(game,game.sceneData.finalTarget.x,game.sceneData.finalTarget.y,sprite.scaleMul)},init:(game,sprite)=>{sprite.onRefresh(game,sprite)},index:game=>{if(!game.sceneData.templeTemplate){return 0}
const{dx,dy,scale}=game.sceneData.templeTemplate;return dy>=2?-1:2},onClick:game=>{const{pos}=game;const{x,y}=pos;const ddx=game.sceneData.finalTarget.x-x;const ddy=game.sceneData.finalTarget.y-y;const dist=ddx*ddx+ddy*ddy;if(dist<25){game.sceneData.leavingScene=game.now;game.fadeToScene("tavern-entrance")}},tip:"This is it! Westrow's tavern!",allowMove:!0,},makeFoe('monster',ASSETS.MONSTER),makeFoe('brusalien',ASSETS.BRUSALIEN),{init:({sceneData})=>{sceneData.compassRotation=game.rotation;sceneData.compassRotationDirection=0},onRefresh:game=>{},custom:(game,sprite,ctx)=>{const x=54,y=57;ctx.strokeStyle="#aaaaaa";ctx.fillStyle="#222233";ctx.beginPath();ctx.ellipse(x,y,8,4,0,0,2*Math.PI);ctx.fill();ctx.stroke();const angle=game.rotation/8*Math.PI*2;ctx.strokeWidth=3;ctx.strokeStyle="#9999aa";ctx.beginPath();ctx.moveTo(x,y+1);ctx.lineTo(x-Math.sin(angle)*6,y+Math.cos(angle)*3);ctx.stroke();ctx.strokeStyle="#aa0000";ctx.beginPath();ctx.moveTo(x,y+1);ctx.lineTo(x+Math.sin(angle)*6,y-Math.cos(angle)*3);ctx.stroke();const orientation=game.granular_orientation;game.displayTextLine(ctx,{msg:orientation,x:x-5+(orientation.length===1?3:0),y:y-2});ctx.fillStyle="#cccccc55";ctx.beginPath();ctx.ellipse(x-1,y-1,3,1,0,0,2*Math.PI);ctx.fill()},hidden:game=>game.sceneData.moonLand||!game.inventory.compass||game.battle||game.dialog||game.useItem==="compass",},...standardBattle(),...standardMenu(),...standardBag(),],...makeOnSceneBattle(),openChest:(game,battle,shot)=>{if(game.now-game.sceneData>360000&&!game.inventory.compass){game.findChest(game.now+2000,{item:"compass",image:ASSETS.GRAB_COMPASS,message:"A compass!",});return}
const rand=Math.floor(Math.random()*10000000);switch(rand%10){case 0:case 1:game.findChest(game.now+2000,{item:"bullet",count:5,image:ASSETS.GRAB_GUN,message:"I found five bullets for my gun.",hideFromInventory:!0,});break;case 2:case 3:case 4:game.findChest(game.now+2000,{item:"fruit?",image:ASSETS.GRAB_APPLE,});break;case 5:if(!game.inventory.compass&&game.now-game.sceneData>120000){game.findChest(game.now+2000,{item:"compass",image:ASSETS.GRAB_COMPASS,message:"A compass!",})}else{game.findChest(game.now+2000,{item:"bullet",count:1,image:ASSETS.GRAB_GUN,message:"I found one bullet for my gun.",hideFromInventory:!0,})}
break;default:if(shot){game.findChest(game.now+2000,{item:null,message:"The chest is empty!",})}else{game.findChest(game.now+2000,{item:"bullet",count:1,image:ASSETS.GRAB_GUN,message:"I found one bullet for my gun.",hideFromInventory:!0,})}
break}},events:{'m':{foe:"monster",foeLife:150,foeBlockChance:.8,attackSpeed:1500,riposteChance:.6,attackPeriod:100,foeDamage:7,foeDefense:12,xp:12,belowTheBelt:!1,blocking:!0,blockMap:!0,chest:!0,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt})=>{const{data,now}=game;game.chest=null;const theme=game.data.theme.song;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,theme,}}
return!0},onWin:(game,battle,shot)=>game.currentScene.openChest(game,battle,shot),},'b':{foe:"brusalien",foeLife:180,foeBlockChance:.9,attackSpeed:2000,riposteChance:.3,attackPeriod:100,foeDamage:8,foeDefense:12,xp:15,belowTheBelt:!1,blocking:!0,blockMap:!0,chest:!0,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt})=>{const{data,now}=game;game.chest=null;const theme=game.data.theme.song;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,theme,}}
return!0},onWin:(game,battle,shot)=>game.currentScene.openChest(game,battle,shot),},},},);game.addScene({name:"final-planet",onScene:game=>{delete game.inventory.warpdrive;game.save();game.playSound(SOUNDS.DIVING);game.playTheme(null);game.delayAction(game=>{game.gotoScene("final-planet-world")},4000)},onSceneRefresh:game=>{},sprites:[{src:ASSETS.FINAL_PLANET,col:1,row:2,},{src:ASSETS.SPACESHIP_STAIRS,col:4,row:4,scale:.8,index:game=>{const frame=Math.floor((game.now-game.sceneTime-2000)/100);return Math.max(5,15-Math.min(frame,15))},offsetY:game=>{const time=Math.max(0,game.now-game.sceneTime)/2;return Math.round(Math.min(7,Math.sqrt(time)-30))},offsetX:4,hidden:game=>game.now-game.sceneTime<1000,},{src:ASSETS.SPACESHIP,col:1,row:2,scale:.8,offsetY:game=>{const time=Math.max(0,game.now-game.sceneTime)/2;return Math.round(Math.min(7,Math.sqrt(time)-30))},offsetX:4,},...standardMenu(),...standardBag(),],},);game.addScene({name:"final-title",onScene:game=>{game.hideCursor=!0;game.data.theEnd=game.now+3000;game.playTheme(SOUNDS.FUTURE_SONG_THEME)},sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},{ending:!0,},],},);game.addScene({name:"first-prison-cell",arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(5),null,RIGHT],],onScene:game=>{game.save()},doors:{1:{exit:game=>game.fadeToScene("maze-4",{door:3}),},},map:`
			XXX
			XOX
			X.X
			X1X
			XXX
		`,onSceneRefresh:(game)=>{const{orientation,sceneData,frameIndex}=game;if(sceneData.orientation!==orientation){sceneData.orientation=orientation;if(frameIndex===3){game.frameIndex=0}}},sprites:[...getRoomMaze(""),{src:ASSETS.SHOP_MONSTER,onClick:game=>{game.gotoScene("zoom-shop-monster")},hidden:game=>game.rotation!==0,tip:"There's a hole in the ceiling, with a creature in it.",},{src:ASSETS.CAGE_OPENED,col:2,row:2,index:3,hidden:game=>game.rotation!==0,},...standardMenu(),...standardBag(),],},);game.addScene({name:"gangsta-check-cards",onScene:game=>{game.currentScene.startTalk(game,"bodyguard",["Boss, that's odd.","He has the same card as you boss.","Is that normal?",],game=>{game.sceneData.showCard=game.now;game.delayAction(game=>{game.sceneData.showCard=0;game.sceneData.dickMad=game.now;game.currentScene.startTalk(game,"bodyguard",["Boss, are you ok?",],game=>{game.sceneData.zoomDick=game.now;game.playTheme(null);game.currentScene.startTalk(game,"dick",["You... ","... BASTARD!",],game=>{game.gotoScene("gangsta-shootout")})})},3000)})},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="dick"){x=2;y=64;game.playSound(SOUNDS.GRUMP)}else if(talker==="bodyguard"){x=2;y=45;game.playSound(SOUNDS.YES_BOSS)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},sprites:[{src:ASSETS.GANGSTA_CHECK_CARDS,index:({sceneData})=>sceneData.dickMad?1:0,side:LEFT,},{src:ASSETS.GANGSTA_CHECK_CARDS,index:({pendingTip,now})=>pendingTip&&pendingTip.talker==="bodyguard"&&pendingTip.progress<1?Math.floor(now/80)%2:0,side:RIGHT,},{src:ASSETS.GANGSTA_CHECK_CARDS,index:2,hidden:game=>!game.sceneData.showCard,},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#990000";ctx.fillRect(0,0,64,64)},hidden:game=>!game.sceneData.zoomDick,},{src:ASSETS.ZOOM_DICK_MAD,index:({pendingTip,now})=>pendingTip&&pendingTip.talker==="dick"&&pendingTip.progress<1?Math.floor(now/80)%4:0,hidden:game=>!game.sceneData.zoomDick,},],},);game.addScene({name:"gangsta-shootout",arrowGrid:[[null,null,null,null,null],[],[null,null,null,null,null],[null,null,null,null,null],[null,null,BAG,null,null],],onScene:game=>{game.playTheme(null);game.delayAction(game=>{game.sceneData.startDraw=game.now},500);game.delayAction(game=>{game.sceneData.drawGun=game.now},1200);game.delayAction(game=>{if(!game.sceneData.dickShot){game.playSound(SOUNDS.GUN_SHOT);game.sceneData.dickShoot=game.now;game.currentScene.hideBartender(game);game.currentScene.onHitPlayer(game)}},2600)},shortcut:game=>{game.addToInventory({item:"bullet",count:6,});game.pickUp({item:"gun",image:ASSETS.GRAB_GUN,});game.getSituation("tavern-phone").yupaAndBrutus=game.now},onSceneRefresh:game=>{if(game.sceneData.bodyguardShoot){const progress=Math.min(1,(game.now-game.sceneData.bodyguardShoot)/3000);game.fade=game.sceneData.bodyguardShoot?.6*progress:0;game.fadeColor="#990000";if(progress>=1&&!game.data.gameOver&&!game.sceneData.overrideGameOver){game.gameOver(!game.countItem("bullet")&&game.sceneData.triedToShoot?"  “Can't function\n   on an empty\n   barrel.” ":game.sceneData.talkItOut?"  “When you have\n  to shoot, shoot.\n   Don't talk.“":!game.sceneData.dickShot||game.getSituation("tavern-phone").yupaAndBrutus?"   “In a shootout,\n you gotta draw\n  quickly.”":" “Three might be\n   too much to\n     handle.”");game.waitCursor=0}}
if(game.sceneData.dickShot&&game.sceneData.rightGuardShot){if(game.sceneData.leftGuardShot||game.getSituation("tavern-phone").yupaAndBrutus){if(!game.sceneData.killedEveryone){game.sceneData.killedEveryone=game.now}else if(game.now-game.sceneData.killedEveryone>3000){if(!game.sceneData.missedShots){game.gotoScene("money-shot")}else{game.delayAction(game=>{game.gotoScene("crowd")},1000)}}}}},hideBartender:game=>{game.delayAction(game=>{if(!game.sceneData.hideBartender){game.sceneData.hideBartender=game.now}},200)},alertBrutus:game=>{game.delayAction(game=>{if(!game.sceneData.alertBrutus){game.sceneData.alertBrutus=game.now}},200)},hideBrutus:game=>{game.delayAction(game=>{if(!game.sceneData.hideBrutus){game.sceneData.hideBrutus=game.now}},500)},onHitPlayer:game=>{if(game.useItem==="gun"){game.sceneData.triedToShoot=!0}
game.dialog=null;game.pendingTip=null;game.useItem=null;game.waitCursor=!0;game.sceneData.bodyguardShoot=game.now},guardAlert:game=>{if(!game.getSituation("tavern-phone").yupaAndBrutus){game.delayAction(game=>{if(!game.sceneData.leftGuardAlert){game.sceneData.leftGuardAlert=game.now}},300);game.delayAction(game=>{if(!game.sceneData.leftGuardShot&&!game.sceneData.leftGuardShoots){game.sceneData.leftGuardShoots=game.now;game.playSound(SOUNDS.GUN_SHOT);game.currentScene.onHitPlayer(game)}},800)}
game.delayAction(game=>{if(!game.sceneData.rightGuardAlert){game.sceneData.rightGuardAlert=game.now}},200);game.delayAction(game=>{if(!game.sceneData.rightGuardShot&&!game.sceneData.rightGuardShoots){game.sceneData.rightGuardShoots=game.now;game.playSound(SOUNDS.GUN_SHOT);game.currentScene.onHitPlayer(game)}},700)},onSceneShot:game=>{game.currentScene.hideBartender(game);game.currentScene.alertBrutus(game);game.currentScene.guardAlert(game)},sprites:[{src:ASSETS.TAVERN_GANGSTA_SHOOTOUT,col:5,row:6,noHighlight:!0,onShot:game=>{game.sceneData.missedShots=(game.sceneData.missedShots||0)+1;return!0},},{src:ASSETS.TAVERN_GANGSTA_SHOOTOUT,col:5,row:6,index:game=>{if(game.sceneData.hideBartender){let frame=1+Math.floor((game.now-game.sceneData.hideBartender)/100);if(frame>3){frame=-1}
return frame}
return 1},},{src:ASSETS.TAVERN_GANGSTA_SHOOTOUT,col:5,row:6,index:game=>{if(game.sceneData.hideBrutus){return Math.min(9,5+Math.floor((game.now-game.sceneData.hideBrutus)/100))}
if(game.sceneData.alertBrutus){return 5}
return 4},hidden:game=>!game.getSituation("tavern-phone").yupaAndBrutus,},{src:ASSETS.TAVERN_GANGSTA_SHOOTOUT,col:5,row:6,side:LEFT,index:game=>{if(game.sceneData.leftGuardShot){let frame=14+Math.floor((game.now-game.sceneData.leftGuardShot)/100);if(frame>16){frame=-1}
return frame}
if(game.sceneData.leftGuardShoots){return game.now-game.sceneData.leftGuardShoots<100?13:12}
if(game.sceneData.leftGuardAlert){return game.now-game.sceneData.leftGuardAlert<200?10:12}
return 11},hidden:game=>game.getSituation("tavern-phone").yupaAndBrutus,onShot:game=>{if(!game.sceneData.leftGuardShot){game.sceneData.leftGuardShot=game.now;game.currentScene.hideBartender(game);game.currentScene.guardAlert(game);return!0}},},{src:ASSETS.TAVERN_GANGSTA_SHOOTOUT,col:5,row:6,side:RIGHT,index:game=>{if(game.sceneData.rightGuardShot){let frame=14+Math.floor((game.now-game.sceneData.rightGuardShot)/100);if(frame>16){frame=-1}
return frame}
if(game.sceneData.rightGuardShoots){return game.now-game.sceneData.rightGuardShoots<100?13:12}
if(game.sceneData.rightGuardAlert){return game.now-game.sceneData.rightGuardAlert<200?10:12}
return 11},onShot:game=>{if(!game.sceneData.rightGuardShot){game.sceneData.rightGuardShot=game.now;game.currentScene.hideBartender(game);game.currentScene.alertBrutus(game);game.currentScene.hideBrutus(game);game.currentScene.guardAlert(game);return!0}},},{src:ASSETS.TAVERN_GANGSTA_SHOOTOUT,col:5,row:6,index:game=>{if(game.sceneData.dickShot){return Math.min(29,25+Math.floor((game.now-game.sceneData.dickShot)/100))}
if(game.sceneData.dickShoot){return game.now-game.sceneData.dickShoot<100?24:23}
if(game.sceneData.drawGun){return Math.min(23,19+Math.floor((game.now-game.sceneData.drawGun)/150))}
if(game.sceneData.startDraw){return Math.min(19,18+Math.floor((game.now-game.sceneData.startDraw)/150))}
return 18},onShot:game=>{if(!game.sceneData.dickShot){game.sceneData.dickShot=game.now;game.currentScene.hideBartender(game);game.currentScene.alertBrutus(game);game.currentScene.guardAlert(game);return!0}},onClick:game=>{game.startDialog({conversation:[{options:[{msg:"Can we talk?",onSelect:game=>{game.sceneData.talkItOut=game.now;game.dialog=null;game.playSound(SOUNDS.HUM);game.showTip(["I have a perfect explanation for what happened","You see, I met this stranger and he gave me this card...","I don't know how he got it,","but if you ask me, I'm sure he had something to do with your brother's deadh...","Are you listening to me?",],null,30)},},{msg:"Sorry!",onSelect:game=>{game.sceneData.talkItOut=game.now;game.dialog=null;game.playSound(SOUNDS.HUM);game.showTip(["I'm sorry about your brother's death. I did not kill him though.","Are you listening to me?",],null,30)},},],},],})},},{src:ASSETS.TAVERN_GANGSTA_SHOOTOUT,col:5,row:6,index:17,},...standardMenu(),...standardBag(),],},);game.addScene({name:"gangsta-table",onScene:game=>{game.playTheme(SOUNDS.TURTLE_SONG_THEME,{volume:.5});game.sceneData.approachGangsta=game.now;game.delayAction(game=>{game.sceneData.gangstaLookUp=game.now;if(game.situation.challenged){game.currentScene.startTalk(game,"dick",["So, have you made up your mind?","Baby Hitler vs your life",],game=>{game.currentScene.challenge(game)})}else{game.currentScene.startTalk(game,"dick",game.situation.proposedGame?["What now?",]:["You're blocking my light.",],game=>{game.startDialog({conversation:[{options:[{msg:"Are you game?",onSelect:game=>{game.situation.proposedGame=game.now;game.currentScene.startTalk(game,"human",["I challenge you to a card game.","Are you man enough to face me?",],game=>{game.currentScene.startTalk(game,"dick",["I don't waste my time with\nmicrobes like you.","But if the stakes are high.","Perhaps I could be interested.",],game=>{game.dialog.index ++})})},},{msg:"We need to talk",onSelect:game=>{game.currentScene.startTalk(game,"human",["I'd like to talk to you",],game=>{game.currentScene.startTalk(game,"dick",["Can't you see I'm busy?","Get lost.",])})},},{msg:"Sorry",onSelect:game=>{game.gotoScene("explore-tavern")},},],},{options:[{msg:"Practice game",onSelect:game=>{game.currentScene.startTalk(game,"human",["Let's do a\npractice game,","just for fun!",],game=>{game.currentScene.startTalk(game,"dick","Get lost!",game=>{game.gotoScene("explore-tavern")})})},},{msg:"Baby Hitler",onSelect:game=>{game.waitCursor=!0;game.dialog.paused=!0;game.sceneData.hitmanCloseup=game.now;game.currentScene.startTalk(game,"human",["I know you are holding Baby Hitler.","If I win the game, you let the kid go.",],game=>{game.sceneData.hitmanCloseup=0;game.currentScene.startTalk(game,"dick",["You're doing all this...","for Baby Hitler?!",],game=>{game.sceneData.hitmanCloseup=game.now;game.delayAction(game=>{game.sceneData.hitmanLookUp=game.now},400);game.delayAction(game=>{game.sceneData.hitmanCloseup=0;game.sceneData.hitmanLookUp=0;game.sceneData.showBabyHitlerWaiter=game.now;game.delayAction(game=>{game.sceneData.showBabyHitlerWaiter=0;game.sceneData.hitmanLookUp=game.now;game.sceneData.hitmanCloseup=game.now;game.waitCursor=!1;game.startDialog({conversation:[{options:[{},{msg:"Yes",onSelect:game=>{game.dialog=null;game.currentScene.thatsRight(game,!0)},},{msg:"No",onSelect:game=>{game.dialog=null;game.currentScene.thatsRight(game,!1)},},],},],})},3000)},1500)})})},},{msg:"Nevermind",onSelect:game=>{game.gotoScene("explore-tavern")},},],},],})})}},5000)},thatsRight:(game,response)=>{if(!response){game.sceneData.hitmanLookUp=0}
game.currentScene.startTalk(game,"human",response?["That's right!","I'm doing this for Baby Hitler!",]:["No, I just need Baby Hitler's help.","He's the only one who can save me.",],game=>{game.sceneData.hitmanCloseup=0;game.sceneData.hitmanLookUp=0;game.delayAction(game=>{game.sceneData.dickToWaiter=game.now},2000);game.delayAction(game=>{game.sceneData.dickToWaiter=game.now;game.currentScene.startTalk(game,"dick",["What are you waiting for kid!","Go grab me a beer, right now!","And if you spill a drop like last time, I'll kick you in the nutz!",],game=>{game.sceneData.kidBow=game.now;game.currentScene.startTalk(game,"boy",["Yes, boss!",],game=>{game.sceneData.showBabyHitlerWaiter=game.now;game.currentScene.startTalk(game,"boy",["Right away boss!",],game=>{game.sceneData.boyGone=game.now;game.sceneData.showBabyHitlerWaiter=0;game.sceneData.dickToWaiter=0;game.currentScene.startTalk(game,"dick",["I like to have a drink when I play someone.",],game=>{game.sceneData.hitmanCloseup=game.now;game.currentScene.startTalk(game,"human",["It means you accept my\nchallenge.","You're going to play cards with me!",],game=>{game.sceneData.hitmanCloseup=0;game.currentScene.startTalk(game,"dick",["Well that depends...","If you win, you can take your boy, or whoever you want...","Now if I win,","I get to take your life!","Do we have a deal?",],game=>{game.currentScene.challenge(game)})})})})})})},2300)})},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="human"){if(game.sceneData.hitmanCloseup){x=5;y=64}else{x=5;y=62}
game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=44;game.playSound(SOUNDS.YUPA)}else if(talker==="bartender"){x=4;y=40;game.playSound(SOUNDS.HELLO_HUMAN,{volume:.2})}else if(talker==="dick"){x=2;y=22;game.playSound(SOUNDS.GRUMP)}else if(talker==="dick2"){x=2;y=24;game.playSound(SOUNDS.GRUMP)}else if(talker==="brutus"){x=1;y=20;game.playSound(SOUNDS.YES_BOSS)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},challenge:game=>{game.situation.challenged=game.now;game.startDialog({conversation:[{options:[{msg:"Deal!",onSelect:game=>{game.currentScene.startTalk(game,"human",["Deal!",],game=>{game.currentScene.startTalk(game,"dick",["Alright let's begin...","We are going to play one of my favorite card game","It is called ...","WAR","This is how the game plays out.","You get a card, and I get a card.","The highest card wins!",],game=>{game.dialog.index ++})})},},{msg:"No deal!",onSelect:game=>{game.currentScene.startTalk(game,"human",["No deal!","I'm not gonna risk my life on a stupid card game!",],game=>{game.currentScene.startTalk(game,"dick",["Well, let me know when you change your mind,","chicken ....",],game=>{game.gotoScene("explore-tavern")})})},},{msg:"I gotta pee",onSelect:game=>{game.currentScene.startTalk(game,"human",["Hum... I really need to pee.","Let me go to the restroom.",],game=>{game.sceneData.slippingAway=game.now;game.currentScene.startTalk(game,"human",["Be right back!",],game=>{game.currentScene.startTalk(game,"dick",["Alright, you go ahead,","chicken ....",],game=>{game.gotoScene("explore-tavern")})})})},},],},{options:[{msg:"That's it?",hidden:game=>game.sceneData.thatsIt,onSelect:game=>{game.sceneData.thatsIt=game.now;game.currentScene.startTalk(game,"human",["That's it? We're playing War?","That's just a game of luck.",],game=>{game.currentScene.startTalk(game,"dick",["Are you having second thoughts now?","chicken ....",])})},},{msg:"And equal cards?",hidden:game=>game.sceneData.equalCards,onSelect:game=>{game.sceneData.equalCards=game.now;game.currentScene.startTalk(game,"human",["What happens if the cards are equal?",],game=>{game.currentScene.startTalk(game,"dick",["We shoot it out.",],game=>{game.currentScene.startTalk(game,"human",["Wait... what?",],game=>{game.currentScene.startTalk(game,"dick",["I'm sure it won't happen anyway.",])})})})},},{msg:"Why War?",hidden:game=>game.sceneData.brotherStory,onSelect:game=>{game.currentScene.startTalk(game,"human",["Don't you have a better card game in mind?","What's the big deal with War?",],game=>{game.currentScene.startTalk(game,"dick",["This was my younger brother's favorite game.","He always used to win with the ace of heart.","He was so lucky with that card, he even wrote his name on it.","Not sure how he did it ... but I will never know ...","Since my brother got murdered!","We never found the killer. But I swear I will someday."],game=>{game.currentScene.startTalk(game,"human",["I hope you do.",]);game.sceneData.brotherStory=game.now})})},},{msg:"Let's play",onSelect:game=>{game.currentScene.startTalk(game,"human",["Let's go, I'm ready to play!",],game=>{game.dialog=null;game.currentScene.startTalk(game,"dick",["Ok, then. For fairness,",],game=>{game.sceneData.zoomDick=game.now;game.currentScene.startTalk(game,"dick2",["we are going to ask Ernest to deal the cards.",],game=>{game.gotoScene("ernest")})})})},},{},{},],},],})},sprites:[{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:game=>{if(game.sceneData.waving&&game.now-game.sceneData.waving<2000){return Math.floor(game.now/150)%2+4}
return 1},},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:3,hidden:({now,pendingTip})=>Math.floor(now/150)%2===0||!pendingTip||pendingTip.progress>=1||pendingTip.talker!=="bartender",},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:({sceneData,now,pendingTip})=>{if(sceneData.kidBow&&now-sceneData.kidBow<300){return 21}
if(pendingTip&&pendingTip.progress<1&&pendingTip.talker==="boy"&&Math.floor(now/150)%2===0){return 22}
return 6},offsetX:game=>{if(game.sceneData.boyGone){return Math.min(30,(game.now-game.sceneData.boyGone)/100)}
return 0},},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,side:LEFT,index:game=>{if(game.pendingTip&&game.pendingTip.talker==="brutus"&&game.pendingTip.progress<1){return 7+Math.floor(game.now/100)%2}
return 7},hidden:game=>game.getSituation("tavern-phone").yupaAndBrutus,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:17,hidden:game=>!game.getSituation("tavern-phone").yupaAndBrutus,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,side:RIGHT,index:7,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:10,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,index:game=>{if(game.sceneData.dickTurnHead){return 12}
if(game.sceneData.dickToWaiter){if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="dick"){return 18+Math.floor(game.now/100)%3}
return 18}
if(game.pendingTip&&game.pendingTip.talker==="dick"){if(!game.sceneData.gangstaLookUp){return game.pendingTip.progress<1?Math.floor(game.now/100)%2+12:12}else{return game.pendingTip.progress<1?Math.floor(game.now/100)%2+14:14}}
return game.sceneData.gangstaLookUp?14:11},},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.approachGangsta,offsetX:({sceneData,now})=>{if(sceneData.slippingAway){return(Math.max(-1000,-(now-sceneData.slippingAway)/250))}
return(Math.min(0,-(4000-(now-sceneData.approachGangsta))/250))},offsetY:({sceneData,now},sprite)=>{if(sceneData.slippingAway){return 1-Math.abs(Math.sin((game.now-sceneData.slippingAway)/200))}
return+1+(now-sceneData.approachGangsta>=4000?0:64-(64+Math.abs(Math.sin((4000+sceneData.approachGangsta-now)/200))*1))},side:LEFT,index:16,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.approachGangsta||game.getSituation("tavern-phone").yupaAndBrutus,offsetX:({sceneData,now})=>{return(Math.max(0,(4000-(now-sceneData.approachGangsta))/250))},offsetY:({sceneData,now},sprite)=>+1+(now-sceneData.approachGangsta>=4000?0:64-(64+Math.abs(Math.sin((4000+sceneData.approachGangsta-now)/200))*1)),side:RIGHT,index:16,},{src:ASSETS.TAVERN_HITMAN_CLOSEUP,col:2,row:3,index:({pendingTip,now})=>{if(pendingTip&&pendingTip.progress<1&&pendingTip.talker==="human"){return Math.floor(now/100)%4}
return 0},hidden:game=>!game.sceneData.hitmanCloseup,},{src:ASSETS.BEARD_SHAVED,col:3,row:3,scale:1.5,offsetX:-33,offsetY:-20,hidden:game=>!game.sceneData.hitmanCloseup,index:(game,sprite)=>{const{pendingTip,now}=game;return pendingTip&&pendingTip.talker==="human"&&pendingTip.progress<1?Math.floor(now/100)%4:0},},{src:ASSETS.TAVERN_HITMAN_CLOSEUP,col:2,row:3,index:4,hidden:game=>!game.sceneData.hitmanCloseup||!game.sceneData.hitmanLookUp,},{src:ASSETS.BABY_HITLER_WAITER,col:2,row:2,hidden:game=>!game.sceneData.showBabyHitlerWaiter,index:({pendingTip,now})=>{if(pendingTip&&pendingTip.progress<1&&pendingTip.talker==="boy"){return Math.floor(now/100)%4}
return 0},},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#453737";ctx.fillRect(0,0,64,64)},hidden:game=>!game.sceneData.zoomDick,},{src:ASSETS.ZOOM_DICK,index:game=>{if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="dick2"){return Math.floor(game.now/100)%4}
return 0},hidden:game=>!game.sceneData.zoomDick,},],},);game.addScene({name:"guards-attack",onScene:game=>{game.hideCursor=!0;game.fadeColor="#000000";game.see("badguards")},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);game.fade=Math.max(0,Math.min(1,(frame-50)/10));if(frame>70){if(!game.sceneData.beatsound){game.sceneData.beatsound=game.now;game.playSound(SOUNDS.HIT);game.delayAction(game=>game.playSound(SOUNDS.PLAYER_HURT),300);game.delayAction(game=>game.playSound(SOUNDS.HIT),500)}}
if(frame>80){game.gotoScene("jail-cell");game.see("intro")}},sprites:[{src:ASSETS.GUARDS_ATTACK,index:2,},{src:ASSETS.GUARDS_ATTACK,index:1,hidden:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);return frame>=40},alpha:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);return Math.max(0,Math.min(1,(40-frame)/10))}},{src:ASSETS.GUARDS_ATTACK,index:0,hidden:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);return frame>=20},alpha:game=>{const frame=Math.floor((game.now-game.sceneTime)/100);return Math.max(0,Math.min(1,(20-frame)/10))}},],},);game.addScene({name:"guards-laughing-2",onScene:game=>{game.hideCursor=!0;game.playSound(SOUNDS.HAHAHA)},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/150);if(frame>50){game.gotoScene("guards-attack")}},sprites:[{src:ASSETS.GUARDS_LAUGHING,index:game=>{const frame=Math.floor((game.now-game.sceneTime)/150);return frame<20?frame%2+2:frame<32?0:4},},],},);game.addScene({name:"guards-laughing",onScene:game=>{game.hideCursor=!0},onSceneRefresh:game=>{const frame=Math.floor((game.now-game.sceneTime)/150);if(frame>50){game.gotoScene("what-so-funny")}else if(!game.sceneData.laughing&&frame>30){game.sceneData.laughing=!0;game.playSound(SOUNDS.HAHAHA)}},sprites:[{src:ASSETS.GUARDS_LAUGHING,index:game=>{const frame=Math.floor((game.now-game.sceneTime)/150);if(frame<15){return 0}else if(frame<30){return 1}else{return frame%2+2}},},],},);game.addScene({name:"human-woke",onScene:game=>{game.playTheme(SOUNDS.FUTURE_SONG_THEME,{volume:.8});game.hideCursor=!0;game.delayAction(game=>{const{currentScene}=game;currentScene.startTalk(game,"yupa","Hey look, he wakin up!",game=>{game.hideCursor=!1;game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Why am I here?",onSelect:(game,dialog)=>{currentScene.startTalk(game,"human",["I thought I was dead,","What am I still doing here?",],game=>{currentScene.startTalk(game,"yupa",[`Ya diden die, ~${game.data.name||"Hitman"}~,`,"We gave ya nother chance tu change yo mind.",],game=>{currentScene.startTalk(game,"doctar",["You ingested a drug that simulates the effects of dying.","We usually give it to suicidal patients,","In case they have a change of heart.","After experiencing this simulation of death,","many choose to live.",],game=>{dialog.index++})})})},},{msg:"Where am I?",onSelect:(game,dialog)=>{currentScene.startTalk(game,"human",["Where am I?","Is this hell or heaven?","It's hell isn't it? I'm sure it is...",],game=>{currentScene.startTalk(game,"yupa",[`It's not hell, ~${game.data.name||"Hitman"}~,`,"You have ya nother chance at life.",],game=>{currentScene.startTalk(game,"doctar",["We gave you a drug that simulates the effects of dying.","It's usually prescribed to suicidal patients,","In case they have a change of heart.","After experiencing this simulation of death,","many choose to live.",],game=>{dialog.index++})})})},},{msg:"I'm alive!",onSelect:(game,dialog)=>{currentScene.startTalk(game,"human",["I'm still alive!","How is that possible?"],game=>{currentScene.startTalk(game,"yupa",["Ya diden die yet.","We gave ya nother chance!",],game=>{currentScene.startTalk(game,"doctar",["You took a drug that simulates the effects of dying.","It's usually prescribed to suicidal patients,","In case they have a change of heart.","After experiencing this simulation of death,","many choose to live.",],game=>{dialog.index++})})})},},],},{options:[{msg:game=>game.sceneData.toldWhy?"":"Why?",cantSelect:game=>game.sceneData.toldWhy,onSelect:game=>{currentScene.startTalk(game,"human",["Why would you keep me alive?",],game=>{currentScene.startTalk(game,"yupa",["Well... I dun realey want ya to go","Kinda like havin ya round...","You sure ya dun wanna go out dhere,","find da Baby wid me,","and becom big famely agan?",],game=>{game.sceneData.toldWhy=game.now})})},},{msg:"Let me die!",onSelect:game=>{currentScene.startTalk(game,"human",["Let me die, you crazies!",],game=>{game.sceneData.looking=game.now;currentScene.startTalk(game,"human",["This time for real, just leave me alone!","I wanna die in peace!",],game=>{game.sceneData.looking=0;currentScene.startTalk(game,"yupa",[`Ok, ~${game.data.name || "Hitman"}~`,"It waz nice knowin ya.","Ya doing nobol sacriface for humanz,","... ya stuped human....",],game=>{game.dialog=null;game.fadeToScene("final-doom")})})})},},{msg:"I wanna live!",onSelect:game=>{currentScene.startTalk(game,"human",["I wanna live this time!","I don't want to go through this hell again!","Let's go Yupa, we're gonna find dat damn baby!"],game=>{currentScene.startTalk(game,"yupa",[`Sura think, ~${game.data.name || "Hitman"}`,"Letz stard wid da shopkeepa.","Docta said he knowz lotza piple.",],game=>{game.dialog=null;game.data.seen.doctor=game.now;game.fadeToScene("sarlie-planet-world",null,null,game=>{game.sceneData.fromDoctor=!0})})})},},],},],})})},3000)},startTalk:(game,talker,msg,onDone,removeLock)=>{let x,y;if(talker==="human"||talker==="human2"){x=2;y=64;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=20;game.playSound(SOUNDS.YUPA)}else if(talker==="doctar"){x=2;y=21;game.playSound(SOUNDS.HUHUH)}
game.showTip(msg,onDone,80,{x,y,talker,removeLock})},sprites:[{src:ASSETS.OPERATION_ROOM,col:2,row:3,side:LEFT,index:game=>{if(game.sceneData.looking){return 4}
return game.pendingTip&&game.pendingTip.talker==="yupa"?Math.floor(game.now/100)%4:0},},{src:ASSETS.OPERATION_ROOM,col:2,row:3,side:RIGHT,index:game=>{if(game.sceneData.looking){return 4}
return game.pendingTip&&game.pendingTip.talker==="doctar"?Math.floor(game.now/100)%4:0},},{src:ASSETS.EYES_OPEN,col:3,row:3,index:game=>{const time=game.now-game.sceneTime;const frame=Math.floor(time/200);if(frame<5){return frame}else if(frame<10){return 5-(frame-5)}else{return Math.min(8,frame-10)}
return frame},},],},);game.addScene({name:"i-have-no-hand",onScene:game=>{game.hideCursor=!0;game.playTheme(SOUNDS.GOGOL);game.delayAction(game=>{game.playSound(SOUNDS.HUM);game.showTip("No left hand!")},2000);game.delayAction(game=>{game.gotoScene("zoom-hottub-2")},5000)},sprites:[{src:ASSETS.HUMAN_NO_HAND,index:game=>game.pendingTip&&game.pendingTip.progress<1?Math.floor(game.now/100)%4:0,},{src:ASSETS.NO_HAND,offsetY:game=>Math.max(0,10-Math.round(10*(game.now-game.sceneTime)/1000)),}],},);game.addScene({name:"in-progress",arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(5),null,RIGHT],],onScene:game=>{game.showTip(`CONGRATS! You reach the end of this demo. But come back soon! I'll keep making updates to this game, and bring a proper ending. But hey, you've made it this far, but the rest might not be so easy. HAHAHA!`,null,null,{removeLock:!0})},doors:{1:{exit:game=>game.fadeToScene("cell-maze",{door:5}),},},map:`
			XXX
			XOX
			X.X
			X1X
			XXX
		`,onSceneRefresh:(game)=>{const{orientation,sceneData,frameIndex}=game;if(sceneData.orientation!==orientation){sceneData.orientation=orientation;if(frameIndex===3){game.frameIndex=0}}},sprites:[...getRoomMaze("_2"),...standardMenu(),...standardBag(),],},);game.addScene({name:"inside-tavern",onScene:game=>{game.delayAction(game=>{game.gotoScene("look-over-there")},64*200)},sprites:[{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:game=>Math.floor(game.now/500)%2,offsetX:game=>Math.max(-64,-(game.now-game.sceneTime)/200),},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:9,offsetX:game=>Math.max(-64,-(game.now-game.sceneTime)/200),},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:2,offsetX:game=>-(game.now-game.sceneTime)/50,offsetY:game=>2-Math.abs(Math.sin(game.now/100)),},{src:ASSETS.INSIDE_TAVERN,size:[128,64],col:2,row:6,index:3,offsetX:game=>Math.max(-64,-(game.now-game.sceneTime)/150),},],},);game.addScene({name:"jail-cell",arrowGrid:[[null,null,MENU,null,null],[],[null,null,s(0),null,null],[LEFT,null,s(0),null,RIGHT],[LEFT,null,BAG,null,RIGHT],],onSceneForward:game=>{game.waitCursor=!0;game.hideArrows=!0;game.fadeToScene("maze",{door:1},2000);return!0},onSceneUseItem:(game,item)=>{if(item==="gun"&&!game.data.shot.lamp){if(game.rotation===0&&!game.sceneData.guardAlert){game.sceneData.guardAlert=game.now+1000}}},onSceneHoldItem:(game,item)=>{if(game.data.shot.lamp&&!game.situation.lighterOn&&item==="lighter"){game.playSound(SOUNDS.HIT);game.situation.lighterOn=game.now+500;game.useItem=null}},onSceneShot:(game,item)=>{if(!game.data.shot.lamp){if(game.rotation===0){if(!game.sceneData.guardAlert||game.now<game.sceneData.guardAlert){game.sceneData.guardAlert=game.now}}else{game.waitCursor=!0;game.showTip("Uh oh, that was a bit loud.",game=>{game.hideCursor=!0;if(game.rotation===4||game.rotation===6){game.turnLeft(game.now,game=>{if(game.rotation!==0){game.turnLeft(game.now,game=>{game.sceneData.guardAlert=game.now})}else{game.sceneData.guardAlert=game.now}})}else if(game.rotation===2){game.turnRight(game.now,game=>{game.sceneData.guardAlert=game.now})}})}}else{if(item=="lamp"){game.playTheme(null)}
if(!game.sceneData.guardAlert){game.sceneData.guardAlert=game.now+2000}}},onScene:game=>{if(location.search.indexOf("bad-guards")>=0){game.see("badguards")}
if(!game.data.seen.intro){game.playTheme(null);game.see("intro");if(location.search.indexOf("skip-intro")<0){game.fade=1;game.sceneIntro=!0;game.hideCursor=!0;game.hideArrows=!0;game.delayAction(game=>{game.showTip(["My brain... it hurts...","And my body is filled with bruises...","What happened? I don't\nremember\nanything.","Where am I?",],game=>{game.sceneIntro=!1;game.sceneData.beginTime=game.now;game.hideCursor=!1;game.playTheme(SOUNDS.JAIL_CELL_THEME)})},3000)}}else if(game.data.seen.badguards&&!game.data.seen.badguards_intro){game.playTheme(null);game.see("badguards_intro");if(location.search.indexOf("skip-intro")<0){game.fade=1;game.sceneIntro=!0;game.hideCursor=!0;game.hideArrows=!0;game.delayAction(game=>{game.showTip(["Ohh my brain... it hurts...","And my body is filled with bruises...","... now at least, I know how I got those.","I must find a way out of here.",],game=>{game.sceneIntro=!1;game.sceneData.beginTime=game.now;game.hideCursor=!1;game.playTheme(SOUNDS.JAIL_CELL_THEME)})},2000)}}
game.save()},onSceneRefresh:game=>{if(game.sceneData.cakebomb&&!game.situation.explode){const frame=Math.floor((game.now-game.sceneData.cakebomb)/100);if(frame>=11&&!game.situation.explode){game.situation.explode=game.now;game.playSound(SOUNDS.GUN_SHOT);game.delayAction(game=>game.playSound(SOUNDS.GUN_SHOT),50);game.delayAction(game=>game.playSound(SOUNDS.GUN_SHOT),50);game.sceneData.pieces=new Array(10).fill(null).map(a=>{const byte=Math.max(0x50,Math.floor(Math.random()*0xaa)).toString(16);const color=`#cc${byte}00`;const size=Math.random()<.5?1:2;const p={x:[37+10*(Math.random()-.5)],y:[35+Math.random()*2],dx:(Math.random()-.5)*2,dy:-Math.random()*2,size,color,appear:game.now,};return p});if(!game.data.shot.lamp){game.sceneData.guardAlert=game.now+1000}}}
if(!game.sceneIntro&&!game.sceneData.showedIntro){game.fade=Math.max(0,1-(game.now-game.sceneData.beginTime)/3000);if(game.hideArrows&&game.fade===0){game.hideArrows=!1}
if(game.fade===0){game.sceneData.showedIntro=!0}}
if(game.sceneData.guardAlert){if(!game.data.shot["right guard"]){const frame=5+Math.max(0,Math.min(2,Math.floor((game.now-game.sceneData.guardAlert)/200)));if(frame===7){if(!game.sceneData.rightShot||game.now-game.sceneData.rightShot>500){if(!game.sceneData.rightShotCount||game.sceneData.rightShotCount<6){game.playSound(SOUNDS.GUN_SHOT);game.sceneData.rightShot=game.now;game.sceneData.rightShotCount=(game.sceneData.rightShotCount||0)+1;if(!game.sceneData.firstShot){game.sceneData.firstShot=game.now;game.frameIndex=0;game.useItem=null;game.hideCursor=!0}}}}}
if(!game.data.shot["left guard"]){const frame=1+Math.max(0,Math.min(2,Math.floor((game.now-game.sceneData.guardAlert)/150)));if(frame===3){if(!game.sceneData.leftShot||game.now-game.sceneData.leftShot>300){if(!game.sceneData.leftShotCount||game.sceneData.leftShotCount<6){game.playSound(SOUNDS.GUN_SHOT);game.sceneData.leftShot=game.now;game.sceneData.leftShotCount=(game.sceneData.leftShotCount||0)+1;if(!game.sceneData.firstShot){game.sceneData.firstShot=game.now;game.frameIndex=0;game.useItem=null;game.hideCursor=!0}}}}}
if(game.sceneData.firstShot){const progress=Math.min(1,(game.now-game.sceneData.firstShot)/3000);game.fade=game.sceneData.firstShot?.9*progress:0;game.fadeColor="#990000";if(progress>=1&&!game.data.gameOver){if(game.data.shot.lamp){game.gameOver("  “A bit faster\n       next time?")}else{game.gameOver("  “That was too\n       noticeable”")}}}}},sprites:[{src:ASSETS.EXIT_DOOR,hidden:game=>game.rotation!==0,tip:"Looks like the only way out",blockMouse:game=>{return game.situation.explode},},{src:ASSETS.JAIL,col:3,row:3,index:()=>Math.random()<.1?1:0,hidden:game=>game.rotation!==0,},{src:ASSETS.DIMMING_LIGHT,col:2,row:2,index:()=>game.data.shot.lamp?3:Math.random()<.1?1:0,hidden:game=>game.rotation!==0,},{name:"lamp",src:ASSETS.LAMP,hidden:game=>game.rotation!==0||game.data.shot.lamp,tip:"That flickering, it's driving me crazy!",},{name:"right guard",src:ASSETS.RIGHT_GUARD,col:3,row:3,index:({data,now,sceneData})=>{if(data.shot["right guard"]){const frame=1+Math.max(0,Math.min(3,Math.floor((now-data.shot["right guard"])/150)));return frame}
if(game.sceneData.guardAlert){const frame=5+Math.max(0,Math.min(2,Math.floor((now-sceneData.guardAlert)/200)));return frame}
return 0},hidden:game=>game.rotation!==0,onClick:game=>{if(!game.data.shot.lamp&&!game.sceneData.guardAlert)game.gotoScene("zoom-guards")},tip:game=>game.data.seen.badguards?null:"He looks bored.",combine:(item,game)=>{if(item!=="gun"&&!game.data.shot.lamp&&!game.sceneData.guardAlert){game.gotoScene("zoom-guards");game.useItem=item}
return!0},blockMouse:game=>{return game.data.shot["right guard"]},},{name:"left guard",src:ASSETS.LEFT_GUARD,col:3,row:3,index:game=>{if(game.data.shot["left guard"]){const frame=4+Math.max(0,Math.min(3,Math.floor((game.now-game.data.shot["left guard"])/150)));return frame}
if(game.sceneData.guardAlert){const frame=1+Math.max(0,Math.min(2,Math.floor((game.now-game.sceneData.guardAlert)/150)));return frame}
return 0},hidden:game=>game.rotation!==0,onClick:game=>{if(!game.data.shot.lamp&&!game.sceneData.guardAlert)game.gotoScene("zoom-guards")},tip:game=>game.data.seen.badguards?null:"He's reading a book.",combine:(item,game)=>{if(item!=="gun"&&!game.data.shot.lamp&&!game.sceneData.guardAlert){game.gotoScene("zoom-guards");game.useItem=item}
return!0},blockMouse:game=>{return game.data.shot["left guard"]},},{name:"tilehole",src:ASSETS.TILE,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:game=>game.rotation===0||!game.data.pickedUp.tile,onClick:game=>game.gotoScene("tile-hole"),combineMessage:(item,game)=>"I don't need to put anything in there.",},{src:ASSETS.CAGE,col:2,row:3,index:game=>(game.situation.lighterOn?3:0)+(game.situation.explode?Math.min(2,Math.floor((game.now-game.situation.explode)/100)):0),hidden:game=>game.rotation!==0,},{name:"lock",src:ASSETS.LOCK,hidden:game=>game.rotation!==0||game.data.cakelock,combineMessage:(item,game)=>`I can't pick the lock with ~a ${item}~.`,combine:(item,game)=>{if(item==="cake"){delete game.inventory[game.useItem];game.useItem=null;game.data.cakelock=game.now;if(!game.data.shot.lamp&&!game.data.shot['left guard']&&!game.data.shot['right guard']){game.showTip("The guards look at me\nsuspiciously.")}
return!0}},tip:game=>game.data.shot['left guard']&&game.data.shot['right guard']?"There must be a way to bust this lock...":"There must be a way to bust this lock, when noone's watching...",},{name:"cakelock",src:ASSETS.CAKE_BOOM,index:game=>game.sceneData.cakebomb?Math.min(11,Math.floor((game.now-game.sceneData.cakebomb)/100)):0,hidden:game=>game.rotation!==0||!game.data.cakelock||game.situation.explode,combine:(item,game)=>{if(item==="lighter"){game.useItem=null;game.sceneData.cakebomb=game.now;return!0}},},{custom:(game,sprite,ctx)=>{if(game.situation.explode){const pieces=game.sceneData.pieces||[];pieces.forEach(piece=>{const{x,y,preX,preY,dx,dy,size,color,appear}=piece;if(appear<game.now){ctx.fillStyle=color;for(let i=0;i<x.length;i++){ctx.fillRect(x[i],y[i],size-i*.1,size-i*.1)}
if(x.length<2){x.push(x[x.length-1]);y.push(y[y.length-1])}
for(let i=x.length-1;i>=1;i--){x[i]=x[i-1];y[i]=y[i-1]}
piece.x[0]+=dx;piece.y[0]+=dy;piece.dy+=.15}})}},},{src:ASSETS.SHOOTS,index:0,hidden:game=>game.rotation!==0||!game.sceneData.leftShot||game.now-game.sceneData.leftShot>100,},{src:ASSETS.SHOOTS,index:1,hidden:game=>game.rotation!==0||!game.sceneData.rightShot||game.now-game.sceneData.rightShot>100,},{src:ASSETS.SHOOTS,index:2,hidden:({rotation,data,sceneData,now})=>{if(rotation!==0||data.shot["left guard"]){return!0}
if(!sceneData.guardAlert){return!0}
const frame=1+Math.max(0,Math.min(2,Math.floor((now-sceneData.guardAlert)/150)));return frame<3}},{src:ASSETS.JAIL360,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:game=>game.rotation===0,},{src:ASSETS.WOOD,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:game=>game.rotation===0,combine:(item,game)=>{if(item==="empty bottle"&&game.data.pickedUp["empty bottle"]){delete game.data.pickedUp["empty bottle"];game.removeFromInventory("empty bottle")}
return!0},},{name:"writing",src:ASSETS.WRITING,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:game=>game.rotation===0,preventClick:game=>game.rotation!==6&&game.rotation!==4,onClick:game=>{if(game.rotation===4){game.turnLeft(game.now,game=>{game.gotoScene("birthday")})}else{game.gotoScene("birthday")}},tip:({rotation,data})=>rotation===4||data.seen.writing?null:"How long was I in this cell?",},{name:"photo",src:ASSETS.PHOTO,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:(game,{name})=>game.rotation===0||game.data.pickedUp[name],onClick:(game,{name})=>game.pickUp({item:name,image:game.data.shot.photo?ASSETS.GRAB_PHOTO_SHOT:ASSETS.GRAB_PHOTO,message:"It's ...\nBABY HITLER!"+(game.data.shot.photo?"\n...\nHuh... did I make that hole?":"")}),tip:()=>"This photo looks familiar",},{name:"tile",src:ASSETS.TILE,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:game=>game.rotation===0||game.data.pickedUp.tile,onClick:game=>game.showTip("I can't lift this tile with my fingers. I need some kind of lever."),tip:"The tile seems loose.",combineMessage:(item,game)=>"That doesn't work as a lever.",combine:(item,game)=>{if(item!=="cake fork"){return!1}
game.playSound(SOUNDS.HIT);game.markPickedUp("tile");delete game.inventory[game.useItem];game.useItem=null;return!0},},{src:ASSETS.CAKE_TRASH,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:(game,{name})=>!game.data.seen.badguards||game.rotation===0,},{name:"cake",src:ASSETS.CAKE_PIECE,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:(game,{name})=>!game.data.seen.badguards||game.rotation===0||game.data.pickedUp[name],tip:"I don't think the cake was edible. That thing burned my eyes.",onClick:(game,{name})=>game.pickUp({item:name,image:ASSETS.GRAB_CAKE,message:"The most\npathetic part in all of this ... I still want a bite of that cake."}),},{name:"cake fork",src:ASSETS.CAKE_FORK,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:(game,{name})=>!game.data.seen.badguards||game.rotation===0||game.data.pickedUp[name],tip:"That looks like a fork.",onClick:(game,{name})=>game.pickUp({item:name,image:ASSETS.GRAB_FORK,message:"Hum... they took the time to bring me a cake fork..."}),},{name:"lighter",src:ASSETS.LIGHTER,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:(game,{name})=>!game.data.seen.badguards||game.rotation===0||game.data.pickedUp[name],tip:"Turns out they left a bunch of stuff behind.",onClick:(game,{name})=>game.pickUp({item:name,image:ASSETS.GRAB_LIGHTER,message:"For the candle on my cake, they actually used a lighter."}),},{name:"empty bottle",src:ASSETS.BOTTLE,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:(game,{name})=>game.rotation===0||game.data.pickedUp[name]||game.data.shot[name],onClick:(game,{name})=>game.pickUp({item:name,image:ASSETS.GRAB_BOTTLE,message:"It's empty."}),},{src:ASSETS.BOTTLE_SHARDS,col:3,row:3,index:game=>(game.rotation+8)%8,hidden:(game,{name})=>game.rotation===0||!game.data.shot["empty bottle"],},{fade:game=>{if(game.situation.lighterOn){const progress=Math.max(0,Math.min(1,(game.now-game.situation.lighterOn)/10000));return.9*(1-progress)+0*progress}
return.9},fadeColor:"#000000",hidden:game=>{if(game.sceneData.rightShot&&game.now-game.sceneData.rightShot<150){return!0}
if(game.sceneData.leftShot&&game.now-game.sceneData.leftShot<150){return!0}
return!game.data.shot.lamp||game.gunFiredWithin(150)}},{fade:game=>{const progress=Math.max(0,Math.min(1,(game.now-game.situation.lighterOn)/5000));return progress*.75+Math.cos(game.now/15)*.01},fadeColor:"#331100",hidden:game=>{if(game.sceneData.rightShot&&game.now-game.sceneData.rightShot<150){return!0}
if(game.sceneData.leftShot&&game.now-game.sceneData.leftShot<150){return!0}
return!game.situation.lighterOn||game.gunFiredWithin(150)}},{fade:.9,fadeColor:"#ffffff",hidden:({data,now})=>!data.shot.lamp||now-data.shot.lamp>=100,},{src:ASSETS.DIMMING_LIGHT,col:2,row:2,index:2,hidden:({data,now,rotation})=>!data.shot.lamp||now-data.shot.lamp>=100||rotation!==0,},...standardMenu(),...standardBag(),],},);game.addScene({name:"lab",arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(10),null,RIGHT],],map:`
			XXX
			XOX
			X.X
			XEX
			XXX
		`,onScene:game=>{game.playTheme(SOUNDS.JAIL_CELL_THEME)},sprites:[...getRoomMaze("_BLUE"),{src:ASSETS.LAB,col:2,row:3,hidden:game=>game.situation.shotTank||game.rotation!==0,index:1,tip:"There's a scary looking creature in the tank, and it seems alive.",onShot:game=>{game.situation.shotTank=game.now},onClick:game=>{game.showTip("I don't know how to open the tank, not that I'd want to.")},combineMessage:(item,game)=>`The ${item} has no effect on the water tank.`,},{src:ASSETS.LAB,col:2,row:3,hidden:game=>game.situation.shotTank||game.rotation!==0,index:2,tip:"Looks like some lab tubes on the shelf.",},{src:ASSETS.LAB,col:2,row:3,hidden:game=>game.situation.shotTank||game.rotation!==0,index:3,tip:"I wonder what's in those flasks.",},{src:ASSETS.LAB,col:2,row:3,hidden:game=>game.situation.shotTank||game.rotation!==0,index:4,tip:"Looks like a sign with lab instructions.",},{src:ASSETS.LAB,col:2,row:3,hidden:game=>game.situation.shotTank||game.rotation!==0,index:0,},{src:ASSETS.LAB_MONSTER,hidden:game=>game.situation.shotTank||game.rotation!==0,offsetY:game=>Math.sin(game.now/500)*1.5-2,},{hidden:game=>game.situation.shotTank||game.rotation!==0,custom:(game,sprite,ctx)=>{if(game.sceneData.bubbles){ctx.strokeStyle="#ccccff";ctx.lineWidth=".2";const[rectX,rectY,rectW,rectH]=game.sceneData.rect;game.sceneData.bubbles.forEach(({x,y})=>{ctx.beginPath();ctx.arc(x*rectW+rectX,y*rectH+rectY,1,0,2*Math.PI);ctx.stroke()})}},onRefresh:game=>{if(game.sceneData.bubbles){game.sceneData.bubbles.forEach(bubble=>{bubble.x+=(Math.random()-.5)*game.sceneData.bubbleSpeed*5;bubble.y-=game.sceneData.bubbleSpeed;if(bubble.x<0||bubble.x>1||bubble.y<0){bubble.x=Math.random();bubble.y=1}})}},onScene:game=>{game.sceneData.rect=[25,18,18,30];game.sceneData.bubbleSpeed=.005;game.sceneData.bubbles=new Array(10).fill(null).map(a=>{return{x:Math.random(),y:Math.random(),}})},onShot:game=>{game.situation.shotTank=game.now},},{src:ASSETS.LAB_EXIT,hidden:game=>game.rotation!==4,onClick:game=>{game.gotoScene("final-corridor",{door:"L"});game.data.yupa.rotation=(game.rotation+4)%8},},{src:ASSETS.LAB_MONSTER_WAKE,col:4,row:4,hidden:game=>!game.situation.shotTank||game.rotation!==0,index:game=>{const frame=Math.floor((game.now-game.situation.shotTank)/100);if(frame<9){return frame}
if(frame<80){return 10+Math.round(Math.sin(game.now/100))}
if(frame<90){return 12}
return 13},combine:(item,game)=>{game.useItem=null;return!0},},{src:ASSETS.LAB_MONSTER_BATTLE,col:3,row:3,offsetX:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-.5)*Math.min(10,200/hitTime)):0},offsetY:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-1)*Math.min(10,200/hitTime)):0},index:({now,battle,data})=>{if(!battle||data.gameOver){return 0}
const hitTime=Math.max(1,now-battle.playerAttackLanded);if(hitTime<400){return 9}
if(battle.foeBlock&&now-battle.foeBlock<200){return 8}
if(now>battle.nextAttack){return 4+Math.floor((now-battle.nextAttack)/100)%4}
return Math.floor(now/200)%4},hidden:({battle,now})=>{if(!battle||battle.foe!=="lab-monster"){return!0}
return battle.foeDefeated&&Math.min(16,11+Math.floor((now-battle.foeDefeated)/60))>=17},combine:(item,game)=>{return!0},},...standardBattle(),...standardMenu(),...standardBag(),],onSceneRefresh:game=>{if(!game.situation.shotTank||game.getSituation("final-corridor").monsterLetOut){return}
const frame=Math.floor((game.now-game.situation.shotTank)/100);if(frame<90||game.sceneData.labMonsterBattle){return}
if(game.rotation!==0){if(!game.sceneData.turning){game.waitCursor=!0;game.sceneData.turning=game.now;if(game.rotation===4||game.rotation===6){game.turnLeft(game.now,game=>{if(game.rotation!==0){game.turnLeft(game.now,game=>{game.waitCursor=!1})}else{game.waitCursor=!1}})}else if(game.rotation===2){game.turnRight(game.now,game=>{game.waitCursor=!1})}}
return}
const{data,now}=game;game.sceneData.labMonsterBattle=now;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe:"lab-monster",fist:LEFT,attackSpeed:4000,playerHit:0,playerBlock:0,foeBlockChance:1,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife:100,invincible:!0,foeMaxLife:100,foeBlock:0,foeDefense:10,foeDefeated:0,attackPeriod:60,riposteChance:.2,foeDamage:25,xp:0,belowTheBelt:!1,noBlock:!0,battleCry:SOUNDS.EAT,}}},...makeOnSceneBattle(),events:{'E':{blocking:!0,showBag:!0,onEvent:game=>{},},'O':{blocking:!0,showBag:!0,onEvent:game=>{},},},},);game.addScene({name:"land-planet",onScene:game=>{game.hideCursor=!0},sprites:[...standardMenu(),...standardBag(),],},);game.addScene({name:"landscape",onScene:game=>{game.sceneData.hitman={pos:{x:55,y:50,},goal:{x:55,y:50,},visible:!0,speed:1/8,direction:4,anim:[[12,13,14,15],[16,17,18,19],[24,25,26,27],[4,5,6,7],[0,1,2,3],[8,9,10,11],[28,29,30,31],[20,21,22,23],],};game.sceneData.yupa={pos:{x:60,y:50,},visible:!0,speed:1/8,dist:10,moving:!1,goal:null,}},onSceneRefresh:game=>{const{pos,goal,speed}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;if(Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1){const dist=Math.sqrt(dx*dx+dy*dy);pos.x+=dx*Math.min(Math.abs(pos.x-goal.x),speed/dist);pos.y+=dy*Math.min(Math.abs(pos.y-goal.y),speed/dist)}else{pos.x=goal.x;pos.y=goal.y}
const{yupa,hitman}=game.sceneData;if(hitman&&yupa){if(yupa.goal){const dx=yupa.pos.x>yupa.goal.x?-1:yupa.pos.x<yupa.goal.x?1:0;const dy=yupa.pos.y>yupa.goal.y?-1:yupa.pos.y<yupa.goal.y?1:0;if(Math.abs(yupa.pos.x-yupa.goal.x)>=1||Math.abs(yupa.pos.y-yupa.goal.y)>=1){const dist=Math.sqrt(dx*dx+dy*dy);yupa.pos.x+=dx*Math.min(Math.abs(yupa.pos.x-yupa.goal.x),speed/dist);yupa.pos.y+=dy*Math.min(Math.abs(yupa.pos.y-yupa.goal.y),speed/dist)}else{yupa.pos.x=yupa.goal.x;yupa.pos.y=yupa.goal.y}}else{const dx=hitman.pos.x-yupa.pos.x;const dy=hitman.pos.y-yupa.pos.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist>yupa.dist){yupa.pos.x+=dx/dist*yupa.speed;yupa.pos.y+=dy/dist*yupa.speed;yupa.moving=!0}else{yupa.moving=!1}}}
if(game.sceneData.script&&game.sceneData.script.length){while(game.sceneData.script.length&&game.sceneData.script[0](game)){if(!game.sceneTime){break}
game.sceneData.script.shift()}}},arrowGrid:[[null,null,MENU,null,null],[],[],[],[null,null,BAG,null,null],],sprites:[{src:ASSETS.LANDSCAPE,noHighlight:!0,onClick:game=>{const{pos,goal,visible}=game.sceneData.hitman;if(game.mouseDown&&visible){goal.x=Math.round(game.mouse.x);goal.y=Math.max(45,Math.round(game.mouse.y));game.sceneData.script=null}},},{src:ASSETS.SPACESHIP_STAIRS,col:4,row:4,index:game=>{if(game.sceneData.ladderDown){return Math.min(5,Math.floor((game.now-game.sceneData.ladderDown)/200))}
if(game.sceneData.ladderUp){return Math.min(10,5+Math.floor((game.now-game.sceneData.ladderUp)/200))}
if(game.sceneData.liftShip){return Math.min(14,10+Math.floor((game.now-game.sceneData.liftShip)/100))}
return 0},offsetY:game=>{if(game.sceneData.liftShip){const time=(game.now-game.sceneData.liftShip)/500;return-time*time}
return 0},},{src:ASSETS.YUPA_WALK,size:[16,32],col:3,row:2,scale:.2,offsetX:({sceneData})=>sceneData.yupa.pos.x-2,offsetY:({sceneData})=>sceneData.yupa.pos.y-6,index:game=>game.sceneData.yupa.moving?Math.floor(game.now/100)%4:0,hidden:game=>!game.sceneData.hitman.visible,},{src:ASSETS.HITMAN_WALK,size:[16,32],col:6,row:6,scale:.2,offsetX:({sceneData})=>sceneData.hitman.pos.x-2,offsetY:({sceneData})=>sceneData.hitman.pos.y-6,index:game=>{const{pos,goal,anim}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},hidden:game=>!game.sceneData.hitman.visible,},{src:ASSETS.HITMAN_BEARD_WALK,size:[16,32],col:6,row:6,scale:.2,offsetX:({sceneData})=>sceneData.hitman.pos.x-2,offsetY:({sceneData})=>sceneData.hitman.pos.y-6,index:game=>{const{pos,goal,anim}=game.sceneData.hitman;const dx=pos.x>goal.x?-1:pos.x<goal.x?1:0;const dy=pos.y>goal.y?-1:pos.y<goal.y?1:0;const moving=Math.abs(pos.x-goal.x)>=1||Math.abs(pos.y-goal.y)>=1;const animation=game.getAnimation(dx,dy);const frame=moving?Math.floor(game.now/100)%4:0;return anim[animation][frame]},hidden:game=>!game.sceneData.hitman.visible,},{src:ASSETS.SPACESHIP,col:1,row:2,offsetY:game=>{if(game.sceneData.liftShip){const time=(game.now-game.sceneData.liftShip)/500;return-time*time}
return 0},onClick:game=>{const{pos,goal,visible}=game.sceneData.hitman;game.sceneData.script=[game=>{game.sceneData.hitman.goal.x=15;game.sceneData.hitman.goal.y=45;return!0},game=>{const{pos,goal}=game.sceneData.hitman;return pos.x===goal.x&&pos.y===goal.y},game=>{game.hideCursor=!0;game.sceneData.ladderDown=game.now;return!0},game=>{return game.now-game.sceneData.ladderDown>1000},game=>{game.sceneData.yupa.goal={};game.sceneData.yupa.goal.x=20;game.sceneData.yupa.goal.y=45;return!0},game=>{const{pos,goal}=game.sceneData.yupa;return pos.x===goal.x&&pos.y===goal.y},game=>{game.sceneData.showForegroundShip=!0;game.sceneData.yupa.goal.x=23;game.sceneData.yupa.goal.y=30;game.sceneData.hitman.goal.x=23;game.sceneData.hitman.goal.y=45;return!0},game=>{const{pos,goal}=game.sceneData.hitman;return pos.x===goal.x&&pos.y===goal.y},game=>{game.sceneData.hitman.goal.x=23;game.sceneData.hitman.goal.y=30;return!0},game=>{const{pos,goal}=game.sceneData.hitman;return pos.x===goal.x&&pos.y===goal.y},game=>{game.sceneData.hitman.visible=!1;game.sceneData.yupa.visible=!1;game.sceneData.ladderDown=0;game.sceneData.ladderUp=game.now;game.sceneData.showForegroundShip=!1;return!0},game=>{return game.now-game.sceneData.ladderUp>1000},game=>{game.playSound(SOUNDS.DIVING);game.sceneData.liftShip=game.now;game.sceneData.ladderUp=0;return!0},game=>{return game.now-game.sceneData.liftShip>4000},game=>{game.gotoScene("stars");return!0},]},},...standardMenu(),...standardBag(),],},);game.addScene({name:"leo-end",onScene:game=>game.showTip("Congrats Leo, you reached the end so far. I didn't program the rest yet."),sprites:[{fade:1,fadeColor:"#cc5588"}],},);gameConfig.scenes.push({name:"load-screen",startScene:!0,onScene:game=>{game.waitCursor=!0;game.sceneData.startTime=game.now;game.sceneData.estimate=3600000},onSceneRefresh:game=>{const progress=game.currentScene.getProgress(game);if(progress<1&&game.now>game.sceneData.startTime){const progressSpeed=progress/(game.now-game.sceneData.startTime);const estimate=(1-progress)/progressSpeed;if(Math.abs(game.sceneData.estimate-estimate)>10000||estimate<game.sceneData.estimate){}}else if(game.now>game.sceneData.startTime&&game.waitCursor){game.waitCursor=!1;game.countLoadError=0;console.log(`${game.now / 1000} sec.`)}},getProgress:game=>{const numAssetsLoaded=game.countAssets(!0);const totalAssets=game.countAssets();return(numAssetsLoaded)/(totalAssets)},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#000000";ctx.fillRect(0,0,64,64)},hidden:game=>game.currentScene.getProgress(game)<1,onClick:game=>{if(!game.sceneData.gameStarted){game.playSound(SOUNDS.RANDOM);game.sceneData.gameStarted=game.now;game.delayAction(game=>{game.gotoScene("start-screen");game.save("clear")},1000)}}},{custom:(game,sprite,ctx)=>{const progress=game.currentScene.getProgress(game);ctx.clearRect(0,0,64,64);ctx.globalAlpha=.08*progress;for(let i=0;i<10;i++){game.displayTextLine(ctx,{msg:"dobuki studio game",x:1,y:2+i*6,})}
ctx.globalAlpha=1;if(progress<1){ctx.fillStyle="#003377";ctx.fillRect(5,35,51,2);ctx.fillStyle="#999999";ctx.fillRect(5,35,1+progress*50,2);game.displayTextLine(ctx,{msg:"Loading~."+(game.now%1500<500?"":game.now%1500<1000?".":".."),x:15,y:26,});if(game.sceneData.estimate<3600000&&Math.floor(game.sceneData.estimate/1000)>0){game.displayTextLine(ctx,{msg:Math.floor(game.sceneData.estimate/1000)+"~ sec",x:18,y:40})}
const numAssetsLoaded=game.countAssets(!0);const totalAssets=game.countAssets();game.displayTextLine(ctx,{msg:`${numAssetsLoaded} / ${totalAssets}`,x:1,y:52,alpha:.2,noTranslate:!0});if(game.sceneData.lastFileLoaded){game.displayTextLine(ctx,{msg:game.sceneData.lastFileLoaded.split(".")[0],x:1,y:58,alpha:.2,noTranslate:!0})}}},},{hidden:game=>{const numScenesLoaded=game.config.scenes.length;const totalScenes=game.getSceneCount();if(numScenesLoaded>=totalScenes){const progress=game.currentScene.getProgress(game);return progress<1}
return!0},custom:(game,sprite,ctx)=>{ctx.globalAlpha=1;if(GAME_VERSION===3){game.displayTextLine(ctx,{msg:"Baby Hitler is",x:8,y:12});game.displayTextLine(ctx,{msg:"OUT OF",x:18,y:19});game.displayTextLine(ctx,{msg:"CONTROL!",x:14,y:26})}else{game.displayTextLine(ctx,{msg:"Where in Space",x:8,y:15});game.displayTextLine(ctx,{msg:"is Baby Hitler?",x:9,y:22})}
ctx.globalAlpha=.2;game.displayTextLine(ctx,{msg:"a game by",x:17,y:40,});game.displayTextLine(ctx,{msg:"Jack Le Hamster",x:5,y:47,});ctx.globalAlpha=1},},{custom:(game,sprite,ctx)=>{const fade=Math.min(1,(game.now-game.sceneData.gameStarted)/1000);const imageData=ctx.getImageData(0,0,64,64);for(let i=0;i<imageData.data.length;i+=4){if(Math.random()<fade){imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255;imageData.data[i+3]=255}}
ctx.putImageData(imageData,0,0)},hidden:game=>!game.sceneData.gameStarted,},{src:game=>game.sceneData.lastFileLoaded,scale:1/16,offsetX:60,offsetY:52,alpha:.5,hidden:game=>game.currentScene.getProgress(game)>=1||!game.sceneData.lastFileLoaded||game.sceneData.lastFileLoaded.indexOf("assets/")!==0,},],});game.addScene({name:"lock-zoom",onScene:game=>{game.startDialog({time:game.now,index:0,conversation:[{message:"",options:[{},{},{msg:"LEAVE",onSelect:game=>{game.gotoScene("locker-room")}},],},],})},onSceneRefresh:(game)=>{const{situation}=game;if(!game.data.lock_unlocked){const code=[situation.digit1||0,situation.digit2||0,situation.digit3||0,situation.digit4||0].join("");if(code===HIGHSCORE+""){game.data.lock_unlocked=game.now;game.playSound(SOUNDS.DUD);game.delayAction(game=>{game.playSound(SOUNDS.DUD)},150);game.showTip("It's the right combination!",game=>{game.gotoScene("locker-room")})}}},sprites:[{src:ASSETS.LOCK_BACK,},{name:"digit1",custom:(game,{name},ctx)=>{const ALIEN_DIGIT_0=1000;const num=game.situation[name]||0;let msg=ALPHAS[ALIEN_DIGIT_0+num].char;ctx.fillStyle="#224455";ctx.fillRect(16,33,5,8);game.displayTextLine(ctx,{msg,x:17+(num===1||num===3?1:0),y:35,})},onClick:(game,{name})=>{if(game.data.lock_unlocked){return}
game.playSound(SOUNDS.DUD);game.situation[name]=((game.situation[name]||0)+1)%10;const{situation}=game;const code=[situation.digit1||0,situation.digit2||0,situation.digit3||0,situation.digit4||0].join("");console.log(code);game.pendingTip=null},},{name:"digit2",custom:(game,{name},ctx)=>{const ALIEN_DIGIT_0=1000;const num=game.situation[name]||0;let msg=ALPHAS[ALIEN_DIGIT_0+num].char;ctx.fillStyle="#224455";ctx.fillRect(26,33,5,8);game.displayTextLine(ctx,{msg,x:27+(num===1||num===3?1:0),y:35,})},onClick:(game,{name})=>{if(game.data.lock_unlocked){return}
game.playSound(SOUNDS.DUD);game.situation[name]=((game.situation[name]||0)+1)%10;const{situation}=game;const code=[situation.digit1||0,situation.digit2||0,situation.digit3||0,situation.digit4||0].join("");console.log(code);game.pendingTip=null},},{name:"digit3",custom:(game,{name},ctx)=>{const ALIEN_DIGIT_0=1000;const num=game.situation[name]||0;let msg=ALPHAS[ALIEN_DIGIT_0+num].char;ctx.fillStyle="#224455";ctx.fillRect(35,33,5,8);game.displayTextLine(ctx,{msg,x:36+(num===1||num===3?1:0),y:35,})},onClick:(game,{name})=>{if(game.data.lock_unlocked){return}
game.playSound(SOUNDS.DUD);game.situation[name]=((game.situation[name]||0)+1)%10;const{situation}=game;const code=[situation.digit1||0,situation.digit2||0,situation.digit3||0,situation.digit4||0].join("");console.log(code);game.pendingTip=null},},{name:"digit4",custom:(game,{name},ctx)=>{const ALIEN_DIGIT_0=1000;const num=game.situation[name]||0;let msg=ALPHAS[ALIEN_DIGIT_0+num].char;ctx.fillStyle="#224455";ctx.fillRect(45,33,5,8);game.displayTextLine(ctx,{msg,x:46+(num===1||num===3?1:0),y:35,})},onClick:(game,{name})=>{if(game.data.lock_unlocked){return}
game.playSound(SOUNDS.DUD);game.situation[name]=((game.situation[name]||0)+1)%10;const{situation}=game;const code=[situation.digit1||0,situation.digit2||0,situation.digit3||0,situation.digit4||0].join("");console.log(code);game.pendingTip=null},},{src:ASSETS.SPEECH_OUT,offsetY:15,hidden:game=>game.bagOpening||game.useItem||game.pendingTip,index:game=>Math.min(3,Math.floor((game.now-game.sceneTime)/80)),},],},);game.addScene({name:"locker-room",arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(1),null,RIGHT],[LEFT,null,s(5),null,RIGHT],],doors:{1:{exit:game=>game.fadeToScene("maze-3",{door:3}),},},map:`
			XXX
			XOX
			X.X
			X1X
			XXX
		`,onScene:game=>{game.save()},sprites:[...getRoomMaze("_BLUE_1"),{src:ASSETS.LOCKER_ROOM,hidden:game=>game.rotation!==0,},{name:"access card",src:ASSETS.ACCESS_CARD,hidden:(game,{name})=>game.rotation!==0||!game.situation.midLockerOpen||game.data.pickedUp[name],onClick:(game,{name})=>game.pickUp({item:name,image:ASSETS.GRAB_ACCESS_CARD,message:"Looks like some kind of access card!"}),},{src:ASSETS.LOCKER_DOOR,index:({situation})=>situation.rightLockerOpen?1:0,onClick:({situation})=>{game.playSound(SOUNDS.DOOR);situation.rightLockerOpen=!situation.rightLockerOpen},hidden:game=>game.rotation!==0,},{src:ASSETS.LOCKER_DOOR,index:({situation})=>situation.midLockerOpen?3:2,onClick:(game)=>{const{situation}=game;if(game.data.lock_unlocked){game.playSound(SOUNDS.DOOR);situation.midLockerOpen=!situation.midLockerOpen}else{game.gotoScene("lock-zoom")}},tip:({situation,data})=>situation.midLockerOpen||data.lock_unlocked?null:game.getSituation("zoom-arcade").gotHighScore?"Looks like some symbol on that locker. It looks familiar.":"Looks like some symbol on that locker.",hidden:game=>game.rotation!==0,},{src:ASSETS.LOCK_BLOCK,hidden:game=>game.rotation!==0||game.data.lock_unlocked,},...standardBag(),...standardMenu(),],},);game.addScene({name:"look-over-there",onScene:game=>{game.playTheme(SOUNDS.JAIL_CELL_THEME);game.currentScene.startTalk(game,"yupa",["Look ova dere!",],game=>{game.delayAction(game=>{game.sceneData.showGangsta=game.now;game.delayAction(game=>{game.sceneData.showGangsta=0;game.sceneData.surprised=game.now;game.currentScene.startTalk(game,"human",["That young boy over there, is that? ...",],game=>{game.currentScene.startTalk(game,"yupa",["Yeah, dat's Baby Hitla!",],game=>{game.delayAction(game=>{game.sceneData.showBabyHitlerWaiter=game.now;game.delayAction(game=>{game.sceneData.showBabyHitlerWaiter=0;game.currentScene.startTalk(game,"human",["Are you sure?","He doesn't look at all like a future dictator...",],game=>{game.currentScene.startTalk(game,"yupa",["Yeah, I raconize dat hairstyle","Definatly dats him.",],game=>{game.currentScene.startTalk(game,"human",["Ok... then that man sitting there.","I bet you that's Dick Ruber.",],game=>{game.sceneData.showGangsta=game.now;game.currentScene.startTalk(game,"human",["Looks like he's surrrounded by two\nbodyguards,","which might cause a bit of trouble.","Let's first check out the room,","then we can chat with him.",],game=>{game.gotoScene("explore-tavern")})})})})},5000)},500)})})},4000)},1000)});game.delayAction(game=>{game.sceneData.turnHead=game.now},1500)},startTalk:(game,talker,msg,onDone,removeLock,speed)=>{let x,y;if(talker==="human"){x=5;y=15;game.playSound(SOUNDS.HUM)}else if(talker==="yupa"){x=2;y=44;game.playSound(SOUNDS.YUPA)}
game.showTip(msg,onDone,speed||80,{x,y,talker,removeLock})},sprites:[{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:0,},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:game=>{if(game.sceneData.turnHead){const frames=[5,4,1,2,3,];const frameIndex=Math.min(4,Math.floor((game.now-game.sceneData.turnHead)/200));return frames[frameIndex]}else{return 5}},},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:game=>{if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="human"){return Math.floor(game.now/200)%4+13}
return 13},hidden:game=>!game.sceneData.surprised,},{src:ASSETS.BEARD_SHAVED,col:3,row:3,scale:(game,sprite)=>1.2,offsetX:(game,sprite)=>{if(game.sceneData.turnHead){const frameIndex=Math.min(4,Math.floor((game.now-game.sceneData.turnHead)/200));return 2.5+(2-frameIndex)/2}else{return 3.5}},offsetY:(game,sprite)=>-11,index:(game,sprite)=>{const{pendingTip,now}=game;return pendingTip&&pendingTip.talker==="human"&&pendingTip.progress<1?Math.floor(now/100)%4:0},},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:8,},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:game=>{const frame=Math.floor(game.now/50)%3;return frame!==0?frame%2+11:8},hidden:game=>!game.pendingTip||game.pendingTip.progress>=1||game.pendingTip.talker!=="yupa",},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.showGangsta,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.showGangsta,index:1,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.showGangsta,index:6,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.showGangsta,index:7,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.showGangsta,index:10,},{src:ASSETS.TAVERN_GANGSTA,col:5,row:5,hidden:game=>!game.sceneData.showGangsta,index:game=>{return game.sceneData.gangstaLookUp?14:11},},{src:ASSETS.BABY_HITLER_WAITER,hidden:game=>!game.sceneData.showBabyHitlerWaiter,},],},);game.addScene({name:"look-right-left",onScene:game=>{game.playTheme(SOUNDS.JAIL_CELL_THEME);game.delayAction(game=>{game.gotoScene("inside-tavern")},11000)},sprites:[{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:0,},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:game=>{const period=400,timeTurn=7000;if(game.now-game.sceneTime>timeTurn&&(game.now-game.sceneTime-timeTurn)/period<Math.PI*2){const frame=Math.round(Math.sin((game.now-game.sceneTime-timeTurn)/period)*2);if(frame>0){return 1+frame}else if(frame<0){return 3-frame}}
return 1},scale:game=>Math.min(1,.7+.3*(game.now-game.sceneTime)/5000),offsetX:(game,sprite)=>3+(game.now-game.sceneTime>=5000?0:32-32*game.evaluate(sprite.scale)),offsetY:(game,sprite)=>+3+(game.now-game.sceneTime>=5000?0:64-(64+Math.abs(Math.sin((5000+game.sceneTime-game.now)/300))*2)*game.evaluate(sprite.scale)),},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:game=>{if(game.pendingTip&&game.pendingTip.progress<1&&game.pendingTip.talker==="human"){return Math.floor(game.now/200)%4+13}
return 13},hidden:game=>!game.sceneData.surprised,},{src:ASSETS.BEARD_SHAVED,col:3,row:3,scale:(game,sprite)=>.2+game.evaluate(sprite.innerScale),innerScale:game=>Math.min(1,.7+.3*(game.now-game.sceneTime)/5000),offX:game=>{const period=400,timeTurn=7000;if(game.now-game.sceneTime>timeTurn&&(game.now-game.sceneTime-timeTurn)/period<Math.PI*2){const frame=Math.sin((game.now-game.sceneTime-timeTurn)/period)*1.3;return 7-frame}
return 7},offY:3,offsetX:(game,sprite)=>3+(game.now-game.sceneTime>=5000?32-1.2*(32-game.evaluate(sprite.offX)):32-(32-game.evaluate(sprite.offX))*game.evaluate(sprite.scale,sprite)),offsetY:(game,sprite)=>+1+(game.now-game.sceneTime>=5000?64-1.2*(64-game.evaluate(sprite.offY)):64-(64-game.evaluate(sprite.offY)+Math.abs(Math.sin((5000+game.sceneTime-game.now)/300))*2)*game.evaluate(sprite.scale,sprite)),},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:game=>{const period=350,timeTurn=7200;if(game.now-game.sceneTime>timeTurn&&(game.now-game.sceneTime-timeTurn)/period<Math.PI*2){const frame=Math.round(Math.sin((game.now-game.sceneTime-timeTurn)/period)*2);if(frame>0){return 6+frame}else if(frame<0){return 8-frame}}
return 6},scale:game=>Math.min(1,.7+.3*(game.now-game.sceneTime)/5000),offsetX:(game,sprite)=>game.now-game.sceneTime>=5000?0:32-32*game.evaluate(sprite.scale),offsetY:(game,sprite)=>+1+(game.now-game.sceneTime>=5000?0:64-(64+Math.abs(Math.sin((5000+game.sceneTime-game.now)/200))*1)*game.evaluate(sprite.scale)),},{src:ASSETS.LOOK_RIGHT_LEFT,col:4,row:5,index:game=>{const frame=Math.floor(game.now/50)%3;return frame!==0?frame%2+11:8},hidden:game=>!game.pendingTip||game.pendingTip.progress<1||game.pendingTip.talker!=="yupa",},],},);game.addScene({name:"maze-2",onScene:game=>{game.save()},arrowGrid:[[null,null,MENU,null,null],[],[LEFT,null,s(1),null,RIGHT],[LEFT,s(7),s(8),s(7),RIGHT],[LEFT,s(7),s(3),s(7),RIGHT],],map:`
			XXXXXXXXXXXXXXXXX
			X...TXXXXXXXXXXXX
			X.XXXXXXXXXXXXXXX
			X_._._._._:5XXXXX
			X.XXXXXXXXXXXXXXX
			X.XMXXXXXXXXXXXXX
			X_._._._._._...2X
			XXX.XXXXXXX:XXXXX
			XXX...3XXXX.XXXXX
			XXX.XXXXXXX.XXXXX
			XXX...4XXXX.XXXXX
			XXXXXXXXXXX.XMXXX
			XXXX1.........XXX
			XXXXXXXXXXXXXXXXX
		`,sprites:[{custom:(game,sprite,ctx)=>ctx.clearRect(0,0,64,64),},...getCommonMaze("_BLUE_1"),makeFoe('guard',ASSETS.GUARD),makeYupa(),...standardBattle(),...standardMenu(),...standardBag(),],doors:{1:{scene:"maze",exit:(game,{scene})=>game.fadeToScene(scene,{door:2},1000),},2:{scene:"toilets",exit:(game,{scene})=>game.fadeToScene(scene,null,1000),},3:{scene:"vending-machine",exit:(game,{scene})=>game.fadeToScene(scene,null,1000),},4:{scene:"arcade-room",exit:(game,{scene})=>game.fadeToScene(scene,null,1000),},5:{scene:"maze-3",wayUp:!0,exit:(game,{scene})=>{game.fadeToScene(scene,{door:1},1000)},},},...makeOnSceneBattle(),events:{T:{chest:!0,blocking:!0,onEvent:(game,event)=>{const{data,now}=game;game.findChest(now,{item:"coin",image:ASSETS.GRAB_COIN,cleared:game.situation.chestCleared,})},},':':{foe:"guard",foeLife:80,foeBlockChance:.5,attackSpeed:3000,riposteChance:.5,attackPeriod:100,foeDamage:9,foeDefense:10,xp:5,belowTheBelt:!1,onEvent:(game,{foe,foeLife,foeBlockChance,foeDefense,attackSpeed,riposteChance,attackPeriod,foeDamage,onWin,xp,belowTheBelt})=>{const{data,now}=game;game.chest=null;game.playTheme(SOUNDS.BATTLE_THEME,{volume:.8});if(!data.battle){data.battle={time:now,foe,fist:LEFT,attackSpeed,playerHit:0,playerBlock:0,foeBlockChance,playerLeftAttack:0,playerRightAttack:0,playerAttackLanded:0,playerAttackPeriod:50,foeLife,foeMaxLife:foeLife,foeBlock:0,foeDefense,foeDefeated:0,attackPeriod,riposteChance,foeDamage,onWin,xp,belowTheBelt,}}
return!0},onWin:game=>game.findChest(game.now+2000,{item:"coin",image:ASSETS.GRAB_COIN,}),},},},)