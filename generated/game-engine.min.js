"undefined"==typeof Newgrounds&&(Newgrounds={}),Newgrounds.io={GATEWAY_URI:"//newgrounds.io/gateway_v3.php"},Newgrounds.io.events={},Newgrounds.io.call_validators={},Newgrounds.io.model={checkStrictValue:function(e,t,r,n,o,s,i){if("mixed"==n)return!0
if(null===r||"undefined"==typeof r)return!0
if(n&&r.constructor===n)return!0
if(n==Boolean&&r.constructor===Number)return!0
if(o&&r.constructor===Newgrounds.io.model[o])return!0
if(r.constructor===Array&&(s||i)){for(var u=0;u<r.length;u++)this.checkStrictValue(e,t,r[u],s,i,null,null)
return!0}if(e)throw new Error("Illegal '"+t+"' value set in model "+e)
return!1}},Newgrounds.io.events.OutputEvent=function(e,t,r){this.type=e,this.call=t,this.data=r,this.success=r&&r.success?!0:!1,this.preventDefault=!1},Newgrounds.io.events.OutputEvent.prototype.constructor=Newgrounds.io.events.OutputEvent,Newgrounds.io.events.SessionEvent=function(e){this.type=e,this.user=null,this.passport_url=null},Newgrounds.io.events.SessionEvent.USER_LOADED="user-loaded",Newgrounds.io.events.SessionEvent.SESSION_EXPIRED="session-expired",Newgrounds.io.events.SessionEvent.REQUEST_LOGIN="request-login",Newgrounds.io.events.SessionEvent.prototype.constructor=Newgrounds.io.events.SessionEvent,Newgrounds.io.events.EventDispatcher=function(){},Newgrounds.io.events.EventDispatcher.prototype={_event_listeners:{},addEventListener:function(e,t){if(e.constructor!==String)throw new Error("Event names must be a string format.")
if(t.constructor!==Function)throw new Error("Event listeners must be functions.")
"undefined"==typeof this._event_listeners[e]&&(this._event_listeners[e]=[]),this._event_listeners[e].push(t)},removeEventListener:function(e,t){if("undefined"!=typeof this._event_listeners[e]){var r=-1
for(i=0;i<this._event_listeners[e].length;i++)if(this._event_listeners[e][i]===t){r=i
break}return r>=0?(this._event_listeners[e].splice(r,1),!0):!1}},removeAllEventListeners:function(e){if("undefined"==typeof this._event_listeners[e])return 0
var t=this._event_listeners[e].length
return this._event_listeners[e]=[],t},dispatchEvent:function(e){var t,r=!1
for(var n in Newgrounds.io.events)if(e.constructor===Newgrounds.io.events[n]){r=!0
break}if(!r)throw new Error("Unsupported event object")
if("undefined"==typeof this._event_listeners[e.type])return!1
for(var o=0;o<this._event_listeners[e.type].length;o++)if(t=this._event_listeners[e.type][o],t(e)===!1||e.preventDefault)return!0
return!0}},Newgrounds.io.events.EventDispatcher.prototype.constructor=Newgrounds.io.events.EventDispatcher,Newgrounds.io.core=function(e,t){function r(){return"undefined"!=typeof localStorage&&localStorage&&localStorage.getItem.constructor==Function?!0:(console.warn("localStorage unavailable. Are you running from a web server?"),!1)}function n(){if(!r())return null
var e=localStorage.getItem(p)
return e?e:null}function o(e){return r()?void localStorage.setItem(p,e):null}function s(){return r()?void localStorage.removeItem(p):null}var i,u,l,a,c=this,d=new Newgrounds.io.urlHelper
if(d.getRequestQueryParam("ngio_session_id")&&(u=d.getRequestQueryParam("ngio_session_id")),Object.defineProperty(this,"app_id",{get:function(){return i}}),Object.defineProperty(this,"user",{get:function(){return this.getCurrentUser()}}),Object.defineProperty(this,"session_id",{set:function(e){if(e&&"string"!=typeof e)throw new Error("'session_id' must be a string value.")
u=e?e:null},get:function(){return u?u:null}}),Object.defineProperty(this,"debug",{set:function(e){l=e?!0:!1},get:function(){return l}}),!e)throw new Error("Missing required 'app_id' in Newgrounds.io.core constructor")
if("string"!=typeof e)throw new Error("'app_id' must be a string value in Newgrounds.io.core constructor")
i=e,t?a=CryptoJS.enc.Base64.parse(t):console.warn("You did not set an encryption key. Some calls may not work without this.")
var p="Newgrounds-io-app_session-"+i.split(":").join("-")
!u&&n()&&(u=n()),this.addEventListener("App.endSession",function(e){c.session_id=null,s()}),this.addEventListener("App.startSession",function(e){e.success&&(c.session_id=e.data.session.id)}),this.addEventListener("App.checkSession",function(e){e.success?e.data.session.expired?(s(),this.session_id=null):e.data.session.remember&&o(e.data.session.id):(this.session_id=null,s())}),this._encryptCall=function(e){if(!e||!e.constructor==Newgrounds.io.model.call_model)throw new Error("Attempted to encrypt a non 'call' object")
var t=CryptoJS.lib.WordArray.random(16),r=CryptoJS.AES.encrypt(JSON.stringify(e.toObject()),a,{iv:t}),n=CryptoJS.enc.Base64.stringify(t.concat(r.ciphertext))
return e.secure=n,e.parameters=null,e}},Newgrounds.io.core.prototype={_session_loader:null,_call_queue:[],_event_listeners:{},addEventListener:Newgrounds.io.events.EventDispatcher.prototype.addEventListener,removeEventListener:Newgrounds.io.events.EventDispatcher.prototype.removeEventListener,removeAllEventListeners:Newgrounds.io.events.EventDispatcher.prototype.removeAllEventListeners,dispatchEvent:Newgrounds.io.events.EventDispatcher.prototype.dispatchEvent,getSessionLoader:function(){return null==this._session_loader&&(this._session_loader=new Newgrounds.io.SessionLoader(this)),this._session_loader},getSession:function(){return this.getSessionLoader().session},getCurrentUser:function(){var e=this.getSessionLoader()
return e.session?e.session.user:null},getLoginError:function(){return this.getSessionLoader().last_error},getValidSession:function(e,t){this.getSessionLoader().getValidSession(e,t)},requestLogin:function(e,t,r,n){function o(){i&&clearInterval(i),u.removeEventListener("cancelLoginRequest",s),l.closePassport()}function s(){r&&r.constructor===Function?r.call(n):t.call(n),o()}if(!e||e.constructor!==Function)throw"Missing required callback for 'on_logged_in'."
if(!t||t.constructor!==Function)throw"Missing required callback for 'on_login_failed'."
var i,u=this,l=this.getSessionLoader()
u.addEventListener("cancelLoginRequest",s),u.getCurrentUser()?e.call(n):(l.loadPassport(),i=setInterval(function(){l.checkSession(function(r){!r||r.expired?111==l.last_error.code?s():(o(),t.call(n)):r.user&&(o(),e.call(n))})},3e3))},cancelLoginRequest:function(){event=new Newgrounds.io.events.OutputEvent("cancelLoginRequest",null,null),this.dispatchEvent(event)},logOut:function(e,t){this.getSessionLoader().endSession(e,t)},queueComponent:function(e,t,r,n){t&&t.constructor===Function&&!r&&(r=t,t=null)
var o=new Newgrounds.io.model.call(this)
o.component=e,"undefined"!=typeof t&&(o.parameters=t),this._validateCall(o),this._call_queue.push([o,r,n])},executeQueue:function(){for(var e=[],t=[],r=[],n=0;n<this._call_queue.length;n++)e.push(this._call_queue[n][0]),t.push(this._call_queue[n][1]),r.push(this._call_queue[n][2])
this._doCall(e,t,r),this._call_queue=[]},callComponent:function(e,t,r,n){t.constructor!==Function||r||(r=t,t=null)
var o=new Newgrounds.io.model.call(this)
o.component=e,"undefined"!=typeof t&&(o.parameters=t),this._validateCall(o),this._doCall(o,r,n)},_doCallback:function(e,t,r,n){var o,s,i,u={success:!1,error:{code:0,message:"Unexpected Server Response"}}
if("undefined"==typeof r&&(r=null),e.constructor===Array&&t&&t.constructor===Array)for(o=0;o<e.length;o++)s=r&&"undefined"!=typeof r[o]?r[o]:u,i="undefined"==typeof t[o]?null:t[o],this._doCallback(e[o],i,s,n[o])
else{if(r&&"undefined"!=typeof r.data){var l
if(r.data.constructor===Array)for(l=[],o=0;o<r.data.length;o++)l.push(this._formatResults(r.component,r.data[o]))
else l=this._formatResults(r.component,r.data)
r.data=l}var a
r?"undefined"!=typeof r.data?a=r.data:(console.warn("Received empty data from '"+e.component+"'."),a=null):a=u
var c
if(a.constructor===Array)for(o=0;o<a.length;o++)c=new Newgrounds.io.events.OutputEvent(e.component,e[o],a[o]),this.dispatchEvent(c)
else c=new Newgrounds.io.events.OutputEvent(e.component,e,a),this.dispatchEvent(c)
t&&t.constructor===Function&&t.call(n,a)}},_formatResults:function(e,t){var r,n,o,s,i,u=null
if("undefined"!=typeof t.success&&t.success&&(u=Newgrounds.io.call_validators.getValidator(e)),!u)return t
var l=u.returns
for(n in l)if("undefined"!=typeof t[n]||t.success===!1){if("undefined"!=typeof l[n].array){if(i="undefined"!=typeof l[n].array.object?l[n].array.object:l[n].array,"undefined"==typeof Newgrounds.io.model[i]){console.warn("Received unsupported model '"+i+"' from '"+e+"'.")
continue}if(t[n].constructor!==Array){console.warn("Expected array<"+i+"> value for '"+n+"' in '"+e+"' data, got "+typeof t[n])
continue}for(s=[],o=0;o<t[n].length;o++)r=new Newgrounds.io.model[i](this),r.fromObject(t[n][o]),s.push(r)
t[n]=s}else if("undefined"!=typeof l[n].object&&t[n]){if(i=l[n].object,"undefined"==typeof Newgrounds.io.model[i]){console.warn("Received unsupported model '"+i+"' from '"+e+"'.")
continue}r=new Newgrounds.io.model[i](this),r.fromObject(t[n]),t[n]=r}}else console.warn("Newgrounds.io server failed to return expected '"+n+"' in '"+e+"' data.")
return t},_doCall:function(e,t,r){function n(e){var t=Newgrounds.io.call_validators.getValidator(e.component)
if(t.hasOwnProperty("redirect")&&t.redirect){var r=e.parameters
if(!r||!r.hasOwnProperty("redirect")||r.redirect)return!0}return!1}if(!this.app_id)throw new Error("Attempted to call Newgrounds.io server without setting an app_id in Newgrounds.io.core instance.")
var o,s=!1
if(e.constructor===Array)for(o=[],i=0;i<e.length;i++){if(n(e[i]))throw new Error("Loader components can not be called in an array without a redirect=false parameter.")
o.push(e[i].toObject())}else o=e.toObject(),s=n(e)
var u={app_id:this.app_id,session_id:this.session_id,call:o}
if(this.debug&&(u.debug=1),s){var l=({success:!0,app_id:this.app_id,result:{component:e.component,data:{success:!0}}},document.createElement("form"))
l.action=Newgrounds.io.GATEWAY_URI,l.target="_blank",l.method="POST"
var a=document.createElement("input")
a.type="hidden",a.name="input",l.appendChild(a),document.body.appendChild(l),a.value=JSON.stringify(u),l.submit(),document.body.removeChild(l)}else{var c=new XMLHttpRequest,d=this
c.onreadystatechange=function(){if(4==c.readyState){var n
try{n=JSON.parse(c.responseText).result}catch(o){}d._doCallback(e,t,n,r)}}
var p=new FormData,_="undefined"!=typeof Array.prototype.toJSON?Array.prototype.toJSON:null
_&&delete Array.prototype.toJSON,p.append("input",JSON.stringify(u)),_&&(Array.prototype.toJSON=_),c.open("POST",Newgrounds.io.GATEWAY_URI,!0),c.send(p)}},_doValidateCall:function(e,t){var r,n,o,s,i=Newgrounds.io.call_validators.getValidator(e)
if(!i)throw new Error("'"+e+"' is not a valid server component.")
if(i.require_session&&!this.session_id)throw new Error("'"+e+"' requires a session id")
if(i["import"]&&i["import"].length>0)for(r=0;r<i["import"].length;r++)n=i["import"][r].split("."),this._doValidateCall(n[0],n[1],t)
var u
for(o in i.params)if(s=i.params[o],u=t&&"undefined"!=typeof t[o]?t[o]:null,!u&&s.extract_from&&s.extract_from.alias&&(u=t[s.extract_from.alias]),null!==u){if(s.extract_from&&u.constructor===Newgrounds.io.model[s.extract_from.object]&&(u=u[s.extract_from.property]),!Newgrounds.io.model.checkStrictValue(null,o,u,s.type,null,null,null))throw new Error("Illegal value for '"+o+"' parameter of '"+e+"': "+u)}else if(s.required)throw new Error("Missing required parameter for '"+e+"': "+o)},_validateCall:function(e){var t
if(e.constructor===Array){var r=[]
for(t=0;t<e.length;t++)r.push(this._validateCall(e[t]))
return r}if(e.constructor!==Newgrounds.io.model.call)throw new Error("Unexpected 'call_model' value. Expected Newgrounds.io.model.call instance.")
var n=e.component,o=e.parameters,s=e.echo
if(o&&o.constructor===Array)for(t=0;t<o.length;t++)this._doValidateCall(n,o[t])
else this._doValidateCall(n,o)
var i={component:e.component},u=Newgrounds.io.call_validators.getValidator(e.component)
if("undefined"!=typeof o)if(u.secure){var l=this._encryptCall(e)
i.secure=l.secure}else i.parameters=o
return"undefined"!=typeof s&&(i.echo=s),i}},Newgrounds.io.core.prototype.constructor=Newgrounds.io.core,Newgrounds.io.core.instance_id=0,Newgrounds.io.core.getNextInstanceID=function(){return Newgrounds.io.core.instance_id++,Newgrounds.io.core.instance_id},Newgrounds.io.urlHelper=function(){var e=window.location.href,t={},r=e.split("?").pop()
if(r)for(var n,o=r.split("&"),s=0;s<o.length;s++)n=o[s].split("="),t[n[0]]=n[1]
this.getRequestQueryParam=function(e,r){return"undefined"==typeof r&&(r=null),"undefined"==typeof t[e]?r:t[e]}},Newgrounds.io.model.call=function(e,t){var r,n,o,s
this.__property_names=["component","echo","parameters","secure"],this.__classname="Newgrounds.io.model.call",this.__ngio=e
var r
Object.defineProperty(this,"component",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"component",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"echo",{get:function(){return"undefined"==typeof n?null:n},set:function(e){n=e}})
var o
Object.defineProperty(this,"parameters",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"parameters",e,Object,null,Object,null),o=e}})
var s
Object.defineProperty(this,"secure",{get:function(){return"undefined"==typeof s?null:s},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"secure",e,String,null,null,null),s=e}}),t&&this.fromObject(t)},Newgrounds.io.model.call.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.call.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.call.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],this[this.__property_names[r]]=t},Newgrounds.io.model.call.prototype.constructor=Newgrounds.io.model.call,Newgrounds.io.model.debug=function(e,t){var r,n
this.__property_names=["exec_time","input"],this.__classname="Newgrounds.io.model.debug",this.__ngio=e
var r
Object.defineProperty(this,"exec_time",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"exec_time",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"input",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"input",e,null,"input",null,null),n=e}}),t&&this.fromObject(t)},Newgrounds.io.model.debug.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.debug.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.debug.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],"input"==this.__property_names[r]&&t&&(t=new Newgrounds.io.model.input(this.__ngio,t)),this[this.__property_names[r]]=t},Newgrounds.io.model.debug.prototype.constructor=Newgrounds.io.model.debug,Newgrounds.io.model.error=function(e,t){var r,n
this.__property_names=["code","message"],this.__classname="Newgrounds.io.model.error",this.__ngio=e
var r
Object.defineProperty(this,"code",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"code",e,Number,null,null,null),r=e}})
var n
Object.defineProperty(this,"message",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"message",e,String,null,null,null),n=e}}),t&&this.fromObject(t)},Newgrounds.io.model.error.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.error.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.error.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],this[this.__property_names[r]]=t},Newgrounds.io.model.error.get=function(e,t){var r=new Newgrounds.io.model.error
return r.message=e?e:"Unknown Error",r.code=t?t:0,r},Newgrounds.io.model.error.MISSING_INPUT=100,Newgrounds.io.model.error.INVALID_INPUT=101,Newgrounds.io.model.error.MISSING_PARAMETER=102,Newgrounds.io.model.error.INVALID_PARAMETER=103,Newgrounds.io.model.error.EXPIRED_SESSION=104,Newgrounds.io.model.error.DUPLICATE_SESSION=105,Newgrounds.io.model.error.MAX_CONNECTIONS_EXCEEDED=106,Newgrounds.io.model.error.MAX_CALLS_EXCEEDED=107,Newgrounds.io.model.error.MEMORY_EXCEEDED=108,Newgrounds.io.model.error.TIMED_OUT=109,Newgrounds.io.model.error.LOGIN_REQUIRED=110,Newgrounds.io.model.error.INVALID_APP_ID=200,Newgrounds.io.model.error.INVALID_ENCRYPTION=201,Newgrounds.io.model.error.INVALID_MEDAL_ID=202,Newgrounds.io.model.error.INVALID_SCOREBOARD_ID=203,Newgrounds.io.model.error.INVALID_SAVEGROUP_ID=204,Newgrounds.io.model.error.SERVER_UNAVAILABLE=504,Newgrounds.io.model.error.prototype.constructor=Newgrounds.io.model.error,Newgrounds.io.model.input=function(e,t){var r,n,o,s,i
this.__property_names=["app_id","call","debug","echo","session_id"],this.__classname="Newgrounds.io.model.input",this.__ngio=e
var r
Object.defineProperty(this,"app_id",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"app_id",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"call",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"call",e,null,"call",null,"call"),n=e}})
var o
Object.defineProperty(this,"debug",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"debug",e,Boolean,null,null,null),o=e}})
var s
Object.defineProperty(this,"echo",{get:function(){return"undefined"==typeof s?null:s},set:function(e){s=e}})
var i
Object.defineProperty(this,"session_id",{get:function(){return"undefined"==typeof i?null:i},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"session_id",e,String,null,null,null),i=e}}),t&&this.fromObject(t)},Newgrounds.io.model.input.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.input.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.input.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],"call"==this.__property_names[r]&&t&&(t=new Newgrounds.io.model.call(this.__ngio,t)),this[this.__property_names[r]]=t},Newgrounds.io.model.input.prototype.constructor=Newgrounds.io.model.input,Newgrounds.io.model.medal=function(e,t){var r,n,o,s,i,u,l,a
this.__property_names=["description","difficulty","icon","id","name","secret","unlocked","value"],this.__classname="Newgrounds.io.model.medal",this.__ngio=e
var r
Object.defineProperty(this,"description",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"description",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"difficulty",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"difficulty",e,Number,null,null,null),n=e}})
var o
Object.defineProperty(this,"icon",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"icon",e,String,null,null,null),o=e}})
var s
Object.defineProperty(this,"id",{get:function(){return"undefined"==typeof s?null:s},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"id",e,Number,null,null,null),s=e}})
var i
Object.defineProperty(this,"name",{get:function(){return"undefined"==typeof i?null:i},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"name",e,String,null,null,null),i=e}})
var u
Object.defineProperty(this,"secret",{get:function(){return"undefined"==typeof u?null:u},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"secret",e,Boolean,null,null,null),u=e}})
var l
Object.defineProperty(this,"unlocked",{get:function(){return"undefined"==typeof l?null:l},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"unlocked",e,Boolean,null,null,null),l=e}})
var a
Object.defineProperty(this,"value",{get:function(){return"undefined"==typeof a?null:a},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"value",e,Number,null,null,null),a=e}}),t&&this.fromObject(t)},Newgrounds.io.model.medal.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.medal.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.medal.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],this[this.__property_names[r]]=t},Newgrounds.io.model.medal.prototype.unlock=function(e){if(this._has_ngio_user())this.__ngio.callComponent("Medal.unlock",{id:this.id},function(t){t.success&&(this.unlocked=!0),e(t)})
else if("function"==typeof e){var t=Newgrounds.io.model.error.get("This function requires a valid user session.",Newgrounds.io.model.error.LOGIN_REQUIRED),r={success:!1,error:t}
e(r)}},Newgrounds.io.model.medal.prototype.constructor=Newgrounds.io.model.medal,Newgrounds.io.model.output=function(e,t){var r,n,o,s,i,u,l,a
this.__property_names=["api_version","app_id","debug","echo","error","help_url","result","success"],this.__classname="Newgrounds.io.model.output",this.__ngio=e
var r
Object.defineProperty(this,"api_version",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"api_version",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"app_id",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"app_id",e,String,null,null,null),n=e}})
var o
Object.defineProperty(this,"debug",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"debug",e,null,"debug",null,null),o=e}})
var s
Object.defineProperty(this,"echo",{get:function(){return"undefined"==typeof s?null:s},set:function(e){s=e}})
var i
Object.defineProperty(this,"error",{get:function(){return"undefined"==typeof i?null:i},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"error",e,null,"error",null,null),i=e}})
var u
Object.defineProperty(this,"help_url",{get:function(){return"undefined"==typeof u?null:u},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"help_url",e,String,null,null,null),u=e}})
var l
Object.defineProperty(this,"result",{get:function(){return"undefined"==typeof l?null:l},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"result",e,null,"result",null,"result"),l=e}})
var a
Object.defineProperty(this,"success",{get:function(){return"undefined"==typeof a?null:a},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"success",e,Boolean,null,null,null),a=e}}),t&&this.fromObject(t)},Newgrounds.io.model.output.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.output.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.output.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],"debug"==this.__property_names[r]&&t?t=new Newgrounds.io.model.debug(this.__ngio,t):"error"==this.__property_names[r]&&t?t=new Newgrounds.io.model.error(this.__ngio,t):"result"==this.__property_names[r]&&t&&(t=new Newgrounds.io.model.result(this.__ngio,t)),this[this.__property_names[r]]=t},Newgrounds.io.model.output.prototype.constructor=Newgrounds.io.model.output,Newgrounds.io.model.result=function(e,t){var r,n,o
this.__property_names=["component","data","echo"],this.__classname="Newgrounds.io.model.result",this.__ngio=e
var r
Object.defineProperty(this,"component",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"component",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"data",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"data",e,Object,null,Object,null),n=e}})
var o
Object.defineProperty(this,"echo",{get:function(){return"undefined"==typeof o?null:o},set:function(e){o=e}}),t&&this.fromObject(t)},Newgrounds.io.model.result.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.result.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.result.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],this[this.__property_names[r]]=t},Newgrounds.io.model.result.prototype.constructor=Newgrounds.io.model.result,Newgrounds.io.model.score=function(e,t){var r,n,o,s
this.__property_names=["formatted_value","tag","user","value"],this.__classname="Newgrounds.io.model.score",this.__ngio=e
var r
Object.defineProperty(this,"formatted_value",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"formatted_value",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"tag",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"tag",e,String,null,null,null),n=e}})
var o
Object.defineProperty(this,"user",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"user",e,null,"user",null,null),o=e}})
var s
Object.defineProperty(this,"value",{get:function(){return"undefined"==typeof s?null:s},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"value",e,Number,null,null,null),s=e}}),t&&this.fromObject(t)},Newgrounds.io.model.score.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.score.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.score.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],"user"==this.__property_names[r]&&t&&(t=new Newgrounds.io.model.user(this.__ngio,t)),this[this.__property_names[r]]=t},Newgrounds.io.model.score.prototype.constructor=Newgrounds.io.model.score,Newgrounds.io.model.scoreboard=function(e,t){var r,n
this.__property_names=["id","name"],this.__classname="Newgrounds.io.model.scoreboard",this.__ngio=e
var r
Object.defineProperty(this,"id",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"id",e,Number,null,null,null),r=e}})
var n
Object.defineProperty(this,"name",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"name",e,String,null,null,null),n=e}}),t&&this.fromObject(t)},Newgrounds.io.model.scoreboard.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.scoreboard.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.scoreboard.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],this[this.__property_names[r]]=t},Newgrounds.io.model.scoreboard.prototype.postScore=function(e,t,r){if("function"!=typeof t||r||(r=t,t=null),t||(t=null),this._has_ngio_user())this.__ngio.callComponent("ScoreBoard.postScore",{id:this.id,value:e,tag:t},function(e){r(e)})
else if("function"==typeof r){var n=Newgrounds.io.model.error.get("This function requires a valid user session.",Newgrounds.io.model.error.LOGIN_REQUIRED),o={success:!1,error:n}
r(o)}},Newgrounds.io.model.scoreboard.prototype.constructor=Newgrounds.io.model.scoreboard,Newgrounds.io.model.session=function(e,t){var r,n,o,s,i
this.__property_names=["expired","id","passport_url","remember","user"],this.__classname="Newgrounds.io.model.session",this.__ngio=e
var r
Object.defineProperty(this,"expired",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"expired",e,Boolean,null,null,null),r=e}})
var n
Object.defineProperty(this,"id",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"id",e,String,null,null,null),n=e}})
var o
Object.defineProperty(this,"passport_url",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"passport_url",e,String,null,null,null),o=e}})
var s
Object.defineProperty(this,"remember",{get:function(){return"undefined"==typeof s?null:s},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"remember",e,Boolean,null,null,null),s=e}})
var i
Object.defineProperty(this,"user",{get:function(){return"undefined"==typeof i?null:i},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"user",e,null,"user",null,null),i=e}}),t&&this.fromObject(t)},Newgrounds.io.model.session.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.session.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.session.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],"user"==this.__property_names[r]&&t&&(t=new Newgrounds.io.model.user(this.__ngio,t)),this[this.__property_names[r]]=t},Newgrounds.io.model.session.prototype.constructor=Newgrounds.io.model.session,Newgrounds.io.model.user=function(e,t){var r,n,o,s
this.__property_names=["icons","id","name","supporter"],this.__classname="Newgrounds.io.model.user",this.__ngio=e
var r
Object.defineProperty(this,"icons",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"icons",e,null,"usericons",null,null),r=e}})
var n
Object.defineProperty(this,"id",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"id",e,Number,null,null,null),n=e}})
var o
Object.defineProperty(this,"name",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"name",e,String,null,null,null),o=e}})
var s
Object.defineProperty(this,"supporter",{get:function(){return"undefined"==typeof s?null:s},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"supporter",e,Boolean,null,null,null),s=e}}),t&&this.fromObject(t)},Newgrounds.io.model.user.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.user.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.user.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],"icons"==this.__property_names[r]&&t&&(t=new Newgrounds.io.model.usericons(this.__ngio,t)),this[this.__property_names[r]]=t},Newgrounds.io.model.user.prototype.constructor=Newgrounds.io.model.user,Newgrounds.io.model.usericons=function(e,t){var r,n,o
this.__property_names=["large","medium","small"],this.__classname="Newgrounds.io.model.usericons",this.__ngio=e
var r
Object.defineProperty(this,"large",{get:function(){return"undefined"==typeof r?null:r},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"large",e,String,null,null,null),r=e}})
var n
Object.defineProperty(this,"medium",{get:function(){return"undefined"==typeof n?null:n},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"medium",e,String,null,null,null),n=e}})
var o
Object.defineProperty(this,"small",{get:function(){return"undefined"==typeof o?null:o},set:function(e){Newgrounds.io.model.checkStrictValue(this.__classname,"small",e,String,null,null,null),o=e}}),t&&this.fromObject(t)},Newgrounds.io.model.usericons.prototype._has_ngio_user=function(){return this.__ngio&&this.__ngio.user},Newgrounds.io.model.usericons.prototype.toObject=function(){for(var e={},t=0;t<this.__property_names.length;t++)"undefined"!=typeof this[this.__property_names[t]]&&(e[this.__property_names[t]]=this[this.__property_names[t]])
return e},Newgrounds.io.model.usericons.prototype.fromObject=function(e){for(var t,r=0;r<this.__property_names.length;r++)t=e[this.__property_names[r]],this[this.__property_names[r]]=t},Newgrounds.io.model.usericons.prototype.constructor=Newgrounds.io.model.usericons,Newgrounds.io.call_validators.getValidator=function(e){var t=e.split("."),r=t[0],n=t[1],o=Newgrounds.io.call_validators[r]&&Newgrounds.io.call_validators[r][n]?Newgrounds.io.call_validators[r][n]:null
return o},Newgrounds.io.call_validators.App={checkSession:{require_session:!0,secure:!1,redirect:!1,"import":!1,params:{},returns:{session:{object:"session",description:null}}},endSession:{require_session:!0,secure:!1,redirect:!1,"import":!1,params:{},returns:{}},getCurrentVersion:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{version:{type:String,extract_from:null,required:null,description:'The version number (in "X.Y.Z" format) of the client-side app. (default = "0.0.0")'}},returns:{}},getHostLicense:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{host:{type:String,extract_from:null,required:null,description:"The host domain to check (ei, somesite.com)."}},returns:{}},logView:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{host:{type:String,extract_from:null,required:!0,description:'The domain hosting your app. Examples: "www.somesite.com", "localHost"'}},returns:{}},startSession:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{force:{type:Boolean,extract_from:null,required:null,description:"If true, will create a new session even if the user already has an existing one.\n\nNote: Any previous session ids will no longer be valid if this is used."}},returns:{session:{object:"session",description:null}}}},Newgrounds.io.call_validators.Event={logEvent:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{event_name:{type:String,extract_from:null,required:!0,description:"The name of your custom event as defined in your Referrals & Events settings."},host:{type:String,extract_from:null,required:!0,description:'The domain hosting your app. Example: "newgrounds.com", "localHost"'}},returns:{}}},Newgrounds.io.call_validators.Gateway={getDatetime:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{},returns:{}},getVersion:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{},returns:{}},ping:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{},returns:{}}},Newgrounds.io.call_validators.Loader={loadAuthorUrl:{require_session:!1,secure:!1,redirect:!0,"import":!1,params:{host:{type:String,extract_from:null,required:!0,description:'The domain hosting your app. Example: "www.somesite.com", "localHost"'},redirect:{type:Boolean,extract_from:null,required:!1,description:"Set this to false to get a JSON response containing the URL instead of doing an actual redirect."}},returns:{}},loadMoreGames:{require_session:!1,secure:!1,redirect:!0,"import":!1,params:{host:{type:String,extract_from:null,required:!0,description:'The domain hosting your app. Example: "www.somesite.com", "localHost"'},redirect:{type:Boolean,extract_from:null,required:!1,description:"Set this to false to get a JSON response containing the URL instead of doing an actual redirect."}},returns:{}},loadNewgrounds:{require_session:!1,secure:!1,redirect:!0,"import":!1,params:{host:{type:String,extract_from:null,required:!0,description:'The domain hosting your app. Example: "www.somesite.com", "localHost"'},redirect:{type:Boolean,extract_from:null,required:!1,description:"Set this to false to get a JSON response containing the URL instead of doing an actual redirect."}},returns:{}},loadOfficialUrl:{require_session:!1,secure:!1,redirect:!0,"import":!1,params:{host:{type:String,extract_from:null,required:!0,description:'The domain hosting your app. Example: "www.somesite.com", "localHost"'},redirect:{type:Boolean,extract_from:null,required:!1,description:"Set this to false to get a JSON response containing the URL instead of doing an actual redirect."}},returns:{}},loadReferral:{require_session:!1,secure:!1,redirect:!0,"import":!1,params:{host:{type:String,extract_from:null,required:!0,description:'The domain hosting your app. Example: "www.somesite.com", "localHost"'},redirect:{type:Boolean,extract_from:null,required:!1,description:"Set this to false to get a JSON response containing the URL instead of doing an actual redirect."},referral_name:{type:String,extract_from:null,required:!0,description:'The name of the referral (as defined in your "Referrals & Events" settings).'}},returns:{}}},Newgrounds.io.call_validators.Medal={getList:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{},returns:{medals:{array:{object:"medal"},description:"An array of medal objects."}}},unlock:{require_session:!0,secure:!0,redirect:!1,"import":!1,params:{id:{type:Number,extract_from:{object:"medal",alias:"medal",property:"id"},required:!0,description:"The numeric ID of the medal to unlock."}},returns:{medal:{object:"medal",description:"The #medal that was unlocked."}}}},Newgrounds.io.call_validators.ScoreBoard={getBoards:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{},returns:{scoreboards:{array:{object:"scoreboard"},description:"An array of #scoreboard objects."}}},getScores:{require_session:!1,secure:!1,redirect:!1,"import":!1,params:{id:{type:Number,extract_from:{object:"scoreboard",alias:"scoreboard",property:"id"},required:!0,description:"The numeric ID of the scoreboard."},limit:{type:Number,extract_from:null,required:null,description:"An integer indicating the number of scores to include in the list. Default = 10."},period:{type:String,extract_from:null,required:null,description:"The time-frame to pull scores from (see notes for acceptable values)."},skip:{type:Number,extract_from:null,required:null,description:"An integer indicating the number of scores to skip before starting the list. Default = 0."},social:{type:Boolean,extract_from:null,required:null,description:"If set to true, only social scores will be loaded (scores by the user and their friends). This param will be ignored if there is no valid session id and the 'user' param is absent."},tag:{type:String,extract_from:null,required:null,description:"A tag to filter results by."},user:{type:"mixed",extract_from:null,required:null,description:"A user's ID or name.  If 'social' is true, this user and their friends will be included. Otherwise, only scores for this user will be loaded. If this param is missing and there is a valid session id, that user will be used by default."}},returns:{scoreboard:{object:"scoreboard",description:"The #scoreboard being queried."},scores:{array:{object:"score"},description:"An array of #score objects."},user:{object:"user",description:"The #user the score list is associated with (either as defined in the 'user' param, or extracted from the current session when 'social' is set to true)"}}},postScore:{require_session:!0,secure:!0,redirect:!1,"import":!1,params:{id:{type:Number,extract_from:{object:"scoreboard",alias:"scoreboard",property:"id"},required:!0,description:"The numeric ID of the scoreboard."},tag:{type:String,extract_from:null,required:null,description:"An optional tag that can be used to filter scores via ScoreBoard.getScores"},value:{type:Number,extract_from:null,required:!0,description:"The int value of the score."}},returns:{score:{object:"score",description:"The #score that was posted to the board."},scoreboard:{object:"scoreboard",description:"The #scoreboard that was posted to."}}}},Newgrounds.io.SessionLoader=function(e){if(!e||e.constructor!==Newgrounds.io.core)throw new Error("'ngio' must be a 'Newgrounds.io.core' instance.")
this.__ngio=e
var t=null
Object.defineProperty(this,"session",{set:function(e){if(e&&!e.constructor===Newgrounds.io.model.session)throw new Error("'session' must be a 'Newgrounds.io.model.session' instance.")
t=e},get:function(){return t}})},Newgrounds.io.SessionLoader.prototype={_event_listeners:{},last_error:null,passport_window:null,addEventListener:Newgrounds.io.events.EventDispatcher.prototype.addEventListener,removeEventListener:Newgrounds.io.events.EventDispatcher.prototype.removeEventListener,removeAllEventListeners:Newgrounds.io.events.EventDispatcher.prototype.removeAllEventListeners,dispatchEvent:Newgrounds.io.events.EventDispatcher.prototype.dispatchEvent,getValidSession:function(e,t){var r=this
r.checkSession(function(n){!n||n.expired?r.startSession(e,t):e.call(t,n)})},startSession:function(e,t){var r=new Newgrounds.io.events.SessionEvent,n=this
this.__ngio.callComponent("App.startSession",function(o){o.success&&o.session?(r.type=Newgrounds.io.events.SessionEvent.REQUEST_LOGIN,r.passport_url=o.session.passport_url,n.session=o.session):(o.error?n.last_error=o.error:(n.last_error=new Newgrounds.io.model.error,n.last_error.message="Unexpected Error"),r.type=Newgrounds.io.events.SessionEvent.SESSION_EXPIRED,n.session=null),n.__ngio.session_id=n.session?n.session.id:null,n.dispatchEvent(r),e&&e.constructor===Function&&e.call(t,n.session)})},checkSession:function(e,t){var r=new Newgrounds.io.events.SessionEvent,n=this
n.session&&n.session.user?(r.type=Newgrounds.io.events.SessionEvent.USER_LOADED,r.user=n.session.user,n.dispatchEvent(r),e&&e.constructor===Function&&e.call(t,n.session)):this.__ngio.session_id?this.__ngio.callComponent("App.checkSession",function(o){o.success&&o.session&&!o.session.expired?o.session.user?(r.type=Newgrounds.io.events.SessionEvent.USER_LOADED,r.user=o.session.user,n.session=o.session):(r.type=Newgrounds.io.events.SessionEvent.REQUEST_LOGIN,r.passport_url=o.session.passport_url,n.session=o.session):(r.type=Newgrounds.io.events.SessionEvent.SESSION_EXPIRED,n.session=null,o.error?n.last_error=o.error:(n.last_error=new Newgrounds.io.model.error,o.session&&o.session.expired?n.last_error.message="Session is Expired":n.last_error.message="Unexpected Error")),n.__ngio.session_id=n.session?n.session.id:null,n.dispatchEvent(r),e&&e.constructor===Function&&e.call(t,n.session)}):(r.type=Newgrounds.io.events.SessionEvent.SESSION_EXPIRED,n.session=null,n.dispatchEvent(r),e&&e.constructor===Function&&e.call(t,null))},endSession:function(e,t){var r=this,n=this.__ngio
this.__ngio.callComponent("App.endSession",function(o){r.session=null,n.session_id=null
var s=new Newgrounds.io.events.SessionEvent(Newgrounds.io.events.SessionEvent.SESSION_EXPIRED)
r.dispatchEvent(s),e&&e.constructor===Function&&e.call(t,r.session)}),this.__ngio.session_id=null,this.session=null},loadPassport:function(e){return"string"!=typeof e&&(e="_blank"),this.session&&this.session.passport_url?(this.passport_window=window.open(this.session.passport_url,e),this.passport_window||console.warn("Unable to detect passport window. Pop-up blockers will prevent loading Newgrounds Passport if loadPassport() or requestLogin() are not called from within a mouse click handler."),this.passportOpen()):(console.warn("Attempted to open Newgrounds Passport without a valid passport_url. Be sure you have called getValidSession() first!."),!1)},closePassport:function(){return this.passport_window?(this.passport_window.close(),this.passportOpen()):!1},passportOpen:function(){return this.passport_window&&this.passport_window.parent?!0:!1}},Newgrounds.io.SessionLoader.prototype.constructor=Newgrounds.io.SessionLoader
var CryptoJS=CryptoJS||function(e,t){var r={},n=r.lib={},o=function(){},s=n.Base={extend:function(e){o.prototype=this
var t=new o
return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend()
return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])
e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=n.WordArray=s.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes
if(e=e.sigBytes,this.clamp(),n%4)for(var o=0;e>o;o++)t[n+o>>>2]|=(r[o>>>2]>>>24-8*(o%4)&255)<<24-8*((n+o)%4)
else if(65535<r.length)for(o=0;e>o;o+=4)t[n+o>>>2]=r[o>>>2]
else t.push.apply(t,r)
return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes
t[r>>>2]&=4294967295<<32-8*(r%4),t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this)
return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;t>n;n+=4)r.push(4294967296*e.random()|0)
return new i.init(r,t)}}),u=r.enc={},l=u.Hex={stringify:function(e){var t=e.words
e=e.sigBytes
for(var r=[],n=0;e>n;n++){var o=t[n>>>2]>>>24-8*(n%4)&255
r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;t>n;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-4*(n%8)
return new i.init(r,t/2)}},a=u.Latin1={stringify:function(e){var t=e.words
e=e.sigBytes
for(var r=[],n=0;e>n;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-8*(n%4)&255))
return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;t>n;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-8*(n%4)
return new i.init(r,t)}},c=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},d=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,s=this.blockSize,u=o/(4*s),u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0)
if(t=u*s,o=e.min(4*t,o),t){for(var l=0;t>l;l+=s)this._doProcessBlock(n,l)
l=n.splice(0,t),r.sigBytes-=o}return new i.init(l,o)},clone:function(){var e=s.clone.call(this)
return e._data=this._data.clone(),e},_minBufferSize:0})
n.Hasher=d.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}})
var p=r.algo={}
return r}(Math)
!function(){var e=CryptoJS,t=e.lib.WordArray
e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map
e.clamp(),e=[]
for(var o=0;r>o;o+=3)for(var s=(t[o>>>2]>>>24-8*(o%4)&255)<<16|(t[o+1>>>2]>>>24-8*((o+1)%4)&255)<<8|t[o+2>>>2]>>>24-8*((o+2)%4)&255,i=0;4>i&&r>o+.75*i;i++)e.push(n.charAt(s>>>6*(3-i)&63))
if(t=n.charAt(64))for(;e.length%4;)e.push(t)
return e.join("")},parse:function(e){var r=e.length,n=this._map,o=n.charAt(64)
o&&(o=e.indexOf(o),-1!=o&&(r=o))
for(var o=[],s=0,i=0;r>i;i++)if(i%4){var u=n.indexOf(e.charAt(i-1))<<2*(i%4),l=n.indexOf(e.charAt(i))>>>6-2*(i%4)
o[s>>>2]|=(u|l)<<24-8*(s%4),s++}return t.create(o,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,r,n,o,s,i){return e=e+(t&r|~t&n)+o+i,(e<<s|e>>>32-s)+t}function r(e,t,r,n,o,s,i){return e=e+(t&n|r&~n)+o+i,(e<<s|e>>>32-s)+t}function n(e,t,r,n,o,s,i){return e=e+(t^r^n)+o+i,(e<<s|e>>>32-s)+t}function o(e,t,r,n,o,s,i){return e=e+(r^(t|~n))+o+i,(e<<s|e>>>32-s)+t}for(var s=CryptoJS,i=s.lib,u=i.WordArray,l=i.Hasher,i=s.algo,a=[],c=0;64>c;c++)a[c]=4294967296*e.abs(e.sin(c+1))|0
i=i.MD5=l.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var i=0;16>i;i++){var u=s+i,l=e[u]
e[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var i=this._hash.words,u=e[s+0],l=e[s+1],c=e[s+2],d=e[s+3],p=e[s+4],_=e[s+5],f=e[s+6],h=e[s+7],m=e[s+8],g=e[s+9],y=e[s+10],v=e[s+11],w=e[s+12],N=e[s+13],S=e[s+14],b=e[s+15],E=i[0],O=i[1],k=i[2],j=i[3],E=t(E,O,k,j,u,7,a[0]),j=t(j,E,O,k,l,12,a[1]),k=t(k,j,E,O,c,17,a[2]),O=t(O,k,j,E,d,22,a[3]),E=t(E,O,k,j,p,7,a[4]),j=t(j,E,O,k,_,12,a[5]),k=t(k,j,E,O,f,17,a[6]),O=t(O,k,j,E,h,22,a[7]),E=t(E,O,k,j,m,7,a[8]),j=t(j,E,O,k,g,12,a[9]),k=t(k,j,E,O,y,17,a[10]),O=t(O,k,j,E,v,22,a[11]),E=t(E,O,k,j,w,7,a[12]),j=t(j,E,O,k,N,12,a[13]),k=t(k,j,E,O,S,17,a[14]),O=t(O,k,j,E,b,22,a[15]),E=r(E,O,k,j,l,5,a[16]),j=r(j,E,O,k,f,9,a[17]),k=r(k,j,E,O,v,14,a[18]),O=r(O,k,j,E,u,20,a[19]),E=r(E,O,k,j,_,5,a[20]),j=r(j,E,O,k,y,9,a[21]),k=r(k,j,E,O,b,14,a[22]),O=r(O,k,j,E,p,20,a[23]),E=r(E,O,k,j,g,5,a[24]),j=r(j,E,O,k,S,9,a[25]),k=r(k,j,E,O,d,14,a[26]),O=r(O,k,j,E,m,20,a[27]),E=r(E,O,k,j,N,5,a[28]),j=r(j,E,O,k,c,9,a[29]),k=r(k,j,E,O,h,14,a[30]),O=r(O,k,j,E,w,20,a[31]),E=n(E,O,k,j,_,4,a[32]),j=n(j,E,O,k,m,11,a[33]),k=n(k,j,E,O,v,16,a[34]),O=n(O,k,j,E,S,23,a[35]),E=n(E,O,k,j,l,4,a[36]),j=n(j,E,O,k,p,11,a[37]),k=n(k,j,E,O,h,16,a[38]),O=n(O,k,j,E,y,23,a[39]),E=n(E,O,k,j,N,4,a[40]),j=n(j,E,O,k,u,11,a[41]),k=n(k,j,E,O,d,16,a[42]),O=n(O,k,j,E,f,23,a[43]),E=n(E,O,k,j,g,4,a[44]),j=n(j,E,O,k,w,11,a[45]),k=n(k,j,E,O,b,16,a[46]),O=n(O,k,j,E,c,23,a[47]),E=o(E,O,k,j,u,6,a[48]),j=o(j,E,O,k,h,10,a[49]),k=o(k,j,E,O,S,15,a[50]),O=o(O,k,j,E,_,21,a[51]),E=o(E,O,k,j,w,6,a[52]),j=o(j,E,O,k,d,10,a[53]),k=o(k,j,E,O,y,15,a[54]),O=o(O,k,j,E,l,21,a[55]),E=o(E,O,k,j,m,6,a[56]),j=o(j,E,O,k,b,10,a[57]),k=o(k,j,E,O,f,15,a[58]),O=o(O,k,j,E,N,21,a[59]),E=o(E,O,k,j,p,6,a[60]),j=o(j,E,O,k,v,10,a[61]),k=o(k,j,E,O,c,15,a[62]),O=o(O,k,j,E,g,21,a[63])
i[0]=i[0]+E|0,i[1]=i[1]+O|0,i[2]=i[2]+k|0,i[3]=i[3]+j|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes
r[o>>>5]|=128<<24-o%32
var s=e.floor(n/4294967296)
for(r[(o+64>>>9<<4)+15]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[(o+64>>>9<<4)+14]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),t=this._hash,r=t.words,n=0;4>n;n++)o=r[n],r[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)
return t},clone:function(){var e=l.clone.call(this)
return e._hash=this._hash.clone(),e}}),s.MD5=l._createHelper(i),s.HmacMD5=l._createHmacHelper(i)}(Math),function(){var e=CryptoJS,t=e.lib,r=t.Base,n=t.WordArray,t=e.algo,o=t.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,o=r.hasher.create(),s=n.create(),i=s.words,u=r.keySize,r=r.iterations;i.length<u;){l&&o.update(l)
var l=o.update(e).finalize(t)
o.reset()
for(var a=1;r>a;a++)l=o.finalize(l),o.reset()
s.concat(l)}return s.sigBytes=4*u,s}})
e.EvpKDF=function(e,t,r){return o.create(r).compute(e,t)}}(),CryptoJS.lib.Cipher||function(e){var t=CryptoJS,r=t.lib,n=r.Base,o=r.WordArray,s=r.BufferedBlockAlgorithm,i=t.enc.Base64,u=t.algo.EvpKDF,l=r.Cipher=s.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,r,n){return("string"==typeof r?f:_).encrypt(e,t,r,n)},decrypt:function(t,r,n){return("string"==typeof r?f:_).decrypt(e,t,r,n)}}}})
r.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1})
var a=t.mode={},c=function(t,r,n){var o=this._iv
o?this._iv=e:o=this._prevBlock
for(var s=0;n>s;s++)t[r+s]^=o[s]},d=(r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend()
d.Encryptor=d.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize
c.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),d.Decryptor=d.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=e.slice(t,t+n)
r.decryptBlock(e,t),c.call(this,e,t,n),this._prevBlock=o}}),a=a.CBC=d,d=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,r=r-e.sigBytes%r,n=r<<24|r<<16|r<<8|r,s=[],i=0;r>i;i+=4)s.push(n)
r=o.create(s,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},r.BlockCipher=l.extend({cfg:l.cfg.extend({mode:a,padding:d}),reset:function(){l.reset.call(this)
var e=this.cfg,t=e.iv,e=e.mode
if(this._xformMode==this._ENC_XFORM_MODE)var r=e.createEncryptor
else r=e.createDecryptor,this._minBufferSize=1
this._mode=r.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding
if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize)
var t=this._process(!0)}else t=this._process(!0),e.unpad(t)
return t},blockSize:4})
var p=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),a=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext
return e=e.salt,(e?o.create([1398893684,1701076831]).concat(e).concat(t):t).toString(i)},parse:function(e){e=i.parse(e)
var t=e.words
if(1398893684==t[0]&&1701076831==t[1]){var r=o.create(t.slice(2,4))
t.splice(0,4),e.sigBytes-=16}return p.create({ciphertext:e,salt:r})}},_=r.SerializableCipher=n.extend({cfg:n.extend({format:a}),encrypt:function(e,t,r,n){n=this.cfg.extend(n)
var o=e.createEncryptor(r,n)
return t=o.finalize(t),o=o.cfg,p.create({ciphertext:t,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){return n||(n=o.random(8)),e=u.create({keySize:t+r}).compute(e,n),r=o.create(e.words.slice(t),4*r),e.sigBytes=4*t,p.create({key:e,iv:r,salt:n})}},f=r.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:t}),encrypt:function(e,t,r,n){return n=this.cfg.extend(n),r=n.kdf.execute(r,e.keySize,e.ivSize),n.iv=r.iv,e=_.encrypt.call(this,e,t,r.key,n),e.mixIn(r),e},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt),n.iv=r.iv,_.decrypt.call(this,e,t,r.key,n)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,r=e.algo,n=[],o=[],s=[],i=[],u=[],l=[],a=[],c=[],d=[],p=[],_=[],f=0;256>f;f++)_[f]=128>f?f<<1:f<<1^283
for(var h=0,m=0,f=0;256>f;f++){var g=m^m<<1^m<<2^m<<3^m<<4,g=g>>>8^255&g^99
n[h]=g,o[g]=h
var y=_[h],v=_[y],w=_[v],N=257*_[g]^16843008*g
s[h]=N<<24|N>>>8,i[h]=N<<16|N>>>16,u[h]=N<<8|N>>>24,l[h]=N,N=16843009*w^65537*v^257*y^16843008*h,a[g]=N<<24|N>>>8,c[g]=N<<16|N>>>16,d[g]=N<<8|N>>>24,p[g]=N,h?(h=y^_[_[_[w^y]]],m^=_[_[m]]):h=m=1}var S=[0,1,2,4,8,16,32,64,128,27,54],r=r.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes/4,e=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],s=0;e>s;s++)if(r>s)o[s]=t[s]
else{var i=o[s-1]
s%r?r>6&&4==s%r&&(i=n[i>>>24]<<24|n[i>>>16&255]<<16|n[i>>>8&255]<<8|n[255&i]):(i=i<<8|i>>>24,i=n[i>>>24]<<24|n[i>>>16&255]<<16|n[i>>>8&255]<<8|n[255&i],i^=S[s/r|0]<<24),o[s]=o[s-r]^i}for(t=this._invKeySchedule=[],r=0;e>r;r++)s=e-r,i=r%4?o[s]:o[s-4],t[r]=4>r||4>=s?i:a[n[i>>>24]]^c[n[i>>>16&255]]^d[n[i>>>8&255]]^p[n[255&i]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,i,u,l,n)},decryptBlock:function(e,t){var r=e[t+1]
e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,a,c,d,p,o),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,o,s,i,u){for(var l=this._nRounds,a=e[t]^r[0],c=e[t+1]^r[1],d=e[t+2]^r[2],p=e[t+3]^r[3],_=4,f=1;l>f;f++)var h=n[a>>>24]^o[c>>>16&255]^s[d>>>8&255]^i[255&p]^r[_++],m=n[c>>>24]^o[d>>>16&255]^s[p>>>8&255]^i[255&a]^r[_++],g=n[d>>>24]^o[p>>>16&255]^s[a>>>8&255]^i[255&c]^r[_++],p=n[p>>>24]^o[a>>>16&255]^s[c>>>8&255]^i[255&d]^r[_++],a=h,c=m,d=g
h=(u[a>>>24]<<24|u[c>>>16&255]<<16|u[d>>>8&255]<<8|u[255&p])^r[_++],m=(u[c>>>24]<<24|u[d>>>16&255]<<16|u[p>>>8&255]<<8|u[255&a])^r[_++],g=(u[d>>>24]<<24|u[p>>>16&255]<<16|u[a>>>8&255]<<8|u[255&c])^r[_++],p=(u[p>>>24]<<24|u[a>>>16&255]<<16|u[c>>>8&255]<<8|u[255&d])^r[_++],e[t]=h,e[t+1]=m,e[t+2]=g,e[t+3]=p},keySize:8})
e.AES=t._createHelper(r)}();const ngio=new Newgrounds.io.core("50044:FzIn7qEB","Uk2K416qG9nhc+khmBJpOg==");function onLoggedIn(){console.log("Welcome "+ngio.user.name+"!");fetchMedals(ngio,()=>{})}
function onLoginFailed(){console.log("There was a problem logging in: ".ngio.login_error.message)}
function onLoginCancelled(){console.log("The user cancelled the login.")}
function initSession(){ngio.getValidSession(function(){if(ngio.user){onLoggedIn()}else{const button=document.body.appendChild(document.createElement('button'));button.classList.add('button');button.innerText="login";button.addEventListener('click',e=>{requestLogin()})}})}
function requestLogin(){ngio.requestLogin(onLoggedIn,onLoginFailed,onLoginCancelled)}
function cancelLogin(){ngio.cancelLoginRequest()}
function logOut(){ngio.logOut(function(){})}
initSession();let medals=null;let medalCallbacks=null;function fetchMedals(ngio,callback){if(medals){callback(medals)}else if(medalCallbacks){medalCallbacks.push(callback)}else{medalCallbacks=[callback];ngio.callComponent('Medal.getList',{},result=>{if(result.success){medals=result.medals;medals.forEach(medal=>console.log(medal.name,medal.unlocked));medalCallbacks.forEach(callback=>{callback(medals)});medalCallbacks=null}})}}
function unlockMedal(ngio,medal_name,callback){console.log("unlocking",medal_name);if(!ngio.user)return;fetchMedals(ngio,medals=>{medal=medals.filter(medal=>medal.name===medal_name)[0];if(medal){if(!medal.unlocked){ngio.callComponent('Medal.unlock',{id:medal.id},result=>{if(callback)
callback(result.medal)})}else{if(callback)
callback(medal)}}})}
function getMedal(medal_name){unlockMedal(ngio,medal_name)};const errorDiv=document.getElementById("error-div");errorDiv.addEventListener("click",e=>{errorDiv.style.display="none"});function showError(error){if(error){errorDiv.style.display="";errorDiv.innerHTML+=error+"\n"}else{errorDiv.style.display="none"}}
const loadErrorDiv=document.getElementById("load-error-div");loadErrorDiv.addEventListener("click",e=>{loadErrorDiv.style.display="none"});function showLoadErrors(errors){if(errors){loadErrorDiv.style.display="";loadErrorDiv.innerHTML=errors+"\n"}else{loadErrorDiv.style.display="none"}};const DEMO=!1;const LEFT=1,RIGHT=2,FORWARD=3,BACKWARD=4,BAG=5,DOOR=6,FAR=7,CLOSE=8,FURTHER=9,MENU=10,BLOCK=11;const MAZE_ASSETS={MAZE_ROTATION_BACKGROUND:"assets/maze-rotation-background.png",MAZE_ROTATION_WALLS:"assets/maze-rotation-walls.png",MAZE_ROTATION_CORNER:"assets/maze-rotation-corner.png",DUNGEON_MOVE:'assets/dungeon-move.png',FAR_SIDE:'assets/far-side.png',FAR_SIDE_CORNER:'assets/far-side-corner.png',FAR_WALL:'assets/far-wall.png',FURTHER_WALL:'assets/further-wall.png',FAR_DOOR:'assets/far-door.png',CLOSE_SIDE:'assets/close-side.png',CLOSE_SIDE_CORNER:'assets/close-side-corner.png',FAR_FAR_SIDE:'assets/side-far-far.png',CLOSE_WALL:'assets/close-wall.png',DOOR_OPEN:'assets/door-open.png',CLOSE_DOOR:'assets/close-door.png',FURTHER_SIDE:'assets/further-side.png',CLOSE_FURTHER_SIDE:'assets/close-further-side.png',DUNGEON_MOVE_SOLID:'assets/dungeon-move-solid.png|rotate-colors|rotate-colors',FAR_WALL_SOLID:'assets/far-wall-solid.png|rotate-colors|rotate-colors',CLOSE_WALL_SOLID:'assets/close-wall-solid.png|rotate-colors|rotate-colors',MAZE_ROTATION_BACKGROUND_SOLID:"assets/maze-rotation-background-solid.png|rotate-colors|rotate-colors",MAZE_ROTATION_WALLS_SOLID:"assets/maze-rotation-walls-solid.png|rotate-colors|rotate-colors",MAZE_ROTATION_CORNER_SOLID:"assets/maze-rotation-corner-solid.png|rotate-colors|rotate-colors",CLOSE_SIDE_SOLID:'assets/close-side-solid.png|rotate-colors|rotate-colors',DUNGEON_LOCK:'assets/dungeon-lock.png',};const MAZE_ASSETS_BLUE=Object.assign(...Object.entries(MAZE_ASSETS).map(([k,v])=>({[`${k}_BLUE`]:`${v}|rotate-colors`})));const MAZE_ASSETS_RED=Object.assign(...Object.entries(MAZE_ASSETS).map(([k,v])=>({[`${k}_RED`]:`${v}|rotate-colors|rotate-colors`})));const ASSETS={ARROW_SIDE:'assets/arrow-side.png',ARROW_FORWARD:'assets/arrow-forward.png',ARROW_BACKWARD:'assets/arrow-backward.png',JAIL:'assets/jail.png',JAIL360:'assets/jail-360.png',WRITING:'assets/writing.png',PHOTO:'assets/photo.png',TILE:'assets/tile.png',BOTTLE:'assets/bottle.png',GRAB_WATER_BOTTLE:'assets/grab-water-bottle.png',GRAB_APPLE:'assets/grab-apple.png',BOTTLE_SHARDS:'assets/bottle-shards.png',BAG_OUT:'assets/bag-out.png',LAMP:'assets/light.png',LOCK:'assets/lock.png',EXIT_DOOR:'assets/exit-door.png',CAGE:'assets/cage.png',DIMMING_LIGHT:'assets/dimming-light.png',RIGHT_GUARD:'assets/right-guard.png',LEFT_GUARD:'assets/left-guard.png',ALPHABET_DARK:'assets/alphabet.png',ALPHABET:'assets/alphabet.png|invert-colors',GRAB_PHOTO:'assets/grab-photo.png',GRAB_PHOTO_SHOT:'assets/grab-photo-shot.png',ZOOM_GUARDS:'assets/zoom-guards.png',GRAB_BOTTLE:'assets/grab-bottle.png',BIRTHDAY:'assets/birthday.png',SPEECH_OUT:'assets/speech-out.png',BRING_CAKE:'assets/bring-cake.png',POOR_HITMAN:'assets/poor-hitman.png',POOR_HITMAN_BACK:'assets/poor-hitman-back.png',POOR_HITMAN_GUARD:'assets/poor-hitman-guard.png',GUARDS_LAUGHING:'assets/guards-laughing.png',HITMAN_LAUGH:'assets/hitman-laugh.png',HITMAN_CAKE_FACE:'assets/hitman-cake-face.png',GUARDS_ATTACK:'assets/guards-attack.png',CAKE_TRASH:'assets/cake-trash.png',CAKE_PIECE:'assets/cake-piece.png',CAKE_FORK:'assets/cake-fork.png',LIGHTER:'assets/lighter.png',GRAB_CAKE:'assets/grab-cake.png',GRAB_FORK:'assets/grab-fork.png',GRAB_LIGHTER:'assets/grab-lighter.png',TILE_HOLE:'assets/tile-hole.png',GUN:'assets/gun.png',SHOOTS:'assets/shoots.png',GRAB_GUN:'assets/grab-gun.png',HOLD_GUN:'assets/hold-gun.png',ZOOM_GUARD_ALERT:'assets/zoom-guard-alert.png',SHOOTS:"assets/shoots.png",EATER:"assets/eater.png",ALIEN_EATER:"assets/alien-eater.png",CAKE_BOOM:"assets/cake-boom.png",...MAZE_ASSETS,...Object.assign(...Object.entries(MAZE_ASSETS).map(([k,v])=>({[`${k}_1`]:`${v}|darken`}))),...Object.assign(...Object.entries(MAZE_ASSETS).map(([k,v])=>({[`${k}_2`]:`${v}|darken|darken`}))),...MAZE_ASSETS_BLUE,...Object.assign(...Object.entries(MAZE_ASSETS_BLUE).map(([k,v])=>({[`${k}_1`]:`${v}|darken`}))),...Object.assign(...Object.entries(MAZE_ASSETS_BLUE).map(([k,v])=>({[`${k}_2`]:`${v}|darken|darken`}))),...MAZE_ASSETS_RED,...Object.assign(...Object.entries(MAZE_ASSETS_RED).map(([k,v])=>({[`${k}_1`]:`${v}|darken`}))),...Object.assign(...Object.entries(MAZE_ASSETS_RED).map(([k,v])=>({[`${k}_2`]:`${v}|darken|darken`}))),GUARD:"assets/guard.png",GUARD_2:"assets/guard.png|rotate-colors|rotate-colors",MONSTER:"assets/monster.png",DUMMY:"assets/dummy.png",PUNCH:"assets/punch.png",TOILETS:"assets/toilets.png",BATHROOM:"assets/bathroom-background.png",TOILET_MONSTER:"assets/toilet-monster.png",VENDING_MACHINE:"assets/vending-machine.png",MACHINE:"assets/machine.png",COIN_1:"assets/coin-1.png",COIN_2:"assets/coin-2.png",GRAB_COIN:"assets/grab-coin.png",GRAB_COIN_DARKER:"assets/grab-coin.png|darken",VENDING_MACHINE_CLOSEUP:"assets/vending-machine-close.png",VENDING_MACHINE_GLASS:"assets/vending-machine-glass.png",VENDING_MACHINE_APPLE:"assets/vending-machine-apple.png",VENDING_MACHINE_BOTTLE:"assets/vending-machine-bottle.png",VENDING_MACHINE_COIN_SLOT:"assets/vending-machine-coin-slot.png",VENDING_MACHINE_COIN_RETURN:"assets/vending-machine-coin-return.png",ARCADE:"assets/arcade.png",ZOOM_ARCADE:"assets/zoom-arcade.png",ARCADE_ROOM:"assets/arcade-room.png",LOCKER_ROOM:"assets/locker-room.png",LOCKER_DOOR:"assets/locker-door.png",LOCK_BACK:"assets/lock-back.png",LOCK_DIGIT:"assets/lock-digit.png",LOCK_BLOCK:"assets/lock-block.png",ACCESS_CARD:"assets/access-card.png",GRAB_ACCESS_CARD:"assets/grab-access-card.png",SCAN_CARD:"assets/scan-card.png",FINAL_EXIT:"assets/final-exit.png",GATE:"assets/gate.png",OUTDOOR:"assets/outdoor.png",COINSTART:"assets/coinstart.png",FLASH_SCREEN:"assets/flash-screen.png",ARCADE_HANDS:"assets/arcade-hands.png",TOP_5:"assets/top-5.png",MOON_BASE:"assets/moon-base.png",MOON_BASE_GUARD:"assets/moon-base-guard.png",TOILET_ZOOM:"assets/toilet-zoom.png",TOILET_ZOOM_BACKGROUND:"assets/toilet-zoom-background.png|rotate-colors|rotate-colors",MAP:"assets/map.png",FAR_MAP:"assets/far-map.png",SIDE_MAP:'assets/side-map.png',SIDE_FAR_MAP:'assets/side-far-map.png',SIDE_FURTHER_MAP:'assets/side-further-map.png',FLOOR_CEILING:'assets/floor-ceiling.png',MENU_OUT:'assets/menu-out.png',MENU_DISK:'assets/menu-disk.png',MENU_SOUND_ON:'assets/menu-sound-on.png',MENU_SOUND_OFF:'assets/menu-sound-off.png',MENU_BAG:'assets/menu-bag.png',MENU_PROFILE:'assets/menu-profile.png',MENU_OPTIONS:'assets/menu-options.png',MENU_PROFILE_NOTIFICATION:"assets/profile-notification.png",TREASURE_CHEST:"assets/treasure-chest.png",SLIMO:"assets/slime.png",SLIMAR:"assets/slime.png|rotate-colors|rotate-colors",STATS:"assets/stats.png",LEVEL_UP:"assets/level-up.png",DOORWAY:'assets/doorway.png',KEY_COUNT:"assets/key-count.png",GRAB_KEY:'assets/grab-key.png',SHOP_MONSTER:'assets/shop-monster.png',CAGE_OPENED:"assets/cage-opened.png",ZOOM_SHOP_MONSTER:"assets/zoom-shop-monster.png",SKELETON:"assets/skeleton.png",YUPA_DRY:"assets/yupa-dry.png",YUPA_DRY_CLOSE:"assets/yupa-dry-close.png",YUPA_SHAKE:"assets/yupa-shake.png",YUPA_ZOOM:"assets/yupa-zoom.png",WOOD:"assets/wood.png",SKELETON_ROPE:"assets/skeleton-rope.png",GRAB_ROPE:"assets/grab-rope.png",HITMAN_WALK:"assets/hitman-walk.png",HITMAN_BEARD_WALK:"assets/hitman-beard-walk.png",YUPA_WALK:"assets/yupa-walk.png",YUPA_GRAB_PHOTO:"assets/yupa-grab-photo.png",YUPA_DANCE:"assets/yupa-dance.png",GRAB_YUPA_BOTTLE:"assets/grab-yupa-bottle.png",DRINK_YUPA:"assets/drink-yupa.png",HOLE:"assets/hole.png",LADDER:"assets/ladder.png",BOTTOM:"assets/bottom.png",FEMBOT:"assets/fembot.png",CEILING_HOLE:"assets/ceiling-hole.png",CEILING_ROPE_MOVE:"assets/ceiling-rope-move.png",HOLE_BOTTOM:"assets/hole-bottom.png",THE_HOLE:"assets/the-hole.png",CEILING_HOLE_ONLY:"assets/ceiling-hole-only.png",HOLE_IN_CEILING_ROPE:"assets/hole-in-ceiling-rope.png",HOLE_IN_CEILING_HOLE:"assets/hole-in-ceiling-hole.png|darken",HOLE_IN_CEILING_BACK:"assets/hole-in-ceiling-back.png|darken",LAB_ENTRANCE:"assets/lab-entrance.png",ELECTRO_DIAL:"assets/electro-dial.png",BOTTLE_SLOT:"assets/bottle-slot.png",LAB_DOOR:"assets/lab-door.png",YUPA_IN_LAB:"assets/yupa-in-lab.png",LAB:"assets/lab.png",LAB_EXIT:"assets/lab-exit.png",LAB_MONSTER:"assets/lab-monster.png",LAB_MONSTER_WAKE:"assets/lab-monster-wake.png",LAB_MONSTER_BATTLE:"assets/lab-monster-battle.png",LAB_MONSTER_THROUGH_HOLE:"assets/lab-monster-through-hole.png",ROPE_CEILING:"assets/rope-ceiling.png",EXIT_OUT:"assets/exit-out.png|chroma-key-pink",EXIT_OUT_CARNAGE:"assets/exit-out-carnage.png|chroma-key-pink",EXIT_GATE:"assets/exit-gate.png|chroma-key-pink",GATE_OPEN:"assets/gate-open.png|chroma-key-pink",OUTSIDE:"assets/outside.png",OUTSIDE_CARNAGE:"assets/outside-carnage.png",OUTSIDE_BG:"assets/outside-bg.png",LANDSCAPE:"assets/landscape.png",SPACESHIP:"assets/spaceship.png",SPACESHIP_STAIRS:"assets/spaceship-stairs.png",HOTTUB:"assets/hottub.png",ALEXA:"assets/alexa.png",HUMAN_HOTTUB:"assets/human-hottub.png",YUPA_HOTTUB:"assets/yupa-hottub.png",HOTTUP_CLOSE_UP:"assets/hottub-close-up.png",HOTTUB_WATER_WAVE:"assets/hottub-water-wave.png",HUMAN_NO_HAND:"assets/human-no-hand.png",NO_HAND:"assets/no-hand.png",SARLIE_SHOP:"assets/sarlie-shop.png",SARLIE_HOSPITAL:"assets/sarlie-hospital.png",SARLIE_PLANET:"assets/sarlie-planet.png",SARLIE_PLANET_BG:"assets/sarlie-planet-bg.png",SARLIE_PLANET_WORLD:"assets/sarlie-planet-world.png",SARLIE_PLANET_WORLD_OVERLAY:"assets/sarlie-planet-world-overlay.png",PEDRO:"assets/pedro.png",ZOOM_YUPA_ALONE:"assets/zoom-yupa-alone.png",YUPA_GRAB_PHOTO_ALONE:"assets/yupa-grab-photo-alone.png",DOCTAR:"assets/doctar.png",YUPA_WOOPSIE:"assets/yupa-woopsie.png",HUMAN_WAH:"assets/human-wah.png",DOCTAR_ROOM:"assets/doctar-room.png",RAZOR:"assets/razor.png",BEARD:"assets/beard.png",BEARD_SHAVED:"assets/beard.png|shaved",HITMAN_ARGUES:"assets/hitman-argues.png",ARGUE_MOUTH:"assets/argue-mouth.png",GRAB_TICKETS:"assets/grab-tickets.png",EYES_OPEN:"assets/eyes-open.png",OPERATION_ROOM:"assets/operation-room.png",SHOP:"assets/shop.png",SHOPKEEPA:"assets/shopkeepa.png",YUPA_IN_SHOP:"assets/yupa-in-shop.png",SLOTS:"assets/slots.png",GRAB_WARP_DRIVE:"assets/grab-warp-drive.png",DATE_NIGHT:"assets/date-night.png",MONSTER_PLANET:"assets/monster-planet.png",SHOP_DOOR:"assets/shop-door.png",CAFEE:"assets/cafee.png",DATE_TABLE:"assets/date-table.png",CANDLE:"assets/candle.png",WAITER:"assets/waiter.png",DANCER:"assets/dancer.png",DANCER_2:"assets/dancer.png|darken",DANCER_3:"assets/dancer.png|darken|darken",DANCER_4:"assets/dancer.png|darken|darken|darken",TAMMY_SLOW:"assets/tammy-slow.png",NEXT_SCENE:"assets/next-scene.png",EVENING_DATE:"assets/evening-date.png",DOCTOR_LOBBY:"assets/doctor-lobby.png",DOCTOR_LOBBY_SARLIE:"assets/doctor-lobby-sarlie.png",DOCTOR_LOBBY_AMARI:"assets/doctor-lobby-amari.png",AMARI_BABY:"assets/amari-baby.png",ORIGIN_STORY:"assets/origin-story.png",HITLER:"assets/hitler.png|darken",FINAL_PLANET:"assets/final-planet.png",CRATER:"assets/crater.png",MOUNTAINS:"assets/mountains.png|darken",PLANET_ITEMS:"assets/planet-items.png",TOUCH_ARROWS:"assets/touch-arrows.png",TOUCH_PUNCH:"assets/touch-punch.png",FAR_FLOOR:"assets/far-floor.png",FLOOR:"assets/floor.png",CLOSE_FLOOR:"assets/close-floor.png",BRUSALIEN:"assets/brusalien.png",GRAB_COMPASS:"assets/grab-compass.png",MULTI_ARROWS:"assets/multi-arrows.png",MISSING_HAND_PUNCH:"assets/missing-hand-punch.png",HOOK_PUNCH:"assets/hook-punch.png",SUPER_PUNCH:"assets/super-punch.png",SIDE_BUTTONS:"assets/side-buttons.png",ESCAPE:"assets/escape.png",TAVERN_ENTRANCE:"assets/tavern-entrance.png",ARROW_CURSOR:"assets/arrow-cursor.png",POSTERS:"assets/posters.png",ZOOM_TAVERN_DOOR_SMOKE:"assets/zoom-tavern-door-smoke.png",ZOOM_TAVERN_DOOR_ROBOT:"assets/zoom-tavern-door-robot.png",ZOOM_TAVERN_DOOR_LADY:"assets/zoom-tavern-door-lady.png",ZOOM_TAVERN_DOOR:"assets/zoom-tavern-door.png",DARK_CLOTH_STRANGER:"assets/dark-cloth-stranger.png",GRAB_PLAYING_CARD:"assets/grab-playing-card.png",ROBOT_DIAL:"assets/robot-dial.png",LOOK_RIGHT_LEFT:"assets/look-right-left.png",INSIDE_TAVERN:"assets/inside-tavern.png",TAVERN_GANGSTA:"assets/tavern-gangsta.png",BABY_HITLER_WAITER:"assets/baby-hitler-waiter.png",INSIDE_TAVERN_PHONE:"assets/inside-tavern-phone.png",PHONE_SPLIT:"assets/phone-split.png",TAVERN_HITMAN_CLOSEUP:"assets/hitman-tavern-closeup.png",YUPA_BACK_WALK:"assets/yupa-back-walk.png",ERNEST:"assets/ernest.png",ZOOM_DICK:"assets/zoom-dick.png",SHUFFLE_CARDS:"assets/shuffle-cards.png",SHIFTY_EYES:"assets/shifty-eyes.png",TAVERN_GANGSTA_CARD_GAME:"assets/tavern-gangsta-card-game.png",SWITCHAROO:"assets/switcharoo.png",CARDS_SHOWDOWN:"assets/cards-showdown.png",GANGSTA_CHECK_CARDS:"assets/gangsta-check-cards.png",ZOOM_DICK_MAD:"assets/zoom-dick-mad.png",TAVERN_GANGSTA_SHOOTOUT:"assets/tavern-gangsta-shootout.png",MONEY_SHOT:"assets/money-shot.png",RUNNER0:"assets/runner.png",RUNNER1:"assets/runner.png|rotate-colors",RUNNER2:"assets/runner.png|rotate-colors|rotate-colors",RUNNER3:"assets/runner.png|darken",RUNNER4:"assets/runner.png|rotate-colors|darken",RUNNER5:"assets/runner.png|rotate-colors|rotate-colors|darken",CRAWLING_BOY:"assets/crawling-boy.png",HITMAN_FROM_ABOVE:"assets/hitman-from-above.png",BOY_SMILE:"assets/boy-smile.png",PANIC_EXIT_BACKGROUND:"assets/panic-exit-background.png",PANIC_EXIT_YUPA:"assets/panic-exit-yupa.png",PANIC_EXIT_RUNNER_1:"assets/panic-exit-runner-1.png",PANIC_EXIT_RUNNER_2:"assets/panic-exit-runner-2.png",PANIC_EXIT_RUNNER_3:"assets/panic-exit-runner-3.png",PANIC_EXIT_RUNNER_4:"assets/panic-exit-runner-4.png",PANIC_EXIT_RUNNER_5:"assets/panic-exit-runner-1.png|rotate-colors",PANIC_EXIT_RUNNER_6:"assets/panic-exit-runner-2.png|rotate-colors",PANIC_EXIT_RUNNER_7:"assets/panic-exit-runner-3.png|rotate-colors",PANIC_EXIT_RUNNER_8:"assets/panic-exit-runner-4.png|rotate-colors",PANIC_EXIT_RUNNER_9:"assets/panic-exit-runner-1.png|rotate-colors|rotate-colors",PANIC_EXIT_RUNNER_10:"assets/panic-exit-runner-2.png|rotate-colors|rotate-colors",PANIC_EXIT_RUNNER_11:"assets/panic-exit-runner-3.png|rotate-colors|rotate-colors",PANIC_EXIT_RUNNER_12:"assets/panic-exit-runner-4.png|rotate-colors|rotate-colors",BRING_IT_ON:"assets/bring-it-on.png",SCREEN_FRACTURE:"assets/screen-fracture.png",SHOOT_OUT:"assets/shoot-out.png",GANGSTA_FIGHTER:"assets/gangsta-fighter.png",SHOOT_OUT_2:"assets/shoot-out.png|darken",WE_DID_IT:"assets/we-did-it-yupa.png",YUPA_HITMAN_AT_GUNPOINT:"assets/yupa-hitman-at-gunpoint.png",BOY_GUNPOINT:"assets/boy-gunpoint.png",STRANGER_REVEAL:"assets/stranger-reveal.png",CREATOR:"assets/creator.png",};const SOUNDS={HELLO:'sounds/hello.mp3',HAHAHA:'sounds/hahaha.mp3',BIRTHDAY:'sounds/birthday.mp3',HEY:'sounds/hey.mp3',GUN_SHOT:'sounds/gun-shot.mp3',DUD:'sounds/dud.mp3',ALIEN:'sounds/alien.mp3',HIT:'sounds/hit.mp3',PLAYER_HURT:'sounds/player-hurt.mp3',HIT_LAND:'sounds/hit-land.mp3',PICKUP:'sounds/pickup.mp3',EAT:'sounds/eat.mp3',DRINK:'sounds/drink.mp3',JAIL_CELL_THEME:'sounds/jail-cell-theme.mp3',CHIN_TOK_THEME:'sounds/chintok.mp3',ERROR:'sounds/error.mp3',FUTURE_SONG_THEME:'sounds/future-song.mp3',JINGLE:'sounds/jingle.mp3',DARK_THEME:'sounds/dark.mp3',BATTLE_THEME:'sounds/battle-theme.mp3',FOE_DEFEAT:'sounds/foe-defeat.mp3',LAZER:'sounds/lazer.mp3',DOOR:'sounds/door.mp3',UNLOCK:'sounds/unlock.mp3',BEEP:'sounds/beep.mp3',BOP:'sounds/bop.mp3',YUPA:'sounds/yupa.mp3',YUPA_HAHA:'sounds/yupa-haha.mp3',FEMBOT:'sounds/fembot.mp3',DIVING:'sounds/diving.mp3',HUM:'sounds/hum.mp3',GOGOL:'sounds/gogol.mp3',SOUP_CHOU_THEME:'sounds/soup-chou.mp3',OKAY:'sounds/okay.mp3',YAP:'sounds/yap.mp3',HUHUH:'sounds/huhuh.mp3',SOFT_THEME:'sounds/soft-song.mp3',ANIMAL_CRY:'sounds/animal-cry.mp3',MUSETTE:'sounds/musette.mp3',WAITER:'sounds/waiter.mp3',YULA:'sounds/yula.mp3',BABY_CRY:"sounds/baby-cry.mp3",GOLDMAN_THEME:"sounds/goldman.mp3",F1:"sounds/f1.mp3",RANDOM:"sounds/random.mp3",MYSTICA_THEME:"sounds/mystica.mp3",SELECT:"sounds/select.mp3",WEAKPUNCH:"sounds/weakpunch.mp3",ROBOT_VOICE:"sounds/robot-voice.mp3",HUM_LADY:"sounds/hum-lady.mp3",HUM_KID:"sounds/hum-kid.mp3",TURTLE_SONG_THEME:"sounds/turtle-song.mp3",HELLO_HUMAN:"sounds/hello-human.mp3",INVALID_NUMBER:"sounds/invalid-number.mp3",GRUMP:"sounds/grump.mp3",YES_BOSS:"sounds/yes-boss-low.mp3",YES_SIR:"sounds/yes-boss.mp3",GOOD_BAD_UGLIZ:"sounds/good-bad-ugliz.mp3",WELCOME_TO_YOUR_DOOM:"sounds/welcome-to-your-doom.mp3",BEEBOP_THEME:'sounds/beebop.mp3',};const ALPHAS=(()=>{const letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz.,?'#@!()[]/-+_:% "+new Array(10).fill(null).map((a,index)=>String.fromCharCode(1000+index)).join("");const array=[];for(let c=0;c<letters.length;c++){array[letters.charCodeAt(c)]={char:letters[c],index:c}}
array[" ".charCodeAt(0)].width=1;array[0]={width:0,index:letters.length,char:''};return array})();const ALPHA_SIZE=[10,11];const ORIENTATIONS=['N','NW','W','SW','S','SE','E','NE'];const ARROWS=[null,{src:ASSETS.ARROW_SIDE,side:LEFT},{src:ASSETS.ARROW_SIDE,side:RIGHT},{src:ASSETS.ARROW_FORWARD},{src:ASSETS.ARROW_BACKWARD},];const Cursor={WAIT:"wait",NONE:"none",};const HIGHSCORE=1305;const Game=(()=>{this.title="Where in Space is Baby Hitler?";const canvas=document.getElementById("canvas");const ctx=canvas.getContext("2d");const maskCanvas=document.createElement("canvas");maskCanvas.width=canvas.width;maskCanvas.height=canvas.height;const maskCtx=maskCanvas.getContext("2d");const tempCanvas=document.createElement("canvas");tempCanvas.width=canvas.width;tempCanvas.height=canvas.height;tempCtx=tempCanvas.getContext("2d");const touchCanvas=document.getElementById("touch-canvas");const touchCtx=touchCanvas.getContext("2d");const letterCanvas=document.createElement("canvas");letterCanvas.width=canvas.width;letterCanvas.height=canvas.height;letterCtx=letterCanvas.getContext("2d");const AudioContext=window.AudioContext||window.webkitAudioContext;let TEXTSPEEDER=1;const SAVES_LOCATION="saves";const LAST_CONTINUE="last";const MAX_LOAD_ERRORS=800;const TOUCH_SPRITES={LEFT:{src:ASSETS.TOUCH_ARROWS,col:2,row:3,size:[64,32],index:game=>game.actionDown===LEFT&&game.turning?1:0,side:LEFT,hidden:game=>game.sceneData.freeFormMove||!game.canTurn("left")&&!game.evaluate(game.currentScene.canGo,LEFT),onClick:game=>game.processArrow(LEFT),alpha:.5,},RIGHT:{src:ASSETS.TOUCH_ARROWS,col:2,row:3,size:[64,32],index:game=>game.actionDown===RIGHT&&game.turning?1:0,side:RIGHT,hidden:game=>game.sceneData.freeFormMove||!game.canTurn("right")&&!game.evaluate(game.currentScene.canGo,RIGHT),onClick:game=>game.processArrow(RIGHT),alpha:.5,},FORWARD:{src:ASSETS.TOUCH_ARROWS,col:2,row:3,size:[64,32],index:game=>2+(game.actionDown===FORWARD&&game.moving?1:0),hidden:game=>game.sceneData.freeFormMove||(!game.pos||!game.canMove(game.pos,1))&&!game.evaluate(game.currentScene.canGo,FORWARD),onClick:game=>game.processArrow(FORWARD),alpha:.5,},BACKWARD:{src:ASSETS.TOUCH_ARROWS,col:2,row:3,size:[64,32],index:game=>4+(game.actionDown===BACKWARD&&game.moving?1:0),hidden:game=>game.sceneData.freeFormMove||(!game.pos||!game.canMove(game.pos,-1))&&!game.evaluate(game.currentScene.canGo,BACKWARD),onClick:game=>game.processArrow(BACKWARD),alpha:.5,},PUNCH:{src:ASSETS.TOUCH_PUNCH,col:1,row:2,size:[64,32],index:game=>game.mouseDown&&!game.arrow?1:0,side:LEFT,hidden:game=>!game.battle||game.battle.foeDefeated||game.useItem||game.bagOpening,},BLOCK:{src:ASSETS.TOUCH_PUNCH,col:1,row:2,size:[64,32],index:game=>game.mouseDown&&game.arrow===BLOCK?1:0,side:RIGHT,hidden:game=>!game.battle||game.battle.foeDefeated||game.useItem||game.bagOpening,},MULTI_ARROWS:{src:ASSETS.MULTI_ARROWS,size:[64,32],hidden:game=>game.battle||!game.sceneData.freeFormMove,onRefresh:(game,sprite)=>{const cx=32,cy=18;let jx=0,jy=0;let anyTouch=!1;for(let i=0;i<game.touchList.length;i++){const{pageX,pageY}=game.touchList[i];const px=(pageX-touchCanvas.offsetLeft)/touchCanvas.offsetWidth*touchCanvas.width;const py=(pageY-touchCanvas.offsetTop)/touchCanvas.offsetHeight*touchCanvas.height;jx=px;jy=py;anyTouch=!0}
if(anyTouch){if(!game.mouse){game.mouse=game.lastMousePos?game.lastMousePos:{x:canvas.width/2,y:canvas.height/2,fromTouch:!0,}}
game.mouse.x=jx;game.mouse.y=jy+30;game.mouseDown=!0}else{}},},JOYPAD:{hidden:game=>!game.sceneData.joy,onRefresh:(game,sprite)=>{const{sceneData}=game;if(!sceneData.joystick){sceneData.joystick={}}
const cx=18,cy=18;let jx=0,jy=0;for(let i=0;i<game.touchList.length;i++){const{pageX,pageY}=game.touchList[i];const px=(pageX-touchCanvas.offsetLeft)/touchCanvas.offsetWidth*touchCanvas.width;const py=(pageY-touchCanvas.offsetTop)/touchCanvas.offsetHeight*touchCanvas.height;const djx=(px-cx);const djy=(py-cy);if(px<32){const dist=Math.sqrt(djx*djx+djy*djy);jx=djx/dist*Math.min(dist,5);jy=djy/dist*Math.min(dist,5)}}
sceneData.joystick.jx=jx;sceneData.joystick.jy=jy;if(!game.mouse){game.mouse=game.lastMousePos?game.lastMousePos:{x:canvas.width/2,y:canvas.height/2,fromTouch:!0,}}
const dist=Math.sqrt(jx*jx+jy*jy);const{gameScreen}=sceneData;const limitLeft=gameScreen?gameScreen.x+1:0;const limitTop=gameScreen?gameScreen.y+1:0;const limitBottom=gameScreen?gameScreen.y+gameScreen.height-2:canvas.height;const limitRight=gameScreen?gameScreen.x+gameScreen.width-2:canvas.height;const speed=gameScreen?.3:1;if(dist){game.mouse.x=game.mouse.x+jx/dist*speed;game.mouse.y=game.mouse.y+jy/dist*speed}
game.mouse.x=Math.max(limitLeft,Math.min(limitRight,game.mouse.x));game.mouse.y=Math.max(limitTop,Math.min(limitBottom,game.mouse.y))},custom:(game,sprite,ctx)=>{const cx=18,cy=18;ctx.fillStyle="#888888";ctx.beginPath();ctx.arc(cx,cy,10,0,Math.PI*2);ctx.fill();ctx.fillStyle="#555555";ctx.beginPath();ctx.arc(cx,cy,4,0,Math.PI*2);ctx.fill();ctx.fillStyle="#bbbbbb";ctx.beginPath();ctx.arc(cx,cy,2,0,Math.PI*2);ctx.fill();const{jx,jy}=game.sceneData.joystick;const joyTop=6;ctx.fillStyle="#bbbbbb";ctx.beginPath();ctx.moveTo(cx-2,cy);ctx.lineTo(cx+2,cy);ctx.lineTo(cx+jx+2,cy+jy-joyTop);ctx.lineTo(cx+jx-2,cy+jy-joyTop);ctx.lineTo(cx-2,cy);ctx.closePath();ctx.fill();ctx.strokeStyle="#ffffff";ctx.beginPath();ctx.moveTo(cx-1,cy);ctx.lineTo(cx+jx-1,cy+jy-joyTop);ctx.stroke();ctx.fillStyle="#77bb77";ctx.beginPath();ctx.arc(cx+jx,cy+jy-joyTop,6,0,Math.PI*2);ctx.fill();ctx.fillStyle="#FFFFFF";ctx.beginPath();ctx.arc(cx+jx-2,cy+jy-joyTop-2,2,0,Math.PI*2);ctx.fill()},},JOYBUTTON:{hidden:game=>!game.sceneData.joy,onRefresh:(game,sprite)=>{if(!game.sceneData.joystick){game.sceneData.joystick={}}
game.sceneData.joystick.pressed=0;for(let i=0;i<game.touchList.length;i++){const{pageX,pageY}=game.touchList[i];const px=(pageX-touchCanvas.offsetLeft)/touchCanvas.offsetWidth*touchCanvas.width;const py=(pageY-touchCanvas.offsetTop)/touchCanvas.offsetHeight*touchCanvas.height;if(px>32){game.sceneData.joystick.pressed=game.now}}
game.mouseDown=game.sceneData.joystick.pressed},custom:(game,sprite,ctx)=>{const cx=48,cy=18;ctx.fillStyle="#888888";ctx.beginPath();ctx.arc(cx,cy,8,0,Math.PI*2);ctx.fill();ctx.fillStyle="#222222";ctx.beginPath();ctx.arc(cx,cy,7,0,Math.PI*2);ctx.fill();ctx.fillStyle="#bb5555";ctx.beginPath();ctx.arc(cx,cy+1,6,0,Math.PI*2);ctx.fill();const{pressed}=game.sceneData.joystick;const joyTop=pressed?1:4;ctx.fillStyle="#ff7777";ctx.beginPath();ctx.arc(cx,cy-joyTop,6,0,Math.PI*2);ctx.fill()},},DIALOG:{custom:(game,sprite,ctx)=>{},},};function nop(){}
function toMap(string){if(!string){return null}
const lines=string.split("\n").map(line=>line.trim()).filter(line=>line!="");lines.reverse();return lines}
function getCell(map,x,y){if(!map){console.error("You need a map!");return}
if(y<0||y>=map.length||!map[y]||x<0||x>=map[y].length){return'X'}
return map[y][x]}
const imageStock={};const soundStock={};let gameInstance;const gameSettings={};const ROTATION_FRAMES=[[1,0,7],[2,4,6],[3,4,5],];class Game{static setTextSpeeder(value){TEXTSPEEDER=value;console.log("TextSpeeder",TEXTSPEEDER)}
static start(gameConfig){gameInstance=new Game();gameInstance.config=gameConfig;gameConfig.scenes.forEach(scene=>{gameInstance.onSceneAdded(scene)});return gameInstance}
playGame(){this.play();if(location.hash.split("#")[1]){this.gotoScene(location.hash.split("#")[1])}}
getMapInfo(map,door){if(!map){return null}
for(let row=0;row<map.length;row++){for(let col=0;col<map[row].length;col++){if(map[row][col]==door){for(let rotation=0;rotation<ORIENTATIONS.length;rotation+=2){if(this.matchCell(map,col,row,0,1,ORIENTATIONS[rotation],'','X12345')){const[x,y]=Game.getPosition(col,row,0,1,ORIENTATIONS[rotation]);return{pos:{x,y},rotation,}}}
return this.matchCell(this.map,col,row,0,+1,this.orientation,'12345',[]);return{x:col,y:row+1,}}}}
throw new Error(`Invalid map. Missing door ${door}`)}
emptyBag(){for(let i in this.inventory){return!1}
return!0}
addToInventory(obj){if(this.inventory[obj.item]){const{count}=obj;this.inventory[obj.item].count=this.countItem(obj.item)+(count||1)}else{this.inventory[obj.item]=obj}}
removeFromInventory(item,count){if(this.inventory[item]){if(this.inventory[item].count){this.inventory[item].count-=(count||1)}
if(!this.inventory[item].count){delete this.inventory[item]}}}
countItem(item){return this.inventory[item]?this.inventory[item].count||1:0}
set sceneName(name){if(name!==this.sceneName){this.data.scene={name,};console.log("SCENE",this.data.scene.name)}}
get sceneName(){return(this.data.scene?this.data.scene.name:null)||this.config.scenes.filter(scene=>scene.startScene)[0].name}
unlock(cell){if(!this.situation.unlocked){this.situation.unlocked={}}
if(!this.situation.unlocked[cell]){this.situation.unlocked[cell]=this.now;return!0}
return!1}
constructor(){this.imageStock=imageStock;this.soundStock=soundStock;this.keyboard=[];document.addEventListener("keydown",({keyCode})=>{this.keyboard[keyCode]=!0});document.addEventListener("keyup",({keyCode})=>{this.keyboard[keyCode]=!1});canvas.addEventListener("mousemove",({currentTarget,offsetX,offsetY})=>{const{offsetWidth,offsetHeight}=currentTarget;this.actionMove(offsetX,offsetY,offsetWidth,offsetHeight)});canvas.addEventListener("mousedown",e=>{e.preventDefault();const{currentTarget,offsetX,offsetY}=e;const{offsetWidth,offsetHeight}=currentTarget;this.actionClick(offsetX,offsetY,offsetWidth,offsetHeight);if(this.pendingTip){this.pendingTip.time-=400;this.playSound(SOUNDS.BOP,{volume:.2});this.sceneData.flashTip=this.now}
if(this.pickedUp&&this.pickedUp.tip){this.pickedUp.tip.time-=400;this.playSound(SOUNDS.BOP,{volume:.2});this.sceneData.flashTip=this.now}});canvas.addEventListener("mouseleave",()=>{this.arrow=0;this.lastMousePos=null;this.mouse=null;this.mouseDown=0;this.actionDown=0});document.addEventListener("mouseup",e=>{this.actionDown=0;this.mouseDown=0;this.clicking=!1});document.addEventListener("keydown",({keyCode})=>{switch(keyCode){case 65:case 81:this.turnLeft(this.now);break;case 68:case 69:this.turnRight(this.now);break;case 32:this.performAction(this.now);break;default:}});const self=this;this.touchActive=!1;document.addEventListener('touchend',function activateMotion(e){self.touchActive=!0;if(!document.fullscreenElement&&!self.disableFullScreen){self.toggleFullScreen();e.preventDefault();e.stopPropagation()}else{if(e.target===canvas){const{target,changedTouches}=e;const[touch]=changedTouches;const{offsetLeft,offsetTop,offsetWidth,offsetHeight}=target;self.actionClick(touch.clientX-offsetLeft,touch.clientY-offsetTop,offsetWidth,offsetHeight,!0)}}
document.removeEventListener('touchend',activateMotion);registerAllTouchEvents(self)});const touchCanvas=document.getElementById("touch-canvas");function registerAllTouchEvents(game){document.addEventListener('touchend',e=>{if(game.data.theme&&game.soundStock[game.data.theme.song]){const audio=game.soundStock[game.data.theme.song].audio;if(!audio.played.length){audio.play();console.log("Unblocking song")}}
if(!document.fullscreenElement&&!self.disableFullScreen){self.toggleFullScreen();e.preventDefault();e.stopPropagation()}});document.addEventListener('touchend',e=>{if(!game.touchActive){return}
if(!document.fullscreenElement&&!self.disableFullScreen){return}
if(e.target!=canvas&&e.target!=touchCanvas&&!event.touches.length){if(game.mouse)
game.lastMousePos=game.mouse;game.mouse=null}
game.actionDown=0;game.mouseDown=0;game.clicking=!1;game.arrow=null});canvas.addEventListener('touchmove',e=>{const{currentTarget,changedTouches}=e;const[touch]=changedTouches;const{offsetLeft,offsetTop,offsetWidth,offsetHeight}=currentTarget;game.actionMove(touch.clientX-offsetLeft,touch.clientY-offsetTop,offsetWidth,offsetHeight,!0)},{passive:!0});canvas.addEventListener('touchstart',e=>{if(!game.touchActive){return}
if(!document.fullscreenElement&&!self.disableFullScreen){return}
const{currentTarget,changedTouches}=e;const[touch]=changedTouches;const{offsetLeft,offsetTop,offsetWidth,offsetHeight}=currentTarget;game.actionMove(touch.clientX-offsetLeft,touch.clientY-offsetTop,offsetWidth,offsetHeight);game.checkMouseHover(!0);game.actionClick(touch.clientX-offsetLeft,touch.clientY-offsetTop,offsetWidth,offsetHeight,!0);if(game.pendingTip){game.pendingTip.time-=400;game.playSound(SOUNDS.BOP,{volume:.2});game.sceneData.flashTip=game.now}
if(game.pickedUp&&game.pickedUp.tip){game.pickedUp.tip.time-=400;game.playSound(SOUNDS.BOP,{volume:.2});game.sceneData.flashTip=game.now}},{passive:!0});canvas.addEventListener('touchend',e=>e.preventDefault());self.touchList={length:0};self.touchesSaved=[];touchCanvas.addEventListener("touchstart",({changedTouches,touches})=>{self.touchList=touches;if(game.sceneData.joy||game.sceneData.freeFormMove&&!game.battle){return}
for(let i=0;i<changedTouches.length;i++){const{identifier,pageX,pageY}=changedTouches[i];const px=(pageX-touchCanvas.offsetLeft)/touchCanvas.offsetWidth*touchCanvas.width;const py=(pageY-touchCanvas.offsetTop)/touchCanvas.offsetHeight*touchCanvas.height;const pos={x:px,y:py};if(game.battle&&!game.battle.foeDefeated){if(pos.x<32){game.arrow=null}else{game.arrow=BLOCK}
game.mouse=null;game.actionClickAtMouse();return}
for(let arrow in TOUCH_SPRITES){const sprite=TOUCH_SPRITES[arrow];if(game.isMouseHover(sprite,pos)&&sprite.onClick){sprite.onClick(game,sprite);game.mouse=null;return}}}
for(let i=0;i<changedTouches.length;i++){delete self.touchesSaved[changedTouches[i].identifier]}
if(!game.mouse){game.mouse=game.lastMousePos?game.lastMousePos:{x:canvas.width/2,y:canvas.height/2,fromTouch:!0,}}
game.mouse.time=game.now;game.lastMouseMove=game.now},{passive:!0});touchCanvas.addEventListener("touchmove",e=>{const{changedTouches,touches}=e;self.touchList=touches;if(game.sceneData.joy||game.sceneData.freeFormMove&&!game.battle){return}
Array.prototype.slice.call(changedTouches).forEach(({identifier,pageX,pageY})=>{if(!self.touchesSaved[identifier]){self.touchesSaved[identifier]={pageX,pageY,}}else{if(game.mouse){const diffX=(pageX-self.touchesSaved[identifier].pageX);const diffY=(pageY-self.touchesSaved[identifier].pageY);const dist=Math.sqrt(diffX*diffX+diffY*diffY);const dx=diffX*canvas.width/canvas.offsetWidth*dist;const dy=diffY*canvas.height/canvas.offsetHeight*dist;game.mouse.x=Math.max(0,Math.min(canvas.width,game.mouse.x+dx));game.mouse.y=Math.max(0,Math.min(canvas.height,game.mouse.y+dy));game.mouse.fromTouch=!0;game.actionMoveMouse()}
self.touchesSaved[identifier].pageX=pageX;self.touchesSaved[identifier].pageY=pageY}})},{passive:!0});touchCanvas.addEventListener("touchend",({changedTouches,touches})=>{self.touchList=touches;if(game.sceneData.joy||game.sceneData.freeFormMove&&!game.battle){return}
if(game.mouse){if(game.now-game.mouse.time<400){game.mouse.fromTouch=!0;game.actionClickAtMouse();game.checkMouseHover(!0);game.actionDown=0;game.mouseDown=0;game.clicking=!1}}});document.addEventListener('fullscreenerror',(event)=>{console.error('an error occurred changing into fullscreen',event)});document.addEventListener("fullscreenchange",self.fixScreenSize)}
window.oncontextmenu=function(event){event.preventDefault();event.stopPropagation();return!1}}
fixScreenSize(){const w=Math.max(document.documentElement.clientWidth,window.innerWidth||0);const h=Math.max(document.documentElement.clientHeight,window.innerHeight||0);const minSize=Math.min(w,h);if(!document.fullscreenElement){document.querySelectorAll(".game-size").forEach(({classList,style})=>{style.width=``;style.height=``;classList.remove("full")});document.querySelectorAll(".touch-size").forEach(({classList,style})=>{classList.remove("full")});document.querySelector(".game-container").classList.remove("full")}else{document.querySelectorAll(".game-size").forEach(({classList,style})=>{style.width=`${minSize}px`;style.height=`${minSize}px`;classList.add("full")});document.querySelectorAll(".touch-size").forEach(({classList,style})=>{classList.add("full")});document.querySelector(".game-container").classList.add("full")}}
actionMove(x,y,offsetWidth,offsetHeight,fromTouch){if(!this.mouse){this.mouse={}}
this.mouse.x=x/offsetWidth*canvas.width;this.mouse.y=y/offsetHeight*canvas.height;this.mouse.fromTouch=fromTouch;this.actionMoveMouse()}
actionMoveMouse(){if(this.now-this.lastMouseCheck<100){this.lastMouseCheck=0}
this.lastMouseMove=this.now;if(this.pendingTip&&(this.pendingTip.progress<1||this.pendingTip.moreText)&&!this.pendingTip.removeLock||this.waitCursor||this.hideCursor){return}
if(this.pickedUp&&this.pickedUp.tip&&this.pickedUp.tip.progress<1){return}
if(this.arrowGrid){this.arrow=this.getArrow(this.mouse.x,this.mouse.y,64,64);if(this.mouseDown){this.actionDown=this.arrow}}}
actionClick(x,y,offsetWidth,offsetHeight,fromTouch){if(!this.mouse){this.mouse={}}
this.mouse.x=x/offsetWidth*canvas.width;this.mouse.y=y/offsetHeight*canvas.height;this.mouse.fromTouch=fromTouch;this.actionClickAtMouse()}
actionClickAtMouse(){this.lastMouseMove=this.now;this.lastMouseCheck=0;if(this.battle&&!this.bagOpening){if(!this.blocking()&&!this.battle.playerHit&&!this.battle.playerBlock&&this.arrow!==BAG&&!(this.battle.dummyBattle&&(this.arrow===LEFT||this.arrow===RIGHT))&&!this.battle.playerLeftAttack&&!this.battle.playerRightAttack&&(!this.hoverSprite||!this.evaluate(this.hoverSprite.noPunch,this.hoverSprite))){if(this.onScenePunch(this,this.battle)){if(this.battle.fist===LEFT&&!this.battle.playerLeftAttack){this.battle.playerLeftAttack=this.now;this.battle.playerAttackLanded=0;this.battle.foeBlock=0}else if(this.battle.fist===RIGHT&&!this.battle.playerRightAttack){this.battle.playerRightAttack=this.now;this.battle.playerAttackLanded=0;this.battle.foeBlock=0}}}}
if(this.pendingTip&&(this.pendingTip.progress<1||this.pendingTip.moreText)&&!this.pendingTip.removeLock||this.waitCursor||this.hideCursor){return}
if(this.useItem==="gun"&&(!this.hoverSprite||!this.hoverSprite.bag&&!this.hoverSprite.menu)){if(this.countItem('bullet')>0){const{bullet}=this.inventory;this.removeFromInventory('bullet');this.gunFired=this.now;game.playSound(SOUNDS.GUN_SHOT)}else{this.gunFired=0;game.playSound(SOUNDS.DUD);game.sceneData.missedShots=(game.sceneData.missedShots||0)+1}
this.mouseDown=this.now;return}
if(this.pickedUp){const{item,onPicked,tip,image}=this.pickedUp;if(tip.progress>=1){this.pickedUp=null;this.tips={};this.openBag(this.now,onPicked)}
return}
if(this.useItem){const{image,item,message,col,row}=this.inventory[this.useItem];if(game.isMouseHover({src:image,index:3,col,row},this.mouse)){this.pickUp({item,image,message:message||"",justLooking:!0});return}}
if(this.dialog&&(!this.pendingTip||this.pendingTip.removeLock)){this.checkHoveredDialog();if(this.dialog.hovered){if(this.dialog.hovered.onSelect&&!this.dialog.tapped){this.dialog.tapped=this.now;this.playSound(SOUNDS.SELECT,{volume:.5});const hovered=game.dialog.hovered;const dialog=game.dialog;this.delayAction(game=>{dialog.tapped=0;hovered.onSelect(game,dialog,dialog.conversation[dialog.index],hovered)},180)}
return}}
if(this.data.gameOver){const selection=Math.floor(this.mouse.y/10)-4;if(selection>=0&&selection<=1){if(selection==0){this.load()}else{this.restart()}
return}}
this.mouseDown=this.now;if(this.mouse){if(!this.hoverSprite||this.hoverSprite.bag||this.hoverSprite.menu){if(this.arrowGrid&&!this.useItem&&!this.bagOpening&&!game.sceneData.showStats){this.arrow=this.getArrow(this.mouse.x,this.mouse.y,64,64);this.processArrow(this.arrow)}}}
this.checkMouseHover(!0)}
processArrow(arrow){switch(arrow){case LEFT:{if(this.onSceneRotate(this,arrow)){return}
this.turnLeft(this.now);this.actionDown=arrow;break}
case RIGHT:{if(this.onSceneRotate(this,arrow)){return}
this.turnRight(this.now);this.actionDown=arrow;break}
case DOOR:{const{x,y}=this.pos;if(this.matchCell(this.map,x,y,0,1,this.orientation,"12345",[])){const cell=this.frontCell();const door=this.frontDoor();if(!door){console.error("You need doors!")}else if(door.lock&&(!this.situation.unlocked||!this.situation.unlocked[cell])){this.showTip("It's locked.",null,null,{removeLock:!0});this.playErrorSound()}else{if(!this.doorOpening){this.performAction(this.now)}else if(this.doors[cell].exit){if(this.doors[cell].wayUp||this.doors[cell].wayDown){this.playSteps()}
this.doors[cell].exit(this,this.doors[cell])}else{this.actionDown=arrow}}}else{this.actionDown=arrow}
break}
case FORWARD:{if(this.onSceneForward(this)){return}
if(!this.pos){this.actionDown=arrow;return}
const{x,y}=this.pos;if(this.matchCell(this.map,x,y,0,1,this.orientation,"12345",[])){if(!this.doorOpening){this.performAction(this.now)}else if(this.doors){const cell=getCell(this.map,...Game.getPosition(x,y,0,1,this.orientation));if(this.doors[cell].exit){if(this.doors[cell].wayUp||this.doors[cell].wayDown){this.playSteps()}
this.doors[cell].exit(this,this.doors[cell])}else{this.actionDown=arrow}}else{console.error("You need doors!")}}else{this.actionDown=arrow}
break}
case BACKWARD:{if(this.onSceneBackward(this)){return}
this.actionDown=arrow;break}}}
fadeToScene(index,entrance,fadeDuration,afterScene){if(!fadeDuration){fadeDuration=1000}
this.waitCursor=!0;this.fadeOut(this.now,{duration:fadeDuration*1.5,fadeDuration,color:"#000000",onDone:game=>{game.waitCursor=!1;game.gotoScene(index,entrance);if(afterScene){afterScene(game)}}})}
gotoScene(index,entrance,restoreMapInfo){const{door}=entrance||{};if(typeof(index)==="string"){const sceneToGoTo=index;index=this.config.scenes.map(({name},idx)=>name===index?idx:-1).filter(index=>index>=0)[0];if(typeof(index)==='undefined'){console.error(`${sceneToGoTo}: unknown scene.`)}}
this.sceneName=this.config.scenes[index].name;this.door=door||1;this.loadScene(this.config.scenes[index],restoreMapInfo)}
checkMotionAvailable(){this.motionAvailable=!1;if(this.arrowGrid){this.arrowGrid.forEach(line=>{line.forEach(cell=>{if(cell&&cell!==BAG&&cell!==MENU){this.motionAvailable=!0}})})}}
getSceneByName(name){if(this.sceneByName){return this.sceneByName[name]}
return null}
get currentScene(){return this.getSceneByName(this.sceneName)}
set door(value){this.data.scene.door=value}
get door(){return this.data.scene?this.data.scene.door||0:0}
get inventory(){return this.data.inventory}
get situation(){const{data,sceneName}=this;if(!data.situation[sceneName]){data.situation[sceneName]={}}
return data.situation[sceneName]}
get mute(){return gameSettings.mute||!1}
set mute(value){if(this.mute!==value){gameSettings.mute=value;const{theme}=this.data;if(theme){if(this.mute){this.stopSound(theme.song)}else{this.playTheme(theme.song,theme)}}}}
getSituation(sceneName){const{data,config}=this;if(!data.situation[sceneName]){data.situation[sceneName]={}}
return data.situation[sceneName]}
hasVisited(sceneName){const{data,config}=this;const index=config.scenes.map(({name},idx)=>name===sceneName?idx:-1).filter(index=>index>=0)[0];return data.situation[index]}
pause(){this.paused=this.now;this.resumed=0;for(let s in SOUNDS){this.stopSound(SOUNDS[s])}
if(this.tone){this.tone.stop()}}
resume(){this.paused=0;this.resumed=this.now;if(this.data&&this.data.theme&&this.data.theme.song){this.playTheme(this.data.theme.song,this.data.theme)}
if(this.tone){this.tone.start()}}
clearData(){this.data={time:0,name:null,scene:{},pickedUp:{},seen:{},shot:{},inventory:{},situation:{},pos:{x:0,y:0},rotation:0,gameOver:0,battle:null,mute:!1,stats:null,joined:null,ship:{},};this.setupStats()}
initGame(){this.clearData();if(this.mouse)
this.lastMousePos=this.mouse;this.mouse=null;this.timeOffset=0;this.paused=!1;this.loadCount=0;this.lastMouseCheck=0;this.lastMouseMove=0;this.clickCtx=document.createElement("canvas").getContext("2d");this.clickCtx.canvas.width=3;this.clickCtx.canvas.height=3;this.prepareAssets();this.prepareSounds(({src})=>{});this.createLoop(this.refresh.bind(this))}
get orientation(){return ORIENTATIONS[Math.floor(this.rotation/2)*2]}
get granular_orientation(){return ORIENTATIONS[Math.round(this.rotation)%8]}
initScene(){this.actions=[];this.keyboard=[];this.frameIndex=0;this.doorOpening=0;this.bagOpening=0;this.menuOpening=0;this.doorOpened=0;this.arrow=0;this.actionDown=0;this.fade=0;this.fadeColor="#000000";this.mouseDown=0;this.clicking=!1;this.hoverSprite=null;this.tips={};this.pickedUp=null;this.useItem=null;this.useItemTime=0;this.pendingTip=null;this.hideCursor=!1;this.waitCursor=!1;this.hideArrows=!1;this.sceneData={visited:{},};this.sceneIntro=!1;this.mouseHand=null;this.gunFired=0;this.map=null;this.sprites=null;this.doors=null;this.events=null;this.arrowGrid=null;this.sceneTime=0;this.dialog=null;this.onScene=null;this.onSceneRefresh=null;this.onSceneShot=null;this.onSceneHoldItem=null;this.onSceneUseItem=null;this.onSceneForward=null;this.onSceneBackward=null;this.onSceneBattle=null;this.onScenePunch=null;this.customCursor=null;this.moving=0;this.turning=0;this.setTone(0);this.data.gameOver=!1;this.processingBag=!1}
markPickedUp(item){if(!this.data.pickedUp[item]){this.data.pickedUp[item]=this.now}}
pickUp({item,image,message,inventoryMessage,count,col,row,index,onPicked,onTipDone,justLooking,hideFromInventory}){if(!item){console.error(`Your item (${image}) needs a name.`)}
const time=this.now;if(!justLooking){this.markPickedUp(item);this.addToInventory({item,image:hideFromInventory?null:image,col:col||2,row:row||2,count:count||1,message:inventoryMessage,});this.playSound(SOUNDS.PICKUP)}
this.pickedUp={item,image,time,onPicked,col:col||2,row:row||2,index:index||0,tip:{text:message||"",time,speed:100*TEXTSPEEDER,fade:0,end:0,onDone:onTipDone,},};if(!this.bagOpening){this.openBag(this.now)}}
getArrow(x,y,width,height){if(this.hideArrows){return 0}
const quadrantX=Math.min(4,Math.max(0,Math.floor(x/width*5)));const quadrantY=Math.min(4,Math.max(0,Math.floor(y/height*5)));const arrow=this.evaluate(this.arrowGrid[quadrantY][quadrantX]);return arrow}
evaluate(value,extra){if(value&&value.constructor===Function){return this.evaluate(value(this,extra))}
return value}
turnLeft(now,callback){const{map}=this;this.turn(now,"left",callback)}
turnRight(now,callback){const{map}=this;this.turn(now,"right",callback)}
turn(now,direction,callback){if(this.battle){if(this.battle.dummyBattle){this.setVisited(!1);this.battle=null}}
if(this.rotation%2===0&&this.canTurn(direction)){this.actions.push({time:now,frame:0,command:"turn",direction,rotation:this.rotation,active:!0,started:!1,repeat:0,onDone:(game,action)=>{if(game.checkEvents()){action.active=!1}
if(callback){callback(game,action)}},});this.tips={}}}
performAction(now){if(this.map){const{x,y}=this.pos;const closeDoor=this.matchCell(this.map,x,y,0,1,this.orientation,'12345','');if(closeDoor){this.playSound(SOUNDS.DOOR);this.actions.push({time:now,frame:0,command:"open",onStart:()=>this.doorOpening=!this.doorOpening?1:-this.doorOpening,onDone:game=>game.doorOpened=game.doorOpening>0?1:0,active:!0,started:!1,})}}}
openBag(now,onClose){if(this.processingBag){return}
this.doorOpening=0;this.processingBag=!0;this.actions.push({time:now,command:"openbag",onStart:()=>this.bagOpening=!this.bagOpening?1:-this.bagOpening,onDone:game=>{if(game.bagOpening<0){game.bagOpening=0;if(onClose){onClose(game)}}else if(game.bagOpening>0&&game.useItem){game.useItem=null}
this.processingBag=!1},active:!0,started:!1,});if(this.pendingTip){this.pendingTip.end=game.now}}
openMenu(now,onClose){this.actions.push({time:now,command:"openmenu",onStart:()=>this.menuOpening=!this.menuOpening?1:-this.menuOpening,onDone:game=>{if(game.menuOpening<0){game.menuOpening=0;if(onClose){onClose(game)}}},active:!0,started:!1,})}
fadeOut(now,{duration,fadeDuration,color,onDone,max}){this.actions.push({time:now,command:"fadeOut",color:color||"#000000",onDone,duration,fadeDuration,active:!0,started:!1,max:max||1,})}
refreshMove(){if(!this.map){return}
let dy=0;if(this.keyboard[87]){dy++}
if(this.keyboard[83]){dy--}
if(this.actionDown){dy=this.actionDown===FORWARD?1:this.actionDown===BACKWARD?-1:0}
if(dy<0){this.moveBack(this.now)}else if(dy>0){this.moveForward(this.now)}}
refreshActions(){this.actions.forEach(action=>{const{time,command,direction,active,onDone,onStart,started}=action;if(!active){return}
if(!started){action.started=!0;if(onStart){onStart(this,action)}}
switch(command){case "move":{action.frame=Math.floor((this.now-time)/120);if(action.frame<4){this.frameIndex=direction==="forward"?3-action.frame:direction==="backward"?action.frame:0}else{this.frameIndex=0;if(onDone){onDone(this,action)}
const dy=direction==="forward"?1:-1;if(action.repeat&&action.active&&this.canMove(this.pos,dy)){action.repeat--;const{x,y}=this.pos;if(this.matchCell(this.map,x,y,0,dy,this.orientation,'X12345',"")){action.active=!1}else{action.started=!1;action.time=this.now;this.doorOpening=0;this.doorOpened=0;this.moving=this.now}}else{action.active=!1}}
break}
case "open":{const frame=Math.floor((this.now-time)/150);if(frame<4){this.frameIndex=Math.min(3,this.doorOpening>0?frame:3-frame)}else{if(onDone){onDone(this,action)}
action.active=!1}
break}
case "openbag":{const frame=Math.floor((this.now-time)/80);if(frame<4){this.frameIndex=Math.min(3,this.bagOpening>0?frame:3-frame)}else{if(onDone){onDone(this,action)}
action.active=!1}
break}
case "openmenu":{const frame=Math.floor((this.now-time)/50);if(frame<4){this.frameIndex=Math.min(3,this.menuOpening>0?frame:3-frame)}else{if(onDone){onDone(this,action)}
action.active=!1}
break}
case "turn":{const frame=Math.floor((this.now-time)/150);const cycle=2;if(frame<cycle){const dr=direction==="left"?1:direction==="right"?-1:0;if(!dr){throw new Error("invalid direction")}
this.rotation=(action.rotation+dr*(frame+1)+8)%8;if(!this.turning){this.turning=this.now}}else{if(onDone){onDone(this,action)}
action.active=!1;this.turning=0}
break}
case "fadeOut":{const{duration,fadeDuration,color,max}=action;this.fadeColor=color;this.fade=Math.min(max,(this.now-time)/fadeDuration);if(this.now-time>duration){if(onDone){onDone(this,action)}
action.active=!1}
break}
case "delay":{const{delay}=action;if(this.now-time>delay){if(onDone){onDone(this,action)}
action.active=!1}}
break}})}
showTip(message,onDone,speed,options){const{removeLock,x,y,talker,maxLines}=options||{};if(Array.isArray(message)){let index=0;message=message.filter(a=>a);if(message.length){const tip=this.pendingTip={maxLines,index,text:message[index],time:this.now+200,speed:(speed||80)*TEXTSPEEDER,end:0,x,y,talker,moreText:message.length>1,onDone:message.length===1?onDone:game=>{index++;tip.index=index;tip.text=message[index];tip.time=game.now+200;if(index===message.length-1){tip.onDone=onDone}
this.pendingTip=tip},removeLock,}}}else{this.pendingTip={maxLines,text:message,time:this.now+200,speed:(speed||90)*TEXTSPEEDER,end:0,x,y,talker,onDone,removeLock,}}}
startDialog(dialog){this.dialog=dialog;dialog.time=game.now;dialog.index=dialog.index||0}
checkMouseHover(checkClick){if(this.now-this.lastMouseCheck<300&&!checkClick){return}
this.lastMouseCheck=this.now;if(this.mouse){let hovered=null;for(let i=this.sprites.length-1;i>=0;i--){const sprite=this.sprites[i];if((sprite.onClick||sprite.onHover||sprite.onShot||this.evaluate(sprite.tip,sprite)||this.useItem&&sprite.name||this.useItem&&sprite.combine)&&!this.actionDown&&!this.evaluate(sprite.blockMouse,sprite)){if(this.isMouseHover(sprite,this.mouse)){if(this.mouseDown&&!this.clicking){if(this.useItem&&!sprite.bag&&!sprite.menu){const{combine,combineMessage,name,onShot}=sprite;if(this.useItem==="gun"&&this.gunFired){this.data.shot[name]=this.now;let handled=!1;if(onShot){handled=onShot(this,sprite)}
if(!handled){this.onSceneShot(this,name)}}else if(!combine||!combine(this.useItem,this,sprite)){if(this.useItem!=="gun"){this.showTip(combineMessage&&combineMessage(this.useItem,this)||(name?`You can't use ~the ${this.useItem}~ on ~the ${name}~.`:`You can't use ~the ${this.useItem}~ like that.`),()=>{},70,{removeLock:!0});this.useItem=null}}}else if(sprite.onClick&&checkClick){sprite.onClick(this,sprite)}else if(sprite.tip){const hoveredTip=this.evaluate(sprite.tip,sprite);if(hoveredTip){const tip=this.tips[hoveredTip];if(tip){tip.time=Math.min(this.now,tip.time)}}}
return}
hovered=sprite;if(!hovered.bag&&!hovered.menu&&!this.battle){this.arrow=0}
break}}}
if(this.hoverSprite!==hovered){if(this.hoverSprite!==null){if(this.hoverSprite.onHoverOut){this.hoverSprite.onHoverOut(this,this.hoverSprite,hovered)}
this.hoverSprite.hoverTime=0}
this.hoverSprite=hovered;if(hovered){hovered.hoverTime=game.now;if(this.hoverSprite.onHover){this.hoverSprite.onHover(this,this.hoverSprite)}}}}}
checkUseItem(){if(this.mouseDown&&!this.actionDown&&!this.clicking){this.clicking=!0;if(this.useItem==="gun"){if(this.gunFiredWithin(100)){this.onSceneShot(this,this.useItem)}}else if(this.useItem){this.onSceneUseItem(this,this.useItem)}}}
isMouseHover(sprite,mouse){if(this.evaluate(sprite.hidden,sprite)){return!1}
if(this.evaluate(sprite.mouseHovered,sprite)){return!0}
const{x,y}=mouse;const{clickCtx}=this;clickCtx.clearRect(0,0,clickCtx.canvas.width,clickCtx.canvas.height);const shiftX=-x+1;const shiftY=-y+1;clickCtx.translate(shiftX,shiftY);this.displayImage(clickCtx,sprite);clickCtx.resetTransform();const pixels=clickCtx.getImageData(0,0,3,3).data;for(let i=0;i<pixels.length;i+=4){if(pixels[i+3]>0){return!0}}
return!1}
canTurn(direction){if(this.battle){return!1}
if(this.sceneData.freeFormMove){return!0}
if(!this.motionAvailable){return!1}
if(this.dialog){return!1}
if(this.sceneData.noTurn){return!1}
return!this.battle||this.battle.dummyBattle}
isBlocked({x,y},dx,dy,goingBackwards){const closeWallWithDirection=this.matchCell(this.map,x,y,dx,dy,this.orientation,"MXO",'');if(closeWallWithDirection){return!0}
const closeDoorWithDirection=this.matchCell(this.map,x,y,dx,dy,this.orientation,'12345','');if(closeDoorWithDirection&&(!this.doorOpened||goingBackwards)){return!0}
const mapPosition=Game.getPosition(x,y,dx,dy,this.orientation);const cell=getCell(this.map,...mapPosition);if(this.events&&this.events[cell]&&this.events[cell].blocking){return!0}
return!1}
canMove(pos,direction){if(this.battle){return!1}
if(this.sceneData.freeFormMove){return!0}
if(direction<0&&this.evaluate(this.currentScene.canGo,BACKWARD)){return!0}
if(direction>0&&this.evaluate(this.currentScene.canGo,FORWARD)){return!0}
if(!this.motionAvailable){return!1}
if(!this.map){return!1}
if(this.fade>0||this.battle||this.dialog){return!1}
return!this.isBlocked(pos,0,direction,direction===-1)}
canOpen({x,y},direction){const closeDoor=this.matchCell(this.map,x,y,0,direction,this.orientation,'12345','');return closeDoor&&!this.doorOpened}
facingPosition(){const{pos,orientation}=this;const{x,y}=pos;return Game.getPosition(x,y,0,1,orientation)}
behindEvent(){const{events}=this;if(!events){return null}
const{pos,orientation}=this;const{x,y}=pos;const mapPosition=Game.getPosition(x,y,0,-1,orientation);const cell=getCell(this.map,...mapPosition);return events[cell]}
currentEvent(){const{events,map}=this;if(!events){return null}
if(this.sceneData.currentEventCell&&events[this.sceneData.currentEventCell]){return events[this.sceneData.currentEventCell]}
if(!map){return null}
const{pos,orientation}=this;const{x,y}=pos;const mapPosition=Game.getPosition(x,y,0,0,orientation);const cell=getCell(this.map,...mapPosition);return events[cell]}
facingEvent(){const{events,map}=this;if(!events||!map){return null}
const mapPosition=this.facingPosition();const cell=getCell(this.map,...mapPosition);return events[cell]}
furtherEvent(){const{events}=this;if(!events){return null}
const{pos,orientation}=this;const{x,y}=pos;const mapPosition=Game.getPosition(x,y,0,2,orientation);const cell=getCell(this.map,...mapPosition);return events[cell]}
setVisited(value){const mapPosition=this.facingPosition();const visitTag=mapPosition.join("_");this.sceneData.visited[visitTag]=value}
checkEvents(){const{events,map}=this;if(events){if(this.sceneData.currentEventCell){this.triggerEvent(this.sceneData.currentEventCell);this.sceneData.currentEventTriggered=this.now;return}
if(map){const mapPosition=this.facingPosition();const cell=getCell(map,...mapPosition);if(events[cell]){const visitTag=mapPosition.join("_");if(!this.sceneData.visited[visitTag]){if(this.triggerEvent(cell)){this.setVisited(!0)}}}}}
return!1}
triggerEvent(cell){const{events}=this;if(!events[cell]){return!1}
const{onEvent}=events[cell];return onEvent&&onEvent(this,events[cell])}
move(now,direction,callback){const dy=direction==="forward"?1:-1;if(!this.canMove(this.pos,dy)){return}
const onStart=direction==="forward"?game=>game.applyMove(direction,game.orientation):nop;const onDone=direction==="backward"?(game,action)=>{game.applyMove(direction,game.orientation);const{x,y}=game.pos;const closeDoor=game.matchCell(game.map,x,y,0,direction,game.orientation,'12345','');game.doorOpening=0;game.doorOpened=0;game.frameIndex=0;if(callback){callback(game)}
if(this.checkEvents()){action.active=!1}}:(game,action)=>{if(callback){callback(game)}
if(this.checkEvents()){action.active=!1}};const[action]=this.actions.filter(action=>{const{command,active}=action;return active&&command==="move"&&action.direction===direction});if(action){if(action.frame===3&&action.repeat===0){action.repeat++}
return}
this.bagOpening=0;this.menuOpening=0;this.doorOpening=0;this.doorOpened=0;this.moving=now;this.actions.push({time:now,frame:0,command:"move",direction,onStart,onDone:(game,action)=>{this.moving=0;onDone(game,action)},active:!0,started:!1,repeat:0,});const{yupa}=game.data;if(yupa){yupa.rotation=direction==="forward"?(this.rotation+4)%8:this.rotation;if(direction==="forward"){yupa.position=Math.random()<.5?-9:9}}}
moveForward(now){this.move(now,"forward")}
moveBack(now){this.move(now,"backward")}
applyMove(direction,orientation){const dir=direction==="forward"?1:direction==="backward"?-1:0;switch(orientation){case 'N':this.pos.y+=dir;break;case 'S':this.pos.y-=dir;break;case 'E':this.pos.x+=dir;break;case 'W':this.pos.x-=dir;break}}
cleanupData(){this.actions=this.actions.filter(({active})=>active)}
static getPosition(x,y,dx,dy,orientation){switch(orientation){case 'N':return[x+dx,y+dy];case 'S':return[x-dx,y-dy];case 'E':return[x+dy,y-dx];case 'W':return[x-dy,y+dx]}}
hasLeftWallWhenRotating(){if(!this.pos){return!1}
const{x,y}=this.pos;switch(this.granular_orientation){case 'NW':return this.onDoor()?this.matchCell(this.map,x,y,-1,0,'N','.',""):this.matchCell(this.map,x,y,-1,0,'N','XM12345',"");case 'SW':return this.onDoor()?this.matchCell(this.map,x,y,0,-1,'N','.',""):this.matchCell(this.map,x,y,0,-1,'N','XM12345',"");case 'SE':return this.onDoor()?this.matchCell(this.map,x,y,1,0,'N','.',""):this.matchCell(this.map,x,y,1,0,'N','XM12345',"");case 'NE':return this.onDoor()?this.matchCell(this.map,x,y,0,1,'N','.',""):this.matchCell(this.map,x,y,0,1,'N','XM12345',"")}}
hasRightWallWhenRotating(){if(!this.pos){return!1}
const{x,y}=this.pos;switch(this.granular_orientation){case 'NW':return this.onDoor()?this.matchCell(this.map,x,y,0,1,'N','.',""):this.matchCell(this.map,x,y,0,1,'N','XM12345',"");case 'SW':return this.onDoor()?this.matchCell(this.map,x,y,-1,0,'N','.',""):this.matchCell(this.map,x,y,-1,0,'N','XM12345',"");case 'SE':return this.onDoor()?this.matchCell(this.map,x,y,0,-1,'N','.',""):this.matchCell(this.map,x,y,0,-1,'N','XM12345',"");case 'NE':return this.onDoor()?this.matchCell(this.map,x,y,1,0,'N','.',""):this.matchCell(this.map,x,y,1,0,'N','XM12345',"")}}
matchCell(map,x,y,dx,dy,orientation,types,nottypes){const cell=getCell(map,...Game.getPosition(x,y,dx,dy,orientation));return(types.length===0||types.indexOf(cell)>=0)&&(!nottypes.length||nottypes.indexOf(cell)<0)}
mazeHole({direction,distance}){if(!this.pos){return!1}
const{x,y}=this.pos;const dx=direction===LEFT?-1:direction===RIGHT?1:0;const dy=distance===FURTHER?2:distance===FAR?1:distance===CLOSE?0:0;if(this.onDoor()&&this.matchCell(this.map,x,y,dx,dy,this.orientation,".","")){return!1}
return this.matchCell(this.map,x,y,dx,dy,this.orientation,[],'XM12345')}
closeWall(){if(!this.pos){return!1}
const{x,y}=this.pos;if(this.facingEvent()&&this.facingEvent().wall){return!0}
return this.matchCell(this.map,x,y,0,+1,this.orientation,'XM12345',[])||this.matchCell(this.map,x,y,0,0,this.orientation,'12345',[])&&this.frontCell()==='.'}
closeDoor(){if(!this.pos){return!1}
const{x,y}=this.pos;return this.matchCell(this.map,x,y,0,+1,this.orientation,'12345',[])||this.matchCell(this.map,x,y,0,0,this.orientation,'12345',[])&&this.frontCell()==='.'}
onDoor(){if(!this.pos){return!1}
const{x,y}=this.pos;return this.matchCell(this.map,x,y,0,0,this.orientation,'12345',[])}
frontDoor(){if(!this.doors){return null}
return this.doors[this.frontCell()]}
frontCell(){if(!this.pos){return!1}
const{x,y}=this.pos;return getCell(this.map,...Game.getPosition(x,y,0,1,this.orientation))}
closeMap(){if(!this.pos){return!1}
const{x,y}=this.pos;return this.matchCell(this.map,x,y,0,+1,this.orientation,'M',[])}
farMap(){if(!this.pos){return!1}
const{x,y}=this.pos;return this.matchCell(this.map,x,y,0,+2,this.orientation,'M',[])}
mazeMap({direction,distance}){const{x,y}=this.pos;const dx=direction===LEFT?-1:direction===RIGHT?1:0;const dy=distance===FURTHER?2:distance===FAR?1:distance===CLOSE?0:0;return this.matchCell(this.map,x,y,dx,dy,this.orientation,"M",[])}
mazeFloor(distance){if(!this.pos){return!1}
const{x,y}=this.pos;return this.matchCell(this.map,x,y,0,distance,this.orientation,'_',[])}
farWall(){if(!this.pos){return!1}
const{x,y}=this.pos;if(this.furtherEvent()&&this.furtherEvent().wall){return!0}
return this.matchCell(this.map,x,y,0,+2,this.orientation,'XM12345',[])}
furtherWall(){if(!this.pos){return!1}
const{x,y}=this.pos;return this.matchCell(this.map,x,y,0,+3,this.orientation,'XM12345',[])}
farDoor(){if(!this.pos){return!1}
const{x,y}=this.pos;return this.matchCell(this.map,x,y,0,+2,this.orientation,'12345',[])}
displayArrows(){if(this.touchActive){return}
const{useItem,bagOpening,hideArrows,pickedUp,hideCursor}=this;if(useItem||bagOpening||hideArrows||pickedUp||hideCursor){return}
if(this.data.gameOver||this.battle&&this.arrow!==BAG&&!this.battle.dummyBattle||game.sceneData.showStats){return}
const sprites=[];const{arrow,pos}=this;if(arrow){if(arrow===FORWARD&&pos&&!this.canMove(pos,1)){}else if(arrow===BACKWARD&&pos&&!this.canMove(pos,-1)){}else if(arrow===LEFT&&!this.canTurn("left")||arrow===RIGHT&&!this.canTurn("right")){}else if(ARROWS[arrow]){const index=this.actionDown?1+Math.floor(this.now/100)%3:0;const{src,side}=ARROWS[arrow];sprites.push({src,side,index})}}
sprites.forEach(sprite=>this.displayImage(ctx,sprite))}
displayTips(){const flash=this.sceneData.flashTip&&this.now-this.sceneData.flashTip<30;if(this.pendingTip){const tip=this.pendingTip;tip.fade=Math.min(1,(this.now-(tip.end||tip.time+(tip.text.length+10)*tip.speed))/350);this.displayText(tip,flash);if(tip.fade>=1){this.pendingTip=null;this.tips={};if(tip.onDone){tip.onDone(this)}}
return}
if(this.hideCursor||this.waitCursor||this.sceneIntro||this.useItem||this.pickedUp||this.dialog&&!this.dialog.paused){return}
let hoveredTip=null;if(this.hoverSprite&&this.mouse){hoveredTip=this.evaluate(this.hoverSprite.tip,this.hoverSprite);if(hoveredTip){const tip=this.tips[hoveredTip];if(!tip){this.tips[hoveredTip]={text:hoveredTip,time:this.now+1000,speed:80*TEXTSPEEDER,end:0,}}else{tip.end=0}}}
for(let t in this.tips){const tip=this.tips[t];if(!tip.end&&(!this.hoverSprite||hoveredTip!=tip.text)){tip.end=this.now+200}
tip.fade=Math.min(1,tip.end?(this.now-tip.end)/100:(this.now-(tip.time+(tip.text.length+15)*tip.speed))/350);this.displayText(tip,flash);if(tip.fade>=1){delete this.tips[t]}}}
displayInventoryTips(){if(this.hoverSprite&&this.mouse&&this.hoverSprite.bag&&this.bagOpening&&(this.frameIndex===2||this.frameIndex===3)&&!this.pickedUp){let tipItem=null;for(let i in this.inventory){if(i!==this.useItem&&(!this.pickedUp||i!==this.pickedUp.item)){const{item,image,count,col,row}=this.inventory[i];if(this.isMouseHover({src:image,index:this.frameIndex-1,col,row},this.mouse)){tipItem=i}}}
if(tipItem){const{item,count}=this.inventory[tipItem];const msg=item==="gun"?`gun with ~${this.countItem('bullet')}~ bullet${this.countItem('bullet')>1?'s':''}`:(count||1)>1?`${item} x${count}`:`${item}`;ctx.fillStyle="#000000aa";const showAbove=this.mouse.y>=55;ctx.fillRect(1,showAbove?40:57,62,7);this.displayTextLine(ctx,{msg,x:3,y:showAbove?40:58})}}}
displayFade({fade,fadeColor}){if(fade>0){ctx.globalAlpha=fade;ctx.fillStyle=fadeColor;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.globalAlpha=1.0}}
displayCursor(){if(this.hideCursor){return}
if(this.mouse){const{x,y,fromTouch}=this.mouse;const px=Math.floor(x)+.5,py=Math.floor(y)+.5;const customCursor=this.customCursor?this.customCursor(this,ctx):null;if(customCursor==="none"){return}
if(this.pendingTip&&(this.pendingTip.progress<1||this.pendingTip.moreText)&&!this.pendingTip.removeLock||this.pickedUp&&this.pickedUp.tip&&this.pickedUp.tip.progress<1||this.waitCursor||customCursor==="wait"){const angle=this.now/200;const radius=2;ctx.strokeStyle="#FFFFFF";ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(x-Math.cos(angle)*radius,y-Math.sin(angle)*radius);ctx.lineTo(x+Math.cos(angle)*radius,y+Math.sin(angle)*radius);ctx.stroke()}else if(this.useItem&&this.useItem==="gun"&&this.arrow!==BAG){ctx.strokeStyle=Math.random()<.5?"#FFFFFF":"#000000";ctx.lineWidth=.5;ctx.beginPath();ctx.moveTo(px,0);ctx.lineTo(px,64);ctx.moveTo(0,py);ctx.lineTo(64,py);ctx.stroke()}else{const tipReady=this.hoverSprite&&this.evaluate(this.hoverSprite.tip,this.hoverSprite);const canClick=this.hoverSprite&&this.hoverSprite.onClick&&!this.evaluate(this.hoverSprite.preventClick);const noHighlight=this.hoverSprite&&this.evaluate(this.hoverSprite.noHighlight,this.hoverSprite);const canCombine=this.hoverSprite&&this.useItem&&(this.hoverSprite.name||this.hoverSprite.combine||this.hoverSprite.combineMessage);const canOpen=this.map&&this.arrow===DOOR&&this.matchCell(this.map,this.pos.x,this.pos.y,0,1,this.orientation,"12345",[])&&!this.doorOpening;const highLight=!this.data.gameOver&&(!this.arrow||this.arrow===DOOR||this.chest)&&(tipReady||canClick||canCombine||canOpen)&&!this.bagOpening&&!noHighlight;ctx.strokeStyle="#00000055";ctx.lineWidth=1;if(!highLight){ctx.fillStyle="#00000099";ctx.beginPath();ctx.moveTo(px,2+py);ctx.lineTo(px-(x/16),2+py+8-(x/32));ctx.lineTo(px+4-(x/16),2+py+6+(x/32));ctx.lineTo(px,2+py);ctx.fill()}
const ydown=this.mouseDown?1:0;const x0=px-x/16,y0=py+8-(x/32);const x1=px+4-x/16,y1=py+6-(x/32);ctx.fillStyle=highLight?(this.arrow&&!this.battle?"#aaFFaa":"#FFFFaa"):"#FFFFFF";ctx.beginPath();ctx.moveTo(px,py+ydown*2);ctx.lineTo(px-(x/16),py+8-(x/32));ctx.lineTo(px+4-(x/16),py+6+(x/32));ctx.lineTo(px,ydown*2+py);ctx.stroke();ctx.fill();if(!this.mouseDown&&!highLight){ctx.strokeStyle="#aaccFF";const mid=(x%8)/8;ctx.beginPath();ctx.moveTo(px,py+ydown*2);ctx.lineTo(x0*mid+x1*(1-mid),y0*mid+y1*(1-mid));ctx.stroke()}}
if(this.useItem&&this.useItem==="gun"){if(!this.mouseHand){this.mouseHand={x:32,y:32}}
this.mouseHand.x+=(x-this.mouseHand.x)*.15;this.mouseHand.y+=(y-this.mouseHand.y)*.5;ctx.transform(1,0,-(this.mouseHand.x-32)/128,1,(this.mouseHand.x-32)*1.25,Math.max(0,this.mouseHand.y-41));const{gunFired}=this;this.displayImage(ctx,{src:ASSETS.HOLD_GUN,col:1,row:2,index:gunFired&&this.now-gunFired<100?1:0});ctx.resetTransform()}}}
wordwrap(text,col){return text.split("\n").map(text=>{const split=text.split(" ");const array=[];let w=0;for(let i=0;i<split.length;i++){const char=split[i];array.push(split[i]);if(i<split.length-1){w+=split[i].length+1;if(w>=col){w=0;array.push("\n")}else{array.push(" ")}}}
return array.join("")}).join("\n")}
displayText(tip,flash){let{text}=tip;const{time,fade,speed}=tip;if(this.now<time){return}
this.prepareImage(ASSETS.ALPHABET);const spriteData=imageStock[ASSETS.ALPHABET];if(!spriteData||!spriteData.loaded||this.loadPending){return}
if(fade>=1){return}
text=this.processText(text);const frame=Math.floor((this.now-(time||0))/speed);const fullWrappedText=this.wordwrap(text,12);tip.progress=Math.min(1,frame/fullWrappedText.length);const lines=fullWrappedText.substr(0,Math.min(text.length,frame)).split("\n").slice(-(tip.maxLines||3));tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height);lines.forEach((msg,row)=>{this.displayTextLine(tempCtx,{msg,x:(tip.x||2),y:(row-lines.length)*7+(tip.y||60),noTranslate:!0})});if(fade>0){ctx.globalAlpha=1-fade}
this.displayOutlinedImage(tempCanvas,flash?"#444488":"black",20);if(fade>0){ctx.globalAlpha=1}}
countAssets(loaded){let count=0;for(let a in ASSETS){if(!loaded||imageStock[ASSETS[a]]&&imageStock[ASSETS[a]].loaded){count++}}
for(let a in SOUNDS){if(!loaded||soundStock[SOUNDS[a]]&&soundStock[SOUNDS[a]].loaded){count++}}
if(loaded){count+=this.config.scenes.length}else{count+=Object.keys(CONFIG_FILES).length}
return count}
prepareAssets(callback){for(let a in ASSETS){const src=ASSETS[a];if(!imageStock[src]){this.prepareImage(src,stock=>{stock.org=stock.img;if(callback){callback(stock)}})}}}
prepareSounds(callback){for(let a in SOUNDS){const src=SOUNDS[a];if(!soundStock[src]){this.prepareSound(src,stock=>{if(callback){callback(stock)}})}}}
playTheme(song,options){const{volume}=options||{};if(this.data.theme&&this.data.theme.song!==song){this.stopSound(this.data.theme.song)}
if(song){this.playSound(song,{loop:!0,volume})}
this.data.theme={song,volume,}}
playSoundClone(src){const{audio,clones}=soundStock[src];let freeClone=clones.filter(({playing})=>!playing)[0];if(!freeClone){freeClone={audio:audio.cloneNode(!0),playing:!1,};freeClone.audio.addEventListener("ended",e=>{freeClone.playing=!1});clones.push(freeClone)}
freeClone.playing=!0;return freeClone.audio}
playSound(src,options){if(this.mute){return}
const{loop,volume}=options||{};if(soundStock[src]){const{audio,playing}=soundStock[src];if(loop){audio.volume=volume||1;audio.loop=!0;try{audio.play()}catch(e){console.log("sound blocked",e)}}else{if(!playing){soundStock[src].playing=!0}
const soundBite=playing?this.playSoundClone(src):audio;soundBite.volume=volume||.5;soundBite.loop=!1;try{soundBite.play()}catch(e){console.log("sound blocked",e)}}}else{this.prepareSound(src,({audio})=>{soundStock[src]=audio;audio.volume=volume||1;try{audio.play()}catch(e){console.log("sound blocked",e)}})}}
setTone(index,digit){if(index&&!this.audioContext){this.audioContext=new AudioContext()}
switch(index){case 0:if(this.tone){this.tone.stop();this.tone=null}
break;case 1:this.setTone(0);this.tone=new Tone(this.audioContext,200,300);this.tone.start();break;case 2:this.setTone(0);this.tone=new Tone(this.audioContext,350,440);this.tone.start();break;case 3:this.setTone(0);this.tone=new Tone(this.audioContext,350,440);this.tone.start();break;case 4:this.setTone(0);this.tone=new Tone(this.audioContext,400,450);this.tone.startRinging();break;default:this.setTone(0);const dtmfFrequencies={"1":{f1:697,f2:1209},"2":{f1:697,f2:1336},"3":{f1:697,f2:1477},"4":{f1:770,f2:1209},"5":{f1:770,f2:1336},"6":{f1:770,f2:1477},"7":{f1:852,f2:1209},"8":{f1:852,f2:1336},"9":{f1:852,f2:1477},"0":{f1:941,f2:1336},};const{f1,f2}=dtmfFrequencies[digit];this.tone=new Tone(this.audioContext,f1,f2);this.tone.start();this.delayAction(game=>{game.setTone(0)},100);break}}
stopSound(src,reset){if(src&&soundStock[src]){const{audio}=soundStock[src];audio.pause();if(reset){audio.currentTime=0}}}
prepareSound(src,callback){if(!src){console.error("Invalid sound.")}
const soundData=soundStock[src];if(!soundData){const stock={src,clones:[]};const audio=new Audio(src);audio.addEventListener("ended",()=>{stock.playing=!1});this.loadPending=!0;const onReady=()=>{if(!stock.loaded){stock.loaded=!0;this.loadPending=!1;this.sceneData.lastFileLoaded=src;if(callback){callback(stock)}}};audio.addEventListener("canplaythrough",onReady);audio.addEventListener("error",()=>{this.addLoadError(src);delete soundStock[src];this.loadPending=!1;if(this.countLoadError>MAX_LOAD_ERRORS){this.tooManyErrors();return}
this.delayAction(game=>{this.prepareSound(src,data=>{this.removeLoadError(src);if(callback){callback(data)}})},5000)});stock.audio=audio;soundStock[src]=stock;audio.load()}}
addLoadError(src){console.error(`Error: ${src}`);if(!this.loadError){this.loadError={};this.loadErrorResolved={}}
this.loadError[src]=!0;this.countLoadError=(this.countLoadError||0)+1;this.showLoadError()}
removeLoadError(src){this.loadErrorResolved[src]=this.now;this.showLoadError();this.delayAction(game=>{delete this.loadErrorResolved[src];delete this.loadError[src];this.showLoadError()},1000)}
showLoadError(){const errors=[];for(let src in this.loadError){if(this.loadErrorResolved[src]){errors.push(`<div style="color: #FFFFDD33"> <del>Failed to load: ${src}.</del></div>`)}else{errors.push(`<div> Failed to load: <a target=_blank href="${src}">${src}.</a></div>`)}}
if(errors.length){showLoadErrors(errors.join(""))}else{showLoadErrors(null)}}
injectImage(src,img){imageStock[src]={loaded:!0,img,}}
tooManyErrors(){if(!this.showedTooManyErrors){this.showedTooManyErrors=!0;showError("Too many load errors. Please check your internet connection then <a href onClick='location.reload()'>refresh</a>.<br>")}}
prepareImage(src,callback){const spriteData=imageStock[src];if(spriteData){if(spriteData.loaded){if(callback){callback(spriteData)}}else{if(callback){spriteData.img.addEventListener("load",()=>{callback(spriteData)});spriteData.img.addEventListener("error",()=>{this.addLoadError(src);if(this.countLoadError>MAX_LOAD_ERRORS){this.tooManyErrors();return}
this.delayAction(game=>{this.prepareImage(src,data=>{this.removeLoadError(src);if(callback){callback(data)}})},5000)})}}
return}
if(spritesheet[src]){this.prepareImage(spritesheet[src],stock=>{imageStock[src]={loaded:!0,img:stock.img,};if(callback){callback(imageStock[src])}});return}
const splitPop=src.split("|").pop();if(splitPop.indexOf("crop:")===0){const[cropX,cropY,cropWidth,cropHeight]=splitPop.split("crop:").pop().split(",");this.prepareImage(src.split("|").slice(0,-1).join("|"),stock=>{const tempCanvas=document.createElement("canvas");tempCanvas.width=cropWidth;tempCanvas.height=cropHeight;const tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(stock.img,-cropX,-cropY);imageStock[src]={loaded:!0,img:tempCanvas,};if(callback){callback(imageStock[src])}});return}
if(splitPop==="invert-colors"){this.prepareImage(src.split("|").slice(0,-1).join("|"),stock=>{const tempCanvas=document.createElement("canvas");tempCanvas.width=stock.img.naturalWidth||stock.img.width;tempCanvas.height=stock.img.naturalHeight||stock.img.height;const tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(stock.img,0,0);const imageData=tempCtx.getImageData(0,0,tempCanvas.width,tempCanvas.height);const{data}=imageData;for(let i=0;i<data.length;i+=4){if(data[i+3]){data[i+0]=255-data[i+0];data[i+1]=255-data[i+1];data[i+2]=255-data[i+2]}}
tempCtx.putImageData(imageData,0,0);imageStock[src]={loaded:!0,img:tempCanvas,};if(callback){callback(imageStock[src])}});return}
if(splitPop==="darken"){this.prepareImage(src.split("|").slice(0,-1).join("|"),stock=>{const tempCanvas=document.createElement("canvas");tempCanvas.width=stock.img.naturalWidth||stock.img.width;tempCanvas.height=stock.img.naturalHeight||stock.img.height;const tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(stock.img,0,0);const imageData=tempCtx.getImageData(0,0,tempCanvas.width,tempCanvas.height);const{data}=imageData;for(let i=0;i<data.length;i+=4){if(data[i+3]){data[i+0]=Math.max(0,Math.floor(data[i+0]/2));data[i+1]=Math.max(0,Math.floor(data[i+1]/2));data[i+2]=Math.max(0,Math.floor(data[i+2]/2))}}
tempCtx.putImageData(imageData,0,0);imageStock[src]={src,loaded:!0,img:tempCanvas,};if(callback){callback(imageStock[src])}});return}
if(splitPop==="rotate-colors"){this.prepareImage(src.split("|").slice(0,-1).join("|"),stock=>{const tempCanvas=document.createElement("canvas");tempCanvas.width=stock.img.naturalWidth||stock.img.width;tempCanvas.height=stock.img.naturalHeight||stock.img.height;const tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(stock.img,0,0);const imageData=tempCtx.getImageData(0,0,tempCanvas.width,tempCanvas.height);const{data}=imageData;for(let i=0;i<data.length;i+=4){if(data[i+3]){const temp=data[i+0];data[i+0]=data[i+2];data[i+2]=data[i+1];data[i+1]=temp}}
tempCtx.putImageData(imageData,0,0);imageStock[src]={src,loaded:!0,img:tempCanvas,};if(callback){callback(imageStock[src])}});return}
if(splitPop==="chroma-key-pink"){this.prepareImage(src.split("|").slice(0,-1).join("|"),stock=>{const tempCanvas=document.createElement("canvas");tempCanvas.width=stock.img.naturalWidth||stock.img.width;tempCanvas.height=stock.img.naturalHeight||stock.img.height;const tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(stock.img,0,0);const imageData=tempCtx.getImageData(0,0,tempCanvas.width,tempCanvas.height);const{data}=imageData;for(let i=0;i<data.length;i+=4){if(data[i+3]){if(data[i+0]===0xFF&&data[i+1]===0&&data[i+2]===0xFF){data[i+0]=0;data[i+1]=0;data[i+2]=0;data[i+3]=0}}}
tempCtx.putImageData(imageData,0,0);imageStock[src]={src,loaded:!0,img:tempCanvas,};if(callback){callback(imageStock[src])}});return}
if(splitPop==="shaved"){this.prepareImage(src.split("|").slice(0,-1).join("|"),stock=>{const tempCanvas=document.createElement("canvas");tempCanvas.width=stock.img.naturalWidth||stock.img.width;tempCanvas.height=stock.img.naturalHeight||stock.img.height;const tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(stock.img,0,0);imageStock[src]={src,loaded:!0,img:tempCanvas,};if(callback){callback(imageStock[src])}});return}
if(!spriteData){const stock={src};const img=new Image();img.src=src;this.loadPending=!0;img.addEventListener("load",()=>{stock.loaded=!0;this.sceneData.lastFileLoaded=src;this.loadPending=!1;if(callback){callback(stock)}});img.addEventListener("error",()=>{this.addLoadError(src);delete imageStock[src];this.loadPending=!1;if(this.countLoadError>MAX_LOAD_ERRORS){this.tooManyErrors();return}
this.delayAction(game=>{this.prepareImage(src,data=>{this.removeLoadError(src);if(callback){callback(data)}})},5000)});stock.img=img;imageStock[src]=stock}else if(callback){callback(spriteData)}}
createLoop(callback){const self=this;let previousTime=0;function step(timestamp){callback(timestamp-previousTime);previousTime=timestamp;self.requestId=requestAnimationFrame(step)}
self.requestId=requestAnimationFrame(step)}
play(){this.initGame();const firstScene=this.config.scenes.filter(({startScene})=>startScene)[0];this.loadScene(firstScene)}
addScene(scene){this.config.scenes.push(scene);this.onSceneAdded(scene)}
onSceneAdded(scene){if(this.sceneData){this.sceneData.lastFileLoaded=`config/${scene.name}`}
if(!this.sceneByName){this.sceneByName={}}
this.sceneByName[scene.name]=scene}
loadScene(scene,restoreMapInfo){this.initScene();const{map,sprites,doors,arrowGrid,events,customCursor,onScene,onSceneRefresh,onSceneShot,onSceneHoldItem,onSceneUseItem,onSceneForward,onSceneBackward,onSceneBattle,onScenePunch,onSceneRotate,}=scene;this.map=toMap(map);if(!restoreMapInfo&&this.map){const mapInfo=this.getMapInfo(this.map,this.door);if(mapInfo){const{pos,rotation}=mapInfo;this.pos=pos;this.rotation=rotation}}
this.sprites=sprites||[];this.doors=doors;this.events=events;this.arrowGrid=arrowGrid||null;this.onSceneRefresh=onSceneRefresh||nop;this.onScene=onScene||nop;this.onSceneShot=onSceneShot||nop;this.onSceneHoldItem=onSceneHoldItem||nop;this.onSceneUseItem=onSceneUseItem||nop;this.onSceneForward=onSceneForward||nop;this.onSceneBackward=onSceneBackward||nop;this.onSceneBattle=onSceneBattle||nop;this.onScenePunch=onScenePunch||nop;this.onSceneRotate=onSceneRotate||nop;this.customCursor=customCursor;this.checkMotionAvailable()}
get now(){return this.data?this.data.time:0}
set now(value){this.data.time=value}
get pos(){return this.data.pos}
set pos(value){this.data.pos=value}
get rotation(){return this.data.rotation}
set rotation(value){this.data.rotation=value}
get battle(){return this.data.battle}
set battle(value){this.data.battle=value}
set chest(value){this.data.chest=value}
get chest(){return this.data.chest}
handleSceneEvents(){if(!this.sceneTime){this.sceneTime=this.data.time;this.onScene(this);this.sprites.forEach((sprite,index)=>{if(sprite.onScene){sprite.onScene(this,sprite)}
if(sprite.init){if(!this.sceneData.inited){this.sceneData.inited={}}
if(!this.sceneData.inited[index]){this.sceneData.inited[index]=this.now;sprite.init(this,sprite)}}});if(this.facingEvent()&&!this.facingEvent().foe){this.checkEvents()}
const{yupa}=game.data;if(yupa){yupa.rotation=(this.rotation+4)%8}}
this.onSceneRefresh(this);if(this.battle&&!this.data.gameOver){this.onSceneBattle(this,this.battle)}}
refreshSprites(){this.sprites.forEach(sprite=>{if(sprite.onRefresh&&this.sceneTime){if(this.evaluate(sprite.hidden,sprite)){return}
sprite.onRefresh(this,sprite)}})}
displaySprites(){this.sprites.forEach(sprite=>{const{src,hidden}=sprite;if(this.evaluate(hidden,sprite)){return}
const processedSrc=this.evaluate(src,sprite);if(processedSrc){this.prepareImage(processedSrc)}
this.displayImage(ctx,sprite)})}
refresh(dt){if(this.paused&&this.gameLoaded){return}
this.data.time+=dt;this.handleSceneEvents();if(this.sceneTime){this.refreshMove();this.refreshActions()}
if(this.sceneTime){this.checkMouseHover();this.checkUseItem()}
if(this.sceneTime){this.refreshSprites();this.displaySprites();this.displayFade(this);this.displayDialog();this.displayInventory();this.displayPickedUp();this.displayGameOver();this.displayArrows();this.displayCursor();this.displayTips();this.displayInventoryTips();this.displayTouchscreen();this.cleanupData()}
if(this.refreshCallback){this.refreshCallback()}}
displayGameOver(){if(this.data.gameOver){ctx.fillStyle="#998800";if(this.mouse){const{y}=this.mouse;const selection=Math.floor(y/10)-4;if(selection>=0&&selection<=1){ctx.fillRect(0,40+selection*10,64,6)}}
tempCtx.globalAlpha=Math.min(1,(this.now-this.data.gameOver)/3000);tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height);tempCtx.globalAlpha=1;if(this.sceneData.gameOverMessage){const lines=this.sceneData.gameOverMessage.split("\n");lines.forEach((msg,index)=>{this.displayTextLine(tempCtx,{msg,x:1,y:15+Math.round(index-lines.length/2)*7})})}else{this.displayTextLine(tempCtx,{msg:"GAME OVER",x:11,y:20})}
if(!this.sceneData.gameOverNoTry){this.displayTextLine(tempCtx,{msg:"try again",x:16,y:40})}
this.displayTextLine(tempCtx,{msg:"start over",x:14,y:50});this.displayOutlinedImage(tempCtx.canvas,"black",4,2)}}
displayEnding(){if(this.data.theEnd){tempCtx.globalAlpha=Math.min(1,(this.now-this.data.theEnd)/3000);tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height);tempCtx.globalAlpha=1;const progress=Math.min(1,Math.max(0,(this.now-this.data.theEnd)/10000));const antiProgress=1-progress;const letter=5;const y=Math.round(antiProgress*20+progress*25);if(this.now-this.data.theEnd<1000){this.displayTextLine(tempCtx,{msg:"ESCAPE FROM",x:10,y:10,})}else if(this.now-this.data.theEnd>10000){this.displayTextLine(tempCtx,{msg:"upcoming:",x:10,y:10,});this.displayTextLine(tempCtx,{msg:"the saga",x:10,y:40,});this.displayTextLine(tempCtx,{msg:"continues",x:15,y:46,})}
this.displayTextLine(tempCtx,{msg:"L",x:5+Math.round((antiProgress*0+progress*8)*letter),y,});this.displayTextLine(tempCtx,{msg:"A",x:5+Math.round((antiProgress*1+progress*1)*letter),y,});this.displayTextLine(tempCtx,{msg:"B",x:5+Math.round((antiProgress*2+progress*0)*letter),y});this.displayTextLine(tempCtx,{msg:"B",x:5+Math.round((antiProgress*3+progress*2)*letter),y});this.displayTextLine(tempCtx,{msg:"Y",x:5+Math.round((antiProgress*4+progress*3)*letter),y});this.displayTextLine(tempCtx,{msg:"R",x:5+Math.round((antiProgress*5+progress*10)*letter),y});this.displayTextLine(tempCtx,{msg:"I",x:5+Math.round((antiProgress*6+progress*6)*letter),y});this.displayTextLine(tempCtx,{msg:"T",x:5+Math.round((antiProgress*7+progress*7)*letter),y});this.displayTextLine(tempCtx,{msg:"H",x:5+Math.round((antiProgress*8+progress*5)*letter),y});this.displayTextLine(tempCtx,{msg:"E",x:5+Math.round((antiProgress*9+progress*9)*letter),y});this.displayOutlinedImage(tempCtx.canvas,"#660000",4,2)}}
processText(text,addOnly){if(!text.match(/[a-z]/i)){return text}
if(text.indexOf("~")>=0){text.split("~").forEach(a=>this.processText(a,addOnly));return text}
if(!this.translate){this.translate={}}
if(!this.translate[text]){this.translate[text]={};if(window.updateTranslationLink&&!addOnly&&this.allowTranslation){const request=new XMLHttpRequest();request.open("GET",`${window.updateTranslationLink}${encodeURIComponent(text)}`);request.send()}}
return text}
displayTextLine(ctx,{msg,x,y,spacing,alpha,noTranslate,dark}){const src=dark?ASSETS.ALPHABET_DARK:ASSETS.ALPHABET;if(!imageStock[src]){return}
if(!noTranslate){msg=this.processText(msg)}
const letterTemplate={src:src,col:10,row:11,size:ALPHA_SIZE,offsetX:20,offsetY:20,index:game=>Math.floor(game.now/100)%62,isText:!0,alpha,};letterTemplate.offsetY=y;let spaceX=x;for(let c=0;c<msg.length;c++){const code=msg.charCodeAt(c);const ALPHA=ALPHAS[code]||ALPHAS[0];const{index}=ALPHA;letterTemplate.offsetX=spaceX;letterTemplate.index=index;this.displayImage(ctx,letterTemplate);if(typeof(ALPHA.width)==='undefined'){maskCtx.clearRect(0,0,maskCanvas.width,maskCanvas.height);this.displayImage(maskCtx,{src:letterTemplate.src,col:letterTemplate.col,row:letterTemplate.row,size:letterTemplate.size,offsetX:0,offsetY:0,index:letterTemplate.index,isText:letterTemplate.isText,alpha:1,});const[LETTER_WIDTH,LETTER_HEIGHT]=letterTemplate.size;const{data}=maskCtx.getImageData(0,0,LETTER_WIDTH,LETTER_HEIGHT);const PIXEL_SIZE=4;let foundW=-1;for(let w=LETTER_WIDTH-1;w>=0;w--){for(let h=LETTER_HEIGHT-1;h>=0;h--){const offset=(h*LETTER_WIDTH+w)*PIXEL_SIZE;if(data[offset+PIXEL_SIZE-1]!==0){foundW=w;break}}
if(foundW>=0){break}}
ALPHA.width=foundW+1}
if(ALPHA.width){spaceX+=ALPHA.width+(spacing||1)}}
return spaceX-x}
checkHoveredDialog(){if(!this.dialog){return}
const{pendingTip}=this;if(pendingTip&&!pendingTip.talker){return}
const{index,conversation,time}=this.dialog;const frame=Math.min(3,Math.floor((this.now-time)/80));if(this.bagOpening||this.useItem||this.pendingTip&&!this.pendingTip.removeLock||this.dialog.paused){this.dialog.hovered=null;return}
if(!conversation[index]){throw new Error(`Dialog index ${index} out of bound.`)}
const{options,offsetY}=conversation[index];const offY=this.evaluate(offsetY,conversation[index])||0;const filteredOptions=options.filter(option=>!option.hidden||!this.evaluate(option.hidden,option));const y=this.mouse?Math.floor((this.mouse.y-43-offY)/7):-1;ctx.fillStyle=this.dialog.highlightColor||"#009988aa";if(y>=0&&y<filteredOptions.length){const{msg,cantSelect}=filteredOptions[y];if(this.evaluate(msg)&&!this.evaluate(cantSelect)){this.dialog.hovered=filteredOptions[y]}else{this.dialog.hovered=null}}else{this.dialog.hovered=null}}
displayDialog(){if(!this.dialog){return}
this.checkHoveredDialog();const{pendingTip}=this;if(pendingTip&&!pendingTip.talker){return}
const{index,conversation,time}=this.dialog;const frame=Math.min(3,Math.floor((this.now-time)/80));if(this.bagOpening||this.useItem||this.pendingTip&&!this.pendingTip.removeLock||this.dialog.paused){this.dialog.hovered=null;return}
if(!conversation[index]){throw new Error(`Dialog index ${index} out of bound.`)}
const{options,offsetY}=conversation[index];const offY=this.evaluate(offsetY,conversation[index])||0;const dialogTime=this.now-this.dialog.time;const dialogShift=Math.round((dialogTime<50?(50-dialogTime)/50:0)*4)+offY;const filteredOptions=options.filter(option=>!option.hidden||!this.evaluate(option.hidden,option));const y=this.mouse?Math.floor((this.mouse.y-43-offY)/7):-1;ctx.fillStyle=this.dialog.tapped&&Math.floor(this.now/50)%2===0?"#00443355":(this.dialog.highlightColor||"#009988aa");let selectedRow;if(y>=0&&y<filteredOptions.length){const{msg,cantSelect}=filteredOptions[y];if(this.evaluate(msg)&&!this.evaluate(cantSelect)){ctx.fillRect(0,dialogShift+y*7+42,64,7);selectedRow=y}}
tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height);filteredOptions.forEach((option,row)=>{const msg=this.evaluate(option.msg);if(msg){this.displayTextLine(tempCtx,{msg,x:2,y:dialogShift+row*7+43,})}});this.displayOutlinedImage(tempCtx.canvas,"#001144",16)}
displayOutlinedImage(image,color,intensity,size){ctx.shadowColor=color;ctx.shadowBlur=size||1;for(let i=0;i<intensity;i++){ctx.drawImage(image,0,0)}
ctx.shadowBlur=0}
displayInventory(){if(this.bagOpening&&(this.frameIndex===2||this.frameIndex===3)){for(let i in this.inventory){if(i!==this.useItem&&(!this.pickedUp||i!==this.pickedUp.item)){const{item,image,col,row}=this.inventory[i];this.displayImage(ctx,{src:image,col,row,index:this.frameIndex-1})}}}
if(this.useItem){if(!this.inventory[this.useItem]){this.useItem=null}else{const{image,col,row}=this.inventory[this.useItem];this.displayImage(ctx,{src:image,col,row,index:3})}}}
displayPickedUp(){if(!this.pickedUp){return}
const{item,time,image,tip,col,row,index}=this.pickedUp;this.displayFade({fade:Math.min(.8,(this.now-time)/500),fadeColor:"#333333",});this.displayImage(ctx,{src:image,col,row,index});tip.fade=Math.min(1,(this.now-(tip.time+(tip.text.length+15)*tip.speed))/350);const flash=this.sceneData.flashTip&&this.now-this.sceneData.flashTip<30;this.displayText(tip,flash);if(tip.fade>=1&&!tip.done){tip.done=!0;if(tip.onDone){tip.onDone(this)}}}
displayImage(ctx,sprite){const{src,scale,index,side,col,row,size,hidden,offsetX,offsetY,alpha,custom,ending,isText,globalCompositeOperation,flipH}=sprite;if(this.evaluate(hidden,sprite)){return}
if(ending){this.displayEnding();return}
if(custom){custom(game,sprite,ctx);return}
const processedSrc=this.evaluate(src,sprite);if(!processedSrc){const fade=this.evaluate(sprite.fade);const fadeColor=this.evaluate(sprite.fadeColor);if(fade>0&&fadeColor){ctx.globalAlpha=fade;ctx.fillStyle=fadeColor;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.globalAlpha=1.0}
return}
const spriteData=imageStock[processedSrc];if(!spriteData){return}
const[imgWidth,imgHeight]=size||[64,64];const spriteScale=this.evaluate(scale,sprite)||1;let frameIndex=this.evaluate(index,sprite)||0;let dstX=this.evaluate(offsetX,sprite)||0;let dstY=this.evaluate(offsetY,sprite)||0;let srcX=(frameIndex%(col||2))*imgWidth;let srcY=Math.floor(frameIndex/(col||2))*imgHeight;let srcW=imgWidth;let srcH=imgHeight;let dstW=imgWidth;let dstH=imgHeight;switch(this.evaluate(side,sprite)){case LEFT:srcW/=2;dstW/=2;break;case RIGHT:srcW/=2;dstW/=2;srcX+=srcW;dstX+=dstW;break}
dstW*=spriteScale;dstH*=spriteScale;const alphaColor=this.evaluate(alpha,sprite);if(alphaColor){ctx.globalAlpha=alphaColor}
let shiftX=0,shiftY=0;if(this.battle&&this.battle.playerHit&&!isText){const hitTime=Math.max(10,this.now-this.battle.playerHit);if(hitTime<500){const intensity=2;shiftX=Math.round((Math.random()-.5)*intensity*(200/hitTime));shiftY=Math.round((Math.random()-.5)*intensity*(200/hitTime))}}
if(this.sceneData.shakeTime&&!isText){const hitTime=Math.max(10,this.now-this.sceneData.shakeTime);if(hitTime<500){const intensity=1;shiftY+=Math.round((Math.random()-.5)*intensity*(200/hitTime))}}
if(globalCompositeOperation){ctx.globalCompositeOperation=this.evaluate(globalCompositeOperation,sprite)}
if(flipH){ctx.translate(64,0);ctx.scale(-1,1)}
ctx.drawImage(spriteData.img,srcX,srcY,srcW,srcH,dstX+shiftX,dstY+shiftY,dstW,dstH);if(flipH){ctx.scale(-1,1);ctx.translate(-64,0)}
if(alphaColor){ctx.globalAlpha=1.0}
if(globalCompositeOperation){ctx.globalCompositeOperation="source-over"}}
displayTouchscreen(){if(this.touchActive){for(let i in TOUCH_SPRITES){const{onRefresh,hidden}=TOUCH_SPRITES[i];if(!this.evaluate(hidden)){if(onRefresh){onRefresh(game,TOUCH_SPRITES[i])}}}
touchCtx.clearRect(0,0,64,32);if(!this.hideCursor&&!this.waitCursor){for(let i in TOUCH_SPRITES){this.displayImage(touchCtx,TOUCH_SPRITES[i])}}
for(let i=0;i<this.touchList.length;i++){const{identifier,pageX,pageY,force}=this.touchList[i];const px=(pageX-touchCanvas.offsetLeft)/touchCanvas.offsetWidth*touchCanvas.width;const py=(pageY-touchCanvas.offsetTop)/touchCanvas.offsetHeight*touchCanvas.height;touchCtx.beginPath();touchCtx.strokeStyle="#33336666";touchCtx.arc(px,py,force*4,0,Math.PI*2);touchCtx.stroke()}}}
clickBag(){if(this.processingBag){return}
if(this.emptyBag()){return}
if(this.frameIndex===3){if(this.useItem){this.useItem=null}else{for(let i in this.inventory){const{item,image,col,row}=this.inventory[i];if(this.isMouseHover({src:image,index:this.frameIndex-1,col,row},this.mouse)){this.useItem=item;this.useItemTime=this.now}}}
this.arrow=0}
game.menuOpening=0;this.openBag(this.now,game=>{this.onSceneHoldItem(game,this.useItem)})}
clickMenu(){this.sceneData.showStats=0;this.openMenu(this.now)}
see(name){if(!this.data.seen[name]){this.data.seen[name]=this.now}}
gunFiredWithin(millis){return this.gunFired&&this.now-this.gunFired<millis}
delayAction(callback,delay){console.assert(delay,"delayAction missing delay");this.actions.push({time:this.now,command:"delay",onDone:callback,delay,active:!0,started:!1,})}
screenshot(){tempCtx.canvas.width=28;tempCtx.canvas.height=28;tempCtx.imageSmoothingEnabled=!0;tempCtx.drawImage(ctx.canvas,0,0,ctx.canvas.width,ctx.canvas.height,0,0,tempCtx.canvas.width,tempCtx.canvas.height);const uri=tempCtx.canvas.toDataURL();tempCtx.canvas.width=canvas.width;tempCtx.canvas.height=canvas.height;return uri}
save(name,image){this.saveData(name,image,this.data)}
saveData(name,image,data){if(typeof(name)==='undefined'){name=LAST_CONTINUE}
const saves=JSON.parse(localStorage.getItem(SAVES_LOCATION)||"{}");saves[name]=JSON.parse(JSON.stringify(data));saves[name].image=image||data.image||this.screenshot();localStorage.setItem("saves",JSON.stringify(saves))}
deleteSave(name){if(typeof(name)!=='undefined'){const saves=JSON.parse(localStorage.getItem(SAVES_LOCATION)||"{}");delete saves[name];localStorage.setItem("saves",JSON.stringify(saves))}}
getLoadData(name){if(typeof(name)==='undefined'){name=LAST_CONTINUE}
const saves=JSON.parse(localStorage.getItem(SAVES_LOCATION)||"{}");return saves[name]}
load(name){this.playTheme(null);const triedAgain=this.data.gameOver;this.data=this.getLoadData(name);this.setupStats();if(triedAgain){this.data.stats.life=Math.max(this.data.stats.maxLife/2,this.data.stats.life)
this.data.stats.state.drank=0;this.data.stats.state.ate=0}
this.gotoScene(this.sceneName,this.door,!0);if(this.data.theme){this.playTheme(this.data.theme.song,{volume:this.data.theme.volume})}
for(let id in this.imageStock){if(this.imageStock[id].org){this.imageStock[id].img=this.imageStock[id].org}}
if(this.data.images){for(let src in this.data.images){this.replaceImage(src,this.data.images[src])}}}
replaceImage(id,src){const img=new Image();img.addEventListener("load",e=>{const canvas=document.createElement("canvas");canvas.width=img.naturalWidth;canvas.height=img.naturalHeight;canvas.getContext("2d").drawImage(img,0,0);const stock=this.imageStock[id]={img:canvas,loaded:!0,}});img.addEventListener("error",()=>{this.delayAction(game=>{this.replaceImage(id,src)},5000)});img.src=this.data.images[id]}
setupStats(){if(!this.data.stats){this.data.stats={life:80,maxLife:120,damage:10,defense:10,xp:0,bonus:0,}}
if(!this.data.stats.state){this.data.stats.state={drank:0,ate:0,}}}
checkIsBrave(callback){const timeout=setTimeout(()=>{request.cancel();callback(!1)},3000);const request=new XMLHttpRequest()
request.open('GET','https://api.duckduckgo.com/?q=useragent&format=json',!0)
request.addEventListener("load",e=>{clearTimeout(timeout);callback(request.responseText.toLowerCase().indexOf("brave")>=0)});request.addEventListener("error",e=>{clearTimeout(timeout);callback(!1)});request.send()}
getSaveList(){try{return JSON.parse(localStorage.getItem(SAVES_LOCATION)||"{}")}catch(e){this.checkIsBrave(isBrave=>{showError(isBrave?`Game blocked. Please disable Brave's Shield Protection for this site (Next to the URL bar).<br><img style="width:133px; height:38px; margin:10px" src="assets/brave-shield.png">`:"Browser not supported. Please try a different one.")});return{}}}
restart(){this.load("clear");this.gotoScene("start-screen");this.data.gameOver=!1}
gameOver(message,leaveTheme,noTry){if(!this.data.gameOver){this.waitCursor=!0;this.data.gameOver=this.now;this.sceneData.gameOverMessage=message;this.sceneData.gameOverNoTry=noTry;this.hideCursor=!1;this.bagOpening=0;this.delayAction(game=>{this.waitCursor=!1},1000);this.useItem=null;if(!leaveTheme){this.playTheme(null)}}}
clear(){ctx.clearRect(0,0,canvas.width,canvas.height)}
blocking(){return this.battle&&(this.arrow===BLOCK||this.arrow===BAG)}
damagePlayer(damage,options){const{shot,blocked}=options?options:{};const{stats}=this.data;const calcDamage=damage*damage/Math.max(1,this.data.stats.defense);stats.life=Math.max(stats.life-calcDamage,blocked?1:0)}
failEscape(callback){this.battle.failedEscape=game.now;this.playErrorSound();this.showTip("I failed my escape!",callback,20)}
canEscape(battle){if(battle&&this.evaluate(battle.blockEscape,battle)){return!1}
if(!this.sceneData.freeFormMove){const blocked=this.isBlocked(this.pos,0,-1,!0)&&this.isBlocked(this.pos,1,0,!0)&&this.isBlocked(this.pos,-1,0,!0);return!blocked}
return!0}
escapeBattle(callback){this.data.stats.state.drank=0;this.data.stats.state.ate=0;if(this.currentScene.onEscapeBattle){this.currentScene.onEscapeBattle(this,callback);return}
this.waitCursor=!0;this.useItem=null;const battleTheme=this.battle.theme||SOUNDS.CHIN_TOK_THEME;this.playTheme(null);this.battle=null;this.setVisited(!1);this.playSound(SOUNDS.HIT,{volume:.3});for(let i=0;i<5;i++){this.delayAction(game=>{game.playSound(SOUNDS.HIT,{volume:.3})},150*(i+1))}
const{x,y,}=this.pos;if(!this.isBlocked(this.pos,0,-1,!0)){game.move(game.now,"backward",game=>{this.waitCursor=!1;if(battleTheme!=="none"){this.playTheme(battleTheme,{volume:.2})}
if(callback)
callback(this)})}else if(!this.isBlocked(this.pos,1,0,!0)){this.turnLeft(this.now,game=>{game.move(game.now,"backward",game=>{game.waitCursor=!1;this.playTheme(battleTheme,{volume:.2});if(callback)
callback(this)})})}else if(!this.isBlocked(this.pos,-1,0,!0)){this.turnRight(this.now,game=>{game.move(game.now,"backward",game=>{game.waitCursor=!1;this.playTheme(battleTheme,{volume:.2});if(callback)
callback(this)})})}}
damageFoe(damage,options){const{shot,blocked}=options?options:{};const calcDamage=shot?damage:damage*damage/Math.max(1,this.battle.foeDefense);this.battle.foeLife=Math.max(blocked?1:0,this.battle.foeLife-calcDamage);if(!this.battle.foeLife){this.data.stats.state.drank=0;this.data.stats.state.ate=0;this.battle.foeDefeated=this.now;this.useItem=null;this.playSound(SOUNDS.FOE_DEFEAT);if(this.battle.theme!=="none"){this.playTheme(this.battle.theme||SOUNDS.CHIN_TOK_THEME,{volume:.2})}
if(this.battle.onWin){this.data.stats.state={ate:0,drank:0,};if(!shot&&this.battle.xp){this.battle.gainedXP=this.battle.xp;const currentLevel=this.getLevel(this.data.stats.xp);this.gainXP(this.battle.xp);if(currentLevel<this.getLevel(this.data.stats.xp)){this.battle.gainedLevel=this.now;this.delayAction(game=>{game.openMenu(game.now);game.data.stats.bonus=(game.data.stats.bonus||0)+3;game.playSound(SOUNDS.JINGLE)},2000)}}
this.battle.onWin(this,this.battle,shot)}
this.sceneData.currentEventCell=null;this.sceneData.currentEventTriggered=null}}
gainXP(xp){this.data.stats.xp=(this.data.stats.xp||0)+(xp||0);console.log("LEVEL: ",this.getLevel(this.data.stats.xp))}
getLevel(xp){return Math.max(2,Math.ceil(Math.log(xp)))-1}
findChest(found,{item,count,image,cleared,message,hideFromInventory}){this.chest={found,opened:0,checked:0,count,item,image,cleared,message,hideFromInventory,}}
playSteps(){this.playSound(SOUNDS.HIT,{volume:.5});this.delayAction(game=>{game.playSound(SOUNDS.HIT,{volume:.3})},300);this.delayAction(game=>{game.playSound(SOUNDS.HIT,{volume:.2})},600);this.delayAction(game=>{game.playSound(SOUNDS.HIT,{volume:.12})},900)}
playErrorSound(){game.playSound(SOUNDS.ERROR);game.delayAction(game=>game.playSound(SOUNDS.ERROR),100)}
toAlienDigits(s,size){const ALIEN_DIGIT_0=1000;let str="";while(s>0||str.length<size){const num=s%10;str=ALPHAS[ALIEN_DIGIT_0+s%10].char+str;s=Math.floor(s/10)}
return str}
addToLife(value,color){const{stats}=this.data;this.sceneData.lifeIncrease={value:Math.min(value,stats.maxLife-stats.life),time:this.now,color,};stats.life=Math.min(stats.life+value,stats.maxLife);if(!game.battle||game.battle.foeDefeated){this.openMenu(this.now)}}
dumdum(){const CHEATCODDE="yupayupa"}
babyHitlerYear(){return 2019}
getAnimation(dx,dy){dx=dx<0?-1:dx>0?1:0;dy=dy<0?-1:dy>0?1:0;return ROTATION_FRAMES[dy+1][dx+1]}
getSceneCount(){const srcs={};let count=0;const scripts=document.querySelectorAll("script");for(let i=0;i<scripts.length;i++){if(scripts[i].src.indexOf("config/")>=0&&scripts[i].src.indexOf("config/config.js")<0){count++}}
return count}
isTouchDevice(){return this.isTouch}
getOrientationText(){switch(ORIENTATIONS[Math.floor(game.rotation)]){case "N":return"North";break;case "NE":return"North East";break;case "E":return"East";break;case "SE":return"South East";break;case "S":return"South";break;case "SW":return"South West";break;case "W":return"West";break;case "NW":return"North West";break}
return"Nowhere"}
toggleFullScreen(forceFull){if(document.fullscreenElement){if(!forceFull){document.exitFullscreen()}}else{try{if(document.body.webkitEnterFullScreen){document.body.webkitEnterFullScreen()}else if(document.body.mozRequestFullScreen){document.body.mozRequestFullScreen()}else if(document.body.requestFullscreen){document.body.requestFullscreen()}else{this.disableFullScreen=!0}}catch(e){this.disableFullScreen=!0}}}}
function Tone(context,value1,value2){this.context=context;this.status=0;this.value1=value1;this.value2=value2}
Tone.prototype.setup=function(){this.osc1=this.context.createOscillator();this.osc2=this.context.createOscillator();this.osc1.frequency.value=this.value1;this.osc2.frequency.value=this.value2;this.gainNode=this.context.createGain();this.gainNode.gain.value=0.25;this.filter=this.context.createBiquadFilter();this.filter.type="lowpass";this.filter.frequency=8000;this.osc1.connect(this.gainNode);this.osc2.connect(this.gainNode);this.gainNode.connect(this.filter);this.filter.connect(this.context.destination)}
Tone.prototype.start=function(){if(!this.status){this.setup();this.osc1.start(0);this.osc2.start(0);this.status=1}}
Tone.prototype.stop=function(){if(this.status){this.osc1.stop(0);this.osc2.stop(0);this.osc1=null;this.osc2=null;this.status=0;if(this.ringerLFOSource){this.ringerLFOSource.stop(0);this.ringerLFOSource=null}}}
Tone.prototype.createRingerLFO=function(){var channels=1;var sampleRate=this.context.sampleRate;var frameCount=sampleRate*3;var arrayBuffer=this.context.createBuffer(channels,frameCount,sampleRate);var bufferData=arrayBuffer.getChannelData(0);for(var i=0;i<frameCount;i++){if((i/sampleRate>0&&i/sampleRate<0.4)||(i/sampleRate>0.6&&i/sampleRate<1.0)){bufferData[i]=0.25}}
this.ringerLFOBuffer=arrayBuffer}
Tone.prototype.startRinging=function(){this.start();this.gainNode.gain.value=0;this.status=1;this.createRingerLFO();this.ringerLFOSource=this.context.createBufferSource();this.ringerLFOSource.buffer=this.ringerLFOBuffer;this.ringerLFOSource.loop=!0;this.ringerLFOSource.connect(this.gainNode.gain);this.ringerLFOSource.start(0)}
return Game})();const shortcut={0:({situation,data})=>situation.explode&&data.shot["left guard"]&&data.shot["right guard"]?FORWARD:null,1:game=>game.matchCell(game.map,game.pos.x,game.pos.y,0,1,game.orientation,"12345",[])&&!game.doorOpening?DOOR:FORWARD,2:game=>game.matchCell(game.map,game.pos.x,game.pos.y,0,1,game.orientation,"12345",[])?(!game.doorOpening?DOOR:FORWARD):null,3:game=>game.battle||game.touchActive?BAG:BACKWARD,4:game=>game.sceneData.forwardUnlocked?FORWARD:null,5:game=>game.rotation===0?BAG:null,6:({battle})=>battle?BLOCK:s(3),7:({battle})=>battle?BLOCK:null,8:({battle})=>battle?BLOCK:s(1),9:game=>{if(game.battle||game.dialog){return BAG}
const door=game.frontDoor();if(door&&door.lock&&game.frameIndex===0&&game.rotation%2===0){const cell=game.frontCell();if(!game.situation.unlocked||!game.situation.unlocked[cell]){return BAG}}
if(game.facingEvent()&&game.facingEvent().showBag){return BAG}
if(game.pos&&!game.canMove(game.pos,-1)){return BAG}
return BACKWARD},10:game=>game.rotation%4===0?BAG:null,11:({battle})=>battle?BLOCK:FORWARD,12:game=>game.dialog?null:BACKWARD,};function s(index){return shortcut[index]}
const gameConfig={scenes:[],};function getCommonMaze(modifier){const maze=[{src:ASSETS[`MAZE_ROTATION_BACKGROUND${modifier}`],hidden:game=>game.rotation%2===0,},{src:ASSETS[`MAZE_ROTATION_WALLS${modifier}`],side:LEFT,hidden:game=>game.rotation%2===0||!game.hasLeftWallWhenRotating(),},{src:ASSETS[`MAZE_ROTATION_WALLS${modifier}`],side:RIGHT,hidden:game=>game.rotation%2===0||!game.hasRightWallWhenRotating(),},{src:ASSETS[`MAZE_ROTATION_CORNER${modifier}`],hidden:game=>game.hasLeftWallWhenRotating()!==game.hasRightWallWhenRotating(),},{src:ASSETS[`DUNGEON_MOVE${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1,},{src:ASSETS[`FAR_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FAR})||game.farWall()&&!game.mazeHole({direction:LEFT,distance:FURTHER}),},{src:ASSETS[`FAR_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FAR})||game.farWall()&&!game.mazeHole({direction:RIGHT,distance:FURTHER}),},{src:ASSETS[`FAR_FAR_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FURTHER}),},{src:ASSETS[`FAR_FAR_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FURTHER}),},{src:ASSETS[`FURTHER_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FAR})||!game.mazeHole({direction:LEFT,distance:FURTHER}),},{src:ASSETS[`FURTHER_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FAR})||!game.mazeHole({direction:RIGHT,distance:FURTHER}),},{src:ASSETS[`FURTHER_WALL${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.furtherWall(),},{src:ASSETS[`FAR_WALL${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farWall(),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farWall()||game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farWall()||game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`FAR_DOOR${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farDoor(),},{src:ASSETS[`CLOSE_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:CLOSE}),},{src:ASSETS[`CLOSE_FURTHER_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:CLOSE})||!game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:CLOSE})||game.closeWall()&&!game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`CLOSE_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:CLOSE}),},{src:ASSETS[`CLOSE_FURTHER_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:CLOSE})||!game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:CLOSE})||game.closeWall()&&!game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeWall()||game.mazeHole({direction:LEFT,distance:CLOSE}),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeWall()||game.mazeHole({direction:RIGHT,distance:CLOSE}),},{src:ASSETS.FAR_MAP,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farMap(),},{src:ASSETS.SIDE_MAP,side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeMap({direction:LEFT,distance:CLOSE}),},{src:ASSETS.SIDE_MAP,side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeMap({direction:RIGHT,distance:CLOSE}),},{src:ASSETS.SIDE_FAR_MAP,side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||!game.mazeMap({direction:LEFT,distance:FAR}),},{src:ASSETS.SIDE_FAR_MAP,side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||!game.mazeMap({direction:RIGHT,distance:FAR}),},{src:ASSETS.SIDE_FURTHER_MAP,side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||game.farWall()||!game.mazeMap({direction:LEFT,distance:FURTHER}),},{src:ASSETS.SIDE_FURTHER_MAP,side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||game.farWall()||!game.mazeMap({direction:RIGHT,distance:FURTHER}),},{src:ASSETS.FAR_FLOOR,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2==1||game.closeWall()||game.farWall()||!game.mazeFloor(2),},{src:ASSETS[`CLOSE_WALL${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeWall(),},{src:ASSETS.DOORWAY,col:2,row:3,index:game=>{const frontDoor=game.frontDoor();if(!frontDoor)return 0;if(frontDoor.wayUp)return 1;if(frontDoor.wayDown)return 2;if(frontDoor.eye)return 3+(game.now%4000<1000?1:0);return 0},hidden:game=>game.rotation%2===1||!game.closeDoor()||game.moving,},{src:ASSETS[`DOOR_OPEN${modifier}`],index:game=>game.onDoor()?3:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeDoor()||!game.doorOpening&&(!game.onDoor()||game.moving),},{src:ASSETS[`CLOSE_DOOR${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeDoor()||game.doorOpening||game.onDoor(),},{src:ASSETS[`DUNGEON_LOCK${modifier}`],col:2,row:2,index:game=>game.moving?game.frameIndex:0,hidden:game=>{if(game.rotation%2===1||!game.closeDoor()){return!0}
const frontDoor=game.frontDoor();if(!frontDoor||!frontDoor.lock){return!0}
if(game.situation.unlocked&&game.situation.unlocked[game.frontCell()]){return!0}
return!1},onClick:game=>{game.showTip("It's locked.",null,null,{removeLock:!0})},combine:(item,game)=>{if(item==="key"){const cell=game.frontCell();if(game.unlock(cell)){game.playSound(SOUNDS.DUD)}}else{game.playErrorSound()}
game.useItem=null;return!0},},{src:ASSETS.MAP,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeMap(),},{src:ASSETS.FLOOR,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2==1||game.closeWall()||!game.mazeFloor(1),},{src:ASSETS.CLOSE_FLOOR,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>!game.mazeFloor(0),},{custom:({map,sceneData,pos,events},sprite,ctx)=>{const mapWidth=map[0].length,mapHeight=map.length;const mapXCenter=64/2,mapYCenter=64/2;const key=`${pos.x}_${pos.y}`;if(!sceneData.canvases||!sceneData.canvases[key]){if(!sceneData.canvases){sceneData.canvases={}}
const mapCanvas=document.createElement("canvas");mapCanvas.width=mapWidth;mapCanvas.height=mapHeight;const ctx=mapCanvas.getContext("2d");ctx.clearRect(0,0,mapWidth,mapHeight);const imageData=ctx.getImageData(0,0,mapWidth,mapHeight);for(let i=0;i<imageData.data.length;i+=4){const cell=map[mapHeight-1-Math.floor((i/4)/mapWidth)][(i/4)%mapWidth];const onCell=mapHeight-1-Math.floor((i/4)/mapWidth)===pos.y&&(i/4)%mapWidth===pos.x;if(onCell){imageData.data[i]=255;imageData.data[i+1]=0;imageData.data[i+2]=0}else if("12345".indexOf(cell)>=0){imageData.data[i]=50;imageData.data[i+1]=150;imageData.data[i+2]=255}else if(cell==='.'||cell==='_'||events&&events[cell]&&!events[cell].blockMap){imageData.data[i]=0;imageData.data[i+1]=0;imageData.data[i+2]=0}else{imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255}
imageData.data[i+3]=255}
ctx.putImageData(imageData,0,0);sceneData.canvases[key]=mapCanvas}
ctx.drawImage(sceneData.canvases[key],Math.floor(mapXCenter-mapWidth/2),Math.floor(mapYCenter-mapHeight/2))},hidden:game=>game.rotation%2===1||game.frameIndex!==0&&!game.bagOpening&&!game.menuOpening||!game.closeMap(),},];return maze}
function getRoomMaze(modifier){const maze=[{src:ASSETS[`MAZE_ROTATION_BACKGROUND_SOLID${modifier}`],hidden:game=>game.rotation%2===0,},{src:ASSETS[`MAZE_ROTATION_WALLS_SOLID${modifier}`],side:LEFT,hidden:game=>game.rotation%2===0||!game.hasLeftWallWhenRotating(),},{src:ASSETS[`MAZE_ROTATION_WALLS_SOLID${modifier}`],side:RIGHT,hidden:game=>game.rotation%2===0||!game.hasRightWallWhenRotating(),},{src:ASSETS[`MAZE_ROTATION_CORNER_SOLID${modifier}`],hidden:game=>game.hasLeftWallWhenRotating()!==game.hasRightWallWhenRotating(),},{src:ASSETS[`DUNGEON_MOVE_SOLID${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1,},{src:ASSETS[`FAR_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FAR})||game.farWall()&&!game.mazeHole({direction:LEFT,distance:FURTHER}),},{src:ASSETS[`FAR_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FAR})||game.farWall()&&!game.mazeHole({direction:RIGHT,distance:FURTHER}),},{src:ASSETS[`FAR_FAR_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FURTHER}),},{src:ASSETS[`FAR_FAR_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FURTHER}),},{src:ASSETS[`FURTHER_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:FAR})||!game.mazeHole({direction:LEFT,distance:FURTHER}),},{src:ASSETS[`FURTHER_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:FAR})||!game.mazeHole({direction:RIGHT,distance:FURTHER}),},{src:ASSETS[`FURTHER_WALL${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.furtherWall(),},{src:ASSETS[`FAR_WALL_SOLID${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farWall(),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farWall()||game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`FAR_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farWall()||game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`FAR_DOOR${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farDoor(),},{src:ASSETS[`CLOSE_SIDE_SOLID${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:CLOSE}),},{src:ASSETS[`CLOSE_FURTHER_SIDE${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:CLOSE})||!game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:LEFT,distance:CLOSE})||game.closeWall()&&!game.mazeHole({direction:LEFT,distance:FAR}),},{src:ASSETS[`CLOSE_SIDE_SOLID${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:CLOSE}),},{src:ASSETS[`CLOSE_FURTHER_SIDE${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:CLOSE})||!game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.mazeHole({direction:RIGHT,distance:CLOSE})||game.closeWall()&&!game.mazeHole({direction:RIGHT,distance:FAR}),},{src:ASSETS[`CLOSE_WALL_SOLID${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeWall(),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeWall()||game.mazeHole({direction:LEFT,distance:CLOSE}),},{src:ASSETS[`CLOSE_SIDE_CORNER${modifier}`],side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeWall()||game.mazeHole({direction:RIGHT,distance:CLOSE}),},{src:ASSETS.DOORWAY,col:2,row:3,index:game=>{const frontDoor=game.frontDoor();if(!frontDoor)return 0;if(frontDoor.wayUp)return 1;if(frontDoor.wayDown)return 2;if(frontDoor.eye)return 3+(game.now%4000<1000?1:0);return 0},hidden:game=>game.rotation%2===1||!game.closeDoor()||game.moving,},{src:ASSETS[`DOOR_OPEN${modifier}`],index:game=>game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeDoor()||!game.doorOpening,},{src:ASSETS[`CLOSE_DOOR${modifier}`],index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeDoor()||game.doorOpening,},{src:ASSETS.MAP,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.closeMap(),},{src:ASSETS.FAR_MAP,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||!game.farMap(),},{src:ASSETS.SIDE_MAP,side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||!game.mazeMap({direction:LEFT,distance:CLOSE}),},{src:ASSETS.SIDE_MAP,side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||!game.mazeMap({direction:RIGHT,distance:CLOSE}),},{src:ASSETS.SIDE_FAR_MAP,side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||!game.mazeMap({direction:LEFT,distance:FAR}),},{src:ASSETS.SIDE_FAR_MAP,side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||!game.mazeMap({direction:RIGHT,distance:FAR}),},{src:ASSETS.SIDE_FURTHER_MAP,side:LEFT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||game.farWall()||!game.mazeMap({direction:LEFT,distance:FURTHER}),},{src:ASSETS.SIDE_FURTHER_MAP,side:RIGHT,index:game=>game.doorOpening||game.bagOpening||game.menuOpening?0:game.frameIndex,hidden:game=>game.rotation%2===1||game.closeWall()||game.farWall()||!game.mazeMap({direction:RIGHT,distance:FURTHER}),},{custom:({map,sceneData,pos},sprite,ctx)=>{const mapWidth=map[0].length,mapHeight=map.length;const mapXCenter=64/2,mapYCenter=64/2;const key=`${pos.x}_${pos.y}`;if(!sceneData.canvases||!sceneData.canvases[key]){if(!sceneData.canvases){sceneData.canvases={}}
const mapCanvas=document.createElement("canvas");mapCanvas.width=mapWidth;mapCanvas.height=mapHeight;const ctx=mapCanvas.getContext("2d");ctx.clearRect(0,0,mapWidth,mapHeight);const imageData=ctx.getImageData(0,0,mapWidth,mapHeight);for(let i=0;i<imageData.data.length;i+=4){const cell=map[mapHeight-1-Math.floor((i/4)/mapWidth)][(i/4)%mapWidth];const onCell=mapHeight-1-Math.floor((i/4)/mapWidth)===pos.y&&(i/4)%mapWidth===pos.x;if(onCell){imageData.data[i]=255;imageData.data[i+1]=0;imageData.data[i+2]=0}else if("12345".indexOf(cell)>=0){imageData.data[i]=50;imageData.data[i+1]=150;imageData.data[i+2]=255}else if(cell==='.'){imageData.data[i]=0;imageData.data[i+1]=0;imageData.data[i+2]=0}else{imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255}
imageData.data[i+3]=255}
ctx.putImageData(imageData,0,0);sceneData.canvases[key]=mapCanvas}
ctx.drawImage(sceneData.canvases[key],Math.floor(mapXCenter-mapWidth/2),Math.floor(mapYCenter-mapHeight/2))},hidden:game=>game.rotation%2===1||game.frameIndex!==0&&!game.bagOpening&&!game.menuOpening||!game.closeMap(),},];return maze}
function standardBag(){return[{name:"self",src:ASSETS.EATER,col:2,row:2,offsetX:({now,useItemTime})=>{return Math.round(-12*Math.sqrt(1-Math.max(0,now-useItemTime)/300))},index:(game,sprite)=>{if(game.sceneData.eatTime){if(game.now-game.sceneData.eatTime<500){return Math.min(2,Math.floor((game.now-game.sceneData.eatTime)/100))}}
return game.hoverSprite===sprite?Math.min(2,Math.floor((game.now-sprite.hoverTime)/100)):0},hidden:game=>!consumable[game.useItem],combine:(item,game)=>{if(consumable[item]){game.sceneData.eatTime=game.now;game.hideCursor=!0;game.delayAction(game=>{game.hideCursor=!1;if(consumable[item](game)){game.sceneData.eatTime=0;game.removeFromInventory(item);game.useItem=null}},500);return!0}
game.useItem=null},},{bag:!0,src:ASSETS.BAG_OUT,index:game=>game.bagOpening?game.frameIndex:0,hidden:game=>{const{arrow,bagOpening,dialog,data,battle,pickedUp,sceneData,now}=game;if(data.gameOver){return!0}
if(bagOpening){return!1}
if(dialog){const{options,offsetY}=dialog.conversation[dialog.index];const offY=game.evaluate(offsetY,dialog.conversation[dialog.index])||0;const flag=options.filter(({hidden})=>!hidden||!game.evaluate(hidden)).length*7+offY>2*7||dialog.paused;return flag}
if(game.touchActive){return!1}
if(arrow==="BAG"){const door=game.frontDoor();if(door&&door.lock&&game.frameIndex===0&&game.rotation%2===0){const cell=game.frontCell();if(!game.situation.unlocked||!game.situation.unlocked[cell]){return!1}}
if(game.facingEvent()&&game.facingEvent().showBag){return!1}}
const touchOverride=game.touchActive&&(!game.pos||!game.canMove(game.pos,-1));return(arrow!==BAG&&!touchOverride)&&(!sceneData.showStats||now-sceneData.showStats<400)&&game.useItem===null},alpha:game=>game.emptyBag()?.2:1,onClick:game=>game.clickBag(),},]}
function standardMenu(){return[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#00000088";ctx.fillRect(0,0,64,64)},hidden:game=>!game.sceneData.showStats,onClick:game=>game.sceneData.showStats=0,},{src:ASSETS.STATS,index:({now,sceneData})=>Math.min(3,Math.floor((now-sceneData.showStats)/100)),hidden:game=>!game.sceneData.showStats,onClick:game=>{},},{custom:(game,sprite,ctx)=>{const{data}=game;const{stats}=data;const labelX=5;const statX=27;let y=9;game.displayTextLine(ctx,{msg:`LVL ${game.getLevel(stats.xp)}`,x:34,y,});y+=13;game.displayTextLine(ctx,{msg:`ATK`,x:labelX,y,});game.displayTextLine(ctx,{msg:`${stats.damage}`,x:statX,y,});y+=7;game.displayTextLine(ctx,{msg:`DEF`,x:labelX,y,});game.displayTextLine(ctx,{msg:`${stats.defense}`,x:statX,y,});y+=7;game.displayTextLine(ctx,{msg:`STA`,x:labelX,y,});game.displayTextLine(ctx,{msg:`${Math.ceil(stats.life)}/${stats.maxLife}`,x:statX,y,});y+=7;game.displayTextLine(ctx,{msg:`XP`,x:labelX,y,});game.displayTextLine(ctx,{msg:`${stats.xp}/${Math.ceil(Math.exp(Math.max(2, Math.ceil(Math.log(stats.xp)))))}`,x:statX,y,});if(stats.bonus){ctx.fillStyle="#aa9933";for(let i=0;i<Math.min(9,stats.bonus);i++){ctx.fillRect(34+i*3,16,2,2)}}},hidden:({now,sceneData})=>!sceneData.showStats||now-sceneData.showStats<400,},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#ccaa33";ctx.strokeStyle="#cccc00";const x=23.5,y=23.5;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x-2,y+2);ctx.lineTo(x+2,y+2);ctx.closePath();ctx.fill();ctx.stroke()},hidden:({data,sceneData,now})=>!sceneData.showStats||now-sceneData.showStats<400||!data.stats.bonus,onClick:game=>{const{data}=game;data.stats.bonus --;data.stats.damage ++;game.playSound(SOUNDS.DRINK)},},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#ccaa33";ctx.strokeStyle="#cccc00";const x=23.5,y=30.5;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x-2,y+2);ctx.lineTo(x+2,y+2);ctx.closePath();ctx.fill();ctx.stroke()},hidden:({data,sceneData,now})=>!sceneData.showStats||now-sceneData.showStats<400||!data.stats.bonus,onClick:game=>{const{data}=game;data.stats.bonus --;data.stats.defense ++;game.playSound(SOUNDS.DRINK)},},{custom:(game,sprite,ctx)=>{ctx.fillStyle="#ccaa33";ctx.strokeStyle="#cccc00";const x=23.5,y=37.5;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x-2,y+2);ctx.lineTo(x+2,y+2);ctx.closePath();ctx.fill();ctx.stroke()},hidden:({data,sceneData,now})=>!sceneData.showStats||now-sceneData.showStats<400||!data.stats.bonus,onClick:game=>{const{data}=game;data.stats.bonus --;data.stats.life+=10;data.stats.maxLife+=10;game.playSound(SOUNDS.DRINK)},},{menu:!0,src:ASSETS.MENU_OUT,index:game=>game.menuOpening?game.frameIndex:0,hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU&&!game.touchActive||game.sceneData.firstShot)||game.hideCursor&&game.frameIndex===0||game.battle&&!game.battle.foeDefeated||game.currentEvent()&&game.currentEvent().noMenu,onClick:game=>game.clickMenu(),onHoverOut:(game,sprite,hovered)=>{if(game.menuOpening>0&&game.frameIndex===3&&(!hovered||!hovered.menu_item&&!hovered.menu))game.openMenu(game.now)},},{menu_item:!0,name:"disk",src:ASSETS.MENU_DISK,index:game=>game.frameIndex,hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot),alpha:({hoverSprite},sprite)=>hoverSprite===sprite?1:.5,onClick:game=>{game.hideCursor=!0;game.openMenu(game.now,game=>{const currentSceneName=game.sceneName;const currentScreenshot=game.screenshot();const currentData=JSON.parse(JSON.stringify(game.data));game.gotoScene("disk-screen");game.sceneData.savedData=currentData;game.sceneData.returnScene=currentSceneName;game.sceneData.screenshot=currentScreenshot})},onHoverOut:(game,sprite,hovered)=>{if(game.menuOpening>0&&(!hovered||!hovered.menu_item&&!hovered.menu))game.openMenu(game.now)},combine:(item,game)=>{game.useItem=null;return!0},},{menu_item:!0,name:"sound_on",src:ASSETS.MENU_SOUND_ON,index:game=>game.frameIndex,hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot)||game.mute,alpha:({hoverSprite},sprite)=>hoverSprite===sprite?1:.5,onClick:game=>game.mute=!0,onHoverOut:(game,sprite,hovered)=>{if(game.menuOpening>0&&(!hovered||!hovered.menu_item&&!hovered.menu))game.openMenu(game.now)},combine:(item,game)=>{game.useItem=null;return!0},},{menu_item:!0,name:"sound_off",src:ASSETS.MENU_SOUND_OFF,index:game=>game.frameIndex,hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot)||!game.mute,alpha:({hoverSprite},sprite)=>hoverSprite===sprite?1:.5,onClick:game=>game.mute=!1,onHoverOut:(game,sprite,hovered)=>{if(game.menuOpening>0&&(!hovered||!hovered.menu_item&&!hovered.menu))game.openMenu(game.now)},combine:(item,game)=>{game.useItem=null;return!0},},{menu_item:!0,name:"options",src:ASSETS.MENU_OPTIONS,index:game=>game.frameIndex,hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot),alpha:({hoverSprite},sprite)=>hoverSprite===sprite?1:.5,onClick:game=>{game.openMenu(game.now);game.startDialog({time:game.now,index:0,highlightColor:"#00998899",conversation:[{offsetY:(game,{options})=>(options.filter(({hidden})=>!hidden).length-3)*-7,options:[{msg:"Exit to menu",onSelect:(game,dialog)=>{dialog.index++},},{msg:game=>`Sound ~${!game.mute?"ON":"OFF"}`,onSelect:(game,dialog)=>{game.mute=!game.mute},},{msg:()=>`Retro mode ~${scanlines[0].checked?"ON":"OFF"}`,onSelect:(game,dialog)=>{toggleScanlines()}},{hidden:!0,msg:"Language",onSelect:(game,dialog)=>{game.showTip("Option not yet available");game.dialog=null}},{cantSelect:game=>game.disableFullScreen,msg:game=>game.disableFullScreen?"Full screen not supported":document.fullscreenElement?"Exit Full Screen":"Full Screen",onSelect:(game,dialog)=>{game.toggleFullScreen();game.dialog=null},},{msg:"Close",onSelect:(game,dialog)=>game.dialog=null,},],},{options:[{msg:"Do you wanna exit?",cantSelect:!0,},{msg:"Confirm Exit",onSelect:(game,dialog)=>{const fadeDuration=1000;game.fadeOut(game.now,{duration:fadeDuration*1.5,fadeDuration,color:"#000000",onDone:game=>{game.restart()}})},},{msg:"Cancel",onSelect:(game,dialog)=>dialog.index--,},],}],});return!0},onHoverOut:(game,sprite,hovered)=>{if(game.menuOpening>0&&(!hovered||!hovered.menu_item&&!hovered.menu))game.openMenu(game.now)},combine:(item,game)=>{game.useItem=null;return!0},},{menu_item:!0,name:"profile",src:ASSETS.MENU_PROFILE,index:game=>game.frameIndex,hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot),alpha:({hoverSprite},sprite)=>hoverSprite===sprite?1:.5,onClick:game=>{game.sceneData.showStats=game.sceneData.showStats?0:game.now;game.openMenu(game.now)},onHoverOut:(game,sprite,hovered)=>{if(game.menuOpening>0&&(!hovered||!hovered.menu_item&&!hovered.menu))game.openMenu(game.now)},combine:(item,game)=>{game.useItem=null;return!0},},{menu_item:!0,name:"profile-notification",src:ASSETS.MENU_PROFILE_NOTIFICATION,index:game=>game.frameIndex,hidden:game=>!game.data.stats.bonus||game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot),combine:(item,game)=>{game.useItem=null;return!0},},{menu_item:!0,name:"bag",src:ASSETS.MENU_BAG,index:game=>game.frameIndex,hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot),alpha:({hoverSprite},sprite)=>hoverSprite===sprite?1:.5,onClick:game=>{game.clickBag()},onHoverOut:(game,sprite,hovered)=>{if(game.menuOpening>0&&(!hovered||!hovered.menu_item&&!hovered.menu))game.openMenu(game.now)},combine:(item,game)=>{game.useItem=null;return!0},},{hidden:game=>game.bagOpening||!game.menuOpening&&(game.arrow!==MENU||game.sceneData.firstShot)||game.hideCursor&&game.frameIndex===0||game.battle,custom:({data,frameIndex,sceneData},sprite,ctx)=>{const{stats}=data;const offsetX=frameIndex===3?0:frameIndex===2?1:-10;ctx.fillStyle="#110044";ctx.fillRect(50,2+offsetX,12,3);ctx.fillStyle="#aa0022";ctx.fillRect(51,3+offsetX,10,1);ctx.fillStyle="#bbcc22";ctx.fillRect(51,3+offsetX,10*stats.life/stats.maxLife,1);if(sceneData.lifeIncrease){const progress=(game.now-sceneData.lifeIncrease.time)/2000;if(progress<1){ctx.fillStyle=sceneData.lifeIncrease.color;const preValue=Math.max(0,stats.life-sceneData.lifeIncrease.value*(1-progress));ctx.fillRect(51+10*preValue/stats.maxLife,3+offsetX,10*(stats.life-preValue)/stats.maxLife,1)}}},onRefresh:game=>{if(game.sceneData.lifeIncrease){const progress=(game.now-game.sceneData.lifeIncrease.time)/2000;if(progress>=2){game.frameIndex=0;game.menuOpening=0;game.sceneData.lifeIncrease=null}}},},]}
function makeYupa(){return{src:ASSETS.YUPA_DANCE,col:4,row:4,offsetX:game=>game.data.yupa.position,offsetY:game=>game.moving?-1:1,index:({dialog,now,pendingTip,moving})=>{if(moving){return Math.floor(now/120)%4+12}
if(pendingTip&&pendingTip.talker==="yupa"){return pendingTip.progress<1?8+Math.floor(now/100)%3:8}
if(!dialog){const phase=Math.floor(now/300/8);if(phase%4===0){return Math.floor(now/300)%8}}
return game.data.yupa.position<0?0:4},hidden:game=>game.battle||!game.data.yupa||game.data.yupa.inBottle||game.data.yupa.rotation!==game.rotation||game.facingEvent()&&game.facingEvent().hideYupa,combine:(item,game)=>{switch(item){case "empty bottle":if(game.data.yupa.noMoreBottle){game.playSound(SOUNDS.YUPA);game.showTip("I aint going in dat bottle anymore!",null,null,{talker:"yupa"});game.useItem=null}else if(game.data.yupa.canTurnIntoGoo){game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Come on, try it!",onSelect:game=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip(["Come on! Just give it a try.","Please, I wanna see you do it!","Show me you're a real Yupa!"],game=>{game.playSound(SOUNDS.YUPA);game.showTip("Hum... ooright. But only for a few secondz then...",game=>{game.waitCursor=!1;game.data.yupa.inBottle=game.now;game.playSound(SOUNDS.HUM);game.pickUp({item:"yupa bottle",index:({pendingTip,now})=>pendingTip&&pendingTip.talker==="yupa"?4+Math.floor(now/100)%4:0,image:ASSETS.GRAB_YUPA_BOTTLE,col:3,row:3,message:"Lol, I can't believe he did it! He does look pretty comfortable.",inventoryMessage:"He looks pissed.",onPicked:game=>{game.dialog=null},onTipDone:game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Am not comfotabe!","Gemme outta here, naow!"],game=>{game.playSound(SOUNDS.HUM);game.showTip("You can still talk! Amazing!",null,null,{removeLock:!0})},null,{x:2,y:22,speed:80,talker:"yupa"})}})},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"Ok, nevermind.",onSelect:game=>game.dialog=null,},],},],});game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip(["Hey, so since you can liquify yourself","Can you fit in this bottle?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip("No way! I'm cloztrofobic!",game=>{game.useItem=null;game.waitCursor=!1},null,{x:2,y:22,speed:80,talker:"yupa"})})}else{game.showTip(["No reason to give him that, at the moment.","Let's chat first.",],null,null,{removeLock:!0});game.useItem=null}
return!0;break;case "water bottle":game.playSound(SOUNDS.YUPA);game.showTip("Am nat thursty",null,80,{x:2,y:22,talker:"yupa"});game.useItem=null;return!0;break;case "fruit?":game.playSound(SOUNDS.YUPA);game.showTip("Am nat hongry",null,80,{x:2,y:22,talker:"yupa"});game.useItem=null;return!0;break;case "photo":game.playSound(SOUNDS.YUPA);game.showTip(["Ya wantet to take photo befar takin da baby,","az suvenir.",],null,80,{x:2,y:22,talker:"yupa"});game.useItem=null;return!0;break;default:}
return!1},onClick:game=>{game.startDialog({time:game.now,index:0,conversation:[{options:[{msg:"Hello Yupa",onSelect:(game,dialog)=>{game.playSound(SOUNDS.YUPA);game.waitCursor=!0;game.showTip("Whadz up?",()=>{game.waitCursor=!1},null,{x:2,y:22,speed:80,talker:"yupa"});dialog.index=1},},{msg:"LATER",onSelect:game=>{game.dialog=null},},],},{options:[{msg:"What can I do?",onSelect:(game,dialog)=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip(["I don't know what to do.","Can you advise me?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Abowt what?",],game=>{game.waitCursor=!1;game.dialog.index+=3},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"Got superpowers?",hidden:game=>game.data.yupa.canTurnIntoGoo,onSelect:(game,dialog)=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip(["So... do you have ... like","Alien super powers?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Supapawa? You mean stuf humanz cannut do?","Hum... Yupa can release smelly gas from my bott.","Also make a very loud noise when da happen.",],game=>{game.playSound(SOUNDS.HUM);game.showTip(["No! Not that!","I mean... like super strength, super speed? Or flying?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Welll, I told yo I can travel to paralol uverse",],game=>{game.waitCursor=!1;dialog.index++},null,{x:2,y:22,speed:80,talker:"yupa"})})},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"Turning into goo",hidden:game=>!game.data.yupa.canTurnIntoGoo||game.data.yupa.talkedAboutGoo,onSelect:(game,dialog)=>{game.waitCursor=!0;game.data.yupa.talkedAboutGoo=!0;game.playSound(SOUNDS.HUM);game.showTip(["So you can turn into liquid goo.","That must come pretty handy","If you need to sneak under a door or something.",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Not rally, I cun't movarownd in goo form.","I cun anly turn back to normol.",],game=>{game.playSound(SOUNDS.HUM);game.showTip(["Really? So what is that power good for?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["On ma planet, it good for transpartation.","We can fit hundredz Yupaz in a big truck.","Nat cunfortable but vury iconomic.",],game=>{game.waitCursor=!1;dialog.index-=2},null,{x:2,y:22,speed:80,talker:"yupa"})})},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"How dense?",hidden:game=>!game.data.yupa.talkedAboutGoo,onSelect:(game,dialog)=>{game.waitCursor=!0;game.data.yupa.talkedAboutGoo=!0;game.playSound(SOUNDS.HUM);game.showTip(["How dense is the goo?","Like, could you fit in a glass?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Maybi. I naver tride.",],game=>{game.playSound(SOUNDS.HUM);game.showTip(["That's crazy!",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Yupp...",],game=>{game.waitCursor=!1;dialog.index-=2},null,{x:2,y:22,speed:80,talker:"yupa"})})},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"LATER",onSelect:game=>{game.dialog=null},},],},{options:[{},{msg:"Impressed!",onSelect:(game,dialog)=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip("Amazing! tell me more!",game=>{game.playSound(SOUNDS.YUPA);game.showTip(["In paralol uverse, I had a big famly.","Mi, mi wife, mi husban, and tree kidz","We was goin on an advanture...",],game=>{game.playSound(SOUNDS.HUM);game.showTip(["Ok ok, I got it.","So you don't have any useful superpawa?"],game=>{game.playSound(SOUNDS.YUPA);game.showTip("Hum.. Yupa can shapeshit.",game=>{game.waitCursor=!1;dialog.index++},null,{x:2,y:22,speed:80,talker:"yupa"})})},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"Not impressed.",onSelect:(game,dialog)=>{game.playSound(SOUNDS.HUM);game.showTip(["I think that's what's called dreaming.","Don't you have anything more useful?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip("Hum.. Yupa can shapeshit.",game=>{game.waitCursor=!1;dialog.index++},null,{x:2,y:22,speed:80,talker:"yupa"})})},},],},{onSelect:(game,dialog)=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip(["That's awesome! So maybe you can transform into a big scary dragon?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Oh no, not dat!","Yupa can liquify and turn into very dense goo.",],game=>{game.playSound(SOUNDS.HUM);game.showTip(["Erghh... not sure how I'd feel about that.",],game=>{game.playSound(SOUNDS.YUPA);game.showTip("I feel greyt!",game=>{game.waitCursor=!1;game.data.yupa.canTurnIntoGoo=!0;game.dialog=null},null,{x:2,y:22,speed:80,talker:"yupa"})})},null,{x:2,y:22,speed:80,talker:"yupa"})})},options:[{msg:"No way!",onSelect:(game,dialog)=>{dialog.conversation[dialog.index].onSelect(game,dialog)},},{msg:"No kiddin!",onSelect:(game,dialog)=>{dialog.conversation[dialog.index].onSelect(game,dialog)},},{msg:"No shit!",onSelect:(game,dialog)=>{dialog.conversation[dialog.index].onSelect(game,dialog)},},],},{options:[{msg:"Guards",onSelect:(game,dialog)=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip("There are too many guards! How can I get through them?",game=>{game.waitCursor=!1;game.playSound(SOUNDS.YUPA);game.showTip("You can fight dem, or have something fight dem for ya.",game=>{game.dialog=null},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"Battles!",onSelect:(game,dialog)=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip("Some battles are too difficult!",game=>{game.waitCursor=!1;game.playSound(SOUNDS.YUPA);game.showTip("Ya gotta train more with smaller foez. If all fail, use da gun!",game=>{game.dialog=null},null,{x:2,y:22,speed:80,talker:"yupa"})})},},{msg:"Yupa power",hidden:game=>game.data.yupa.canTurnIntoGoo,onSelect:(game,dialog)=>{game.waitCursor=!0;game.playSound(SOUNDS.HUM);game.showTip(["So... do you have ... like","Alien super powers?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Supapawa? You mean stuff humans cannot do?","Hum... Yupa can release smelly gas from my bott.","Also make a very loud noise when da happen.",],game=>{game.playSound(SOUNDS.HUM);game.showTip(["No! Not that!","I mean... like super strength, super speed? Or flying?",],game=>{game.playSound(SOUNDS.YUPA);game.showTip(["Welll, I told yo I can travel to paralol uverse",],game=>{game.waitCursor=!1;dialog.index-=2},null,{x:2,y:22,speed:80,talker:"yupa"})})},null,{x:2,y:22,speed:80,talker:"yupa"})})},},],},],})},}}
function makeFoe(foe,src){return{src,col:4,row:4,offsetX:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-.5)*Math.min(10,200/hitTime)):0},offsetY:({now,battle})=>{const hitTime=Math.max(1,now-battle.playerAttackLanded);return hitTime<500?Math.round((Math.random()-1)*Math.min(10,200/hitTime)):0},index:({now,battle,data})=>{if(!battle||data.gameOver){return 0}
if(battle.foeDefeated){return Math.min(15,9+Math.floor((now-battle.foeDefeated)/100))}
const hitTime=Math.max(1,now-battle.playerAttackLanded);if(hitTime<400){return 9}
if(battle.foeBlock&&now-battle.foeBlock<200){return 8}
if(now>battle.nextAttack){return 4+Math.floor((now-battle.nextAttack)/100)%4}
return Math.floor(now/200)%4},hidden:({battle,now})=>!battle||battle.foe!=foe||battle.foeDefeated&&now-battle.foeDefeated>=2000,onShot:(game,sprite)=>{const{battle,data}=game;if(!battle.invincible){console.log(battle.gunDamage);game.damageFoe(battle.gunDamage||1000,{shot:!0})}},combine:(item,game)=>{game.battle.nextAttack=Math.min(game.now+3000,game.battle.nextAttack);if(item==="gun"){game.showTip("I'm out of ammo.",null,50,{removeLock:!0})}else if(item==="photo"){game.playSound(SOUNDS.HUM);game.showTip("Have you seen this baby?",null,50,{removeLock:!0})}else{game.playSound(SOUNDS.HUM);game.showTip(`Would you like this ${item}?`,null,50,{removeLock:!0})}
return!0},}}
function makeOnSceneBattle(){return{onSceneBattle:(game,battle)=>{const{now,arrow,data}=game;if(battle.foeDefeated){return}
const isCritical=game.data.stats.life/game.data.stats.maxLife<.1;if(!battle.nextAttack){battle.nextAttack=Math.random()*battle.attackSpeed+now}else if(now>=battle.nextAttack&&!battle.preventAttack){if(battle.battleCry&&!battle.didBattleCry){battle.didBattleCry=game.now;game.playSound(battle.battleCry)}
const frame=4+Math.floor((now-battle.nextAttack)/battle.attackPeriod);if(frame===7&&!battle.foeDidAttack){if(game.blocking()&&!battle.playerLeftAttack&&!battle.playerRightAttack&&!battle.noBlock){game.playSound(SOUNDS.DUD);battle.playerBlock=now;if(!isCritical){game.damagePlayer(battle.foeDamage/5,{blocked:!0})}}else{game.playSound(SOUNDS.HIT);battle.playerHit=now;battle.playerLeftAttack=battle.playerRightAttack=0;game.damagePlayer(isCritical?battle.foeDamage/2:battle.foeDamage)}
game.pendingTip=null;battle.foeDidAttack=now}else if(frame>7){battle.foeDidAttack=0;battle.nextAttack=null;battle.didBattleCry=0}}
if(battle.playerBlock&&now-battle.playerBlock>200){battle.playerBlock=0}
if(battle.playerHit&&now-battle.playerHit>200){battle.playerHit=0}
const attackPeriod=(battle.foeBlock?1.5:1)*battle.playerAttackPeriod;const playerAttack=battle.playerLeftAttack||battle.playerRightAttack;if(playerAttack){const frame=Math.floor((now-playerAttack)/attackPeriod);if(frame===3&&battle.fatalKick&&battle.belowTheBelt){game.playSound(SOUNDS.HIT);battle.playerAttackLanded=now;game.damageFoe(1000)}else if(frame===3&&!battle.playerAttackLanded&&!battle.foeBlock){if(game.data.leftHand==="none"&&battle.playerLeftAttack){game.playSound(SOUNDS.WEAKPUNCH,{volume:.2});battle.playerLeftAttack=0;battle.fist=RIGHT}else if((now>=battle.nextAttack||Math.random()*(isCritical?1.5:1)>=battle.foeBlockChance)&&!battle.invincible){battle.nextAttack=null;battle.playerAttackLanded=now;const superPunch=game.data.leftHand==="super"&&battle.playerLeftAttack;if(superPunch){game.playSound(SOUNDS.PLAYER_HURT);game.playSound(SOUNDS.WEAKPUNCH,{volume:.2})}else{game.playSound(SOUNDS.HIT)}
game.damageFoe(isCritical||superPunch?data.stats.damage*2:data.stats.damage)}else if(!battle.foeBlock){game.playSound(SOUNDS.DUD);battle.foeBlock=now;if(!battle.invincible){game.damageFoe(data.stats.damage/5,{blocked:!0})}
if(Math.random()<=battle.riposteChance){battle.nextAttack=Math.min(battle.nextAttack,now+50)}}}
if(frame>4){battle.playerRightAttack=0;battle.playerLeftAttack=0;battle.fist=battle.fist===LEFT?RIGHT:LEFT}}
if(game.data.stats.life<=0&&!game.data.gameOver){game.gameOver(battle.gameOverMessage);const fadeDuration=3000;game.fadeOut(game.now,{duration:fadeDuration*1.5,fadeDuration,color:"#FF0000",max:.7})}},onScenePunch:({useItem},battle)=>{return!useItem},}}
function standardBattle(){return[{noPunch:(game,sprite)=>game.evaluate(sprite.canEscape),src:ASSETS.ESCAPE,offsetY:5,hidden:game=>{const{battle,arrow,useItem,bagOpening}=game;return!battle||battle.preventEscape||game.data.gameOver||battle.foeDefeated||useItem||bagOpening},onClick:(game,sprite)=>{if(!game.evaluate(sprite.canEscape)){return}
if(game.battle&&game.battle.dummyBattle){game.escapeBattle()}else if(Math.random()<.5||!game.canEscape(game.battle)){game.failEscape()}else{game.escapeBattle()}},canEscape:(game,sprite)=>!game.battle.failedEscape||game.now-game.battle.failedEscape>10000,alpha:(game,sprite)=>game.evaluate(sprite.canEscape)?1:.3,},{src:({data})=>{switch(data.leftHand){case "none":return ASSETS.MISSING_HAND_PUNCH;case "hook":return ASSETS.HOOK_PUNCH;case "super":return ASSETS.SUPER_PUNCH}
return ASSETS.PUNCH},col:4,row:4,side:({battle})=>!battle.playerRightAttack?RIGHT:0,offsetX:({now,battle})=>Math.cos((now-Math.PI)/100)+1+3,offsetY:({now,battle})=>Math.sin((now-Math.PI)/100)+1+(battle.playerLeftAttack?10:0),index:({battle,now})=>{if(!battle.playerRightAttack||battle.belowTheBelt){return 12}
const attackPeriod=battle.playerAttackPeriod;const frame=Math.min(3,Math.floor((now-battle.playerRightAttack)/attackPeriod));return frame},hidden:game=>{const{battle,arrow,useItem,bagOpening}=game;return!battle||battle.dummyBattle&&(arrow===LEFT||arrow===RIGHT)||battle.belowTheBelt&&(battle.playerLeftAttack||battle.playerRightAttack)||game.data.gameOver||battle.foeDefeated||(game.blocking()&&!battle.playerLeftAttack&&!battle.playerRightAttack&&!battle.playerHit||useItem||bagOpening)},},{src:({data})=>{switch(data.leftHand){case "none":return ASSETS.MISSING_HAND_PUNCH;case "hook":return ASSETS.HOOK_PUNCH;case "super":return ASSETS.SUPER_PUNCH}
return ASSETS.PUNCH},col:4,row:4,side:({battle})=>!battle.playerLeftAttack?LEFT:0,offsetX:({now,battle})=>Math.sin(now/100)-1-3,offsetY:({now,battle})=>Math.cos(now/100)+1+(battle.playerRightAttack?10:0),index:({battle,now})=>{if(!battle.playerLeftAttack||battle.belowTheBelt){return 12}
const attackPeriod=battle.playerAttackPeriod;const frame=Math.min(3,Math.floor((now-battle.playerLeftAttack)/attackPeriod));return 4+frame},hidden:game=>{const{battle,arrow,useItem,bagOpening}=game;return!battle||battle.dummyBattle&&(arrow===LEFT||arrow===RIGHT)||battle.belowTheBelt&&(battle.playerLeftAttack||battle.playerRightAttack)||game.data.gameOver||battle.foeDefeated||game.blocking()&&!battle.playerLeftAttack&&!battle.playerRightAttack&&!battle.playerHit||useItem||bagOpening},},{src:({data})=>{switch(data.leftHand){case "none":return ASSETS.MISSING_HAND_PUNCH;case "hook":return ASSETS.HOOK_PUNCH;case "super":return ASSETS.SUPER_PUNCH}
return ASSETS.PUNCH},col:4,row:4,index:({battle,now})=>{const{playerAttackPeriod,playerLeftAttack,playerRightAttack}=battle;if(!playerLeftAttack&&!playerRightAttack){return 12}
const frame=Math.min(3,Math.floor((now-Math.max(playerLeftAttack,playerRightAttack))/playerAttackPeriod));return 8+frame},hidden:game=>{const{battle,arrow,useItem,bagOpening}=game;return!battle||!battle.playerLeftAttack&&!battle.playerRightAttack||!battle.belowTheBelt||game.data.gameOver||battle.foeDefeated||game.blocking()&&!battle.playerLeftAttack&&!battle.playerRightAttack&&!battle.playerHit||useItem||bagOpening},},{src:({data})=>{switch(data.leftHand){case "none":return ASSETS.MISSING_HAND_PUNCH;case "hook":return ASSETS.HOOK_PUNCH;case "super":return ASSETS.SUPER_PUNCH}
return ASSETS.PUNCH},col:4,row:4,offsetY:({battle,now})=>battle.playerBlock&&now-battle.playerBlock<50?5:0,index:13,hidden:game=>{const{battle,arrow,useItem,bagOpening,hoverSprite}=game;if(!game.blocking()||hoverSprite&&hoverSprite.bag||battle.foeDefeated||battle.playerHit||battle.playerLeftAttack||battle.playerRightAttack||useItem||bagOpening){return!0}
return!1},},{src:ASSETS.TREASURE_CHEST,hidden:game=>{const{chest,now,rotation,moving,frameIndex}=game;if(!chest||now<chest.found||rotation%2==1||moving){return!0}
if(!game.battle){const event=game.facingEvent();if(!event||!event.chest){return!0}}
return!1},onClick:(game,sprite)=>{const{now,chest,situation}=game;if(!game.battle){if(situation.chestCleared&&situation.chestCleared[game.frontCell()]){return}}
if(chest){if(!chest.opened){chest.opened=now;game.playSound(SOUNDS.DOOR)}else if(game.now-chest.opened>2000){game.battle=null}}},index:game=>{const{now,chest,situation}=game;return!this.battle&&situation.chestCleared&&situation.chestCleared[game.frontCell()]?3:!chest.opened?0:Math.min(3,Math.floor((now-chest.opened)/100))},onRefresh:(game,sprite)=>{const{now,chest,situation}=game;if(chest.opened){const frame=Math.floor((now-chest.opened)/100);if(frame>4&&!chest.checked){chest.checked=now;const{item,count,image,message,hideFromInventory}=chest;if(item){game.pickUp({item,count,image,message:message||"",onPicked:game=>{if(game.battle){if(!game.battle.chest){game.chest=null}
game.battle=null}else{if(!situation.chestCleared){situation.chestCleared={}}
situation.chestCleared[game.frontCell()]=now}},hideFromInventory})}else{game.showTip(message||null,game=>{if(game.battle){if(!game.battle.chest){game.chest=null}
game.battle=null}else{if(!situation.chestCleared){situation.chestCleared={}}
situation.chestCleared[game.frontCell()]=now}})}}}},},{custom:(game,sprite,ctx)=>{const{stats,battle}=game.data;ctx.fillStyle="#333333";ctx.fillRect(4,60,56,3);ctx.fillStyle="#aa0022";ctx.fillRect(5,61,54,1);ctx.fillStyle="#bbcc22";ctx.fillRect(5,61,54*stats.life/stats.maxLife,1);if(!battle||battle.dummyBattle){return}
ctx.fillStyle="#333333";ctx.fillRect(4,2,56,3);ctx.fillStyle="#770022";ctx.fillRect(5,3,54,1);ctx.fillStyle="#cc22bb";ctx.fillRect(5,3,54*battle.foeLife/battle.foeMaxLife,1)},hidden:({battle,data,sceneData})=>(!battle&&!sceneData.showLifebar)||data.stats.life<=0||battle&&battle.foeDefeated,},{custom:(game,sprite,ctx)=>{const{battle,now}=game;const l=now-battle.foeDefeated;game.displayTextLine(ctx,{msg:`+${battle.gainedXP}xp`,x:25,y:30-Math.round(l/400),})},hidden:({battle,data,now})=>!battle||!battle.foeDefeated||!battle.gainedXP||now-battle.foeDefeated>2000,},{src:ASSETS.LEVEL_UP,index:({now,battle})=>Math.min(3,Math.floor((now-(battle.foeDefeated+2000))/100)),hidden:({battle,data,now})=>!battle||!battle.foeDefeated||!battle.gainedLevel||now-battle.foeDefeated<=2000||now-battle.foeDefeated>4500,alpha:({now,battle})=>Math.max(0,Math.min(1,(battle.foeDefeated+4500-now)/500)),},]}
const consumable={"cake":game=>{game.gotoScene("alien");return!0},"fruit?":game=>{const{stats}=game.data;game.useItem=null;if(game.data.stats.state.ate&&!game.battle&&!game.sceneData.actionScequence){game.showTip("I'm not hungry.");return!1}else{game.playSound(SOUNDS.EAT);game.addToLife(100,"#663300");game.data.stats.state.ate=game.now;if(!game.battle&&!game.sceneData.actionScequence){game.showTip("Delicious!")}
return!0}},"water bottle":game=>{const{stats}=game.data;game.useItem=null;if(game.data.stats.state.drank&&!game.battle&&!game.sceneData.actionScequence){game.showTip(["I'm not thirsty.","Physical exercise usually gets me thirsty."]);return!1}else{game.playSound(SOUNDS.DRINK);game.addToInventory({item:"empty bottle",image:ASSETS.GRAB_BOTTLE});game.addToLife(30,"#0099aa");game.data.stats.state.drank=game.now;if(!game.battle&&!game.sceneData.actionScequence){game.showTip("Refreshing!")}
return!0}},"yupa bottle":game=>{game.gotoScene("drink-yupa");return!0},};const CONFIG_FILES={'9-months.js':{size:6298,md5:'85c4f5d49c347550e1eb95e04c1e8978',},'alien.js':{size:3079,md5:'d1225fdddba641f2823b5804418cacf8',},'amari-baby.js':{size:3674,md5:'51fc80a8c89c256c389eeef64e56dd8a',},'arcade-room.js':{size:1035,md5:'5d448d078ba970810f32a18d38d2185a',},'asteroid-field.js':{size:17055,md5:'74deb1ee9900a559b3ab62e782d25d38',},'birthday.js':{size:607,md5:'984e4fd2c0bb01b827c3164c2314434c',},'bring-cake.js':{size:1773,md5:'57c5e6a38e08765a7913b3d9f98bb521',},'bring-it-on.js':{size:1675,md5:'572176e8093ddc163552aac6681281ca',},'cake-face.js':{size:605,md5:'54c860fec364386e2e7fc6206c69391f',},'call-gangsta.js':{size:2988,md5:'c73f20ec2c16ecf6d6b73d76369bf701',},'cards-showdown.js':{size:1558,md5:'ab9366a8593403d453f71180ada22428',},'ceiling-maze.js':{size:10759,md5:'27ef14cacd95e87df2b52e9a5ca538e3',},'cell-maze-2.js':{size:715,md5:'1835442fd869556e7595de32c410d1e5',},'cell-maze.js':{size:18065,md5:'db449eccedb8d096750739bdb3fee80b',},'concert.js':{size:7983,md5:'10defcf92c9a2651d9b3313971cb9c2b',},'congrats.js':{size:919,md5:'2ec7897dcb823305a6cbac0a456d6c77',},'creator.js':{size:4047,md5:'6039f36f439202287a6077c238e798a1',},'crowd.js':{size:2920,md5:'032f27661431d20a85dd3b1fec6ae396',},'deadly-landing.js':{size:1939,md5:'f57df972a168f2e19f28355d9b912ce5',},'disk-screen.js':{size:13125,md5:'05559b58fecea3663dc8cba712a979cc',},'doctar-room.js':{size:8934,md5:'c42f26e8d06527c3c1819ad17b833479',},'doctar.js':{size:20311,md5:'80f655cec3bc97b501dbab017d86e8cd',},'doom.js':{size:1795,md5:'2166cd7313aacca4746dfdc22e81c95d',},'drink-yupa.js':{size:3108,md5:'fe221b868cd5d20ce64efe846ba6d4c4',},'ending.js':{size:2731,md5:'f94b17c9123f0703f8163e4b603583ff',},'ernest-card-dealing.js':{size:11529,md5:'1ef17a9ac6ceb373885208750151e338',},'ernest.js':{size:3230,md5:'c212aa738f158aaaec4a1ed0d3a7a972',},'evening-date.js':{size:1127,md5:'9bbde1852c630e86bf9cbe0a79e9fc38',},'explore-tavern.js':{size:3671,md5:'3614e69be44ad335bc4db2b5802f176e',},'final-corridor.js':{size:22166,md5:'98e001cd69d620310027a16121f614a0',},'final-credit.js':{size:3458,md5:'d8e3e56a4ca56c277d7473dbb25fe171',},'final-doom.js':{size:625,md5:'68a1755032d917a369c87d58f32cf7bf',},'final-exit.js':{size:2109,md5:'fb97967c5ea97d9e3ff371187bb54e6a',},'final-fight.js':{size:14503,md5:'37cfa04249b3b45995b33fca3016ed8b',},'final-planet-world.js':{size:30799,md5:'b62cc01d47d1e635b962d0b4446238e0',},'final-planet.js':{size:1112,md5:'824dd4c22657f421742fbec25111b671',},'final-title.js':{size:306,md5:'aefbaaced3667a46a24d0e5d766c5a45',},'first-prison-cell.js':{size:1066,md5:'9b9a0cc06fa69cddd43ce14c3dc6db65',},'gangsta-check-cards.js':{size:1940,md5:'337b62f9ccf682732628d28094ba437d',},'gangsta-shootout.js':{size:8919,md5:'e6d2b7816fb12f0cde74611b7e62cd19',},'gangsta-table.js':{size:17532,md5:'16bdaa890e65ae232ee8deb9eeb865c6',},'guards-attack.js':{size:1415,md5:'a2b611905fb2f793ba30f0cb442a3227',},'guards-laughing-2.js':{size:523,md5:'feaae7bb40fd4155a1ef25bf7d67760d',},'guards-laughing.js':{size:686,md5:'7e5341af2e1f873bf14e39014a8be691',},'human-woke.js':{size:7114,md5:'0729fdb8d376c0cc54647a8599938dad',},'i-have-no-hand.js':{size:618,md5:'65d623fa7f97af7fbdc3f809878cd2b9',},'in-progress.js':{size:980,md5:'3aaf28f2ad21be44c34c79390494c039',},'inside-tavern.js':{size:912,md5:'af720eff952a07f431f94d0f67a35b44',},'jail-cell.js':{size:18047,md5:'130c129f0420347dafc30ee55ab5eb88',},'lab.js':{size:6642,md5:'ae5fcd4f6c35faf84509b941ba05d8cc',},'land-planet.js':{size:163,md5:'4b41f05243a1be76140b798a21a08e11',},'landscape.js':{size:7633,md5:'9050d50958a29edf4fc3a8885019c7c4',},'leo-end.js':{size:208,md5:'2348222837eee2fe742d4f2a330e2ab9',},'load-screen.js':{size:4344,md5:'747692111fdd6e0c6f27e0a8fc30bab1',},'lock-zoom.js':{size:4529,md5:'6737d042e1b42918aafa64b2a4f95d67',},'locker-room.js':{size:2954,md5:'4d3449ae1bb4f83ab3faa4d0f6d6e8c2',},'look-over-there.js':{size:4955,md5:'e0de42c9721d185888fb9a72748d5cc5',},'look-right-left.js':{size:3611,md5:'fa6397650e02c64d6ab84839d83155bb',},'maze-2.js':{size:2832,md5:'5276025f46cd1c926c674920616cfcab',},'maze-3.js':{size:2678,md5:'c6407888d8afa99f5eb08ca06047d144',},'maze-4.js':{size:2450,md5:'b1212a592b62df95fd504fb2523d57ce',},'maze.js':{size:2460,md5:'a1c4d69ae5d1cf36491e3e49617fb6ca',},'meet-dick.js':{size:648,md5:'5a1d470e313cbd7e6f8bdd6ac09a9868',},'mirror.js':{size:5635,md5:'462386bacd9d771326e71d0fe516f901',},'money-shot.js':{size:757,md5:'dc491e39a9d56e1f09f52553f1444b81',},'monster-in-space.js':{size:5599,md5:'0be5af632f7e58f293cdf81c0d1ebbeb',},'morning-after.js':{size:5640,md5:'51775515e20fceaedb4ba18ec0d3ad20',},'name-screen.js':{size:4526,md5:'744ddc979660e619c1e3255d5ac97741',},'not-so-fast.js':{size:28811,md5:'d56174260b3d8ffa8cd963d89a056b7f',},'origin.js':{size:3831,md5:'71c9a36afa0aa8544d6eeaaa92cb30cb',},'outside-carnage.js':{size:5916,md5:'be2af1d1b05536abec74a34e93b0e0e1',},'outside.js':{size:2584,md5:'5abb2d202bcea6ac52059395a7c19edf',},'panic-exit.js':{size:1447,md5:'de8a1373a2ca87d302a317ff3139c401',},'poor-hitman.js':{size:602,md5:'22752cad772440956cb00acbd4a7ea97',},'robot-dial.js':{size:4119,md5:'e871f78c0f7f081206f3e4b0ddfcf088',},'sarlie-planet-world.js':{size:18346,md5:'ca1cdaa227a4bd1c00e69ca5ff8dda91',},'sarlie-planet.js':{size:6672,md5:'cb995af3f12d8e2fd9071c06bd9c4ccf',},'shop.js':{size:1823,md5:'9319a8b29a008e3419f727bfc1ac58c0',},'shopkeepa.js':{size:49726,md5:'063562eed39aac920378f25889a653bc',},'slots.js':{size:5255,md5:'4f6614767bb3ca720e10cb09d8c19dd5',},'space-adventure.js':{size:5731,md5:'c4383726248e6dee7dcf41eb84009c7a',},'space-travel.js':{size:1861,md5:'ec57e6e42c17ee2f812025b900e7933a',},'stars.js':{size:9559,md5:'b3d9ad925d4fe35bd8f47647c65a549f',},'start-screen.js':{size:9428,md5:'47b26a8d2883978bb672cd8e5697b277',},'stay-here-baby-hitler.js':{size:370,md5:'fb4de4cedfdd8bf129e437e0a4c4eadb',},'surface.js':{size:1739,md5:'e88a4abb9e94896503febfcecf5ffe44',},'tavern-entrance-zoom.js':{size:7344,md5:'6210d8f31bd95edc244f7cfca9709ed3',},'tavern-entrance.js':{size:3953,md5:'4778ab7adc87384c8d0f61c03fe090d5',},'tavern-phone.js':{size:16384,md5:'361574a103985c9e62fc0af3407b256f',},'tavern-posters.js':{size:692,md5:'00c68291970081321383d30bb3b537b2',},'tavern-stranger-zoom.js':{size:16252,md5:'e8531de04760339896310fe17c12adbc',},'temp-end.js':{size:269,md5:'c7e74bc9e2aaed2d8a8e4b85cc5c79fb',},'the-date.js':{size:22274,md5:'071106309a82ea6cf755d292fa3f9219',},'tile-hole.js':{size:791,md5:'49050c2a848cd2ca4e7772c2dfac8e90',},'toilet-monster.js':{size:858,md5:'6b748fc085ceea5fe1bd58c0113a8fea',},'toilet-zoom.js':{size:874,md5:'c32eca182c954ba83f0c8024fe00a12f',},'toilets.js':{size:1642,md5:'cf8d318fea614ec7ac863ef9990c6532',},'training-room.js':{size:3048,md5:'15eefaa0dd1b158e967c0a98d19a3d17',},'vending-machine.js':{size:2184,md5:'00d8a2986650c95176bc26bb3fcec90b',},'we-take-care-of-you.js':{size:2838,md5:'cf2b2423efdc704bad3e0ae4018361d6',},'what-so-funny.js':{size:956,md5:'62e927080943b59aa7e58153a09b14ea',},'yupa-sarlie.js':{size:17975,md5:'da211bd00d74101123ead27ac3715890',},'zoom-arcade.js':{size:20791,md5:'c3680871654d9588552822e5beaa357b',},'zoom-guards.js':{size:3923,md5:'62bbd9833c894ca05d1abedc4eccb04d',},'zoom-hottub-2.js':{size:4987,md5:'3a72d209f88a20fa4cf879575c2246f3',},'zoom-hottub.js':{size:4649,md5:'8e000d7a3fe3983ad438f5bb79af387e',},'zoom-shop-monster.js':{size:15320,md5:'199a89326e9753a6e079dea28f651a0e',},'zoom-vending-machine.js':{size:5026,md5:'4a1ef601fca133d9e3b242c1e33008c5',},};const spritesheet={"assets/access-card.png":"generated/spritesheets/sheet2.png|crop:448,640,64,64","assets/alexa.png":"generated/spritesheets/sheet1.png|crop:320,1088,256,256","assets/alien-eater.png":"generated/spritesheets/sheet1.png|crop:640,768,320,320","assets/amari-baby.png":"generated/spritesheets/sheet3.png|crop:1280,576,128,192","assets/arcade-hands.png":"generated/spritesheets/sheet1.png|crop:576,1408,64,64","assets/arcade-room.png":"generated/spritesheets/sheet1.png|crop:1280,704,64,64","assets/arcade.png":"generated/spritesheets/sheet1.png|crop:1152,704,64,64","assets/argue-mouth.png":"generated/spritesheets/sheet3.png|crop:576,1152,192,192","assets/arrow-backward.png":"generated/spritesheets/sheet4.png|crop:768,1280,128,128","assets/arrow-cursor.png":"generated/spritesheets/sheet0.png|crop:1472,1152,11,22","assets/arrow-forward.png":"generated/spritesheets/sheet4.png|crop:768,896,128,128","assets/arrow-left.png":"generated/spritesheets/sheet3.png|crop:192,1024,128,128","assets/arrow-right.png":"generated/spritesheets/sheet3.png|crop:960,0,128,128","assets/arrow-side.png":"generated/spritesheets/sheet0.png|crop:320,1344,128,128","assets/baby-hitler-waiter.png":"generated/spritesheets/sheet1.png|crop:640,1344,128,128","assets/bag-out.png":"generated/spritesheets/sheet3.png|crop:384,1280,128,128","assets/bathroom-background.png":"generated/spritesheets/sheet1.png|crop:1344,704,64,64","assets/beard.png":"generated/spritesheets/sheet3.png|crop:768,1152,192,192","assets/birthday.png":"generated/spritesheets/sheet1.png|crop:1408,128,64,64","assets/bottle-shards.png":"generated/spritesheets/sheet3.png|crop:1088,576,192,192","assets/bottle-slot.png":"generated/spritesheets/sheet3.png|crop:384,960,192,192","assets/bottle.png":"generated/spritesheets/sheet3.png|crop:384,768,192,192","assets/bottom.png":"generated/spritesheets/sheet1.png|crop:1088,704,64,64","assets/boy-gunpoint.png":"generated/spritesheets/sheet1.png|crop:960,384,256,320","assets/boy-smile.png":"generated/spritesheets/sheet3.png|crop:1216,0,128,128","assets/bring-cake.png":"generated/spritesheets/sheet3.png|crop:896,576,192,192","assets/bring-it-on.png":"generated/spritesheets/sheet3.png|crop:512,192,128,128","assets/brusalien.png":"generated/spritesheets/sheet2.png|crop:0,0,256,256","assets/cafee.png":"generated/spritesheets/sheet3.png|crop:384,576,192,192","assets/cage-opened.png":"generated/spritesheets/sheet1.png|crop:1088,1344,128,128","assets/cage.png":"generated/spritesheets/sheet3.png|crop:1344,384,128,192","assets/cake-boom.png":"generated/spritesheets/sheet2.png|crop:1216,768,192,256","assets/cake-fork.png":"generated/spritesheets/sheet3.png|crop:768,960,192,192","assets/cake-piece.png":"generated/spritesheets/sheet3.png|crop:960,1152,192,192","assets/cake-trash.png":"generated/spritesheets/sheet3.png|crop:1152,1152,192,192","assets/candle.png":"generated/spritesheets/sheet3.png|crop:1024,192,128,128","assets/cards-showdown.png":"generated/spritesheets/sheet3.png|crop:704,384,128,192","assets/ceiling-hole-only.png":"generated/spritesheets/sheet3.png|crop:576,576,192,192","assets/ceiling-hole.png":"generated/spritesheets/sheet3.png|crop:384,384,192,192","assets/ceiling-rope-move.png":"generated/spritesheets/sheet3.png|crop:960,960,192,192","assets/close-door.png":"generated/spritesheets/sheet0.png|crop:1344,832,128,128","assets/close-floor.png":"generated/spritesheets/sheet0.png|crop:960,1344,128,128","assets/close-further-side.png":"generated/spritesheets/sheet3.png|crop:576,1344,128,128","assets/close-side-corner.png":"generated/spritesheets/sheet3.png|crop:1152,1344,128,128","assets/close-side-solid.png":"generated/spritesheets/sheet1.png|crop:640,256,128,128","assets/close-side.png":"generated/spritesheets/sheet1.png|crop:960,1344,128,128","assets/close-wall-back.png":"generated/spritesheets/sheet3.png|crop:576,0,128,128","assets/close-wall-solid.png":"generated/spritesheets/sheet3.png|crop:704,0,128,128","assets/close-wall.png":"generated/spritesheets/sheet3.png|crop:832,0,128,128","assets/coin-1.png":"generated/spritesheets/sheet1.png|crop:256,704,64,64","assets/coin-2.png":"generated/spritesheets/sheet1.png|crop:256,896,64,64","assets/coinstart.png":"generated/spritesheets/sheet3.png|crop:640,192,128,128","assets/compass.png":"generated/spritesheets/sheet0.png|crop:1216,1344,64,128","assets/crater.png":"generated/spritesheets/sheet2.png|crop:1280,1024,192,256","assets/crawling-boy.png":"generated/spritesheets/sheet3.png|crop:576,960,192,192","assets/creator.png":"generated/spritesheets/sheet0.png|crop:896,0,320,384","assets/dancer.png":"generated/spritesheets/sheet2.png|crop:1376,0,96,96","assets/dark-cloth-stranger.png":"generated/spritesheets/sheet0.png|crop:0,832,320,320","assets/date-night.png":"generated/spritesheets/sheet3.png|crop:768,768,192,192","assets/date-table.png":"generated/spritesheets/sheet1.png|crop:1216,1088,256,320","assets/dimming-light.png":"generated/spritesheets/sheet4.png|crop:1152,768,128,128","assets/doctar-room.png":"generated/spritesheets/sheet0.png|crop:512,960,320,320","assets/doctar.png":"generated/spritesheets/sheet1.png|crop:320,768,256,320","assets/doctor-lobby-amari.png":"generated/spritesheets/sheet3.png|crop:1216,384,128,192","assets/doctor-lobby-sarlie.png":"generated/spritesheets/sheet3.png|crop:1088,384,128,192","assets/doctor-lobby.png":"generated/spritesheets/sheet3.png|crop:576,768,192,192","assets/door-open.png":"generated/spritesheets/sheet4.png|crop:896,1024,128,128","assets/doorway.png":"generated/spritesheets/sheet3.png|crop:960,384,128,192","assets/drink-yupa.png":"generated/spritesheets/sheet0.png|crop:512,512,448,448","assets/dummy.png":"generated/spritesheets/sheet1.png|crop:640,0,256,256","assets/dungeon-lock.png":"generated/spritesheets/sheet4.png|crop:1152,1280,128,128","assets/dungeon-move-solid.png":"generated/spritesheets/sheet4.png|crop:1280,1280,128,128","assets/dungeon-move.png":"generated/spritesheets/sheet4.png|crop:1152,1152,128,128","assets/eater.png":"generated/spritesheets/sheet4.png|crop:896,896,128,128","assets/electro-dial.png":"generated/spritesheets/sheet3.png|crop:832,384,128,192","assets/ernest.png":"generated/spritesheets/sheet0.png|crop:832,1280,128,192","assets/escape.png":"generated/spritesheets/sheet2.png|crop:960,1344,64,64","assets/evening-date.png":"generated/spritesheets/sheet2.png|crop:0,832,192,192","assets/exit-door.png":"generated/spritesheets/sheet2.png|crop:1408,960,64,64","assets/exit-gate.png":"generated/spritesheets/sheet3.png|crop:0,0,192,192","assets/exit-out-carnage.png":"generated/spritesheets/sheet2.png|crop:768,1280,192,192","assets/exit-out.png":"generated/spritesheets/sheet2.png|crop:1024,1280,192,192","assets/eyes-open.png":"generated/spritesheets/sheet0.png|crop:320,1152,192,192","assets/far-door.png":"generated/spritesheets/sheet4.png|crop:1280,1024,128,128","assets/far-floor.png":"generated/spritesheets/sheet4.png|crop:1152,1024,128,128","assets/far-map.png":"generated/spritesheets/sheet4.png|crop:896,768,128,128","assets/far-side-corner.png":"generated/spritesheets/sheet4.png|crop:768,640,128,128","assets/far-side.png":"generated/spritesheets/sheet4.png|crop:1024,1280,128,128","assets/far-wall-solid.png":"generated/spritesheets/sheet4.png|crop:1280,896,128,128","assets/far-wall.png":"generated/spritesheets/sheet3.png|crop:1088,0,128,128","assets/fembot.png":"generated/spritesheets/sheet2.png|crop:512,256,256,256","assets/final-exit.png":"generated/spritesheets/sheet2.png|crop:1408,896,64,64","assets/final-planet.png":"generated/spritesheets/sheet1.png|crop:1408,256,64,128","assets/flash-screen.png":"generated/spritesheets/sheet4.png|crop:896,1152,128,128","assets/floor-ceiling.png":"generated/spritesheets/sheet2.png|crop:1408,832,64,64","assets/floor.png":"generated/spritesheets/sheet4.png|crop:1024,1152,128,128","assets/further-side.png":"generated/spritesheets/sheet4.png|crop:768,768,128,128","assets/further-wall.png":"generated/spritesheets/sheet4.png|crop:0,0,128,128","assets/gangsta-check-cards.png":"generated/spritesheets/sheet4.png|crop:640,640,128,128","assets/gangsta-fighter.png":"generated/spritesheets/sheet2.png|crop:512,512,256,256","assets/gate-open.png":"generated/spritesheets/sheet0.png|crop:512,1280,192,192","assets/gate.png":"generated/spritesheets/sheet2.png|crop:1216,1408,64,64","assets/grab-access-card.png":"generated/spritesheets/sheet3.png|crop:0,576,128,128","assets/grab-apple.png":"generated/spritesheets/sheet3.png|crop:0,704,128,128","assets/grab-bottle-2.png":"generated/spritesheets/sheet3.png|crop:0,832,128,128","assets/grab-bottle.png":"generated/spritesheets/sheet3.png|crop:0,960,128,128","assets/grab-cake.png":"generated/spritesheets/sheet3.png|crop:0,1088,128,128","assets/grab-coin.png":"generated/spritesheets/sheet3.png|crop:0,1216,128,128","assets/grab-compass.png":"generated/spritesheets/sheet3.png|crop:0,320,128,128","assets/grab-fork.png":"generated/spritesheets/sheet3.png|crop:0,1344,128,128","assets/grab-gun.png":"generated/spritesheets/sheet4.png|crop:128,128,128,128","assets/grab-key.png":"generated/spritesheets/sheet4.png|crop:256,256,128,128","assets/grab-lighter.png":"generated/spritesheets/sheet4.png|crop:128,0,128,128","assets/grab-photo-shot.png":"generated/spritesheets/sheet4.png|crop:256,128,128,128","assets/grab-photo.png":"generated/spritesheets/sheet4.png|crop:384,256,128,128","assets/grab-playing-card.png":"generated/spritesheets/sheet4.png|crop:384,384,128,128","assets/grab-rope.png":"generated/spritesheets/sheet4.png|crop:512,384,128,128","assets/grab-tickets.png":"generated/spritesheets/sheet4.png|crop:512,512,128,128","assets/grab-warp-drive.png":"generated/spritesheets/sheet3.png|crop:1344,0,128,128","assets/grab-water-bottle.png":"generated/spritesheets/sheet4.png|crop:640,512,128,128","assets/grab-yupa-bottle.png":"generated/spritesheets/sheet0.png|crop:320,960,192,192","assets/guard.png":"generated/spritesheets/sheet1.png|crop:0,384,256,256","assets/guards-attack.png":"generated/spritesheets/sheet4.png|crop:1024,896,128,128","assets/guards-laughing.png":"generated/spritesheets/sheet0.png|crop:1344,512,128,192","assets/gun.png":"generated/spritesheets/sheet2.png|crop:1216,1344,64,64","assets/hitler.png":"generated/spritesheets/sheet1.png|crop:256,1408,64,64","assets/hitman-argues.png":"generated/spritesheets/sheet0.png|crop:320,768,192,192","assets/hitman-beard-walk.png":"generated/spritesheets/sheet0.png|crop:832,960,96,192","assets/hitman-cake-face.png":"generated/spritesheets/sheet0.png|crop:704,1280,128,192","assets/hitman-from-above.png":"generated/spritesheets/sheet4.png|crop:1024,768,128,128","assets/hitman-laugh.png":"generated/spritesheets/sheet4.png|crop:1152,896,128,128","assets/hitman-tavern-closeup.png":"generated/spritesheets/sheet2.png|crop:1152,256,128,192","assets/hitman-walk.png":"generated/spritesheets/sheet2.png|crop:640,0,96,192","assets/hold-gun.png":"generated/spritesheets/sheet1.png|crop:1408,0,64,128","assets/hole-bottom.png":"generated/spritesheets/sheet1.png|crop:256,1344,64,64","assets/hole-in-ceiling-back.png":"generated/spritesheets/sheet1.png|crop:256,1280,64,64","assets/hole-in-ceiling-hole.png":"generated/spritesheets/sheet1.png|crop:256,1216,64,64","assets/hole-in-ceiling-rope.png":"generated/spritesheets/sheet1.png|crop:1408,192,64,64","assets/hole.png":"generated/spritesheets/sheet4.png|crop:1152,640,128,128","assets/hook-punch.png":"generated/spritesheets/sheet1.png|crop:0,640,256,256","assets/hottub-close-up.png":"generated/spritesheets/sheet0.png|crop:960,512,384,448","assets/hottub-water-wave.png":"generated/spritesheets/sheet1.png|crop:256,1088,64,128","assets/hottub.png":"generated/spritesheets/sheet1.png|crop:256,960,64,128","assets/human-hottub.png":"generated/spritesheets/sheet1.png|crop:256,384,64,128","assets/human-no-hand.png":"generated/spritesheets/sheet4.png|crop:1280,640,128,128","assets/human-wah.png":"generated/spritesheets/sheet2.png|crop:1280,1280,192,192","assets/inside-tavern-phone.png":"generated/spritesheets/sheet1.png|crop:320,0,320,384","assets/inside-tavern.png":"generated/spritesheets/sheet0.png|crop:1216,0,256,384","assets/jail-360.png":"generated/spritesheets/sheet2.png|crop:256,512,192,192","assets/jail.png":"generated/spritesheets/sheet4.png|crop:768,1152,128,128","assets/key-count.png":"generated/spritesheets/sheet1.png|crop:256,832,64,64","assets/lab-door.png":"generated/spritesheets/sheet1.png|crop:256,768,64,64","assets/lab-entrance.png":"generated/spritesheets/sheet2.png|crop:1280,256,192,192","assets/lab-exit.png":"generated/spritesheets/sheet1.png|crop:256,640,64,64","assets/lab-monster-battle.png":"generated/spritesheets/sheet3.png|crop:192,192,192,192","assets/lab-monster-through-hole.png":"generated/spritesheets/sheet0.png|crop:320,512,192,256","assets/lab-monster-wake.png":"generated/spritesheets/sheet1.png|crop:0,896,256,256","assets/lab-monster.png":"generated/spritesheets/sheet1.png|crop:256,576,64,64","assets/lab.png":"generated/spritesheets/sheet0.png|crop:1344,960,128,192","assets/ladder.png":"generated/spritesheets/sheet1.png|crop:256,512,64,64","assets/landscape.png":"generated/spritesheets/sheet2.png|crop:960,1408,64,64","assets/left-guard.png":"generated/spritesheets/sheet2.png|crop:448,0,192,192","assets/level-up.png":"generated/spritesheets/sheet3.png|crop:0,192,128,128","assets/light.png":"generated/spritesheets/sheet2.png|crop:1408,512,64,64","assets/lighter.png":"generated/spritesheets/sheet2.png|crop:736,0,192,192","assets/lock-back.png":"generated/spritesheets/sheet2.png|crop:960,1280,64,64","assets/lock-block.png":"generated/spritesheets/sheet2.png|crop:1408,768,64,64","assets/lock-digit.png":"generated/spritesheets/sheet2.png|crop:0,1216,192,192","assets/lock.png":"generated/spritesheets/sheet2.png|crop:1216,1280,64,64","assets/locker-door.png":"generated/spritesheets/sheet3.png|crop:960,1344,128,128","assets/locker-room.png":"generated/spritesheets/sheet2.png|crop:640,1408,64,64","assets/look-right-left.png":"generated/spritesheets/sheet1.png|crop:960,768,256,320","assets/machine.png":"generated/spritesheets/sheet0.png|crop:832,1152,128,128","assets/map.png":"generated/spritesheets/sheet3.png|crop:1344,1344,128,128","assets/maze-rotation-background-solid.png":"generated/spritesheets/sheet2.png|crop:704,1024,64,64","assets/maze-rotation-background.png":"generated/spritesheets/sheet2.png|crop:1216,448,64,64","assets/maze-rotation-corner-solid.png":"generated/spritesheets/sheet2.png|crop:1280,448,64,64","assets/maze-rotation-corner.png":"generated/spritesheets/sheet2.png|crop:448,576,64,64","assets/maze-rotation-walls-solid.png":"generated/spritesheets/sheet2.png|crop:448,512,64,64","assets/maze-rotation-walls.png":"generated/spritesheets/sheet2.png|crop:1408,448,64,64","assets/menu-bag.png":"generated/spritesheets/sheet1.png|crop:1280,256,128,128","assets/menu-disk.png":"generated/spritesheets/sheet1.png|crop:1024,256,128,128","assets/menu-options.png":"generated/spritesheets/sheet1.png|crop:896,256,128,128","assets/menu-out.png":"generated/spritesheets/sheet1.png|crop:448,1344,128,128","assets/menu-profile.png":"generated/spritesheets/sheet0.png|crop:896,384,128,128","assets/menu-sound-off.png":"generated/spritesheets/sheet1.png|crop:320,1344,128,128","assets/menu-sound-on.png":"generated/spritesheets/sheet0.png|crop:1344,1152,128,128","assets/missing-hand-punch.png":"generated/spritesheets/sheet1.png|crop:1152,0,256,256","assets/money-shot.png":"generated/spritesheets/sheet0.png|crop:1344,704,128,128","assets/monster-planet.png":"generated/spritesheets/sheet2.png|crop:0,1024,192,192","assets/monster.png":"generated/spritesheets/sheet1.png|crop:896,0,256,256","assets/moon-base-guard.png":"generated/spritesheets/sheet0.png|crop:1344,384,64,128","assets/moon-base.png":"generated/spritesheets/sheet2.png|crop:1344,448,64,64","assets/mountains.png":"generated/spritesheets/sheet0.png|crop:1280,384,64,128","assets/multi-arrows.png":"generated/spritesheets/sheet2.png|crop:1152,448,64,32","assets/next-scene.png":"generated/spritesheets/sheet2.png|crop:704,1408,64,64","assets/no-hand.png":"generated/spritesheets/sheet2.png|crop:704,1344,64,64","assets/operation-room.png":"generated/spritesheets/sheet3.png|crop:1216,768,128,192","assets/origin-story.png":"generated/spritesheets/sheet0.png|crop:1088,1344,128,128","assets/outdoor.png":"generated/spritesheets/sheet1.png|crop:128,1408,64,64","assets/outside-bg.png":"generated/spritesheets/sheet2.png|crop:704,1280,64,64","assets/outside-carnage.png":"generated/spritesheets/sheet2.png|crop:768,512,192,256","assets/outside.png":"generated/spritesheets/sheet2.png|crop:256,0,192,256","assets/panic-exit-background.png":"generated/spritesheets/sheet3.png|crop:1088,768,128,192","assets/panic-exit-runner-1.png":"generated/spritesheets/sheet3.png|crop:1280,960,128,192","assets/panic-exit-runner-2.png":"generated/spritesheets/sheet3.png|crop:1344,1152,128,192","assets/panic-exit-runner-3.png":"generated/spritesheets/sheet3.png|crop:1152,960,128,192","assets/panic-exit-runner-4.png":"generated/spritesheets/sheet3.png|crop:960,768,128,192","assets/panic-exit-yupa.png":"generated/spritesheets/sheet3.png|crop:1344,768,128,192","assets/pedro.png":"generated/spritesheets/sheet3.png|crop:192,1152,128,128","assets/phone-split.png":"generated/spritesheets/sheet2.png|crop:512,1216,192,192","assets/photo.png":"generated/spritesheets/sheet2.png|crop:0,640,192,192","assets/planet-items.png":"generated/spritesheets/sheet0.png|crop:0,0,512,512","assets/poor-hitman-back.png":"generated/spritesheets/sheet2.png|crop:704,1216,64,64","assets/poor-hitman-guard.png":"generated/spritesheets/sheet3.png|crop:192,1280,128,128","assets/poor-hitman.png":"generated/spritesheets/sheet3.png|crop:768,192,128,128","assets/posters.png":"generated/spritesheets/sheet2.png|crop:704,1152,64,64","assets/profile-notification.png":"generated/spritesheets/sheet3.png|crop:320,0,128,128","assets/punch-hit.png":"generated/spritesheets/sheet1.png|crop:640,1088,256,256","assets/punch.png":"generated/spritesheets/sheet1.png|crop:960,1088,256,256","assets/razor.png":"generated/spritesheets/sheet1.png|crop:896,1088,64,128","assets/right-guard.png":"generated/spritesheets/sheet2.png|crop:0,448,192,192","assets/robot-dial.png":"generated/spritesheets/sheet2.png|crop:1024,768,192,256","assets/rope-ceiling.png":"generated/spritesheets/sheet2.png|crop:704,1088,64,64","assets/runner.png":"generated/spritesheets/sheet3.png|crop:1152,192,128,128","assets/sarlie-hospital.png":"generated/spritesheets/sheet2.png|crop:512,1408,128,64","assets/sarlie-planet-bg.png":"generated/spritesheets/sheet2.png|crop:1408,704,64,64","assets/sarlie-planet-world-overlay.png":"generated/spritesheets/sheet1.png|crop:0,1408,128,64","assets/sarlie-planet-world.png":"generated/spritesheets/sheet1.png|crop:960,704,128,64","assets/sarlie-planet.png":"generated/spritesheets/sheet3.png|crop:896,192,128,128","assets/sarlie-shop.png":"generated/spritesheets/sheet1.png|crop:1216,1408,128,64","assets/scan-card.png":"generated/spritesheets/sheet0.png|crop:448,1344,64,128","assets/screen-fracture.png":"generated/spritesheets/sheet2.png|crop:1408,640,64,64","assets/shifty-eyes.png":"generated/spritesheets/sheet3.png|crop:192,384,128,128","assets/shoot-out.png":"generated/spritesheets/sheet0.png|crop:512,0,384,512","assets/shoots.png":"generated/spritesheets/sheet1.png|crop:768,1344,128,128","assets/shop-door.png":"generated/spritesheets/sheet0.png|crop:1344,1408,128,64","assets/shop-monster.png":"generated/spritesheets/sheet2.png|crop:1408,576,64,64","assets/shop.png":"generated/spritesheets/sheet3.png|crop:768,576,128,192","assets/shopkeepa.png":"generated/spritesheets/sheet0.png|crop:960,960,384,384","assets/shuffle-cards.png":"generated/spritesheets/sheet2.png|crop:928,0,192,192","assets/side-buttons.png":"generated/spritesheets/sheet3.png|crop:1280,192,128,128","assets/side-far-far.png":"generated/spritesheets/sheet3.png|crop:192,512,128,128","assets/side-far-map.png":"generated/spritesheets/sheet3.png|crop:192,640,128,128","assets/side-further-map.png":"generated/spritesheets/sheet3.png|crop:192,768,128,128","assets/side-map.png":"generated/spritesheets/sheet3.png|crop:192,896,128,128","assets/skeleton-rope.png":"generated/spritesheets/sheet1.png|crop:576,768,64,128","assets/skeleton.png":"generated/spritesheets/sheet1.png|crop:192,1408,64,64","assets/slime.png":"generated/spritesheets/sheet2.png|crop:1152,512,256,256","assets/slots.png":"generated/spritesheets/sheet1.png|crop:0,1152,256,256","assets/spaceship-stairs.png":"generated/spritesheets/sheet2.png|crop:512,768,256,256","assets/spaceship.png":"generated/spritesheets/sheet0.png|crop:1408,384,64,128","assets/speech-out.png":"generated/spritesheets/sheet0.png|crop:1344,1280,128,128","assets/stats.png":"generated/spritesheets/sheet0.png|crop:1024,384,128,128","assets/stranger-reveal.png":"generated/spritesheets/sheet2.png|crop:768,1024,256,256","assets/super-punch.png":"generated/spritesheets/sheet2.png|crop:1024,1024,256,256","assets/switcharoo.png":"generated/spritesheets/sheet1.png|crop:768,256,128,128","assets/tammy-slow.png":"generated/spritesheets/sheet1.png|crop:1152,256,128,128","assets/tavern-entrance.png":"generated/spritesheets/sheet1.png|crop:1216,768,256,320","assets/tavern-gangsta-card-game.png":"generated/spritesheets/sheet1.png|crop:0,0,320,384","assets/tavern-gangsta-shootout.png":"generated/spritesheets/sheet1.png|crop:640,384,320,384","assets/tavern-gangsta.png":"generated/spritesheets/sheet0.png|crop:0,512,320,320","assets/the-hole.png":"generated/spritesheets/sheet1.png|crop:576,960,64,64","assets/tile-hole.png":"generated/spritesheets/sheet1.png|crop:576,896,64,64","assets/tile.png":"generated/spritesheets/sheet2.png|crop:0,256,192,192","assets/toilet-monster.png":"generated/spritesheets/sheet2.png|crop:768,768,256,256","assets/toilet-zoom-background.png":"generated/spritesheets/sheet1.png|crop:896,1408,64,64","assets/toilet-zoom.png":"generated/spritesheets/sheet1.png|crop:576,1024,64,64","assets/toilets.png":"generated/spritesheets/sheet1.png|crop:576,1088,64,64","assets/top-5.png":"generated/spritesheets/sheet2.png|crop:768,256,192,256","assets/touch-arrows.png":"generated/spritesheets/sheet3.png|crop:768,1344,128,96","assets/touch-punch.png":"generated/spritesheets/sheet1.png|crop:576,1344,64,64","assets/treasure-chest.png":"generated/spritesheets/sheet3.png|crop:384,1152,128,128","assets/vending-machine-apple.png":"generated/spritesheets/sheet3.png|crop:576,384,128,192","assets/vending-machine-bottle.png":"generated/spritesheets/sheet3.png|crop:384,192,128,192","assets/vending-machine-close.png":"generated/spritesheets/sheet1.png|crop:576,1152,64,64","assets/vending-machine-coin-return.png":"generated/spritesheets/sheet0.png|crop:1280,1344,64,128","assets/vending-machine-coin-slot.png":"generated/spritesheets/sheet0.png|crop:1152,384,128,128","assets/vending-machine-glass.png":"generated/spritesheets/sheet1.png|crop:896,1344,64,64","assets/vending-machine.png":"generated/spritesheets/sheet1.png|crop:896,1280,64,64","assets/waiter.png":"generated/spritesheets/sheet3.png|crop:192,0,128,192","assets/we-did-it-yupa.png":"generated/spritesheets/sheet1.png|crop:1216,384,256,320","assets/wood.png":"generated/spritesheets/sheet2.png|crop:256,1280,192,192","assets/writing.png":"generated/spritesheets/sheet2.png|crop:256,1088,192,192","assets/yupa-back-walk.png":"generated/spritesheets/sheet3.png|crop:448,0,128,128","assets/yupa-dance.png":"generated/spritesheets/sheet2.png|crop:256,256,256,256","assets/yupa-dry-close.png":"generated/spritesheets/sheet1.png|crop:1408,1408,64,64","assets/yupa-dry.png":"generated/spritesheets/sheet4.png|crop:1280,768,128,128","assets/yupa-grab-photo-alone.png":"generated/spritesheets/sheet2.png|crop:1248,0,128,192","assets/yupa-grab-photo.png":"generated/spritesheets/sheet2.png|crop:1120,0,128,192","assets/yupa-hitman-at-gunpoint.png":"generated/spritesheets/sheet0.png|crop:0,1152,320,320","assets/yupa-hottub.png":"generated/spritesheets/sheet1.png|crop:576,1216,64,128","assets/yupa-in-lab.png":"generated/spritesheets/sheet1.png|crop:320,384,320,384","assets/yupa-in-shop.png":"generated/spritesheets/sheet2.png|crop:960,512,192,256","assets/yupa-shake.png":"generated/spritesheets/sheet2.png|crop:960,256,192,256","assets/yupa-walk.png":"generated/spritesheets/sheet1.png|crop:1408,704,48,64","assets/yupa-woopsie.png":"generated/spritesheets/sheet4.png|crop:896,640,128,128","assets/yupa-zoom.png":"generated/spritesheets/sheet2.png|crop:256,896,192,192","assets/zoom-arcade.png":"generated/spritesheets/sheet1.png|crop:1216,704,64,64","assets/zoom-dick-mad.png":"generated/spritesheets/sheet4.png|crop:768,1024,128,128","assets/zoom-dick.png":"generated/spritesheets/sheet4.png|crop:1024,640,128,128","assets/zoom-guard-alert.png":"generated/spritesheets/sheet1.png|crop:896,1216,64,64","assets/zoom-guards.png":"generated/spritesheets/sheet3.png|crop:0,448,128,128","assets/zoom-shop-monster.png":"generated/spritesheets/sheet4.png|crop:896,1280,128,128","assets/zoom-tavern-door-lady.png":"generated/spritesheets/sheet4.png|crop:1280,1152,128,128","assets/zoom-tavern-door-robot.png":"generated/spritesheets/sheet2.png|crop:256,704,192,192","assets/zoom-tavern-door-smoke.png":"generated/spritesheets/sheet4.png|crop:1024,1024,128,128","assets/zoom-tavern-door.png":"generated/spritesheets/sheet1.png|crop:1344,1408,64,64","assets/zoom-yupa-alone.png":"generated/spritesheets/sheet2.png|crop:512,1024,192,192"};gameConfig.scenes.push({name:"load-screen",startScene:!0,onScene:game=>{game.waitCursor=!0;game.sceneData.startTime=game.now;game.sceneData.estimate=3600000},onSceneRefresh:game=>{const progress=game.currentScene.getProgress(game);if(progress<1&&game.now>game.sceneData.startTime){const progressSpeed=progress/(game.now-game.sceneData.startTime);const estimate=(1-progress)/progressSpeed;if(Math.abs(game.sceneData.estimate-estimate)>10000||estimate<game.sceneData.estimate){}}else if(game.now>game.sceneData.startTime&&game.waitCursor){game.waitCursor=!1;game.countLoadError=0;console.log(`${game.now / 1000} sec.`)}},getProgress:game=>{const numAssetsLoaded=game.countAssets(!0);const totalAssets=game.countAssets();return(numAssetsLoaded)/(totalAssets)},sprites:[{custom:(game,sprite,ctx)=>{ctx.fillStyle="#000000";ctx.fillRect(0,0,64,64)},hidden:game=>game.currentScene.getProgress(game)<1,onClick:game=>{if(!game.sceneData.gameStarted){game.playSound(SOUNDS.RANDOM);game.sceneData.gameStarted=game.now;game.delayAction(game=>{game.gotoScene("start-screen");game.save("clear")},1000)}}},{custom:(game,sprite,ctx)=>{const progress=game.currentScene.getProgress(game);ctx.clearRect(0,0,64,64);ctx.globalAlpha=.08*progress;for(let i=0;i<10;i++){game.displayTextLine(ctx,{msg:"dobuki studio game",x:1,y:2+i*6,})}
ctx.globalAlpha=1;if(progress<1){ctx.fillStyle="#003377";ctx.fillRect(5,35,51,2);ctx.fillStyle="#999999";ctx.fillRect(5,35,1+progress*50,2);game.displayTextLine(ctx,{msg:"Loading~."+(game.now%1500<500?"":game.now%1500<1000?".":".."),x:15,y:26,});if(game.sceneData.estimate<3600000&&Math.floor(game.sceneData.estimate/1000)>0){game.displayTextLine(ctx,{msg:Math.floor(game.sceneData.estimate/1000)+"~ sec",x:18,y:40})}
const numAssetsLoaded=game.countAssets(!0);const totalAssets=game.countAssets();game.displayTextLine(ctx,{msg:`${numAssetsLoaded} / ${totalAssets}`,x:1,y:52,alpha:.2,noTranslate:!0});if(game.sceneData.lastFileLoaded){game.displayTextLine(ctx,{msg:game.sceneData.lastFileLoaded.split(".")[0],x:1,y:58,alpha:.2,noTranslate:!0})}}},},{hidden:game=>{const numScenesLoaded=game.config.scenes.length;const totalScenes=game.getSceneCount();if(numScenesLoaded>=totalScenes){const progress=game.currentScene.getProgress(game);return progress<1}
return!0},custom:(game,sprite,ctx)=>{ctx.globalAlpha=1;game.displayTextLine(ctx,{msg:"Where in Space",x:8,y:15});game.displayTextLine(ctx,{msg:"is Baby Hitler?",x:9,y:22});ctx.globalAlpha=.2;game.displayTextLine(ctx,{msg:"a game by",x:17,y:40,});game.displayTextLine(ctx,{msg:"Jack Le Hamster",x:5,y:47,});ctx.globalAlpha=1},},{custom:(game,sprite,ctx)=>{const fade=Math.min(1,(game.now-game.sceneData.gameStarted)/1000);const imageData=ctx.getImageData(0,0,64,64);for(let i=0;i<imageData.data.length;i+=4){if(Math.random()<fade){imageData.data[i]=255;imageData.data[i+1]=255;imageData.data[i+2]=255;imageData.data[i+3]=255}}
ctx.putImageData(imageData,0,0)},hidden:game=>!game.sceneData.gameStarted,},{src:game=>game.sceneData.lastFileLoaded,scale:1/16,offsetX:60,offsetY:52,alpha:.5,hidden:game=>game.currentScene.getProgress(game)>=1||!game.sceneData.lastFileLoaded||game.sceneData.lastFileLoaded.indexOf("assets/")!==0,},],});function processTranslation(){const request=new XMLHttpRequest();request.open("GET",'translation.json');request.addEventListener("load",e=>{if(request.status===200){const obj=JSON.parse(request.responseText);const now=new Date();for(let o in obj){const{md5,text,timestamp}=obj[o];if(timestamp){const age=now-new Date(timestamp);game.processText(obj[o].text,!0)}}
if(game)
game.allowTranslation=!0}});if(request.overrideMimeType){request.overrideMimeType("application/json")}
request.send()};const noises=document.querySelectorAll(".noise");const scanlines=document.querySelectorAll(".scanline");const screenCopies=document.querySelectorAll(".screen-copy");function toggleScanlines(){const check=document.querySelector("#scanlines");check.click();setScanline(check.checked)}
function setScanline(checked){const display=checked?"":"none";noises.forEach(noise=>{noise.style.display=display});scanlines.forEach(scanline=>{scanline.style.display=display});screenCopies.forEach(screenCopy=>{screenCopy.style.display=display})}
function copyFromTo(contextSrc,contextDst){const{width,height}=contextDst.canvas;contextDst.clearRect(0,0,width,height);contextDst.drawImage(contextSrc.canvas,0,0,width,height)}
function startGame(){const ctx=document.getElementById("canvas").getContext("2d");const ctx2=document.getElementById("canvas2").getContext("2d",{alpha:!1});const touchCtx=document.getElementById("touch-canvas").getContext("2d");const touchCtx2=document.getElementById("touch-canvas2").getContext("2d",{alpha:!1});game.injectImage(ASSETS.ALPHABET_DARK,document.getElementById("alphabet"));document.getElementById("alphabet").style.display="none";game.playGame();updateSaves();game.refreshCallback=()=>{copyFromTo(ctx,ctx2);copyFromTo(touchCtx,touchCtx2)};processTranslation()}
const game=Game.start(gameConfig);if(DEMO){document.getElementById("saves").style.display="none"}
function clearSaves(){localStorage.removeItem("saves");updateSaves()}
function save(){const saves=game.getSaveList();let index=0;while(saves[index]){index++}
game.save(index);updateSaves()}
function updateSaves(){const saveBox=document.getElementById("savebox");saveBox.innerHTML="";const saves=game.getSaveList();for(let name in saves){addSaveBox(name)}}
function addSaveBox(name){const saveBox=document.getElementById("savebox");const button=saveBox.appendChild(document.createElement("button"));button.innerText=name;button.addEventListener("click",()=>{game.playTheme(null);game.load(name);game.gotoScene(game.sceneIndex,game.door);if(game.data.theme){game.playTheme(game.data.theme.song,game.data.theme)}
game.showTip(`GAME ${name} LOADED.`,null,null,{removeLock:!0})})}
addEventListener("focus",()=>{if(game&&document.getElementById("pauseexit").checked)
game.resume()});addEventListener("blur",()=>{if(game&&document.getElementById("pauseexit").checked)
game.pause()});document.addEventListener("visibilitychange",()=>{if(game&&document.getElementById("pauseexit").checked){if(document.visibilityState==="hidden"){game.pause()}else{game.resume()}}});const mainNoiseCanvas=document.getElementById("noise");const noiseCanvases=[];for(let i=0;i<10;i++){const noiseCanvas=document.createElement("canvas");noiseCanvas.width=mainNoiseCanvas.width;noiseCanvas.height=mainNoiseCanvas.height;const noiseCtx=noiseCanvas.getContext("2d");const noiseData=noiseCtx.getImageData(0,0,noiseCtx.canvas.width,noiseCtx.canvas.height);const{data}=noiseData;for(let n=0;n<data.length;n+=4){data[n+3]=Math.random()<.6+(1-i/10*i/10)*.3?0:40}
noiseCtx.putImageData(noiseData,0,0);noiseCanvases.push(noiseCanvas)}
const canvasOverlays=document.querySelectorAll(".canvas-overlay").forEach(canvas=>{const ctx=canvas.getContext("2d")
ctx.msImageSmoothingEnabled=!1;ctx.mozImageSmoothingEnabled=!1;ctx.webkitImageSmoothingEnabled=!1;ctx.imageSmoothingEnabled=!1});function startNoiseStatic(){const noiseContexes=Array.prototype.slice.call(document.querySelectorAll(".noise")).map(canvas=>canvas.getContext("2d"));let time=0;function noise(dt){time+=dt;if(time>100){noiseContexes.forEach(noiseCtx=>{noiseCtx.clearRect(0,0,noiseCtx.canvas.width,noiseCtx.canvas.height);noiseCtx.drawImage(noiseCanvases[Math.floor(Math.random()*noiseCanvases.length)],0,0)});time-=100}
requestAnimationFrame(noise)}
requestAnimationFrame(noise)}
startNoiseStatic();screen.orientation.lock('portrait').catch(function(error){})